<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Flask学习 | 三月三</title><meta name="description" content="#Flask概述 Flask 是一个微型的 Python 开发的 Web框架，基于Werkzeug WSGI工具箱和Jinja2 模板引擎。 Flask使用BSD授权。 Flask也被称为“microframework”，因为它使用简单的核心，用extension增加其他功能。Flask没有默认使用的数据库、窗体验证工具。然而，Flask保留了扩增的弹性，可以用Flask-extension加入这"><meta name="keywords" content="Python,Flask"><meta name="author" content="三月三"><meta name="copyright" content="三月三"><meta name="format-detection" content="telephone=no"><link rel="shortcut icon" href="/img/favicon.png"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="dns-prefetch" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="https://hm.baidu.com"/><link rel="dns-prefetch" href="https://hm.baidu.com"/><link rel="preconnect" href="https://fonts.googleapis.com" crossorigin="crossorigin"/><link rel="dns-prefetch" href="https://fonts.googleapis.com"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="dns-prefetch" href="//busuanzi.ibruce.info"/><meta name="twitter:card" content="summary"><meta name="twitter:title" content="Flask学习"><meta name="twitter:description" content="#Flask概述 Flask 是一个微型的 Python 开发的 Web框架，基于Werkzeug WSGI工具箱和Jinja2 模板引擎。 Flask使用BSD授权。 Flask也被称为“microframework”，因为它使用简单的核心，用extension增加其他功能。Flask没有默认使用的数据库、窗体验证工具。然而，Flask保留了扩增的弹性，可以用Flask-extension加入这"><meta name="twitter:image" content="http://cdn.panyucable.cn/zysheep/flask_cover.jpg"><meta property="og:type" content="article"><meta property="og:title" content="Flask学习"><meta property="og:url" content="https://zysheep.cn/2020/04/06/Python/Flask%E5%AD%A6%E4%B9%A0/"><meta property="og:site_name" content="三月三"><meta property="og:description" content="#Flask概述 Flask 是一个微型的 Python 开发的 Web框架，基于Werkzeug WSGI工具箱和Jinja2 模板引擎。 Flask使用BSD授权。 Flask也被称为“microframework”，因为它使用简单的核心，用extension增加其他功能。Flask没有默认使用的数据库、窗体验证工具。然而，Flask保留了扩增的弹性，可以用Flask-extension加入这"><meta property="og:image" content="http://cdn.panyucable.cn/zysheep/flask_cover.jpg"><meta property="article:published_time" content="2020-04-06T04:30:45.000Z"><meta property="article:modified_time" content="2020-08-05T10:07:33.355Z"><script src="https://cdn.jsdelivr.net/npm/js-cookie/dist/js.cookie.min.js"></script><script>var autoChangeMode = '1'
var t = Cookies.get("theme")
if (autoChangeMode == '1'){
  var isDarkMode = window.matchMedia("(prefers-color-scheme: dark)").matches
  var isLightMode = window.matchMedia("(prefers-color-scheme: light)").matches
  var isNotSpecified = window.matchMedia("(prefers-color-scheme: no-preference)").matches
  var hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified

  if (t === undefined){
    if (isLightMode) activateLightMode()
    else if (isDarkMode) activateDarkMode()
    else if (isNotSpecified || hasNoSupport){
      console.log('You specified no preference for a color scheme or your browser does not support it. I Schedule dark mode during night time.')
      var now = new Date()
      var hour = now.getHours()
      var isNight = hour < 6 || hour >= 18
      isNight ? activateDarkMode() : activateLightMode()
  }
  } else if (t == 'light') activateLightMode()
  else activateDarkMode()

} else if (autoChangeMode == '2'){
  now = new Date();
  hour = now.getHours();
  isNight = hour < 6 || hour >= 18
  if(t === undefined) isNight? activateDarkMode() : activateLightMode()
  else if (t === 'light') activateLightMode()
  else activateDarkMode() 
} else {
  if ( t == 'dark' ) activateDarkMode()
  else if ( t == 'light') activateLightMode()
}

function activateDarkMode(){
  document.documentElement.setAttribute('data-theme', 'dark')
  if (document.querySelector('meta[name="theme-color"]') !== null){
    document.querySelector('meta[name="theme-color"]').setAttribute('content','#000')
  }
}
function activateLightMode(){
  document.documentElement.setAttribute('data-theme', 'light')
  if (document.querySelector('meta[name="theme-color"]') !== null){
  document.querySelector('meta[name="theme-color"]').setAttribute('content','#fff')
  }
}</script><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@latest/css/font-awesome.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.css"><link rel="canonical" href="https://zysheep.cn/2020/04/06/Python/Flask%E5%AD%A6%E4%B9%A0/"><link rel="prev" title="关于我" href="https://zysheep.cn/2020/05/20/%E5%85%B3%E4%BA%8E%E6%88%91/"><link rel="next" title="虚拟环境管理" href="https://zysheep.cn/2020/04/04/Python/%E8%99%9A%E6%8B%9F%E7%8E%AF%E5%A2%83%E7%AE%A1%E7%90%86/"><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/gitalk/dist/gitalk.min.css"><script src="https://cdn.jsdelivr.net/npm/gitalk@latest/dist/gitalk.min.js"></script><script src="https://cdn.jsdelivr.net/npm/blueimp-md5/js/md5.min.js"></script><script>var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?7f671f0f6d996680d21d5c32a23a9313";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Titillium+Web"><script>var GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: {"defaultEncoding":2,"translateDelay":0,"cookieDomain":"https://zysheep.github.io/","msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"簡"},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  bookmark: {
    message_prev: '按',
    message_next: '键将本页加入书签'
  },
  runtime_unit: '天',
  runtime: true,
  copyright: undefined,
  ClickShowText: undefined,
  medium_zoom: true,
  fancybox: false,
  Snackbar: {"bookmark":{"message_prev":"按","message_next":"键将本页加入书签"},"chs_to_cht":"你已切换为繁体","cht_to_chs":"你已切换为简体","day_to_night":"你已切换为深色模式","night_to_day":"你已切换为浅色模式","bgLight":"#49b1f5","bgDark":"#2d3035","position":"bottom-left"},
  baiduPush: false,
  highlightCopy: true,
  highlightLang: true,
  highlightShrink: 'false',
  isFontAwesomeV5: false,
  isPhotoFigcaption: true,
  islazyload: false,
  isanchor: false
  
}</script><script>var GLOBAL_CONFIG_SITE = { 
  isPost: true,
  isHome: false,
  isSidebar: true  
  }</script><noscript><style>
#page-header {
  opacity: 1
}
.justified-gallery img{
  opacity: 1
}
</style></noscript><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/sviptzk/HexoStaticFile@master/Hexo/css/hideCategory.min.css"><meta name="generator" content="Hexo 4.2.1"></head><body><div id="loading-box"><div class="loading-left-bg"></div><div class="loading-right-bg"></div><div class="spinner-box"><div class="configure-border-1"><div class="configure-core"></div></div><div class="configure-border-2"><div class="configure-core"></div></div><div class="loading-word">加载中...</div></div></div><div id="mobile-sidebar"><div id="menu_mask"></div><div id="mobile-sidebar-menus"><div class="mobile_author_icon"><img class="avatar-img" src="https://cdn.jsdelivr.net/gh/zysheep/picgo-imgs/img41.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="mobile_post_data"><div class="mobile_data_item is-center"><div class="mobile_data_link"><a href="/archives/"><div class="headline">文章</div><div class="length_num">205</div></a></div></div><div class="mobile_data_item is-center">      <div class="mobile_data_link"><a href="/tags/"><div class="headline">标签</div><div class="length_num">46</div></a></div></div><div class="mobile_data_item is-center">     <div class="mobile_data_link"><a href="/categories/"><div class="headline">分类</div><div class="length_num">68</div></a></div></div></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> 主页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fa fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fa fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fa fa-heart"></i><span> 关于三月三</span></a></div><div class="menus_item"><a class="site-page"><i class="fa-fw fa fa-bug" aria-hidden="true"></i><span> 编程路线</span><i class="fa fa-chevron-down menus-expand" aria-hidden="true"></i></a><ul class="menus_item_child"><li><a class="site-page" href="/java/"><i class="fa-fw fa fa-coffee"></i><span> Java</span></a></li><li><a class="site-page" href="/python/"><i class="fa-fw fa fa-binoculars"></i><span> Python</span></a></li></ul></div><div class="menus_item"><a class="site-page"><i class="fa-fw fa fa-folder-open" aria-hidden="true"></i><span> 面试宝典</span><i class="fa fa-chevron-down menus-expand" aria-hidden="true"></i></a><ul class="menus_item_child"><li><a class="site-page" href="/interview/"><i class="fa-fw fa fa-file-text-o"></i><span> Java面试题</span></a></li></ul></div><div class="menus_item"><a class="site-page"><i class="fa-fw fa fa-list" aria-hidden="true"></i><span> 我的生活</span><i class="fa fa-chevron-down menus-expand" aria-hidden="true"></i></a><ul class="menus_item_child"><li><a class="site-page" href="/gallery/"><i class="fa-fw fa fa-picture-o"></i><span> Gallery</span></a></li></ul></div></div></div></div><i class="fa fa-arrow-right on" id="toggle-sidebar" aria-hidden="true">     </i><div id="sidebar"><div class="sidebar-toc"><div class="sidebar-toc__title">目录</div><div class="sidebar-toc__progress"><span class="progress-notice">你已经读了</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc__progress-bar">     </div></div><div class="sidebar-toc__content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#Flask-环境"><span class="toc-number">1.</span> <span class="toc-text">Flask 环境</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#为开发环境安装virtualenv"><span class="toc-number">1.1.</span> <span class="toc-text">为开发环境安装virtualenv</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Flask-路由"><span class="toc-number">2.</span> <span class="toc-text">Flask 路由</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Flask-变量规则"><span class="toc-number">3.</span> <span class="toc-text">Flask 变量规则</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Flask-变量规则-1"><span class="toc-number">3.1.</span> <span class="toc-text">Flask 变量规则</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Flask-URL构建"><span class="toc-number">4.</span> <span class="toc-text">Flask URL构建</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Flask-URL构建-1"><span class="toc-number">4.1.</span> <span class="toc-text">Flask URL构建</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Flask-Request对象"><span class="toc-number">5.</span> <span class="toc-text">Flask Request对象</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Flask-Response对象与模板"><span class="toc-number">6.</span> <span class="toc-text">Flask Response对象与模板</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Response对象"><span class="toc-number">6.1.</span> <span class="toc-text">Response对象</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#flask里组装过程"><span class="toc-number">6.1.1.</span> <span class="toc-text">flask里组装过程</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#模板"><span class="toc-number">6.2.</span> <span class="toc-text">模板</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#标签呈现‘Hello-World’"><span class="toc-number">6.2.1.</span> <span class="toc-text">标签呈现‘Hello World’</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#render-template"><span class="toc-number">6.2.2.</span> <span class="toc-text">render_template()</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#模板语法"><span class="toc-number">6.2.3.</span> <span class="toc-text">模板语法</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#过滤器"><span class="toc-number">6.3.</span> <span class="toc-text">过滤器</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#自定义过滤器"><span class="toc-number">6.4.</span> <span class="toc-text">自定义过滤器</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#模板代码的复用"><span class="toc-number">6.5.</span> <span class="toc-text">模板代码的复用</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#宏"><span class="toc-number">6.5.1.</span> <span class="toc-text">宏</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#使用"><span class="toc-number">6.5.1.1.</span> <span class="toc-text">使用</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#方式一"><span class="toc-number">6.5.1.1.1.</span> <span class="toc-text">方式一</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#方式二"><span class="toc-number">6.5.1.1.2.</span> <span class="toc-text">方式二</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#继承"><span class="toc-number">6.5.2.</span> <span class="toc-text">继承</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#父模板"><span class="toc-number">6.5.2.1.</span> <span class="toc-text">父模板</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#子模板"><span class="toc-number">6.5.2.2.</span> <span class="toc-text">子模板</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#包含"><span class="toc-number">6.5.3.</span> <span class="toc-text">包含</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Flask-静态文件"><span class="toc-number">7.</span> <span class="toc-text">Flask 静态文件</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Flask-蓝图"><span class="toc-number">8.</span> <span class="toc-text">Flask 蓝图</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#什么是蓝图"><span class="toc-number">8.1.</span> <span class="toc-text">什么是蓝图</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#蓝图的运行机制"><span class="toc-number">8.2.</span> <span class="toc-text">蓝图的运行机制</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#蓝图的使用"><span class="toc-number">8.3.</span> <span class="toc-text">蓝图的使用</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Flask-Script"><span class="toc-number">9.</span> <span class="toc-text">Flask-Script</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#安装"><span class="toc-number">9.1.</span> <span class="toc-text">安装</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#集成Flask-Script到falsk应用中"><span class="toc-number">9.2.</span> <span class="toc-text">集成Flask-Script到falsk应用中</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#自定义命令"><span class="toc-number">9.3.</span> <span class="toc-text">自定义命令</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#安装-Flask-Migrate"><span class="toc-number">9.3.1.</span> <span class="toc-text">安装 Flask-Migrate</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#实例"><span class="toc-number">9.3.2.</span> <span class="toc-text">实例</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#查看指令-manager-db-的可用选项"><span class="toc-number">9.3.3.</span> <span class="toc-text">查看指令 manager db 的可用选项</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#初始化-DB-Migrate"><span class="toc-number">9.3.4.</span> <span class="toc-text">初始化 DB Migrate</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#开始第一次跟踪"><span class="toc-number">9.3.5.</span> <span class="toc-text">开始第一次跟踪</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#根据记录文件生成数据库"><span class="toc-number">9.3.6.</span> <span class="toc-text">根据记录文件生成数据库</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#回滚到某历史版本"><span class="toc-number">9.3.7.</span> <span class="toc-text">回滚到某历史版本</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#总结"><span class="toc-number">9.4.</span> <span class="toc-text">总结</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#问题"><span class="toc-number">9.5.</span> <span class="toc-text">问题</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Flask-SQLAlchemy"><span class="toc-number">10.</span> <span class="toc-text">Flask SQLAlchemy</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Flask-SQLAlchemy-1"><span class="toc-number">10.1.</span> <span class="toc-text">Flask SQLAlchemy</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Flask-SQLAlchemy环境搭建"><span class="toc-number">10.2.</span> <span class="toc-text">Flask SQLAlchemy环境搭建</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#测试添加数据"><span class="toc-number">10.3.</span> <span class="toc-text">测试添加数据</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#CRUD方法"><span class="toc-number">10.4.</span> <span class="toc-text">CRUD方法</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#查询"><span class="toc-number">10.4.1.</span> <span class="toc-text">查询</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#添加"><span class="toc-number">10.4.2.</span> <span class="toc-text">添加</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#删除"><span class="toc-number">10.4.3.</span> <span class="toc-text">删除</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#逻辑删除"><span class="toc-number">10.4.3.1.</span> <span class="toc-text">逻辑删除</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#更新"><span class="toc-number">10.4.4.</span> <span class="toc-text">更新</span></a></li></ol></li></ol></li></ol></div></div></div><div id="body-wrap"><div class="post-bg" id="nav" style="background-image: url(http://cdn.panyucable.cn/zysheep/flask_top.jpg)"><div id="page-header"><span class="pull_left" id="blog_name"><a class="blog_title" id="site-name" href="/">三月三</a></span><span class="pull_right menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> 主页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fa fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fa fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fa fa-heart"></i><span> 关于三月三</span></a></div><div class="menus_item"><a class="site-page"><i class="fa-fw fa fa-bug" aria-hidden="true"></i><span> 编程路线</span><i class="fa fa-chevron-down menus-expand" aria-hidden="true"></i></a><ul class="menus_item_child"><li><a class="site-page" href="/java/"><i class="fa-fw fa fa-coffee"></i><span> Java</span></a></li><li><a class="site-page" href="/python/"><i class="fa-fw fa fa-binoculars"></i><span> Python</span></a></li></ul></div><div class="menus_item"><a class="site-page"><i class="fa-fw fa fa-folder-open" aria-hidden="true"></i><span> 面试宝典</span><i class="fa fa-chevron-down menus-expand" aria-hidden="true"></i></a><ul class="menus_item_child"><li><a class="site-page" href="/interview/"><i class="fa-fw fa fa-file-text-o"></i><span> Java面试题</span></a></li></ul></div><div class="menus_item"><a class="site-page"><i class="fa-fw fa fa-list" aria-hidden="true"></i><span> 我的生活</span><i class="fa fa-chevron-down menus-expand" aria-hidden="true"></i></a><ul class="menus_item_child"><li><a class="site-page" href="/gallery/"><i class="fa-fw fa fa-picture-o"></i><span> Gallery</span></a></li></ul></div></div><span class="toggle-menu close"><a class="site-page"><i class="fa fa-bars fa-fw" aria-hidden="true"></i></a></span></span></div><div id="post-info"><div id="post-title"><div class="posttitle">Flask学习</div></div><div id="post-meta"><div class="meta-firstline"><time class="post-meta__date"><span class="post-meta__date-created" title="发表于 2020-04-06 12:30:45"><i class="fa fa-calendar" aria-hidden="true"></i> 发表于 2020-04-06</span><span class="post-meta__separator">|</span><span class="post-meta__date-updated" title="更新于 2020-08-05 18:07:33"><i class="fa fa-history" aria-hidden="true"></i> 更新于 2020-08-05</span></time><span class="post-meta__categories"><span class="post-meta__separator">|</span><i class="fa fa-inbox post-meta__icon" aria-hidden="true"></i><a class="post-meta__categories" href="/categories/Python/">Python</a><i class="fa fa-angle-right post-meta__separator" aria-hidden="true"></i><i class="fa fa-inbox post-meta__icon" aria-hidden="true"></i><a class="post-meta__categories" href="/categories/Python/Flask/">Flask</a></span></div><div class="meta-secondline"> <span class="post-meta-wordcount"><i class="post-meta__icon fa fa-file-word-o" aria-hidden="true"></i><span>字数总计:</span><span class="word-count">10.4k</span><span class="post-meta__separator">|</span><i class="post-meta__icon fa fa-clock-o" aria-hidden="true"></i><span>阅读时长: 43 分钟</span></span></div><div class="meta-thirdline"><span class="post-meta-pv-cv"><span class="post-meta__separator">|</span><i class="fa fa-eye post-meta__icon" aria-hidden="true"> </i><span>阅读量:</span><span id="busuanzi_value_page_pv"></span></span><span class="post-meta-commentcount"><span class="post-meta__separator">|</span><i class="post-meta__icon fa fa-comment-o" aria-hidden="true"></i><span>评论数:</span><a href="/2020/04/06/Python/Flask%E5%AD%A6%E4%B9%A0/#post-comment"><span class="gitalk-comment-count comment-count"></span></a></span></div></div></div></div><main class="layout_post" id="content-inner"><article id="post"><div class="post-content" id="article-container"><p>#Flask概述</p>
<p>Flask 是一个微型的 <code>Python</code> 开发的 <code>Web</code>框架，基于<a href="https://www.oschina.net/p/werkzeug" target="_blank" rel="noopener">Werkzeug</a> WSGI工具箱和<a href="https://www.oschina.net/p/jinja" target="_blank" rel="noopener">Jinja2</a> 模板引擎。 Flask使用BSD授权。 Flask也被称为“microframework”，因为它使用简单的核心，用extension增加其他功能。Flask没有默认使用的数据库、窗体验证工具。然而，Flask保留了扩增的弹性，可以用<code>Flask-extension</code>加入这些功能：ORM、窗体验证工具、文件上传、各种开放式身份验证技术。</p>
<p>示例代码：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">from flask import Flask</span><br><span class="line">app &#x3D; Flask(__name__)</span><br><span class="line"></span><br><span class="line">@app.route(&quot;&#x2F;&quot;)</span><br><span class="line">def hello():</span><br><span class="line">    return &quot;Hello World!&quot;</span><br><span class="line"></span><br><span class="line">if __name__ &#x3D;&#x3D; &quot;__main__&quot;:</span><br><span class="line">    app.run()</span><br></pre></td></tr></table></figure>

<p>必须在项目中导入<code>Flask</code>模块。 <code>Flask类</code>的一个对象是我们的<strong>WSGI</strong>应用程序。</p>
<p>Flask构造函数使用<strong>当前模块（<code>__name __</code>）</strong>的名称作为参数。</p>
<p>Flask类的<strong>route()</strong>函数是一个装饰器，它告诉应用程序哪个URL应该调用相关的函数。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">app.route(rule, options)</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>rule</strong> 参数表示与该函数的URL绑定。</li>
<li><strong>options</strong> 是要转发给基础Rule对象的参数列表。</li>
</ul>
<p>在上面的示例中，’/ ‘ URL与<strong>hello_world()</strong>函数绑定。因此，当在浏览器中打开web服务器的主页时，将呈现该函数的输出。</p>
<p>最后，Flask类的<strong>run()</strong>方法在本地开发服务器上运行应用程序。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">app.run(host&#x3D;&#39;192.168.0.235&#39;,port&#x3D;8081,debug&#x3D;True)</span><br></pre></td></tr></table></figure>

<blockquote>
<ul>
<li>host: 要监听的主机名。 默认为127.0.0.1（localhost）。设置为“0.0.0.0”以使服务器在外部可用</li>
<li>port: 指定端口,默认值为5000</li>
<li>debug=True: 相当于热部署,代码改变服务器会重新加载最新代码,用于开发环境。默认为Flase,代码发生改变不会自动加载,用于生产环境</li>
</ul>
</blockquote>
<p>启动：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ pip install Flask</span><br><span class="line">$ python hello.py</span><br></pre></td></tr></table></figure>

<p>##特性</p>
<ul>
<li>内置开发用服务器和debugger</li>
<li>集成单元测试（unit testing）</li>
<li>RESTful request dispatching</li>
<li>使用Jinja2模板引擎</li>
<li>支持secure cookies（client side sessions）</li>
<li>100% WSGI 1.0兼容</li>
<li>Unicode based</li>
<li>详细的文件、教学</li>
<li>Google App Engine兼容</li>
<li>可用Extensions增加其他功能</li>
</ul>
<h1 id="Flask-环境"><a href="#Flask-环境" class="headerlink" title="Flask 环境"></a>Flask 环境</h1><h2 id="为开发环境安装virtualenv"><a href="#为开发环境安装virtualenv" class="headerlink" title="为开发环境安装virtualenv"></a>为开发环境安装virtualenv</h2><p><strong>virtualenv</strong>是一个虚拟的Python环境构建器。它可以帮助用户并行创建多个Python环境。 因此，它可以避免不同版本的库之间的兼容性问题。</p>
<h1 id="Flask-路由"><a href="#Flask-路由" class="headerlink" title="Flask 路由"></a>Flask 路由</h1><p>现代<code>Web</code>框架使用路由技术来帮助用户记住应用程序URL。可以直接访问所需的页面，而无需从主页导航。</p>
<p>Flask中的<strong>route()</strong>装饰器用于将URL绑定到函数。例如：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># 这个装饰器其实就是将rule字符串跟视图函数进行了绑定，通过add_url_rule()实现的绑定</span><br><span class="line">@app.route(‘&#x2F;hello’)</span><br><span class="line">def hello_world():</span><br><span class="line">   return ‘hello world’</span><br></pre></td></tr></table></figure>

<p>在这里，URL <strong>‘/ hello’</strong> 规则绑定到<strong>hello_world()</strong>函数。 因此，如果用户访问<strong>http：// localhost：5000 / hello</strong> URL，<strong>hello_world()</strong>函数的输出将在浏览器中呈现。</p>
<p>application对象的<strong>add_url_rule()</strong>函数也可用于将URL与函数绑定，如上例所示，使用<strong>route()</strong>。</p>
<p>装饰器的目的也由以下表示：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">def hello_world():</span><br><span class="line">   return ‘hello world’</span><br><span class="line">   </span><br><span class="line">app.add_url_rule(‘&#x2F;’, ‘hello’, hello_world)</span><br></pre></td></tr></table></figure>

<h1 id="Flask-变量规则"><a href="#Flask-变量规则" class="headerlink" title="Flask 变量规则"></a>Flask 变量规则</h1><h2 id="Flask-变量规则-1"><a href="#Flask-变量规则-1" class="headerlink" title="Flask 变量规则"></a>Flask 变量规则</h2><p>通过向规则参数添加变量部分，可以动态构建URL。此变量部分标记为<strong><variable-name></strong>。它作为关键字参数传递给与规则相关联的函数。</p>
<p>在以下示例中，<strong>route()</strong>装饰器的规则参数包含附加到URL <strong>‘/hello’</strong>的<strong><name>。</strong>因此，如果在浏览器中输入<strong><a href="http://localhost:5000/hello/w3cschool" target="_blank" rel="noopener">http://localhost:5000/hello/w3cschool</a></strong>作为<strong>URL</strong>，则<strong>‘w3cschool’</strong>将作为参数提供给<strong>hello()</strong>函数。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">from flask import Flask</span><br><span class="line">app &#x3D; Flask(__name__)</span><br><span class="line"></span><br><span class="line">@app.route(&#39;&#x2F;hello&#x2F;&lt;name&gt;&#39;)</span><br><span class="line">def hello_name(name):</span><br><span class="line">   return &#39;Hello %s!&#39; % name</span><br><span class="line"></span><br><span class="line">if __name__ &#x3D;&#x3D; &#39;__main__&#39;:</span><br><span class="line">   app.run(debug &#x3D; True)</span><br></pre></td></tr></table></figure>

<p>将上述脚本保存为<strong>hello.py</strong>并从Python shell运行它。接下来，打开浏览器并输入URL <strong>http:// localhost:5000/hello/w3cschool。</strong></p>
<p>以下输出将显示在浏览器中:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Hello w3cschool!</span><br></pre></td></tr></table></figure>

<p>除了默认字符串变量部分之外，还可以使用以下转换器构建规则：</p>
<table>
<thead>
<tr>
<th>序号</th>
<th>转换器和描述</th>
</tr>
</thead>
<tbody><tr>
<td>1</td>
<td><strong>int</strong>接受整数</td>
</tr>
<tr>
<td>2</td>
<td><strong>float</strong>对于浮点值</td>
</tr>
<tr>
<td>3</td>
<td><strong>path</strong>接受用作目录分隔符的斜杠</td>
</tr>
</tbody></table>
<p>在下面的代码中，使用了所有这些构造函数：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">from flask import Flask</span><br><span class="line">app &#x3D; Flask(__name__)</span><br><span class="line"></span><br><span class="line">@app.route(&#39;&#x2F;blog&#x2F;&lt;int:postID&gt;&#39;)</span><br><span class="line">def show_blog(postID):</span><br><span class="line">   return &#39;Blog Number %d&#39; % postID</span><br><span class="line"></span><br><span class="line">@app.route(&#39;&#x2F;rev&#x2F;&lt;float:revNo&gt;&#39;)</span><br><span class="line">def revision(revNo):</span><br><span class="line">   return &#39;Revision Number %f&#39; % revNo</span><br><span class="line"></span><br><span class="line">if __name__ &#x3D;&#x3D; &#39;__main__&#39;:</span><br><span class="line">   app.run()</span><br></pre></td></tr></table></figure>

<p>从Python Shell运行上面的代码。访问浏览器中的URL <strong><a href="http://localhost:5000/blog/11" target="_blank" rel="noopener">http://localhost:5000/blog/11</a></strong>。</p>
<p>给定的数字用作<strong>show_blog()</strong>函数的参数。浏览器显示以下输出：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Blog Number 11</span><br></pre></td></tr></table></figure>

<p>在浏览器中输入此URL - <strong><a href="http://localhost:5000/rev/1.1" target="_blank" rel="noopener">http://localhost:5000/rev/1.1</a></strong></p>
<p><strong>revision()</strong>函数将浮点数作为参数。以下结果显示在浏览器窗口中：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Revision Number 1.100000</span><br></pre></td></tr></table></figure>

<p>Flask的URL规则基于<strong>Werkzeug</strong>的路由模块。这确保形成的URL是唯一的，并且基于Apache规定的先例。</p>
<p>考虑以下脚本中定义的规则：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">from flask import Flask</span><br><span class="line">app &#x3D; Flask(__name__)</span><br><span class="line"></span><br><span class="line">@app.route(&#39;&#x2F;flask&#39;)</span><br><span class="line">def hello_flask():</span><br><span class="line">   return &#39;Hello Flask&#39;</span><br><span class="line"></span><br><span class="line">@app.route(&#39;&#x2F;python&#x2F;&#39;)</span><br><span class="line">def hello_python():</span><br><span class="line">   return &#39;Hello Python&#39;</span><br><span class="line"></span><br><span class="line">if __name__ &#x3D;&#x3D; &#39;__main__&#39;:</span><br><span class="line">   app.run()</span><br></pre></td></tr></table></figure>

<p>这两个规则看起来类似，但在第二个规则中，使用斜杠<strong>（/）</strong>。因此，它成为一个规范的URL。因此，使用 <strong>/python</strong> 或 <strong>/python/</strong>返回相同的输出。但是，如果是第一个规则，<strong>/flask/ URL</strong>会产生“404 Not Found”页面。</p>
<h1 id="Flask-URL构建"><a href="#Flask-URL构建" class="headerlink" title="Flask URL构建"></a>Flask URL构建</h1><h2 id="Flask-URL构建-1"><a href="#Flask-URL构建-1" class="headerlink" title="Flask URL构建"></a><strong>Flask URL构建</strong></h2><p><strong>url_for()</strong>函数对于动态构建特定函数的URL非常有用。该函数接受函数的名称作为第一个参数，以及一个或多个关键字参数，每个参数对应于URL的变量部分。</p>
<p>以下脚本演示了如何使用<strong>url_for()</strong>函数：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">from flask import Flask, redirect, url_for</span><br><span class="line">app &#x3D; Flask(__name__)</span><br><span class="line">@app.route(&#39;&#x2F;admin&#39;)</span><br><span class="line">def hello_admin():</span><br><span class="line">   return &#39;Hello Admin&#39;</span><br><span class="line">@app.route(&#39;&#x2F;guest&#x2F;&lt;guest&gt;&#39;)def hello_guest(guest):</span><br><span class="line">   return &#39;Hello %s as Guest&#39; % guest</span><br><span class="line">@app.route(&#39;&#x2F;user&#x2F;&lt;name&gt;&#39;)</span><br><span class="line">def hello_user(name):</span><br><span class="line">   if name &#x3D;&#x3D;&#39;admin&#39;:</span><br><span class="line">      return redirect(url_for(&#39;hello_admin&#39;))</span><br><span class="line">   else:</span><br><span class="line">      return redirect(url_for(&#39;hello_guest&#39;,guest &#x3D; name))</span><br><span class="line">if __name__ &#x3D;&#x3D; &#39;__main__&#39;:</span><br><span class="line">   app.run(debug &#x3D; True)</span><br></pre></td></tr></table></figure>

<p>上述脚本有一个函数<strong>user(name)</strong>，它接受来自URL的参数的值。</p>
<p><strong>User()</strong>函数检查接收的参数是否与<strong>‘admin’</strong>匹配。如果匹配，则使用<strong>url_for()</strong>将应用程序重定向到<strong>hello_admin()</strong>函数，否则重定向到将接收的参数作为guest参数传递给它的<strong>hello_guest()</strong>函数。</p>
<p>保存上面的代码并从Python shell运行。</p>
<p>打开浏览器并输入URL - <strong><a href="http://localhost:5000/user/admin" target="_blank" rel="noopener">http://localhost:5000/user/admin</a></strong></p>
<p>浏览器中的应用程序响应是：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Hello Admin</span><br></pre></td></tr></table></figure>

<p>在浏览器中输入以下URL - <strong><a href="http://localhost:5000/user/mvl" target="_blank" rel="noopener">http://localhost:5000/user/mvl</a></strong></p>
<p>应用程序响应现在更改为：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Hello mvl as Guest</span><br></pre></td></tr></table></figure>

<h1 id="Flask-Request对象"><a href="#Flask-Request对象" class="headerlink" title="Flask Request对象"></a>Flask Request对象</h1><p>来自客户端网页的数据作为全局请求对象发送到服务器。为了处理请求数据，应该从Flask模块导入。</p>
<p><code>Request</code>对象的重要属性如下所列：</p>
<ul>
<li><strong>Form</strong> - 它是一个字典对象，包含表单参数及其值的键和值对。</li>
<li><strong>args</strong> - 解析查询字符串的内容，它是问号（？）之后的URL的一部分。</li>
<li><strong>Cookies</strong>  - 保存Cookie名称和值的字典对象。</li>
<li><strong>files</strong> - 与上传文件有关的数据。</li>
<li><strong>method</strong> - 当前请求方法。</li>
</ul>
<p>默认情况下，Flask路由响应<strong>GET</strong>请求。但是，可以通过为<strong>route()</strong>装饰器提供方法参数来更改此首选项。</p>
<p>为了演示在URL路由中使用<strong>POST</strong>方法，首先让我们创建一个HTML表单，并使用<strong>POST</strong>方法将表单数据发送到URL。将以下脚本另存为login.html</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&lt;html&gt;</span><br><span class="line">   &lt;body&gt;</span><br><span class="line">      </span><br><span class="line">      &lt;form action &#x3D; &quot;http:&#x2F;&#x2F;localhost:5000&#x2F;login&quot; method &#x3D; &quot;post&quot;&gt;</span><br><span class="line">         &lt;p&gt;Enter Name:&lt;&#x2F;p&gt;</span><br><span class="line">         &lt;p&gt;&lt;input type &#x3D; &quot;text&quot; name &#x3D; &quot;nm&quot; &#x2F;&gt;&lt;&#x2F;p&gt;</span><br><span class="line">         &lt;p&gt;&lt;input type &#x3D; &quot;submit&quot; value &#x3D; &quot;submit&quot; &#x2F;&gt;&lt;&#x2F;p&gt;</span><br><span class="line">      &lt;&#x2F;form&gt;</span><br><span class="line">      </span><br><span class="line">   &lt;&#x2F;body&gt;</span><br><span class="line">&lt;&#x2F;html&gt;</span><br></pre></td></tr></table></figure>

<p>现在在Python shell中输入以下脚本：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">from flask import Flask, redirect, url_for, request</span><br><span class="line">app &#x3D; Flask(__name__)</span><br><span class="line"></span><br><span class="line">@app.route(&#39;&#x2F;success&#x2F;&lt;name&gt;&#39;)</span><br><span class="line">def success(name):</span><br><span class="line">   return &#39;welcome %s&#39; % name</span><br><span class="line"></span><br><span class="line">@app.route(&#39;&#x2F;login&#39;,methods &#x3D; [&#39;POST&#39;, &#39;GET&#39;])</span><br><span class="line">def login():</span><br><span class="line">   if request.method &#x3D;&#x3D; &#39;POST&#39;:</span><br><span class="line">   	  # 获取post请求的参数</span><br><span class="line">      user &#x3D; request.form[&#39;nm&#39;]</span><br><span class="line">      return redirect(url_for(&#39;success&#39;,name &#x3D; user))</span><br><span class="line">   else:</span><br><span class="line">      # 获取get请求的参数</span><br><span class="line">      user &#x3D; request.args.get(&#39;nm&#39;)</span><br><span class="line">      return redirect(url_for(&#39;success&#39;,name &#x3D; user))</span><br><span class="line"></span><br><span class="line">if __name__ &#x3D;&#x3D; &#39;__main__&#39;:</span><br><span class="line">   app.run(debug &#x3D; True)</span><br></pre></td></tr></table></figure>

<p>开发服务器开始运行后，在浏览器中打开<strong>login.html</strong>，在文本字段中输入name，然后单击<strong>提交</strong>。</p>
<h1 id="Flask-Response对象与模板"><a href="#Flask-Response对象与模板" class="headerlink" title="Flask Response对象与模板"></a>Flask Response对象与模板</h1><h2 id="Response对象"><a href="#Response对象" class="headerlink" title="Response对象"></a>Response对象</h2><blockquote>
<p>Flask的视图函数return可以返回那些值?</p>
</blockquote>
<ol>
<li><p>可以返回字符串: 返回的字符串其实也是做了一个<code>response</code>对象的封装。最终的返回结果还是<code>response</code>对象</p>
</li>
<li><p>dict对象:  转换成了application/json数据</p>
</li>
<li><p>tuple对象: 返回元组时，顺序依次是：返回内容，返回状态码，返回的header</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">return &#39;hello world&#39;, 200, &#123;&#39;Locateion&#39;:&#39;www.baidu.com&#39;&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>response对象</p>
</li>
<li><p>make_response()</p>
</li>
<li><p>redirect() : 有两次响应：1. 302状态码 + location  2.  返回location请求地址内容</p>
</li>
<li><p>render_template()  模板渲染 + 模板</p>
</li>
</ol>
<p>###标准WSGI接口</p>
<p>实际上，<code>flask</code>是基于<code>Werkzeug</code>工具包的一个web服务框架，所以flask里视图函数的实现，实际上是对werkzeug的一层封装，我们先看一下一个简单的werkzeug应用是怎么实现的：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">from werkzeug.wrappers import Request, Response</span><br><span class="line"></span><br><span class="line">def application(environ, start_response):</span><br><span class="line">    request &#x3D; Request(environ)</span><br><span class="line">    text &#x3D; &#39;Hello %s!&#39; % request.args.get(&#39;name&#39;, &#39;World&#39;)</span><br><span class="line">    response &#x3D; Response(text, mimetype&#x3D;&#39;text&#x2F;plain&#39;)</span><br><span class="line">    return response(environ, start_response)</span><br></pre></td></tr></table></figure>

<p>可以看到，实际上<code>werkzeug</code>要求每次请求的返回值是<code>Response</code>类型。所以实际上，<code>flask</code>的视图函数返回值无论如何变，它都不会离开<code>Response</code>类型。</p>
<h3 id="flask里组装过程"><a href="#flask里组装过程" class="headerlink" title="flask里组装过程"></a>flask里组装过程</h3><p>flask视图函数调用过程如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">rv &#x3D; full_dispatch_request() </span><br><span class="line">     dispatch_request()   </span><br><span class="line">        self.view_functions[rule.endpoint](**req.view_args)</span><br><span class="line">finalize_request(rv)</span><br><span class="line">   	make_response(rv)   </span><br><span class="line">        rv &#x3D; self.response_class(rv, status&#x3D;status, headers&#x3D;headers)</span><br><span class="line">        # 这里response_class实际上就是Response类</span><br><span class="line">        return rv</span><br></pre></td></tr></table></figure>

<p>可以看到，无论<code>flask</code>里视图函数的返回值是什么样式，最终都会调用<code>Flask.make_response()</code>里的<code>response_class</code>构造一个<code>Response</code>对象。回头看flask视图函数的返回值：</p>
<ul>
<li>如果返回的是3个元素的元组，则会在构造Response时使用元组里的后两个作为Response的返回code以及header</li>
<li>如果返回的值是单个元素<ul>
<li>如果是字符串，那么在Flask.make_response()里会加上默认的code和header，并且header里content-type是text/html</li>
<li>如果是jsonify(), 会在jsonify()方法里组装一个Response对象，并在header里添加content-type为text/json。然后返回</li>
</ul>
</li>
<li>如果返回的是render_template, 会通过flask里的渲染引擎将html渲染成字符串返回，之后便和返回字符串形式相同</li>
<li>如果返因的是make_response, 则会直接生成Response对象</li>
</ul>
<p>在Flask.make_response()里，会根据视图函数返回的值的个数，类型的不同，来做不同的处理，生成最终的Response对象，并为字添加code和header等。</p>
<h2 id="模板"><a href="#模板" class="headerlink" title="模板"></a>模板</h2><h3 id="标签呈现‘Hello-World’"><a href="#标签呈现‘Hello-World’" class="headerlink" title="标签呈现‘Hello World’"></a>标签呈现<strong>‘Hello World’</strong></h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">from flask  import Flask</span><br><span class="line">app &#x3D; Flask(__name__)</span><br><span class="line"></span><br><span class="line">@app.route(&#39;&#x2F;&#39;)</span><br><span class="line">def index():</span><br><span class="line">   return &#39;&lt;html&gt;&lt;body&gt;&lt;h1&gt;&#39;Hello World&#39;&lt;&#x2F;h1&gt;&lt;&#x2F;body&gt;&lt;&#x2F;html&gt;&#39;</span><br><span class="line"></span><br><span class="line">if __name__ &#x3D;&#x3D; &#39;__main__&#39;:</span><br><span class="line">   app.run(debug &#x3D; True)</span><br></pre></td></tr></table></figure>

<p>但是，从<code>Python</code>代码生成HTML内容很麻烦，尤其是在需要放置变量数据和Python语言元素（如条件或循环）时。这需要经常从HTML中转义。</p>
<h3 id="render-template"><a href="#render-template" class="headerlink" title="render_template()"></a>render_template()</h3><p>这是可以利用<code>Flask</code>所基于的<strong>Jinja2模板引擎</strong>的地方。而不是从函数返回硬编码<code>HTML</code>，可以通过<strong>render_template()</strong>函数呈现HTML文件。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">from flask import Flask，render_template</span><br><span class="line">app &#x3D; Flask(name)</span><br><span class="line">@app.route(&#39;&#x2F;&#39;)</span><br><span class="line">def index():</span><br><span class="line">   return render_template(‘hello.html’)</span><br><span class="line">if name &#x3D;&#x3D; &#39;main&#39;:</span><br><span class="line">   app.run(debug &#x3D; True)</span><br></pre></td></tr></table></figure>

<p>Flask将尝试在templates文件夹中找到HTML文件，该文件存在于此脚本所在的文件夹中。</p>
<ul>
<li>Application folder<ul>
<li>Hello.py</li>
<li>templates<ul>
<li>hello.html</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>术语<strong>‘web templating system（web模板系统）’</strong>指的是设计一个HTML脚本，其中可以动态插入变量数据。web模板系统包括模板引擎，某种数据源和模板处理器。</p>
<p>Flask使用<strong>jinga2</strong>模板引擎。Web模板包含用于变量和表达式（在这些情况下为Python表达式）的HTML语法散布占位符，这些是在呈现模板时替换的值。</p>
<p>以下代码在<code>templates</code>文件夹中另存为<strong>hello.html</strong> 。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;!doctype html&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">   &lt;body&gt;</span><br><span class="line">	  &#123;# 变量部分插入&#123;&#123;name&#125;&#125;占位符。#&#125;</span><br><span class="line">      &lt;h1&gt;Hello &#123;&#123; name &#125;&#125;!&lt;&#x2F;h1&gt;</span><br><span class="line"></span><br><span class="line">   &lt;&#x2F;body&gt;</span><br><span class="line">&lt;&#x2F;html&gt;</span><br></pre></td></tr></table></figure>

<p>接下来，从Python shell运行以下脚本：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">from flask import Flask, render_template</span><br><span class="line">app &#x3D; Flask(__name__)</span><br><span class="line">@app.route(&#39;&#x2F;hello&#x2F;&#39;)</span><br><span class="line">def hello_name(user):</span><br><span class="line">   # render_template(&#39;模板名字&#39;,**context)</span><br><span class="line">   return render_template(&#39;hello.html&#39;, name &#x3D; user)</span><br><span class="line">if __name__ &#x3D;&#x3D; &#39;__main__&#39;:</span><br><span class="line">   app.run(debug &#x3D; True)</span><br></pre></td></tr></table></figure>

<p>当开发服务器开始运行时，打开浏览器并输入URL - <strong><a href="http://localhost:5000/hello/mvl" target="_blank" rel="noopener">http://localhost:5000/hello/mvl</a></strong></p>
<h3 id="模板语法"><a href="#模板语法" class="headerlink" title="模板语法"></a>模板语法</h3><p><strong>Jinja2</strong>模板引擎使用以下分隔符从HTML转义。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line">1.&#123;% ... %&#125;用于语句</span><br><span class="line">      # 1. 条件判断</span><br><span class="line">      &#123;% if 条件 %&#125;</span><br><span class="line">      </span><br><span class="line">      &#123;% endif %&#125;</span><br><span class="line">      </span><br><span class="line">      # 2. 嵌套条件</span><br><span class="line">      &#123;% if  条件 %&#125;</span><br><span class="line">          条件为True</span><br><span class="line">      &#123;% else %&#125;</span><br><span class="line">          条件为False</span><br><span class="line">      &#123;% endif %&#125;</span><br><span class="line">      </span><br><span class="line">      &#123;% if 条件 %&#125;</span><br><span class="line">          pass</span><br><span class="line">      &#123;% elif 条件 %&#125;</span><br><span class="line">          pass</span><br><span class="line">       ....</span><br><span class="line">      &#123;% endif %&#125;</span><br><span class="line">      # 3. 循环遍历</span><br><span class="line">      &#123;% for 变量 in 可迭代的对象 %&#125;</span><br><span class="line">          for循环要做的任务</span><br><span class="line">          # 可以使用loop变量</span><br><span class="line">          loop.index  序号从1开始</span><br><span class="line">          loop.index0  序号从0开始</span><br><span class="line">          loop.revindex  reverse  序号是倒着的</span><br><span class="line">          loop.revindex0</span><br><span class="line">          loop.first 布尔类型   是否是第一行</span><br><span class="line">          loop.last  布尔类型   是否是第二行</span><br><span class="line">      &#123;% endfor %&#125;</span><br><span class="line">2.&#123;&#123; ... &#125;&#125;用于表达式可以打印到模板输出</span><br><span class="line">      在模板中获取view中传递的变量值：&#123;&#123; 变量名key &#125;&#125;</span><br><span class="line">      # render_template(&#39;模板名字&#39;,key&#x3D;value,key&#x3D;value)</span><br><span class="line">      	name &#x3D; &#39;沈凯&#39;  # str</span><br><span class="line">          age &#x3D; 18  # int</span><br><span class="line">          friends &#x3D; [&#39;建义&#39;, &#39;陈璟&#39;, &#39;小岳岳&#39;, &#39;郭麒麟&#39;]  # list</span><br><span class="line">          dict1 &#x3D; &#123;&#39;gift&#39;: &#39;大手镯&#39;, &#39;gift1&#39;: &#39;鲜花&#39;, &#39;gift2&#39;: &#39;费列罗&#39;&#125;  # dict</span><br><span class="line">          # 创建对象</span><br><span class="line">          girlfriend &#x3D; Girl(&#39;美美&#39;, &#39;安徽阜阳&#39;)  # 自定义的类构建的类型：Girl对象</span><br><span class="line">      </span><br><span class="line">      模板：</span><br><span class="line">      	&#123;&#123;name&#125;&#125;</span><br><span class="line">      	&#123;&#123;age&#125;&#125;</span><br><span class="line">          &#123;&#123; list.0 &#125;&#125;  同 &#123;&#123; list[0] &#125;&#125;</span><br><span class="line">          &#123;&#123; dict.key &#125;&#125; 同 &#123;&#123; dict.get(key) &#125;&#125;</span><br><span class="line">          &#123;&#123; girl.name &#125;&#125; 同 &#123;&#123; 对象.属性 &#125;&#125;</span><br><span class="line">3.&#123;# ... #&#125;用于未包含在模板输出中的注释</span><br></pre></td></tr></table></figure>

<h2 id="过滤器"><a href="#过滤器" class="headerlink" title="过滤器"></a>过滤器</h2><blockquote>
<p>当遇到特殊的值需要打印到模板输出时,我们可以使用过滤器,过滤器的本质就是函数</p>
</blockquote>
<p>模板语法中过滤器：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123; 变量名 | 过滤器(*args) &#125;&#125;</span><br><span class="line">&#123;&#123; 变量名 | 过滤器 &#125;&#125;</span><br></pre></td></tr></table></figure>

<p>常见的过滤器：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">1。 safe ： 禁用转译</span><br><span class="line">msg &#x3D; &#39;&lt;h1&gt;520快乐！&lt;&#x2F;h1&gt;&#39;</span><br><span class="line">return render_template(&#39;show_2.html&#39;, girls&#x3D;girls, users&#x3D;users, msg&#x3D;msg)</span><br><span class="line">不想让其转译：</span><br><span class="line">&#123;&#123; msg | safe &#125;&#125;</span><br><span class="line">2。 capitalize：单词的首字母大写</span><br><span class="line">&#123;&#123; n1 | capitalize &#125;&#125;</span><br><span class="line">3。lower和upper</span><br><span class="line">大小写的转换</span><br><span class="line">4。title 一句话中每个单词的首字母大写</span><br><span class="line"> msg &#x3D; &#39;She is a beautiful girl&#39;</span><br><span class="line"> &#123;&#123; msg | title&#125;&#125;</span><br><span class="line">5。reverse  翻转</span><br><span class="line">&#123;&#123; n1 | reverse&#125;&#125;</span><br><span class="line">6。format</span><br><span class="line">&#123;&#123; &#39;%s is %d years old&#39; | format(&#39;lily&#39;,18) &#125;&#125;</span><br><span class="line">7.truncate 字符串截断</span><br><span class="line">list的操作：</span><br><span class="line">&#123;# 列表过滤器的使用 #&#125;</span><br><span class="line">&#123;&#123; girls | first &#125;&#125;&lt;br&gt;</span><br><span class="line">&#123;&#123; girls | last &#125;&#125;&lt;br&gt;</span><br><span class="line">&#123;&#123; girls | length &#125;&#125;&lt;br&gt;</span><br><span class="line">&#123;#&#123;&#123; girls | sum &#125;&#125; 整型的计算 #&#125;</span><br><span class="line">&#123;&#123; [1,3,5,7,9] | sum &#125;&#125;&lt;br&gt;</span><br><span class="line">&#123;&#123; [1,8,5,7,3] | sort &#125;&#125;&lt;br&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">dict:</span><br><span class="line">&#123;% for v in users.0.values() %&#125;   ----&gt;获取值</span><br><span class="line">    &lt;p&gt;&#123;&#123; v &#125;&#125;&lt;&#x2F;p&gt;</span><br><span class="line">&#123;% endfor %&#125;</span><br><span class="line"></span><br><span class="line">&lt;hr&gt;</span><br><span class="line">&#123;% for k in users.0.keys() %&#125;   ----》获取键</span><br><span class="line">    &lt;p&gt;&#123;&#123; k &#125;&#125;&lt;&#x2F;p&gt;</span><br><span class="line">&#123;% endfor %&#125;</span><br><span class="line"></span><br><span class="line">&lt;hr&gt;</span><br><span class="line"></span><br><span class="line">&#123;% for k,v in users.0.items() %&#125;  ---》获取键值</span><br><span class="line">    &lt;p&gt;&#123;&#123; k &#125;&#125;---&#123;&#123; v &#125;&#125;&lt;&#x2F;p&gt;</span><br><span class="line">&#123;% endfor %&#125;</span><br></pre></td></tr></table></figure>

<h2 id="自定义过滤器"><a href="#自定义过滤器" class="headerlink" title="自定义过滤器"></a>自定义过滤器</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">#第一种方式</span><br><span class="line">通过flask模块中的add_template_filter方法</span><br><span class="line">1. 定义函数，带有参数和返回值</span><br><span class="line">2. 添加过滤器  app.add_template_filter(function,name&#x3D;&#39;&#39;)</span><br><span class="line">3. 在模板中使用： &#123;&#123; 变量 | 自定义过滤器 &#125;&#125;</span><br><span class="line"></span><br><span class="line">    def replace_hello(value):</span><br><span class="line">        print(&#39;------&gt;&#39;, value)</span><br><span class="line">        value &#x3D; value.replace(&#39;hello&#39;, &#39;&#39;)</span><br><span class="line">        print(&#39;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&gt;&#39;, value)</span><br><span class="line">        return value.strip()  # 将 替换的结果返回</span><br><span class="line">        </span><br><span class="line">    app.add_template_filter(replace_hello, &#39;replace&#39;) # replace 自定义过滤器的名字</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">使用装饰器完成</span><br><span class="line">1. 定义函数，带有参数和返回值</span><br><span class="line">2. 通过装饰器完成，@app.template_filter(&#39;过滤器名字&#39;)装饰步骤一的函数</span><br><span class="line">3. 在模板中使用： &#123;&#123; 变量 | 自定义过滤器 &#125;&#125;</span><br><span class="line"># 第二种方式 装饰器</span><br><span class="line">@app.template_filter(&#39;listreverse&#39;)</span><br><span class="line">def reverse_list(li):</span><br><span class="line">    temp_li &#x3D; list(li)</span><br><span class="line">    temp_li.reverse()</span><br><span class="line">    return temp_li</span><br></pre></td></tr></table></figure>

<h2 id="模板代码的复用"><a href="#模板代码的复用" class="headerlink" title="模板代码的复用"></a>模板代码的复用</h2><p><strong>在模板中，可能会遇到以下情况：</strong></p>
<ol>
<li>多个模板具有完全相同的顶部和底部内容</li>
<li>多个模板中具有相同的模板代码内容，但是内容中部分值不一样</li>
<li>多个模板中具有完全相同的 html 代码块内容</li>
</ol>
<h3 id="宏"><a href="#宏" class="headerlink" title="宏"></a>宏</h3><p>对宏(macro)的理解：</p>
<ul>
<li>可以把宏理解为一个函数，它会返回一个模板或者 HTML 字符串</li>
<li>为了避免反复地编写同样的模板代码，出现代码冗余，可以把他们写成函数以进行重用</li>
<li>需要在多处重复使用的模板代码片段可以写入单独的文件，再包含在所有模板中，以避免重复</li>
</ul>
<h4 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h4><h5 id="方式一"><a href="#方式一" class="headerlink" title="方式一"></a>方式一</h5><p>1、定义宏</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;% macro input(name,value=<span class="string">''</span>,type=<span class="string">'text'</span>) %&#125;</span><br><span class="line">    &lt;input type="&#123;&#123;type&#125;&#125;" name="&#123;&#123;name&#125;&#125;" value="&#123;&#123;value&#125;&#125;" class="form-control"&gt;</span><br><span class="line">&#123;% endmacro %&#125;</span><br></pre></td></tr></table></figure>

<p>2、调用宏</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123; input(<span class="string">'name'</span> value=<span class="string">'zs'</span>)&#125;&#125;</span><br></pre></td></tr></table></figure>

<p>3、这会输出</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;input type="text" name="name" value="zs" class="form-control"&gt;</span><br></pre></td></tr></table></figure>

<h5 id="方式二"><a href="#方式二" class="headerlink" title="方式二"></a>方式二</h5><p>4、把宏单独抽取出来，封装成html文件，其它模板中导入使用，文件名可以自定义macro.html</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;% macro function(type=<span class="string">'text'</span>, name=<span class="string">''</span>, value=<span class="string">''</span>) %&#125;</span><br><span class="line">		&lt;input type="&#123;&#123;type&#125;&#125;" name="&#123;&#123;name&#125;&#125;" value="&#123;&#123;value&#125;&#125;" class="form-control"&gt;</span><br><span class="line">&#123;% endmacro %&#125;</span><br></pre></td></tr></table></figure>

<p>5、在其它模板文件中先导入，再调用</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&#123;% <span class="keyword">import</span> <span class="string">'macro.html'</span> <span class="keyword">as</span> func %&#125;</span><br><span class="line">&#123;% func.function() %&#125;</span><br></pre></td></tr></table></figure>

<h3 id="继承"><a href="#继承" class="headerlink" title="继承"></a>继承</h3><p>模板继承是为了重用模板中的公共内容。一般Web开发中，继承主要使用在网站的顶部菜单、底部。这些内容可以定义在父模板中，子模板直接继承，而不需要重复书写。</p>
<ul>
<li>相当于在父模板中挖个坑，当子模板继承父模板时，可以进行填充。</li>
<li>子模板使用 extends 指令声明这个模板继承自哪个模板</li>
<li>父模板中定义的块在子模板中被重新定义，在子模板中调用父模板的内容可以使用super()</li>
</ul>
<h4 id="父模板"><a href="#父模板" class="headerlink" title="父模板"></a>父模板</h4><p>base.html</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&#123;% block top %&#125;</span><br><span class="line">  顶部菜单</span><br><span class="line">&#123;% endblock top %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% block content %&#125;</span><br><span class="line">&#123;% endblock content %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% block bottom %&#125;</span><br><span class="line">  底部</span><br><span class="line">&#123;% endblock bottom %&#125;</span><br></pre></td></tr></table></figure>

<h4 id="子模板"><a href="#子模板" class="headerlink" title="子模板"></a>子模板</h4><p>extends指令声明这个模板继承自哪</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#123;% extends &#39;base.html&#39; %&#125;</span><br><span class="line">&#123;% block content %&#125;</span><br><span class="line"> 需要填充的内容</span><br><span class="line">&#123;% endblock content %&#125;</span><br></pre></td></tr></table></figure>

<p>模板继承使用时注意点：</p>
<ol>
<li>不支持多继承</li>
<li>为了便于阅读，在子模板中使用extends时，尽量写在模板的第一行。</li>
<li>不能在一个模板文件中定义多个相同名字的block标签。</li>
<li>当在页面中使用多个block标签时，建议给结束标签起个名字，当多个block嵌套时，阅读性更好。</li>
</ol>
<h3 id="包含"><a href="#包含" class="headerlink" title="包含"></a>包含</h3><p><code>Jinja2</code>模板中，除了宏和继承，还支持一种代码重用的功能，叫包含(Include)。它的功能是将<strong>另一个模板整个加载到当前模板中，并直接渲染。</strong></p>
<p>1、include的使用</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;% include &#39;hello.html&#39; %&#125;</span><br></pre></td></tr></table></figure>

<p>包含在使用时，如果包含的模板文件不存在时，程序会抛出TemplateNotFound异常，可以加上 <code>ignore missing</code> 关键字。如果包含的模板文件不存在，会忽略这条include语句。</p>
<p>2、include 的使用加上关键字ignore missing</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;% include &#39;hello.html&#39; ignore missing %&#125;</span><br></pre></td></tr></table></figure>

<p><strong>小结：</strong></p>
<ol>
<li>宏(Macro)、继承(Block)、包含(include)均能实现代码的复用。</li>
<li>继承(Block)的本质是代码替换，一般用来实现多个页面中重复不变的区域。</li>
<li>宏(Macro)的功能类似函数，可以传入参数，需要定义、调用。</li>
<li>包含(include)是直接将目标模板文件整个渲染出来。</li>
</ol>
<h1 id="Flask-静态文件"><a href="#Flask-静态文件" class="headerlink" title="Flask 静态文件"></a>Flask 静态文件</h1><p> Web应用程序通常需要静态文件，例如<strong>javascript</strong>文件或支持网页显示的<strong>CSS</strong>文件。通常，配置Web服务器并为您提供这些服务，但在开发过程中，这些文件是从您的包或模块旁边的<code>static</code>文件夹中提供，它将在应用程序的<strong>/static</strong>中提供。</p>
<p>特殊端点<code>static</code>用于生成静态文件的URL。</p>
<p>在下面的示例中，在<strong>index.html</strong>中的HTML按钮的<strong>OnClick</strong>事件上调用<strong>hello.js</strong>中定义的<strong>javascript</strong>函数，该函数在Flask应用程序的<strong>“/”</strong>URL上呈现。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">from flask import Flask, render_template</span><br><span class="line">app &#x3D; Flask(__name__)</span><br><span class="line"></span><br><span class="line">@app.route(&quot;&#x2F;&quot;)</span><br><span class="line">def index():</span><br><span class="line">   return render_template(&quot;index.html&quot;)</span><br><span class="line"></span><br><span class="line">if __name__ &#x3D;&#x3D; &#39;__main__&#39;:</span><br><span class="line">   app.run(debug &#x3D; True)</span><br></pre></td></tr></table></figure>

<p><strong>index.html</strong>的HTML脚本如下所示：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;html&gt;</span><br><span class="line">   &lt;head&gt;</span><br><span class="line">      &lt;script type &#x3D; &quot;text&#x2F;javascript&quot; src &#x3D; &quot;&#123;&#123; url_for(&#39;static&#39;, filename &#x3D; &#39;hello.js&#39;) &#125;&#125;&quot; &gt;		&lt;&#x2F;script&gt;</span><br><span class="line">   &lt;&#x2F;head&gt;</span><br><span class="line">   &lt;body&gt;</span><br><span class="line">      &lt;input type &#x3D; &quot;button&quot; onclick &#x3D; &quot;sayHello()&quot; value &#x3D; &quot;Say Hello&quot; &#x2F;&gt;</span><br><span class="line">  &lt;&#x2F;body&gt; </span><br><span class="line">&lt;&#x2F;html&gt;</span><br></pre></td></tr></table></figure>

<p><strong>Hello.js</strong>包含<strong>sayHello()</strong>函数。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">function sayHello() &#123;</span><br><span class="line">   alert(&quot;Hello World&quot;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="Flask-蓝图"><a href="#Flask-蓝图" class="headerlink" title="Flask 蓝图"></a>Flask 蓝图</h1><h2 id="什么是蓝图"><a href="#什么是蓝图" class="headerlink" title="什么是蓝图"></a>什么是蓝图</h2><p><code>蓝图（blueprint）</code>：用于实现单个应用的视图、模板、静态文件的集合</p>
<p>蓝图就是模块化处理的类。类似于django中app，子应用。简单来说，蓝图就是一个存储操作路由映射方法的容器，主要用来实现客户端请求和URL相互关联的功能。 在<code>Flask</code>中，将项目模块化(<strong>把写在一个文件里的路由拆封成多个文件里写路由</strong>)，blueprint，是flask自带的一种开发模式，目的是为了方便开发大型的项目</p>
<h2 id="蓝图的运行机制"><a href="#蓝图的运行机制" class="headerlink" title="蓝图的运行机制"></a>蓝图的运行机制</h2><p>蓝图是保存了一组将来可以在应用对象上执行的操作。</p>
<p>注册路由就是一种操作,当在程序实例上调用<code>route</code>装饰器注册路由时，这个操作将修改对象的<code>url_map</code>路由映射列表。当我们在蓝图对象上调用<code>route</code>装饰器注册路由时，它只是在内部的一个延迟操作记录列表<code>defered_functions</code>中添加了一个项。当执行应用对象的 <code>register_blueprint()</code> 方法时，应用对象从蓝图对象的 <code>defered_functions</code> 列表中取出每一项，即调用应用对象的 <code>add_url_rule()</code>方法，这将会修改程序实例的路由映射列表。</p>
<h2 id="蓝图的使用"><a href="#蓝图的使用" class="headerlink" title="蓝图的使用"></a>蓝图的使用</h2><ol>
<li><p>创建项目并设置settings.py文件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"># app配置类</span><br><span class="line">class Config:</span><br><span class="line">    # 步骤3 - 现在创建一个Flask应用程序对象并为要使用的数据库设置URI。</span><br><span class="line">    DEBUG &#x3D; True</span><br><span class="line">    # mysql+pymysql:&#x2F;&#x2F;user:password@hostip:port&#x2F;databasename</span><br><span class="line">    SQLALCHEMY_DATABASE_URI &#x3D; &#39;mysql+pymysql:&#x2F;&#x2F;root:1234561@172.16.0.192:3306&#x2F;flaskday05&#39;</span><br><span class="line">    SQLALCHEMY_TRACK_MODIFICATIONS &#x3D; False</span><br><span class="line">    SQLALCHEMY_ECHO &#x3D; True</span><br><span class="line"></span><br><span class="line"># 开发环境</span><br><span class="line">class DevelopmentConfig(Config):</span><br><span class="line">    ENV &#x3D; &#39;development&#39;</span><br><span class="line"></span><br><span class="line"># 生产环境</span><br><span class="line">class ProductionConfig(Config):</span><br><span class="line">    ENV &#x3D; &#39;production&#39;</span><br><span class="line">    DDEBUG &#x3D; False</span><br></pre></td></tr></table></figure>
</li>
<li><p>删除app.py中的部分内容</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">from flask import Flask</span><br><span class="line">from flask_migrate import Migrate, MigrateCommand</span><br><span class="line">from flask_script import Manager</span><br><span class="line"></span><br><span class="line">from apps import create_app</span><br><span class="line">from exts import db</span><br><span class="line"></span><br><span class="line">app &#x3D; create_app()</span><br><span class="line"></span><br><span class="line"># flask-script</span><br><span class="line">manager &#x3D; Manager(app&#x3D;app)</span><br><span class="line"># 使用里面的Manager进行命令得到管理和使用：</span><br><span class="line">migrate &#x3D; Migrate(app&#x3D;app, db&#x3D;db)</span><br><span class="line">manager.add_command(&#39;db&#39;, MigrateCommand)</span><br><span class="line"></span><br><span class="line">if __name__ &#x3D;&#x3D; &#39;__main__&#39;:</span><br><span class="line">    manager.run()</span><br></pre></td></tr></table></figure>
</li>
<li><p>创建包apps,并在包中<code>__init__.py</code>中创建app的工厂函数</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask</span><br><span class="line"><span class="keyword">import</span> settings</span><br><span class="line"><span class="keyword">from</span> apps.user.view <span class="keyword">import</span> user_bp</span><br><span class="line"><span class="keyword">from</span> exts <span class="keyword">import</span> db</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">create_app</span><span class="params">()</span>:</span></span><br><span class="line">    app = Flask(__name__, template_folder=<span class="string">'../templates'</span>, static_folder=<span class="string">'../static'</span>)  <span class="comment"># app是一个核心对象</span></span><br><span class="line">    <span class="comment"># 加载配置</span></span><br><span class="line">    app.config.from_object(settings.DevelopmentConfig)</span><br><span class="line">    <span class="comment"># 初始化配置db</span></span><br><span class="line">    db.init_app(app=app)</span><br><span class="line">    <span class="comment"># 注册蓝图</span></span><br><span class="line">    <span class="comment"># app.register_blueprint(user_bp) # 将蓝图对象绑定到app上</span></span><br><span class="line">    <span class="keyword">return</span> app</span><br></pre></td></tr></table></figure>
</li>
<li><p>在apps中创建项目的程序包比如user，goods，order等</p>
</li>
<li><p>以user为例，在user包中创建view.py，在view.py中<code>定义蓝图</code></p>
<pre><code><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">user_bp &#x3D; Blueprint(&#39;user&#39;, __name__)</span><br><span class="line"># 其中第一个参数是蓝图的名字，第二个参数是import_name</span><br></pre></td></tr></table></figure></code></pre></li>
<li><p>使用蓝图定义路由和视图函数</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@user_bp.route('/')</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">user_center</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">'user/show.html'</span>, users=users)</span><br></pre></td></tr></table></figure>

<p>注意在蓝图中进行了模板的加载，而模板的文件夹默认是跟flask对象是同级的，如果不是同级的注意在Flask对象创建的时候初始化设置</p>
</li>
<li><p>注册蓝图到app对象上,在<code>__init__.py</code>方法<code>create_app()</code>中添加</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># 注册蓝图</span><br><span class="line"># app.register_blueprint(user_bp) # 将蓝图对象绑定到app上</span><br></pre></td></tr></table></figure>

</li>
</ol>
<h1 id="Flask-Script"><a href="#Flask-Script" class="headerlink" title="Flask-Script"></a>Flask-Script</h1><p><strong>Flask-Script是一个让你的命令行支持自定义命令的工具，它为Flask程序添加一个命令行解释器。可以让我们的程序从命令行直接执行相应的程序</strong>。</p>
<p>通过使用<code>Flask-Script</code>扩展，我们可以在Flask服务器启动的时候，通过命令行的方式传入参数。而不仅仅通过<code>app.run</code>()方法中传参，比如我们可以通过<code>python hello.py runserver –h ip地址 -p 端口</code>地址，告诉服务器在哪个网络接口监听来自客户端的连接。默认情况下，服务器只监听来自服务器所在计算机发起的连接，即<code>localhost</code>连接。我们可以通过<code>python hello.py runserver --help</code>来查看参数。</p>
<p><code>Flask-Script</code>插件为在Flask里编写额外的脚本提供了支持。包括了一个开发服务器，一个定制的Python命令行，用于执行初始化数据库、定时任务和其他属于web应用之外的命令行任务的脚本</p>
<h2 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install flask-script</span><br></pre></td></tr></table></figure>

<h2 id="集成Flask-Script到falsk应用中"><a href="#集成Flask-Script到falsk应用中" class="headerlink" title="集成Flask-Script到falsk应用中"></a>集成Flask-Script到falsk应用中</h2><p><code>app.py</code>文件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">from flask import Flask</span><br><span class="line"></span><br><span class="line">app &#x3D; Flask(__name__)</span><br><span class="line"></span><br><span class="line">&quot;&quot;&quot;使用flask-script启动项目&quot;&quot;&quot;</span><br><span class="line">from flask_script import Manager</span><br><span class="line"></span><br><span class="line"># 使用里面的Manager进行命令得到管理和使用：</span><br><span class="line">manager &#x3D; Manager(app&#x3D;app)</span><br><span class="line"></span><br><span class="line">@app.route(&#39;&#x2F;&#39;)</span><br><span class="line">def index():</span><br><span class="line">    return &#39;hello world&#39;</span><br><span class="line"></span><br><span class="line">if  __name__ &#x3D;&#x3D; &quot;__main__&quot;</span><br><span class="line">	# 使用manager启动</span><br><span class="line">    manager.run()</span><br></pre></td></tr></table></figure>

<p>在终端使用命令启动:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python app.py runserver</span><br></pre></td></tr></table></figure>

<p>设置主机和端口启动:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python app.py runserver -h 0.0.0.0 -p 5001</span><br></pre></td></tr></table></figure>

<h2 id="自定义命令"><a href="#自定义命令" class="headerlink" title="自定义命令"></a>自定义命令</h2><p>使用<code>@manager.command</code>装饰器,<strong>注意:</strong>必须要引入当前的app对象(即<code>Flask</code>的初始化对象,app只是一个变量名)，然后传入给<code>Manager</code>对象,赋值给一个变量为<code>manager</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># 装饰命令的功能添加到注册表中</span><br><span class="line">@manager.command</span><br><span class="line">def init():</span><br><span class="line">    print(&#39;初始化&#39;)</span><br></pre></td></tr></table></figure>

<blockquote>
<p><code>@manager.command</code>中的manager为Manager对象的变量引用,只要遵循变量的命令规则即可使用</p>
</blockquote>
<p>终端:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python app.py init</span><br></pre></td></tr></table></figure>

<p>#Flask-migrate</p>
<p>Flask-Migrate 插件提供了和 Django 自带的 migrate 类似的功能。</p>
<p>即 Alembic（<code>Database migration</code>数据迁移跟踪记录）提供的数据库升级和降级的功能。它所能实现的效果有如 Git 管理项目代码一般。</p>
<h3 id="安装-Flask-Migrate"><a href="#安装-Flask-Migrate" class="headerlink" title="安装 Flask-Migrate"></a>安装 Flask-Migrate</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install flask-migrate</span><br></pre></td></tr></table></figure>

<blockquote>
<p>多数情况下 <code>Flask-Migrate</code> 是会和命令行工具插件 <code>Flask-Script</code> 和数据库插件 <code>flask_sqlalchemy</code> 一起使用的，所有也把 Flask-Script 安装一下：</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install flask-script</span><br></pre></td></tr></table></figure>

<h3 id="实例"><a href="#实例" class="headerlink" title="实例"></a>实例</h3><p>官方文档给出的例子：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask</span><br><span class="line"><span class="keyword">from</span> flask_sqlalchemy <span class="keyword">import</span> SQLAlchemy</span><br><span class="line"><span class="keyword">from</span> flask_script <span class="keyword">import</span> Manager</span><br><span class="line"><span class="keyword">from</span> flask_migrate <span class="keyword">import</span> Migrate, MigrateCommand</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line">app.config[<span class="string">'SQLALCHEMY_DATABASE_URI'</span>] = <span class="string">'sqlite:///app.db'</span></span><br><span class="line"></span><br><span class="line">db = SQLAlchemy(app)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 初始化 migrate</span></span><br><span class="line"><span class="comment"># 两个参数一个是 Flask 的 app，一个是数据库 db</span></span><br><span class="line">migrate = Migrate(app, db)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 初始化管理器</span></span><br><span class="line">manager = Manager(app)</span><br><span class="line"><span class="comment"># 添加 db 命令，并与 MigrateCommand 绑定</span></span><br><span class="line">manager.add_command(<span class="string">'db'</span>, MigrateCommand)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 构建我们的数据模型</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">User</span><span class="params">(db.Model)</span>:</span></span><br><span class="line">    id = db.Column(db.Integer, primary_key=<span class="literal">True</span>)</span><br><span class="line">    name = db.Column(db.String(<span class="number">128</span>))</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    manager.run()</span><br></pre></td></tr></table></figure>

<p>假设上面的代码保存在文件 <code>manage.py</code> 中，我们可以这样执行相关命令：</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ python manage.py db init</span><br><span class="line">$ python manage.py db migrate</span><br><span class="line">$ python manage.py db upgrade</span><br><span class="line">$ python manage.py db --help</span><br></pre></td></tr></table></figure>

<p>当然，更多情况下我们不会把代码都放到一个文件里面，我们应该建立一个 <code>manage.py</code> 来放置相关代码，详细源码我传到 Github 上面：<a href="https://github.com/SingleDiego/flask-migrate" target="_blank" rel="noopener">https://github.com/SingleDiego/flask-migrate</a> </p>
<h3 id="查看指令-manager-db-的可用选项"><a href="#查看指令-manager-db-的可用选项" class="headerlink" title="查看指令 manager db 的可用选项"></a>查看指令 manager db 的可用选项</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; python manage.py db</span><br><span class="line">usage: Perform database migrations</span><br><span class="line"></span><br><span class="line">Perform database migrations</span><br><span class="line"></span><br><span class="line">positional arguments:</span><br><span class="line">  &#123;init,revision,migrate,edit,merge,upgrade,downgrade,show,history,heads,branches,current,stamp&#125;</span><br><span class="line">    init                Creates a <span class="keyword">new</span> migration repository</span><br><span class="line">    revision            Create a <span class="keyword">new</span> revision file.</span><br><span class="line">    migrate             Alias <span class="keyword">for</span> <span class="string">'revision --autogenerate'</span></span><br><span class="line">    edit                Edit current revision.</span><br><span class="line">    merge               Merge two revisions together. Creates a <span class="keyword">new</span> migration</span><br><span class="line">                        file</span><br><span class="line">    upgrade             Upgrade to a later version</span><br><span class="line">    downgrade           Revert to a previous version</span><br><span class="line">    show                Show the revision denoted by the given symbol.</span><br><span class="line">    history             <span class="keyword">List</span> changeset scripts in chronological order.</span><br><span class="line">    heads               Show current available heads in the script directory</span><br><span class="line">    branches            Show current branch points</span><br><span class="line">    current             Display the current revision <span class="keyword">for</span> each database.</span><br><span class="line">    stamp               <span class="string">'stamp'</span> the revision table with the given revision;</span><br><span class="line">                        don<span class="string">'t run any migrations</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">optional arguments:</span></span><br><span class="line"><span class="string">  -?, --help            show this help message and exit</span></span><br></pre></td></tr></table></figure>

<h3 id="初始化-DB-Migrate"><a href="#初始化-DB-Migrate" class="headerlink" title="初始化 DB Migrate"></a>初始化 DB Migrate</h3><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;</span>&gt; python manage.py db init</span><br></pre></td></tr></table></figure>

<p>执行该命令后会创建一个 <code>migrations</code> 目录，所有的更改记录文件都会被保存在该目录下。</p>
<h3 id="开始第一次跟踪"><a href="#开始第一次跟踪" class="headerlink" title="开始第一次跟踪"></a>开始第一次跟踪</h3><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;</span>&gt; python manage.py db migrate -m <span class="string">"Initial migration"</span></span><br></pre></td></tr></table></figure>

<p>该指令会扫描所有的 SQLAlchemy 对象，并将没有记录过的行和列记录成为一个 python 文件并保存到 <code>migrations/versions</code> 路径下。然后给本次扫描结果分配一个版本号。生成的数据库会有一张名为 <code>alembic_version</code> 的空表来记录数据库版本号。</p>
<p>例如，我的例子中第一个版本的版本号就是： <code>6c1971cccc11_initial_migration.py</code>，打开该文件，可以看到该文件记录了数据库的结果，比如这样：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">upgrade</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="comment"># ### commands auto generated by Alembic - please adjust! ###</span></span><br><span class="line">    op.create_table(<span class="string">'user'</span>,</span><br><span class="line">    sa.Column(<span class="string">'id'</span>, sa.Integer(), nullable=<span class="literal">False</span>),</span><br><span class="line">    sa.Column(<span class="string">'name'</span>, sa.String(length=<span class="number">128</span>), nullable=<span class="literal">True</span>),</span><br><span class="line">    sa.PrimaryKeyConstraint(<span class="string">'id'</span>)</span><br><span class="line">    )</span><br><span class="line">    <span class="comment"># ### end Alembic commands ###</span></span><br></pre></td></tr></table></figure>

<h3 id="根据记录文件生成数据库"><a href="#根据记录文件生成数据库" class="headerlink" title="根据记录文件生成数据库"></a>根据记录文件生成数据库</h3><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;</span>&gt; python manage.py db upgrade</span><br></pre></td></tr></table></figure>

<p>该命令会根据 <code>migrations/versions</code> 路径下的文件来创建或修改数据库，生成的数据库会有一张名为 <code>alembic_version</code> 的表来记录数据库版本号。</p>
<h3 id="回滚到某历史版本"><a href="#回滚到某历史版本" class="headerlink" title="回滚到某历史版本"></a>回滚到某历史版本</h3><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 获取 History ID</span></span><br><span class="line"><span class="meta">&gt;&gt;</span>&gt; python manage.py db history</span><br><span class="line"></span><br><span class="line"><span class="comment"># 回滚到某个 history</span></span><br><span class="line"><span class="meta">&gt;&gt;</span>&gt; python manage.py db downgrade &lt;history_id&gt;</span><br></pre></td></tr></table></figure>

<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p><code>flask_migrate</code>相关的命令： </p>
<ul>
<li><code>python manage.py db init</code>：初始化一个迁移脚本的环境，只需要执行一次。</li>
<li><code>python manage.py db migrate</code>：将模型生成迁移文件，只要模型更改了，就需要执行一遍这个命令。</li>
<li><code>python manage.py db upgrade</code>：将迁移文件真正的映射到数据库中。每次运行了<code>migrate</code>命令后，就记得要运行这个命令。</li>
</ul>
<h2 id="问题"><a href="#问题" class="headerlink" title="问题"></a>问题</h2><blockquote>
<p>使用<code>flask-migrate</code>进行数据库迁移时，如果更改db.String()的长度？该如何同步</p>
</blockquote>
<p>比如有一个简单的模型</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">class User(db.Model):</span><br><span class="line">    id &#x3D; db.Column(db.Integer, primary_key&#x3D;True)</span><br><span class="line">    username &#x3D; db.Column(db.String(32), index&#x3D;True)</span><br></pre></td></tr></table></figure>

<p>一开始，<code>username</code>的长度限制在32,现在将其增大，比如说变为128，<code>flask-migrate</code>似乎不会检测到这个<code>String</code>变长的变化。</p>
<p>我使用了命令自动生成迁移脚本</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">python app.py db migrate -m &quot;some comment&quot;</span><br><span class="line">python app.py db upgrade</span><br></pre></td></tr></table></figure>

<p>之后，发现<code>username</code>的列的长度依旧被限制在32.</p>
<p><strong>如何进行String长度的变化这种迁移？</strong></p>
<blockquote>
<p>解决问题:</p>
<p><code>alem­bic</code> 支持检测字段长度改变，不过它不是默认的，需要配置；找到 <code>mi­gra­tions/env.py</code>文件，在 <code>run_mi­gra­tions_on­line</code> 函数(<code>87行左右</code>)加入如下内容：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">context.configure(</span><br><span class="line">    connection&#x3D;connection,</span><br><span class="line">    target_metadata&#x3D;target_metadata,</span><br><span class="line">    process_revision_directives&#x3D;process_revision_directives,</span><br><span class="line">    compare_type&#x3D;True,  # 检查字段类型</span><br><span class="line">    compare_server_default&#x3D;True,  # 比较默认值</span><br><span class="line">    **current_app.extensions[&#39;migrate&#39;].configure_args</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<p>重新进行模型迁移</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python manage.py db migrate</span><br></pre></td></tr></table></figure>

<p>查看 up­grade 函数内，可以发现更改的内容已在里面。</p>
</blockquote>
<h1 id="Flask-SQLAlchemy"><a href="#Flask-SQLAlchemy" class="headerlink" title="Flask SQLAlchemy"></a>Flask SQLAlchemy</h1><h2 id="Flask-SQLAlchemy-1"><a href="#Flask-SQLAlchemy-1" class="headerlink" title="Flask SQLAlchemy"></a>Flask SQLAlchemy</h2><p>在<code>Flask Web</code>应用程序中使用原始SQL对数据库执行CRUD操作可能很繁琐。相反， <strong>SQLAlchemy</strong> ，Python工具包是一个强大的<strong>ORMapper</strong>，它为应用程序开发人员提供了SQL的全部功能和灵活性。Flask-SQLAlchemy是Flask扩展，它将对SQLAlchemy的支持添加到Flask应用程序中。</p>
<p><strong>什么是ORM（Object Relation Mapping，对象关系映射）？</strong></p>
<p>大多数编程语言平台是面向对象的。另一方面，RDBMS服务器中的数据存储为表。对象关系映射是将对象参数映射到底层RDBMS表结构的技术。ORM API提供了执行CRUD操作的方法，而不必编写原始SQL语句。</p>
<h2 id="Flask-SQLAlchemy环境搭建"><a href="#Flask-SQLAlchemy环境搭建" class="headerlink" title="Flask SQLAlchemy环境搭建"></a>Flask SQLAlchemy环境搭建</h2><p><strong>步骤1</strong> - 安装<code>Flask-SQLAlchemy</code>扩展。<code>pymysql</code>,<code>flask-migrate</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">pip install pymysql   # mysql连接</span><br><span class="line">pip install flask-migrate  # 发布命令工具</span><br><span class="line">pip install flask-sqlalchemy  # 实现ORM映射</span><br></pre></td></tr></table></figure>

<p><strong>步骤2</strong>-创建<code>settings.py</code>配置数据库的连接路径</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">class Config:</span><br><span class="line">    DEBUG &#x3D; True</span><br><span class="line">    # mysql+pymysql:&#x2F;&#x2F;user:password@hostip:port&#x2F;databasename</span><br><span class="line">    SQLALCHEMY_DATABASE_URI &#x3D; &#39;mysql+pymysql:&#x2F;&#x2F;root:root@127.0.0.1:3306&#x2F;flaskday05&#39;</span><br><span class="line">    SQLALCHEMY_TRACK_MODIFICATIONS &#x3D; False</span><br><span class="line">    SQLALCHEMY_ECHO &#x3D; True</span><br><span class="line"></span><br><span class="line">class DevelopmentConfig(Config):</span><br><span class="line">    ENV &#x3D; &#39;development&#39;</span><br><span class="line"></span><br><span class="line">class ProductionConfig(Config):</span><br><span class="line">    ENV &#x3D; &#39;production&#39;</span><br><span class="line">    DDEBUG &#x3D; False</span><br></pre></td></tr></table></figure>

<p><strong>步骤2</strong> - 创建包<code>ext</code>,在<code>__init__.py</code>中添加</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">#创建一个映射对象</span><br><span class="line">from flask_sqlalchemy import SQLAlchemy</span><br><span class="line">db &#x3D; SQLAlchemy()  # 必须跟app联系</span><br></pre></td></tr></table></figure>

<p><strong>步骤3</strong> - 创建包<code>apps</code>,在<code>__init__.py</code>中添加</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">from flask import Flask</span><br><span class="line"></span><br><span class="line">import settings</span><br><span class="line"># 敲黑板：需要将你想要映射到数据库中的模型，都要导入到manage(app).py文件中，如果没有导入进去，就不会映射到数据库中</span><br><span class="line">from apps.user.view import user_bp</span><br><span class="line">from ext import db</span><br><span class="line"></span><br><span class="line">def create_app():</span><br><span class="line">    app &#x3D; Flask(__name__, template_folder&#x3D;&#39;..&#x2F;templates&#39;, static_folder&#x3D;&#39;..&#x2F;static&#39;)</span><br><span class="line">    app.config.from_object(settings.DevelopmentConfig)</span><br><span class="line">    db.init_app(app)  # 将db对象与app进行了关联</span><br><span class="line">    # 注册蓝图</span><br><span class="line">    app.register_blueprint(user_bp)</span><br><span class="line">    return app</span><br></pre></td></tr></table></figure>

<p><strong>步骤4</strong> - 在<code>app.py</code>配置<code>flask-migrate</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">from flask import Flask</span><br><span class="line">from flask_migrate import Migrate, MigrateCommand</span><br><span class="line">from flask_script import Manager</span><br><span class="line">from apps.user.models import User,UserInfo</span><br><span class="line">from apps import create_app</span><br><span class="line">from ext import db</span><br><span class="line"></span><br><span class="line">app &#x3D; create_app()</span><br><span class="line">manager &#x3D; Manager(app&#x3D;app)</span><br><span class="line"># flask-migrate命令工具</span><br><span class="line">migrate &#x3D; Migrate(app&#x3D;app, db&#x3D;db)</span><br><span class="line">manager.add_command(&#39;db&#39;, MigrateCommand)</span><br><span class="line"></span><br><span class="line">if __name__ &#x3D;&#x3D; &#39;__main__&#39;:</span><br><span class="line">    manager.run()</span><br></pre></td></tr></table></figure>

<p><strong>步骤5</strong>- 然后使用应用程序对象作为参数创建<code>SQLAlchemy</code>类的对象。该对象包含用于<code>ORM</code>操作的辅助函数。它还提供了一个父<code>Model</code>类，使用它来声明用户定义的模型。在下面的代码段中，创建了<strong>students</strong>模型。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"># ORM   类 ----》 表</span><br><span class="line"># 类对象  ---〉表中的一条记录</span><br><span class="line">from datetime import datetime</span><br><span class="line"></span><br><span class="line">from ext import db</span><br><span class="line"></span><br><span class="line">#相当于SQL:create table user(id int primarykey auto_increment,username varchar(20) not null,..)</span><br><span class="line">class User(db.Model):</span><br><span class="line">    # db.Column(类型，约束)  映射表中的列</span><br><span class="line">    &#39;&#39;&#39;</span><br><span class="line">    类型： </span><br><span class="line">    Integer        整型</span><br><span class="line">    String(size)   字符串类型，务必指定大小</span><br><span class="line">    Text          长文本类型</span><br><span class="line">    DateTime       日期时间</span><br><span class="line">    Float         浮点类型</span><br><span class="line">    Boolean        布尔类型</span><br><span class="line">    PickleType     存储pickle类型  主要跟序列化有关</span><br><span class="line">    LargeBinary    存储大的二进制类型</span><br><span class="line">    </span><br><span class="line">    可选的：</span><br><span class="line">    primary_key&#x3D;True   主键</span><br><span class="line">    autoincrement&#x3D;True  自增</span><br><span class="line">    nullable&#x3D;False      不允许为空</span><br><span class="line">    unique&#x3D;True         唯一</span><br><span class="line">    default&#x3D;datetime.now  默认值  可以设置成当前系统时间或者其他的值</span><br><span class="line">    &#39;&#39;&#39;</span><br><span class="line">    id &#x3D; db.Column(db.Integer, primary_key&#x3D;True, autoincrement&#x3D;True)</span><br><span class="line">    username &#x3D; db.Column(db.String(15), nullable&#x3D;False)</span><br><span class="line">    password &#x3D; db.Column(db.String(12), nullable&#x3D;False)</span><br><span class="line">    phone &#x3D; db.Column(db.String(11), unique&#x3D;True)</span><br><span class="line">    email &#x3D; db.Column(db.String(20))</span><br><span class="line">    rdatetime &#x3D; db.Column(db.DateTime, default&#x3D;datetime.now)</span><br><span class="line"></span><br><span class="line">    def __str__(self):</span><br><span class="line">        return self.username</span><br><span class="line"></span><br><span class="line">class UserInfo(db.Model):</span><br><span class="line">    id &#x3D; db.Column(db.Integer, primary_key&#x3D;True, autoincrement&#x3D;True)</span><br><span class="line">    realname &#x3D; db.Column(db.String(20))</span><br><span class="line">    gender &#x3D; db.Column(db.Boolean, default&#x3D;False)</span><br><span class="line"></span><br><span class="line">    def __str__(self):</span><br><span class="line">        return self.realname</span><br></pre></td></tr></table></figure>

<blockquote>
<p><strong>敲黑板</strong>：需要将你想要映射到数据库中的模型，都要导入到<code>manage(app).py</code>文件中，如果没有导入进去，就不会映射到数据库中</p>
</blockquote>
<p><strong>步骤5</strong> - 在终端使用<code>db</code>命令生成数据库</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">python app.py db init   -----》 产生一个文件夹migrations</span><br><span class="line">python app.py db migrate -----&gt; 在versions文件夹下自动产生了一个.py的版本文件</span><br></pre></td></tr></table></figure>

<p><strong>项目结构</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">| ---apps</span><br><span class="line">| ---ext</span><br><span class="line">| ---static</span><br><span class="line">| ---templates</span><br><span class="line">| ---migrations      # python app.py db init  只需要init一次</span><br><span class="line">    |---versions   版本文件夹</span><br><span class="line">        |---71edde7ee937_.py    ---》  python app.py db migrate  迁移</span><br><span class="line">        |---cc0dca61130f_.py</span><br><span class="line">                    # python app.py db upgrade   根据记录文件生成数据库</span><br><span class="line">                    # python app.py db downgrade 回滚到某历史版本</span><br></pre></td></tr></table></figure>

<h2 id="测试添加数据"><a href="#测试添加数据" class="headerlink" title="测试添加数据"></a>测试添加数据</h2><p>添加数据：以注册用户为例</p>
<ol>
<li><p>在templates文件夹中创建user/register.html页面</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>用户注册<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>用户注册<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">'&#123;&#123; url_for('</span><span class="attr">user.register</span>') &#125;&#125;' <span class="attr">method</span>=<span class="string">"post"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">name</span>=<span class="string">"username"</span> <span class="attr">placeholder</span>=<span class="string">"用户名"</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"password"</span> <span class="attr">name</span>=<span class="string">"password"</span> <span class="attr">placeholder</span>=<span class="string">"密码"</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"password"</span> <span class="attr">name</span>=<span class="string">"repassword"</span> <span class="attr">placeholder</span>=<span class="string">"确认密码"</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">name</span>=<span class="string">"phone"</span> <span class="attr">placeholder</span>=<span class="string">"手机号码"</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"submit"</span> <span class="attr">value</span>=<span class="string">"用户注册"</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><img src="http://cdn.panyucable.cn/zysheep/QQ%E6%88%AA%E5%9B%BE20200805172125.png" alt=""></p>
</li>
<li><p>在apps包下创建<code>user/view.py</code>文件</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Blueprint, request, render_template</span><br><span class="line"><span class="keyword">from</span> apps.user.models <span class="keyword">import</span> User</span><br><span class="line"><span class="keyword">from</span> ext <span class="keyword">import</span> db</span><br><span class="line">user_bp = Blueprint(<span class="string">'user'</span>, __name__)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@user_bp.route('/register', methods=['GET', 'POST'])</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">register</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">if</span> request.method == <span class="string">'POST'</span>:</span><br><span class="line">        username = request.form.get(<span class="string">'username'</span>)</span><br><span class="line">        password = request.form.get(<span class="string">'password'</span>)</span><br><span class="line">        repassword = request.form.get(<span class="string">'repassword'</span>)</span><br><span class="line">        phone = request.form.get(<span class="string">'phone'</span>)</span><br><span class="line">        <span class="keyword">if</span> password == repassword:</span><br><span class="line">            <span class="comment"># 1. 找到模型类并创建对象</span></span><br><span class="line">            user = User()</span><br><span class="line">            <span class="comment"># 2. 给对象的属性赋值</span></span><br><span class="line">            user.username = username</span><br><span class="line">            user.password = hashlib.sha256(password.encode(<span class="string">'utf-8'</span>)).hexdigest()</span><br><span class="line">            user.phone = phone</span><br><span class="line">            <span class="comment"># 3. 将user对象添加到session中（类似缓存）</span></span><br><span class="line">            db.session.add(user)</span><br><span class="line">            <span class="comment"># 4.提交数据</span></span><br><span class="line">            db.session.commit()</span><br><span class="line">            <span class="comment"># 在使用蓝图的情况下使用url_for(),必须带有蓝图名</span></span><br><span class="line">            <span class="keyword">return</span> redirect(url_for(<span class="string">'user.user_center'</span>))</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">'user/register.html'</span>)</span><br></pre></td></tr></table></figure>

<blockquote>
<p>注意:在view中定义了蓝图,需要在app对象中进行注册 <code># app.register_blueprint(user_bp)</code></p>
</blockquote>
</li>
<li><p>center.html</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>用户中心<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"&#123;&#123; url_for('user.register') &#125;&#125;"</span>&gt;</span>注册<span class="tag">&lt;/<span class="name">a</span>&gt;</span> <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"&#123;&#123; url_for('user.login') &#125;&#125;"</span>&gt;</span>登录<span class="tag">&lt;/<span class="name">a</span>&gt;</span> <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">""</span>&gt;</span>退出<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h1</span>&gt;</span>所有用户信息如下：<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">    &#123;% if users %&#125;</span><br><span class="line">        <span class="tag">&lt;<span class="name">table</span> <span class="attr">border</span>=<span class="string">"1"</span> <span class="attr">cellspacing</span>=<span class="string">"0"</span> <span class="attr">width</span>=<span class="string">"50%"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">th</span>&gt;</span>序号<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">th</span>&gt;</span>用户名<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">th</span>&gt;</span>手机号<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">th</span>&gt;</span>注册时间<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">th</span>&gt;</span>操作<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">            &#123;% for user in users %&#125;</span><br><span class="line">                <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">th</span>&gt;</span>&#123;&#123; loop.index &#125;&#125;<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">th</span>&gt;</span>&#123;&#123; user.username &#125;&#125;<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">th</span>&gt;</span>&#123;&#123; user.phone &#125;&#125;<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">th</span>&gt;</span>&#123;&#123; user.rdatetime &#125;&#125;<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">th</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">""</span>&gt;</span>更新<span class="tag">&lt;/<span class="name">a</span>&gt;</span> <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">""</span>&gt;</span>删除<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">            &#123;% endfor %&#125;</span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;/<span class="name">table</span>&gt;</span></span><br><span class="line">    &#123;% else %&#125;</span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span> <span class="attr">style</span>=<span class="string">"color: red; font-size: 20px;"</span>&gt;</span>当前还没有任何的用户，抓紧时间注册吧！！！<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    &#123;% endif %&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><img src="http://cdn.panyucable.cn/zysheep/QQ%E6%88%AA%E5%9B%BE20200805172256.png" alt=""></p>
</li>
</ol>
<h2 id="CRUD方法"><a href="#CRUD方法" class="headerlink" title="CRUD方法"></a>CRUD方法</h2><p><strong>SQLAlchemy</strong>的<strong>Session</strong>对象管理<strong>ORM</strong>对象的所有持久性操作。</p>
<p>以下<code>session</code>方法执行CRUD操作：</p>
<ul>
<li><strong>db.session.add</strong> (模型对象) - 将记录插入到映射表中</li>
<li><strong>db.session.delete</strong> (模型对象) - 从表中删除记录</li>
<li><strong>model.query.all()</strong> - 从表中检索所有记录（对应于<code>select * from user</code>）。</li>
</ul>
<p>您可以通过使用<code>filter</code>属性将过滤器应用于检索到的记录集。例如，要在学生表中检索<strong>city =’Hyderabad’</strong>的记录，请使用以下语句：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Students.query.filter_by(city &#x3D; ’Hyderabad’).all()</span><br></pre></td></tr></table></figure>

<h3 id="查询"><a href="#查询" class="headerlink" title="查询"></a>查询</h3><p>1)查询所有： </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">模型类.query.all()    ~  select * from user;</span><br></pre></td></tr></table></figure>

<p>2)如果有条件的查询：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">模型类.query.filter_by(字段名 &#x3D; 值)   ～  select * from user where 字段&#x3D;值；</span><br><span class="line">模型类.query.filter_by(字段名 &#x3D; 值).first()   ～  select * from user where 字段&#x3D;值 limit..</span><br></pre></td></tr></table></figure>

<p>3)模型类.query.filter()</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">1. 模型类.query.filter().all()   -----&gt; 列表</span><br><span class="line">2. 模型类.query.filter().first()  -----&gt;对象</span><br><span class="line">3.  User.query.filter(User.username.endswith(&#39;z&#39;)).all()  </span><br><span class="line">	select * from user where username like &#39;%z&#39;;</span><br><span class="line">    User.query.filter(User.username.startswith(&#39;z&#39;)).all() </span><br><span class="line">    # select * from user where username like &#39;z%&#39;;</span><br><span class="line">    User.query.filter(User.username.contains(&#39;z&#39;)).all() </span><br><span class="line">    # select * from user where username like &#39;%z%&#39;;</span><br><span class="line">  User.query.filter(User.username.like(&#39;z%&#39;)).all()</span><br></pre></td></tr></table></figure>

<p>4)多条件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">并且： and_    获取： or_   非： not_</span><br><span class="line"></span><br><span class="line">1. User.query.filter(or_(User.username.like(&#39;z%&#39;), User.username.contains(&#39;i&#39;))).all()</span><br><span class="line">类似： select * from user where username like &#39;z%&#39; or username like &#39;%i%&#39;;</span><br><span class="line">2. User.query.filter(and_(User.username.contains(&#39;i&#39;), User.rdatetime.__gt__(&#39;2020-05-25 10:30:00&#39;))).all()</span><br><span class="line"> # select * from user where username like &#39;%i%&#39; and rdatetime &lt; &#39;xxxx&#39;</span><br><span class="line">3. User.query.filter(not_(User.username.contains(&#39;i&#39;))).all()</span><br></pre></td></tr></table></figure>

<blockquote>
<p>补充：<code>__gt__,__lt__,__ge__(gt equal),__le__</code>（le equal）  —-》通常应用在范围（整型，日期） 也可以直接使用 &gt;  &lt;  &gt;=  &lt;=  !=</p>
</blockquote>
<p>5)排序：order_by</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">user_list &#x3D; User.query.filter(User.username.contains(&#39;z&#39;)).order_by(-User.rdatetime).all() </span><br><span class="line"># 先筛选再排序</span><br><span class="line">user_list &#x3D; User.query.order_by(-User.id).all()  对所有的进行排序</span><br><span class="line">注意：order_by(参数)：</span><br><span class="line">1. 直接是字符串： &#39;字段名&#39;  但是不能倒序</span><br><span class="line">2. 填字段名： 模型.字段    order_by(-模型.字段)  倒序</span><br></pre></td></tr></table></figure>

<p>6)限制： limit</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"># limit的使用 + offset</span><br><span class="line"># user_list &#x3D; User.query.limit(2).all()   默认获取前两条</span><br><span class="line">user_list &#x3D; User.query.offset(2).limit(2).all()   跳过2条记录再获取两条记录</span><br></pre></td></tr></table></figure>

<p><strong>总结:</strong></p>
<ol>
<li>User.query.all()  所有</li>
<li>User.query.get(pk)  一个</li>
<li>User.query.filter() <ul>
<li>如果要检索的字段是字符串（varchar，db.String）:<ul>
<li>User.username.startswith(‘’)</li>
<li>User.username.endswith(‘’)</li>
<li>User.username.contains(‘’)</li>
<li>User.username.like(‘’)</li>
<li>User.username.in_([‘’,’’,’’])</li>
<li>User.username == ‘zzz’</li>
</ul>
</li>
<li>如果要检索的字段是整型或者日期类型：<ul>
<li><code>User.age.__lt__(18)</code></li>
<li><code>User.rdatetime.__gt__(&#39;.....&#39;)</code></li>
<li><code>User.age.__le__(18)</code></li>
<li><code>User.age.__ge__(18)</code></li>
<li><code>User.age.between(15,30)</code></li>
</ul>
</li>
<li>多个条件一起检索：<code>and_, or_</code></li>
<li>非的条件： <code>not_</code></li>
<li>排序：order_by()</li>
<li>获取指定数量： limit() offset()</li>
</ul>
</li>
<li>User.query.filter_by()</li>
</ol>
<h3 id="添加"><a href="#添加" class="headerlink" title="添加"></a>添加</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"># 1. 找到模型类并创建对象</span><br><span class="line">user &#x3D; User()</span><br><span class="line"># 2. 给对象的属性赋值</span><br><span class="line">user.username &#x3D; username</span><br><span class="line">user.password &#x3D; hashlib.sha256(password.encode(&#39;utf-8&#39;)).hexdigest()</span><br><span class="line">user.phone &#x3D; phone</span><br><span class="line"># 3. 将user对象添加到session中（类似缓存）</span><br><span class="line">db.session.add(user)</span><br><span class="line"># 4.提交数据</span><br><span class="line">db.session.commit()</span><br></pre></td></tr></table></figure>

<h3 id="删除"><a href="#删除" class="headerlink" title="删除"></a>删除</h3><h4 id="逻辑删除"><a href="#逻辑删除" class="headerlink" title="逻辑删除"></a>逻辑删除</h4><p>逻辑删除（定义数据库中的表的时候，添加一个字段isdelete，通过此字段控制是否删除）,实际上是更新操作</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">id &#x3D; request.args.get(id)</span><br><span class="line">user &#x3D; User.query.get(id)</span><br><span class="line">user.isdelete &#x3D; True</span><br><span class="line"># 提交更改</span><br><span class="line">db.session.commit()</span><br></pre></td></tr></table></figure>

<p>####物理删除</p>
<p>物理删除(彻底从数据库中删掉)</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">id &#x3D; request.args.get(id)</span><br><span class="line">user &#x3D; User.query.get(id)</span><br><span class="line">db.session.delete(user)</span><br><span class="line"># 提交更改</span><br><span class="line">db.session.commit()</span><br></pre></td></tr></table></figure>

<h3 id="更新"><a href="#更新" class="headerlink" title="更新"></a>更新</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">id &#x3D; request.args.get(id)</span><br><span class="line">user &#x3D; User.query.get(id)</span><br><span class="line"># 修改对象的属性</span><br><span class="line">user.username&#x3D; xxxx</span><br><span class="line">user.phone &#x3D;xxxx</span><br><span class="line"># 提交更改</span><br><span class="line">db.session.commit()</span><br></pre></td></tr></table></figure></div><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="mailto:undefined">三月三</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="https://zysheep.cn/2020/04/06/Python/Flask%E5%AD%A6%E4%B9%A0/">https://zysheep.cn/2020/04/06/Python/Flask学习/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://zysheep.cn" target="_blank">三月三</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/Python/">Python</a><a class="post-meta__tags" href="/tags/Flask/">Flask</a></div><div class="post_share"><div class="social-share" data-image="http://cdn.panyucable.cn/zysheep/flask_cover.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css"/><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js"></script></div></div><div class="post-reward"><a class="reward-button button--primary button--animated"> <i class="fa fa-qrcode"></i> 打赏<div class="reward-main"><ul class="reward-all"><li class="reward-item"><img class="post-qr-code__img" src="https://cdn.jsdelivr.net/gh/zysheep/picgo-imgs/imgwechat.png" alt="微信"/><div class="post-qr-code__desc">微信</div></li><li class="reward-item"><img class="post-qr-code__img" src="https://cdn.jsdelivr.net/gh/zysheep/picgo-imgs/imgalipay.jpg" alt="支付寶"/><div class="post-qr-code__desc">支付寶</div></li></ul></div></a></div><nav class="pagination_post" id="pagination"><div class="prev-post pull_left"><a href="/2020/05/20/%E5%85%B3%E4%BA%8E%E6%88%91/"><img class="prev_cover" src="https://cdn.jsdelivr.net/gh/zysheep/picgo-imgs/img2.jpg" onerror="onerror=null;src='/img/404.jpg'"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">关于我</div></div></a></div><div class="next-post pull_right"><a href="/2020/04/04/Python/%E8%99%9A%E6%8B%9F%E7%8E%AF%E5%A2%83%E7%AE%A1%E7%90%86/"><img class="next_cover" src="http://cdn.panyucable.cn/zysheep/Python_cover.png" onerror="onerror=null;src='/img/404.jpg'"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">虚拟环境管理</div></div></a></div></nav><div class="relatedPosts"><div class="relatedPosts_headline"><i class="fa fa-fw fa-thumbs-up" aria-hidden="true"></i><span> 相关推荐</span></div><div class="relatedPosts_list"><div class="relatedPosts_item"><a href="/2020/04/04/Python/虚拟环境管理/" title="虚拟环境管理"><img class="relatedPosts_cover" src="http://cdn.panyucable.cn/zysheep/Python_cover.png"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="fa fa-calendar fa-fw" aria-hidden="true"></i> 2020-04-04</div><div class="relatedPosts_title">虚拟环境管理</div></div></a></div><div class="relatedPosts_item"><a href="/2020/04/03/Python/Python几问/" title="Python3简介"><img class="relatedPosts_cover" src="http://cdn.panyucable.cn/zysheep/Python_cover.png"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="fa fa-calendar fa-fw" aria-hidden="true"></i> 2020-04-03</div><div class="relatedPosts_title">Python3简介</div></div></a></div></div><div class="clear_both"></div></div><hr><div id="post-comment"><div class="comment_headling"><i class="fa fa-comments fa-fw" aria-hidden="true"></i><span> 评论</span></div><div id="gitalk-container"></div><script>var gitalk = new Gitalk({
  clientID: '502b8308721b081071a5',
  clientSecret: '35220d15c7f8aaf585d6822cf5d49fedf5b602d6',
  repo: 'blog-comment',
  owner: 'zysheep',
  admin: ['zysheep'],
  id: md5(decodeURI(location.pathname)),
  language: 'zh-CN',
  perPage: 10,
  distractionFreeMode: false,
  pagerDirection: 'last',
  createIssueManually: false,
  updateCountCallback: commentCount
})
gitalk.render('gitalk-container')

function commentCount(n){
  try {
    document.getElementsByClassName('gitalk-comment-count')[0].innerHTML= n
  } catch (e) {
    return false
  }
}</script></div></article></main><footer id="footer" style="background-image: url(http://cdn.panyucable.cn/zysheep/flask_top.jpg)" data-type="photo"><div id="footer-wrap"><div class="copyright">&copy;2019 - 2020 By 三月三</div><div class="framework-info"><span>驱动 </span><a href="https://hexo.io" target="_blank" rel="noopener"><span>Hexo</span></a><span class="footer-separator">|</span><span>主题 </span><a href="https://github.com/jerryc127/hexo-theme-butterfly" target="_blank" rel="noopener"><span>Butterfly</span></a></div><div class="footer_custom_text"><a href="http://zysheep.github.io/" target="_blank" rel="noopener">三月三</a>,专门为你制造快乐的网站</div></div></footer></div><section class="rightside" id="rightside"><div id="rightside-config-hide"><i class="fa fa-book" id="readmode" title="阅读模式"></i><i class="fa fa-plus" id="font_plus" title="放大字体"></i><i class="fa fa-minus" id="font_minus" title="缩小字体"></i><a class="translate_chn_to_cht" id="translateLink" href="javascript:translatePage();" title="简繁转换" target="_self">繁</a><i class="darkmode fa fa-moon-o" id="darkmode" title="夜间模式"></i></div><div id="rightside-config-show"><div id="rightside_config" title="设置"><i class="fa fa-cog" aria-hidden="true"></i></div><a id="to_comment" href="#post-comment" title="直达评论"><i class="scroll_to_comment fa fa-comments">  </i></a><i class="fa fa-list-ul close" id="mobile-toc-button" title="目录" aria-hidden="true"></i><i class="fa fa-arrow-up" id="go-up" title="回到顶部" aria-hidden="true"></i></div></section><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.jsdelivr.net/npm/medium-zoom/dist/medium-zoom.min.js"></script><script src="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.js"></script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script src="/js/third-party/click_heart.js"></script><script src="https://cdn.jsdelivr.net/gh/sviptzk/HexoStaticFile@master/Hexo/js/hideCategory.min.js"></script><script>var endLoading = function () {
  document.body.style.overflow = 'auto';
  document.getElementById('loading-box').classList.add("loaded")
}
window.addEventListener('load',endLoading)</script></body></html>