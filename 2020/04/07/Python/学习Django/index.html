<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Django学习 | 三月三</title><meta name="description" content="Django 简介Django发布于2005年,是一个由 Python 编写的一个开放源代码的 Web 应用框架（源代码是开源的，遵守BSD版权）。使用 Django，只要很少的代码，Python 的程序开发人员就可以轻松地完成一个正式网站所需要的大部分内容，并进一步开发出全功能的 Web 服务Django本身基于 MVC 模型，即 Model（模型）+ View（视图）+ Controller（"><meta name="keywords" content="Python,Django"><meta name="author" content="三月三"><meta name="copyright" content="三月三"><meta name="format-detection" content="telephone=no"><link rel="shortcut icon" href="http://cdn.panyucable.cn/zysheep/ico.png"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="dns-prefetch" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="https://hm.baidu.com"/><link rel="dns-prefetch" href="https://hm.baidu.com"/><link rel="preconnect" href="https://fonts.googleapis.com" crossorigin="crossorigin"/><link rel="dns-prefetch" href="https://fonts.googleapis.com"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="dns-prefetch" href="//busuanzi.ibruce.info"/><meta name="twitter:card" content="summary"><meta name="twitter:title" content="Django学习"><meta name="twitter:description" content="Django 简介Django发布于2005年,是一个由 Python 编写的一个开放源代码的 Web 应用框架（源代码是开源的，遵守BSD版权）。使用 Django，只要很少的代码，Python 的程序开发人员就可以轻松地完成一个正式网站所需要的大部分内容，并进一步开发出全功能的 Web 服务Django本身基于 MVC 模型，即 Model（模型）+ View（视图）+ Controller（"><meta name="twitter:image" content="http://cdn.panyucable.cn/zysheep/django_cover.jpg"><meta property="og:type" content="article"><meta property="og:title" content="Django学习"><meta property="og:url" content="https://zysheep.cn/2020/04/07/Python/%E5%AD%A6%E4%B9%A0Django/"><meta property="og:site_name" content="三月三"><meta property="og:description" content="Django 简介Django发布于2005年,是一个由 Python 编写的一个开放源代码的 Web 应用框架（源代码是开源的，遵守BSD版权）。使用 Django，只要很少的代码，Python 的程序开发人员就可以轻松地完成一个正式网站所需要的大部分内容，并进一步开发出全功能的 Web 服务Django本身基于 MVC 模型，即 Model（模型）+ View（视图）+ Controller（"><meta property="og:image" content="http://cdn.panyucable.cn/zysheep/django_cover.jpg"><meta property="article:published_time" content="2020-04-07T04:30:45.000Z"><meta property="article:modified_time" content="2020-08-24T02:30:17.508Z"><script src="https://cdn.jsdelivr.net/npm/js-cookie/dist/js.cookie.min.js"></script><script>var autoChangeMode = '1'
var t = Cookies.get("theme")
if (autoChangeMode == '1'){
  var isDarkMode = window.matchMedia("(prefers-color-scheme: dark)").matches
  var isLightMode = window.matchMedia("(prefers-color-scheme: light)").matches
  var isNotSpecified = window.matchMedia("(prefers-color-scheme: no-preference)").matches
  var hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified

  if (t === undefined){
    if (isLightMode) activateLightMode()
    else if (isDarkMode) activateDarkMode()
    else if (isNotSpecified || hasNoSupport){
      console.log('You specified no preference for a color scheme or your browser does not support it. I Schedule dark mode during night time.')
      var now = new Date()
      var hour = now.getHours()
      var isNight = hour < 6 || hour >= 18
      isNight ? activateDarkMode() : activateLightMode()
  }
  } else if (t == 'light') activateLightMode()
  else activateDarkMode()

} else if (autoChangeMode == '2'){
  now = new Date();
  hour = now.getHours();
  isNight = hour < 6 || hour >= 18
  if(t === undefined) isNight? activateDarkMode() : activateLightMode()
  else if (t === 'light') activateLightMode()
  else activateDarkMode() 
} else {
  if ( t == 'dark' ) activateDarkMode()
  else if ( t == 'light') activateLightMode()
}

function activateDarkMode(){
  document.documentElement.setAttribute('data-theme', 'dark')
  if (document.querySelector('meta[name="theme-color"]') !== null){
    document.querySelector('meta[name="theme-color"]').setAttribute('content','#000')
  }
}
function activateLightMode(){
  document.documentElement.setAttribute('data-theme', 'light')
  if (document.querySelector('meta[name="theme-color"]') !== null){
  document.querySelector('meta[name="theme-color"]').setAttribute('content','#fff')
  }
}</script><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@latest/css/font-awesome.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.css"><link rel="canonical" href="https://zysheep.cn/2020/04/07/Python/%E5%AD%A6%E4%B9%A0Django/"><link rel="prev" title="About me" href="https://zysheep.cn/2020/06/01/%E5%85%B3%E4%BA%8E%E6%88%91/"><link rel="next" title="Centos7安装Python环境" href="https://zysheep.cn/2020/04/07/Python/Centos7%E5%AE%89%E8%A3%85Python%E7%8E%AF%E5%A2%83/"><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/gitalk/dist/gitalk.min.css"><script src="https://cdn.jsdelivr.net/npm/gitalk@latest/dist/gitalk.min.js"></script><script src="https://cdn.jsdelivr.net/npm/blueimp-md5/js/md5.min.js"></script><script>var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?7f671f0f6d996680d21d5c32a23a9313";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Titillium+Web"><script>var GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: {"defaultEncoding":2,"translateDelay":0,"cookieDomain":"https://zysheep.github.io/","msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"簡"},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  bookmark: {
    message_prev: '按',
    message_next: '键将本页加入书签'
  },
  runtime_unit: '天',
  runtime: true,
  copyright: undefined,
  ClickShowText: undefined,
  medium_zoom: true,
  fancybox: false,
  Snackbar: {"bookmark":{"message_prev":"按","message_next":"键将本页加入书签"},"chs_to_cht":"你已切换为繁体","cht_to_chs":"你已切换为简体","day_to_night":"你已切换为深色模式","night_to_day":"你已切换为浅色模式","bgLight":"#49b1f5","bgDark":"#2d3035","position":"bottom-left"},
  baiduPush: false,
  highlightCopy: true,
  highlightLang: true,
  highlightShrink: 'false',
  isFontAwesomeV5: false,
  isPhotoFigcaption: true,
  islazyload: false,
  isanchor: false
  
}</script><script>var GLOBAL_CONFIG_SITE = { 
  isPost: true,
  isHome: false,
  isSidebar: true  
  }</script><noscript><style>
#page-header {
  opacity: 1
}
.justified-gallery img{
  opacity: 1
}
</style></noscript><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/sviptzk/HexoStaticFile@master/Hexo/css/hideCategory.min.css"><meta name="generator" content="Hexo 4.2.1"></head><body><div id="loading-box"><div class="loading-left-bg"></div><div class="loading-right-bg"></div><div class="spinner-box"><div class="configure-border-1"><div class="configure-core"></div></div><div class="configure-border-2"><div class="configure-core"></div></div><div class="loading-word">加载中...</div></div></div><div id="mobile-sidebar"><div id="menu_mask"></div><div id="mobile-sidebar-menus"><div class="mobile_author_icon"><img class="avatar-img" src="http://cdn.panyucable.cn/zysheep/xiaoman.png" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="mobile_post_data"><div class="mobile_data_item is-center"><div class="mobile_data_link"><a href="/archives/"><div class="headline">文章</div><div class="length_num">209</div></a></div></div><div class="mobile_data_item is-center">      <div class="mobile_data_link"><a href="/tags/"><div class="headline">标签</div><div class="length_num">47</div></a></div></div><div class="mobile_data_item is-center">     <div class="mobile_data_link"><a href="/categories/"><div class="headline">分类</div><div class="length_num">69</div></a></div></div></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> 主页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fa fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fa fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page"><i class="fa-fw fa fa-bug" aria-hidden="true"></i><span> 编程路线</span><i class="fa fa-chevron-down menus-expand" aria-hidden="true"></i></a><ul class="menus_item_child"><li><a class="site-page" href="/java/"><i class="fa-fw fa fa-coffee"></i><span> Java</span></a></li><li><a class="site-page" href="/python/"><i class="fa-fw fa fa-binoculars"></i><span> Python</span></a></li></ul></div><div class="menus_item"><a class="site-page"><i class="fa-fw fa fa-folder-open" aria-hidden="true"></i><span> 面试宝典</span><i class="fa fa-chevron-down menus-expand" aria-hidden="true"></i></a><ul class="menus_item_child"><li><a class="site-page" href="/interview/"><i class="fa-fw fa fa-file-text-o"></i><span> Java面试题</span></a></li></ul></div><div class="menus_item"><a class="site-page"><i class="fa-fw fa fa-list" aria-hidden="true"></i><span> 我的生活</span><i class="fa fa-chevron-down menus-expand" aria-hidden="true"></i></a><ul class="menus_item_child"><li><a class="site-page" href="/gallery/"><i class="fa-fw fa fa-picture-o"></i><span> Gallery</span></a></li></ul></div></div></div></div><i class="fa fa-arrow-right on" id="toggle-sidebar" aria-hidden="true">     </i><div id="sidebar"><div class="sidebar-toc"><div class="sidebar-toc__title">目录</div><div class="sidebar-toc__progress"><span class="progress-notice">你已经读了</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc__progress-bar">     </div></div><div class="sidebar-toc__content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#Django-简介"><span class="toc-number">1.</span> <span class="toc-text">Django 简介</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#MTV-模型"><span class="toc-number">1.1.</span> <span class="toc-text">MTV 模型</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Django版本"><span class="toc-number">1.2.</span> <span class="toc-text">Django版本</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Django的安装"><span class="toc-number">2.</span> <span class="toc-text">Django的安装</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#环境要求"><span class="toc-number">2.1.</span> <span class="toc-text">环境要求</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#pip命令安装"><span class="toc-number">2.2.</span> <span class="toc-text">pip命令安装</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#⼿动安装"><span class="toc-number">2.3.</span> <span class="toc-text">⼿动安装</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Django-创建第一个项目"><span class="toc-number">3.</span> <span class="toc-text">Django 创建第一个项目</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Django-管理工具"><span class="toc-number">3.1.</span> <span class="toc-text">Django 管理工具</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#创建项目"><span class="toc-number">3.2.</span> <span class="toc-text">创建项目</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#建立应用"><span class="toc-number">3.3.</span> <span class="toc-text">建立应用</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#简单视图函数"><span class="toc-number">3.4.</span> <span class="toc-text">简单视图函数</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#基本路由"><span class="toc-number">3.5.</span> <span class="toc-text">基本路由</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#简单模板"><span class="toc-number">3.6.</span> <span class="toc-text">简单模板</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#简单模型"><span class="toc-number">3.7.</span> <span class="toc-text">简单模型</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Django-模型-M"><span class="toc-number">4.</span> <span class="toc-text">Django 模型(M)</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#数据库配置"><span class="toc-number">4.1.</span> <span class="toc-text">数据库配置</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ORM"><span class="toc-number">4.2.</span> <span class="toc-text">ORM</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#基本概念"><span class="toc-number">4.2.1.</span> <span class="toc-text">基本概念</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#模型属性"><span class="toc-number">4.2.2.</span> <span class="toc-text">模型属性</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#字段类型"><span class="toc-number">4.2.2.1.</span> <span class="toc-text">字段类型</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#字段选项"><span class="toc-number">4.2.2.2.</span> <span class="toc-text">字段选项</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#定义模型"><span class="toc-number">4.3.</span> <span class="toc-text">定义模型</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#激活模型"><span class="toc-number">4.4.</span> <span class="toc-text">激活模型</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#模型的使用"><span class="toc-number">4.5.</span> <span class="toc-text">模型的使用</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#增"><span class="toc-number">4.5.1.</span> <span class="toc-text">增</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#删"><span class="toc-number">4.5.2.</span> <span class="toc-text">删</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#改"><span class="toc-number">4.5.3.</span> <span class="toc-text">改</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#数据查询"><span class="toc-number">4.5.4.</span> <span class="toc-text">数据查询</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#返回查询集"><span class="toc-number">4.5.4.1.</span> <span class="toc-text">返回查询集</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#返回单个值"><span class="toc-number">4.5.4.2.</span> <span class="toc-text">返回单个值</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#查询集限制"><span class="toc-number">4.5.4.3.</span> <span class="toc-text">查询集限制</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#字段查询"><span class="toc-number">4.5.4.4.</span> <span class="toc-text">字段查询</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#统计查询"><span class="toc-number">4.5.4.5.</span> <span class="toc-text">统计查询</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Q对象和F对象"><span class="toc-number">4.5.4.6.</span> <span class="toc-text">Q对象和F对象</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#原始sql"><span class="toc-number">4.5.4.7.</span> <span class="toc-text">原始sql</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#模型成员"><span class="toc-number">4.6.</span> <span class="toc-text">模型成员</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#重命名管理器"><span class="toc-number">4.6.1.</span> <span class="toc-text">重命名管理器</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#⾃定义管理器"><span class="toc-number">4.6.2.</span> <span class="toc-text">⾃定义管理器</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#模型对应关系"><span class="toc-number">4.7.</span> <span class="toc-text">模型对应关系</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#⼀对⼀"><span class="toc-number">4.7.1.</span> <span class="toc-text">⼀对⼀</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#⼀对多"><span class="toc-number">4.7.2.</span> <span class="toc-text">⼀对多</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#多对多"><span class="toc-number">4.7.3.</span> <span class="toc-text">多对多</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#模型继承"><span class="toc-number">4.8.</span> <span class="toc-text">模型继承</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Django-模板-T"><span class="toc-number">5.</span> <span class="toc-text">Django 模板(T)</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#一、模板位置"><span class="toc-number">5.1.</span> <span class="toc-text">一、模板位置</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#二、模板的渲染"><span class="toc-number">5.2.</span> <span class="toc-text">二、模板的渲染</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#loader加载"><span class="toc-number">5.2.1.</span> <span class="toc-text">loader加载</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#render加载"><span class="toc-number">5.2.2.</span> <span class="toc-text">render加载</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#变量"><span class="toc-number">5.2.3.</span> <span class="toc-text">变量</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#过滤器"><span class="toc-number">5.2.4.</span> <span class="toc-text">过滤器</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#⾃定义过滤器"><span class="toc-number">5.2.4.1.</span> <span class="toc-text">⾃定义过滤器</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#内置标签"><span class="toc-number">5.2.5.</span> <span class="toc-text">内置标签</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#if标签"><span class="toc-number">5.2.5.1.</span> <span class="toc-text">if标签</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#for"><span class="toc-number">5.2.5.2.</span> <span class="toc-text">for</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#ifequal-ifnotequal"><span class="toc-number">5.2.5.3.</span> <span class="toc-text">ifequal&#x2F;ifnotequal</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#注释"><span class="toc-number">5.2.5.4.</span> <span class="toc-text">注释</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#跨站请求伪造-csrf"><span class="toc-number">5.2.5.5.</span> <span class="toc-text">跨站请求伪造 csrf</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#模板导⼊标签（-include）"><span class="toc-number">5.2.5.6.</span> <span class="toc-text">模板导⼊标签（ include）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#url标签"><span class="toc-number">5.2.5.7.</span> <span class="toc-text">url标签</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#四、模板继承"><span class="toc-number">5.3.</span> <span class="toc-text">四、模板继承</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#五、静态资源配置"><span class="toc-number">5.4.</span> <span class="toc-text">五、静态资源配置</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#六、jinja2模板引擎配置"><span class="toc-number">5.5.</span> <span class="toc-text">六、jinja2模板引擎配置</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Django-视图和路由-V"><span class="toc-number">6.</span> <span class="toc-text">Django 视图和路由(V)</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#路由"><span class="toc-number">6.1.</span> <span class="toc-text">路由</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#模式"><span class="toc-number">6.1.1.</span> <span class="toc-text">模式</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#URL配置"><span class="toc-number">6.1.2.</span> <span class="toc-text">URL配置</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#动态url"><span class="toc-number">6.1.3.</span> <span class="toc-text">动态url</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#视图"><span class="toc-number">6.2.</span> <span class="toc-text">视图</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#HttpRequest"><span class="toc-number">6.2.1.</span> <span class="toc-text">HttpRequest</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#QueryDict"><span class="toc-number">6.2.1.1.</span> <span class="toc-text">QueryDict</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#HttpResponse"><span class="toc-number">6.2.2.</span> <span class="toc-text">HttpResponse</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#不调用模板，直接返回内容"><span class="toc-number">6.2.2.1.</span> <span class="toc-text">不调用模板，直接返回内容</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#调用模板返回"><span class="toc-number">6.2.2.2.</span> <span class="toc-text">调用模板返回</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#JsonResponse"><span class="toc-number">6.2.3.</span> <span class="toc-text">JsonResponse</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#系统模块⾃带的json和JsonResponse"><span class="toc-number">6.2.3.1.</span> <span class="toc-text">系统模块⾃带的json和JsonResponse</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#QuerySet转Json"><span class="toc-number">6.2.3.2.</span> <span class="toc-text">QuerySet转Json</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#模型转Json"><span class="toc-number">6.2.3.3.</span> <span class="toc-text">模型转Json</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#重定向"><span class="toc-number">6.2.4.</span> <span class="toc-text">重定向</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#不带参数重定向"><span class="toc-number">6.2.4.1.</span> <span class="toc-text">不带参数重定向</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#带参数重定向"><span class="toc-number">6.2.4.2.</span> <span class="toc-text">带参数重定向</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#反向解析"><span class="toc-number">6.2.4.3.</span> <span class="toc-text">反向解析</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#错误视图"><span class="toc-number">6.2.5.</span> <span class="toc-text">错误视图</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#404错误及视图"><span class="toc-number">6.2.5.1.</span> <span class="toc-text">404错误及视图</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#500错误及视图"><span class="toc-number">6.2.5.2.</span> <span class="toc-text">500错误及视图</span></a></li></ol></li></ol></li></ol></li></ol></div></div></div><div id="body-wrap"><div class="post-bg" id="nav" style="background-image: url(http://cdn.panyucable.cn/zysheep/django_top.jpg)"><div id="page-header"><span class="pull_left" id="blog_name"><a class="blog_title" id="site-name" href="/">三月三</a></span><span class="pull_right menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> 主页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fa fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fa fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page"><i class="fa-fw fa fa-bug" aria-hidden="true"></i><span> 编程路线</span><i class="fa fa-chevron-down menus-expand" aria-hidden="true"></i></a><ul class="menus_item_child"><li><a class="site-page" href="/java/"><i class="fa-fw fa fa-coffee"></i><span> Java</span></a></li><li><a class="site-page" href="/python/"><i class="fa-fw fa fa-binoculars"></i><span> Python</span></a></li></ul></div><div class="menus_item"><a class="site-page"><i class="fa-fw fa fa-folder-open" aria-hidden="true"></i><span> 面试宝典</span><i class="fa fa-chevron-down menus-expand" aria-hidden="true"></i></a><ul class="menus_item_child"><li><a class="site-page" href="/interview/"><i class="fa-fw fa fa-file-text-o"></i><span> Java面试题</span></a></li></ul></div><div class="menus_item"><a class="site-page"><i class="fa-fw fa fa-list" aria-hidden="true"></i><span> 我的生活</span><i class="fa fa-chevron-down menus-expand" aria-hidden="true"></i></a><ul class="menus_item_child"><li><a class="site-page" href="/gallery/"><i class="fa-fw fa fa-picture-o"></i><span> Gallery</span></a></li></ul></div></div><span class="toggle-menu close"><a class="site-page"><i class="fa fa-bars fa-fw" aria-hidden="true"></i></a></span></span></div><div id="post-info"><div id="post-title"><div class="posttitle">Django学习</div></div><div id="post-meta"><div class="meta-firstline"><time class="post-meta__date"><span class="post-meta__date-created" title="发表于 2020-04-07 12:30:45"><i class="fa fa-calendar" aria-hidden="true"></i> 发表于 2020-04-07</span><span class="post-meta__separator">|</span><span class="post-meta__date-updated" title="更新于 2020-08-24 10:30:17"><i class="fa fa-history" aria-hidden="true"></i> 更新于 2020-08-24</span></time><span class="post-meta__categories"><span class="post-meta__separator">|</span><i class="fa fa-inbox post-meta__icon" aria-hidden="true"></i><a class="post-meta__categories" href="/categories/Python/">Python</a><i class="fa fa-angle-right post-meta__separator" aria-hidden="true"></i><i class="fa fa-inbox post-meta__icon" aria-hidden="true"></i><a class="post-meta__categories" href="/categories/Python/Django/">Django</a></span></div><div class="meta-secondline"> <span class="post-meta-wordcount"><i class="post-meta__icon fa fa-file-word-o" aria-hidden="true"></i><span>字数总计:</span><span class="word-count">16.5k</span><span class="post-meta__separator">|</span><i class="post-meta__icon fa fa-clock-o" aria-hidden="true"></i><span>阅读时长: 67 分钟</span></span></div><div class="meta-thirdline"><span class="post-meta-pv-cv"><span class="post-meta__separator">|</span><i class="fa fa-eye post-meta__icon" aria-hidden="true"> </i><span>阅读量:</span><span id="busuanzi_value_page_pv"></span></span><span class="post-meta-commentcount"><span class="post-meta__separator">|</span><i class="post-meta__icon fa fa-comment-o" aria-hidden="true"></i><span>评论数:</span><a href="/2020/04/07/Python/%E5%AD%A6%E4%B9%A0Django/#post-comment"><span class="gitalk-comment-count comment-count"></span></a></span></div></div></div></div><main class="layout_post" id="content-inner"><article id="post"><div class="post-content" id="article-container"><h1 id="Django-简介"><a href="#Django-简介" class="headerlink" title="Django 简介"></a>Django 简介</h1><p>Django发布于2005年,是一个由 Python 编写的一个开放源代码的 Web 应用框架（源代码是开源的，遵守BSD版权）。使用 Django，只要很少的代码，Python 的程序开发人员就可以轻松地完成一个正式网站所需要的大部分内容，并进一步开发出全功能的 Web 服务Django本身基于 MVC 模型，即 Model（模型）+ View（视图）+ Controller（控制器）设计模式，也有很多人把它称MVT（MTV）模式。MVC 模式使后续对程序的修改和扩展简化，并且使程序某一部分的重复利用成为可能。</p>
<h2 id="MTV-模型"><a href="#MTV-模型" class="headerlink" title="MTV 模型"></a>MTV 模型</h2><p>Django 的 MTV 模式本质上和 MVC 是一样的，也是为了各组件间保持松耦合关系，只是定义上有些许不同，Django 的 MTV 分别是指：</p>
<ul>
<li>M 表示模型（Model）：编写程序应有的功能，负责业务对象与数据库的映射(ORM)。</li>
<li>T 表示模板 (Template)：负责如何把页面(html)展示给用户。</li>
<li>V 表示视图（View）：负责业务逻辑，并在适当时候调用 Model和 Template。</li>
</ul>
<p>除了以上三层之外，还需要一个 URL 分发器，它的作用是将一个个 URL 的页面请求分发给不同的 View 处理，View 再调用相应的 Model 和 Template，MTV 的响应模式</p>
<p>用户操作流程图：</p>
<p><img src="http://cdn.panyucable.cn/zysheep/QQ%E6%88%AA%E5%9B%BE20200818195334.png" alt=""></p>
<p><strong>解析：</strong></p>
<p>用户通过浏览器向我们的服务器发起一个请求(request)，这个请求会去访问视图函数：</p>
<ul>
<li><strong>绿色路线</strong>:如果不涉及到数据调用，那么这个时候视图函数直接返回一个模板也就是一个网页给用户。</li>
<li><strong>红色路线</strong>:如果涉及到数据调用，那么视图函数调用模型，模型去数据库查找数据，然后逐级返回。视图函数把返回的数据填充到模板中空格中，最后返回网页给用户。</li>
</ul>
<h2 id="Django版本"><a href="#Django版本" class="headerlink" title="Django版本"></a>Django版本</h2><p>  <img src="http://cdn.panyucable.cn/zysheep/QQ%E6%88%AA%E5%9B%BE20200818194314.png" alt=""></p>
<p>django各个版本对python的要求：</p>
<table>
<thead>
<tr>
<th>Django version</th>
<th>Python versions</th>
</tr>
</thead>
<tbody><tr>
<td>1.11</td>
<td>2.7, 3.4, 3.5, 3.6</td>
</tr>
<tr>
<td>2.0</td>
<td>3.4, 3.5, 3.6, 3.7</td>
</tr>
<tr>
<td>2.1, 2.2</td>
<td>3.5, 3.6, 3.7</td>
</tr>
</tbody></table>
<h1 id="Django的安装"><a href="#Django的安装" class="headerlink" title="Django的安装"></a>Django的安装</h1><h2 id="环境要求"><a href="#环境要求" class="headerlink" title="环境要求"></a>环境要求</h2><ul>
<li>操作系统: Windows</li>
<li>python版本：&gt;=3.5</li>
<li>Django版本：2.2</li>
</ul>
<h2 id="pip命令安装"><a href="#pip命令安装" class="headerlink" title="pip命令安装"></a>pip命令安装</h2><p>⾸先使用<a href="https://zysheep.cn/2020/04/04/Python/%E8%99%9A%E6%8B%9F%E7%8E%AF%E5%A2%83%E7%AE%A1%E7%90%86/">virtualenvwrapper-win</a>建⽴⼀个虚拟开发环境，然后使用pip安装</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mkvirtualenv django-env   # 新建虚拟环境</span><br><span class="line">workon django-env  # 进入虚拟环境</span><br><span class="line">pip install django==2.2 -i http://mirrors.aliyun.com/pypi/simple/  #安装指定版本的django</span><br></pre></td></tr></table></figure>

<p>安装完毕后，测试⼀下是否安装成功</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">#在虚拟开发环境中</span><br><span class="line">&gt;&gt;&gt;python #开启python</span><br><span class="line">&gt;&gt;&gt;import django</span><br><span class="line">&gt;&gt;&gt;django.get_version()</span><br></pre></td></tr></table></figure>

<h2 id="⼿动安装"><a href="#⼿动安装" class="headerlink" title="⼿动安装"></a>⼿动安装</h2><p>到django官⽹上下载：<a href="https://www.djangoproject.com/download/2.2.9/tarball/安装包,然后解压，到解压⽬录下，打开虚拟开发环境，执⾏以下命令" target="_blank" rel="noopener">https://www.djangoproject.com/download/2.2.9/tarball/安装包,然后解压，到解压⽬录下，打开虚拟开发环境，执⾏以下命令</a>:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python -m pip install .</span><br></pre></td></tr></table></figure>

<h1 id="Django-创建第一个项目"><a href="#Django-创建第一个项目" class="headerlink" title="Django 创建第一个项目"></a>Django 创建第一个项目</h1><p>测试版本说明：</p>
<ul>
<li>Python 3.8.4</li>
<li>Django 2.2</li>
</ul>
<h2 id="Django-管理工具"><a href="#Django-管理工具" class="headerlink" title="Django 管理工具"></a>Django 管理工具</h2><p>安装 Django 之后，您现在应该已经有了可用的管理工具 django-admin.py，Windows 如果没有配置环境变量可以用 django-admin。我们可以使用 <strong>django-admin.py</strong> 来创建一个项目:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">C:\Users\L15096000421&gt;django-admin</span><br><span class="line">Type &#39;django-admin help &lt;subcommand&gt;&#39; for help on a specific subcommand.</span><br><span class="line">Available subcommands:</span><br><span class="line">[django]</span><br><span class="line">    check</span><br><span class="line">    compilemessages</span><br><span class="line">    createcachetable</span><br><span class="line">    dbshell</span><br><span class="line">    diffsettings</span><br><span class="line">    dumpdata</span><br><span class="line">    flush</span><br><span class="line">    inspectdb</span><br><span class="line">    loaddata</span><br><span class="line">    makemessages</span><br><span class="line">    makemigrations</span><br><span class="line">    migrate</span><br><span class="line">    runserver</span><br><span class="line">    sendtestemail</span><br><span class="line">    shell</span><br><span class="line">    showmigrations</span><br><span class="line">    sqlflush</span><br><span class="line">    sqlmigrate</span><br><span class="line">    sqlsequencereset</span><br><span class="line">    squashmigrations</span><br><span class="line">    startapp</span><br><span class="line">    startproject</span><br><span class="line">    test</span><br><span class="line">    testserver</span><br></pre></td></tr></table></figure>

<h2 id="创建项目"><a href="#创建项目" class="headerlink" title="创建项目"></a>创建项目</h2><p>使用 django-admin.py 来创建 HelloWorld 项目。先切换到指定⽬录，开启虚拟环境，然后用以下指令创建⼀个项⽬</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">django-admin startproject HelloWorld</span><br></pre></td></tr></table></figure>

<p>创建完成后我们可以查看下项目的目录结构：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">$ cd HelloWorld&#x2F;</span><br><span class="line">$ tree</span><br><span class="line">.</span><br><span class="line">|-- HelloWorld</span><br><span class="line">|   |-- __init__.py</span><br><span class="line">|   |-- settings.py</span><br><span class="line">|   |-- urls.py</span><br><span class="line">|   &#96;-- wsgi.py</span><br><span class="line">&#96;-- manage.py</span><br></pre></td></tr></table></figure>

<p>目录说明：</p>
<ul>
<li><strong>HelloWorld:</strong> 项目的容器。</li>
<li><strong>manage.py:</strong> 一个实用的命令行工具，可让你以各种方式与该 Django 项目进行交互。</li>
<li><strong>HelloWorld/<strong>init</strong>.py:</strong> 一个空文件，告诉 Python 该目录是一个 Python 包。</li>
<li><strong>HelloWorld/settings.py:</strong> 该 Django 项目的设置/配置。</li>
<li><strong>HelloWorld/urls.py:</strong> 该 Django 项目的 URL 声明; 一份由 Django 驱动的网站”目录”。</li>
<li><strong>HelloWorld/wsgi.py:</strong> 一个 WSGI 兼容的 Web 服务器的入口，以便运行你的项目。</li>
</ul>
<p>接下来我们进入 HelloWorld 目录输入以下命令，启动服务器：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python manage.py runserver 0.0.0.0:8000</span><br></pre></td></tr></table></figure>

<blockquote>
<p>0.0.0.0 让其它电脑可连接到开发服务器，8000 为端口号。如果不说明，那么端口号默认为 8000。</p>
</blockquote>
<p>在浏览器输入你服务器的 ip（这里我们输入本机 IP 地址： <strong>127.0.0.1:8000</strong>） 及端口号，如果正常启动，输出结果如下：</p>
<p><img src="http://cdn.panyucable.cn/zysheep/QQ%E6%88%AA%E5%9B%BE20200818201801.png" alt=""></p>
<p>如果要让远程客户端连接需要修改配置⽂件，其中0.0.0.0:9000是可选的，0.0.0.0说明任何ip都可以访问。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">#修改setting.py中的这⼀行</span><br><span class="line">ALLOWED_HOSTS &#x3D; [&#39;*&#39;]</span><br></pre></td></tr></table></figure>

<p>如果需要让页面显示中文,需要在<code>setting.py</code>中修改国际化的配置</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># 语言 国际化</span><br><span class="line">LANGUAGE_CODE &#x3D; &#39;zh-hans&#39;</span><br><span class="line">TIME_ZONE &#x3D; &#39;Asia&#x2F;Shanghai&#39;</span><br><span class="line"># 不使用世界时间,改为False,数据库储存的时间和当地时间一致</span><br><span class="line">USE_TZ &#x3D; False</span><br></pre></td></tr></table></figure>

<h2 id="建立应用"><a href="#建立应用" class="headerlink" title="建立应用"></a>建立应用</h2><p>⼀个django项⽬中可以包含多个应用，和flask只是叫法上不同,在flask中说法为可以在一个app上建议多个模块</p>
<p>可以使用以下命令建⽴应用:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">#命令： python manager.py startapp 应用名称</span><br><span class="line">实例： python manager.py startapp app</span><br></pre></td></tr></table></figure>

<p>创建应用后，项⽬的结构如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">── App</span><br><span class="line">│ ├── admin.py 站点管理</span><br><span class="line">│ ├── apps.py 应用程序⾃身信息</span><br><span class="line">│ ├── __init__.py</span><br><span class="line">│ ├── migrations 数据迁移</span><br><span class="line">│ │ └── __init__.py</span><br><span class="line">│ ├── models.py 模型</span><br><span class="line">│ ├── tests.py</span><br><span class="line">│ └── views.py 视图响应函数</span><br><span class="line">├── db.sqlite3 sqlite数据库</span><br><span class="line">├── hellodjango 项⽬</span><br><span class="line">│ ├── doc.py</span><br><span class="line">│ ├── __init__.py</span><br><span class="line">│ ├── __pycache__</span><br><span class="line">│ │ ├── __init__.cpython-36.pyc</span><br><span class="line">│ │ ├── settings.cpython-36.pyc</span><br><span class="line">│ │ ├── urls.cpython-36.pyc</span><br><span class="line">│ │ └── wsgi.cpython-36.pyc</span><br><span class="line">│ ├── settings.py 系统配置</span><br><span class="line">│ ├── urls.py 路由映射表</span><br><span class="line">│ └── wsgi.py wsgi协议</span><br><span class="line">└── manage.py 项⽬管理命令</span><br></pre></td></tr></table></figure>

<p>修改项⽬的配置⽂件<code>setting.py</code>:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">INSTALLED_APPS &#x3D; [</span><br><span class="line"> &#39;django.contrib.admin&#39;,</span><br><span class="line"> &#39;django.contrib.auth&#39;,</span><br><span class="line"> &#39;django.contrib.contenttypes&#39;,</span><br><span class="line"> &#39;django.contrib.sessions&#39;,</span><br><span class="line"> &#39;django.contrib.messages&#39;,</span><br><span class="line"> &#39;django.contrib.staticfiles&#39;,</span><br><span class="line"> &#39;App&#39;, # 安装自己的应用</span><br><span class="line">]</span><br></pre></td></tr></table></figure>

<h2 id="简单视图函数"><a href="#简单视图函数" class="headerlink" title="简单视图函数"></a>简单视图函数</h2><p>在django中view代表视图函数，接收用户的请求，进⾏处理然后返回html源代码给客户端。在框架中，我们可以在应用（app）的views.py中写⾃⼰的视图函数， 进⾏相应的处理</p>
<p>视图函数只是⼀个普通的python函数，它的第⼀个参数必须是⼀个请求（request）对象，这是框架传入的，我们可以通过请求对象获取提交参数等内容。它的返回值必须是⼀个web响应对象，可以文本、html源代码、重定向、404等内容。下⾯我们写⼀个简单视图函数，返回“Hello Django” </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">from django.http import HttpResponse</span><br><span class="line">def index(request):</span><br><span class="line"> return HttpResponse(&quot;Hello Django&quot;)</span><br></pre></td></tr></table></figure>

<p>其中HttpResponse函数需要引⼊模块django.http，我们可以直接写HttpResponse，然后通过快捷键<code>alt+enter</code>，在下拉框中选择要导⼊的模块。</p>
<blockquote>
<p>alt+enter 代码飘红、飘⻩、查看定义、引⼊包都可以使用。</p>
</blockquote>
<h2 id="基本路由"><a href="#基本路由" class="headerlink" title="基本路由"></a>基本路由</h2><p>添加完视图函数后，还⽆法在浏览器中查看，必须添加路由。所谓路由就是将用户请求转换为访问对应的视图函数。项⽬路由在urls.py中</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.conf.urls <span class="keyword">import</span> path</span><br><span class="line"><span class="keyword">from</span> django.contrib <span class="keyword">import</span> admin</span><br><span class="line"><span class="keyword">from</span> App <span class="keyword">import</span> views</span><br><span class="line">urlpatterns = [</span><br><span class="line"> path(<span class="string">'admin/'</span>, admin.site.urls),</span><br><span class="line"> <span class="comment"># 路由由两部分组成，第⼀部是⼀个匹配字符串（和flask规则相同），匹配用户的请求路径，第⼆部分是视图函数</span></span><br><span class="line"> path(<span class="string">''</span>, views.index)</span><br><span class="line">]</span><br></pre></td></tr></table></figure>

<p>匹配字符串匹配用户在地址栏中键⼊的url，当用户在地址栏中键⼊<a href="http://localhost:9000时会显示Hello">http://localhost:9000时会显示Hello</a> World</p>
<h2 id="简单模板"><a href="#简单模板" class="headerlink" title="简单模板"></a>简单模板</h2><p>在上⾯我们已经能够展示简单的web⻚⾯，但要显示⼀个html⻚⾯，需要使用模板，在app下建⽴<code>templates</code>⽬录，在<code>templates</code>⽬录下建⽴⼀个<code>index.html</code>⽂件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html lang&#x3D;&quot;en&quot;&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line"> &lt;meta charset&#x3D;&quot;UTF-8&quot;&gt;</span><br><span class="line"> &lt;title&gt;搜狐&lt;&#x2F;title&gt;</span><br><span class="line">&lt;&#x2F;head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">当你的才华还撑不起你的野心的时候，你就应该静下⼼来学习；&lt;br&gt;</span><br><span class="line">当你的能⼒还驾驭不了你的⽬标时，就应该沉下⼼来，历练；</span><br><span class="line">&lt;&#x2F;body&gt;</span><br><span class="line">&lt;&#x2F;html&gt;</span><br></pre></td></tr></table></figure>

<p>然后修改<code>views</code>中视图函数<code>index</code></p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">from django.shortcuts import render</span><br><span class="line">def index(request):</span><br><span class="line"> return render(request,&#39;index.html&#39;)</span><br></pre></td></tr></table></figure>

<p>也可以在html中使用变量和流程控制结构，⽣成复杂的html</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html lang&#x3D;&quot;en&quot;&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line"> &lt;meta charset&#x3D;&quot;UTF-8&quot;&gt;</span><br><span class="line"> &lt;!-- 模板中添加变ᰁ --&gt;</span><br><span class="line"> &lt;title&gt;&#123;&#123; title &#125;&#125;&lt;&#x2F;title&gt;</span><br><span class="line">&lt;&#x2F;head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">当你的才华还撑不起你的野⼼的时候，你就应该静下⼼来学习；&lt;br&gt;</span><br><span class="line">当你的能⼒还驾驭不了你的⽬标时，就应该沉下⼼来，历练；</span><br><span class="line">&lt;&#x2F;body&gt;</span><br><span class="line">&lt;&#x2F;html&gt;</span><br></pre></td></tr></table></figure>

<p>然后修改视图函数</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">from django.shortcuts import render</span><br><span class="line">def index(request):</span><br><span class="line"> return render(request,&#39;index.html&#39;,content&#x3D;&#123;&#39;title&#39;:&#39;草榴&#39;&#125;)</span><br></pre></td></tr></table></figure>

<h2 id="简单模型"><a href="#简单模型" class="headerlink" title="简单模型"></a>简单模型</h2><p>django⾃带了⼀个sqlite数据库，可以用于测试，⽣产环境⼀般不用。在配置⽂件中已经设置好默认的sqlite数据库。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">DATABASES &#x3D; &#123;</span><br><span class="line"> &#39;default&#39;: &#123;</span><br><span class="line"> &#39;ENGINE&#39;: &#39;django.db.backends.sqlite3&#39;, #数据库引擎</span><br><span class="line"> &#39;NAME&#39;: os.path.join(BASE_DIR, &#39;db.sqlite3&#39;), #数据库⽂件路径</span><br><span class="line"> &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在pycharm左边栏中选—-database，然后点选”+”,弹出sqlite的配置窗⼝</p>
<p><img src="http://cdn.panyucable.cn/zysheep/QQ%E6%88%AA%E5%9B%BE20200818203729.png" alt=""></p>
<p>将File改为项⽬中sqlite⽂件：db.sqlite3，然后点击测试，看看能否连接成功。第⼀次配置时，需要下载sqlite的驱动。完成后点击ok。 </p>
<p>然后到<code>app</code>中<code>models.py</code>中创建⼀个User类：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">class User(models.Model):</span><br><span class="line">     uname &#x3D; models.CharField(max_length&#x3D;20)</span><br><span class="line">     password &#x3D; models.CharField(max_length&#x3D;32)</span><br><span class="line">     </span><br><span class="line">     class Meta:</span><br><span class="line">        db_table &#x3D; &#39;app_user&#39; # 指定表名,默认为应用名_类名小写</span><br></pre></td></tr></table></figure>

<p>到命令⾏下，输⼊：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">python manage.py makemigrations #⽣成数据库迁移⽂件</span><br><span class="line">python manage.py migrate #⽣成数据库表</span><br></pre></td></tr></table></figure>

<p>然后到pycharm左边栏database中查看：</p>
<p><img src="http://cdn.panyucable.cn/zysheep/QQ%E6%88%AA%E5%9B%BE20200818203752.png" alt=""></p>
<p>双击app_user添加数据：</p>
<p><img src="http://cdn.panyucable.cn/zysheep/QQ%E6%88%AA%E5%9B%BE20200818203743.png" alt=""></p>
<p>到此为⽌，我们已经给app_user表添加了数据。然后给app添加⼀个模板：<code>list.html</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html lang&#x3D;&quot;en&quot;&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line"> &lt;meta charset&#x3D;&quot;UTF-8&quot;&gt;</span><br><span class="line"> &lt;title&gt;用户列表&lt;&#x2F;title&gt;</span><br><span class="line">&lt;&#x2F;head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;table width&#x3D;&quot;80%&quot; align&#x3D;&quot;center&quot; border&#x3D;&quot;1&quot; cellspacing&#x3D;&quot;0&quot;&gt;</span><br><span class="line"> &lt;caption&gt;用户列表&lt;&#x2F;caption&gt;</span><br><span class="line"> &#123;% for user in users %&#125;</span><br><span class="line"> &lt;tr&gt;</span><br><span class="line"> &lt;td&gt;&#123;&#123; user.uname &#125;&#125;&lt;&#x2F;td&gt;</span><br><span class="line"> &lt;td&gt;&#123;&#123; user.password &#125;&#125;&lt;&#x2F;td&gt;</span><br><span class="line"> &lt;&#x2F;tr&gt;</span><br><span class="line"> &#123;% endfor %&#125;</span><br><span class="line">&lt;&#x2F;table&gt;</span><br><span class="line">&lt;&#x2F;body&gt;</span><br><span class="line">&lt;&#x2F;html&gt;</span><br></pre></td></tr></table></figure>

<p>继续给app添加⼀个视图操作函数： </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">from app.models import User</span><br><span class="line">def userlist(req):</span><br><span class="line"> #获取app_user表中所有数据</span><br><span class="line"> persons &#x3D; User.objects.all()</span><br><span class="line"> return render(req,&quot;list.html&quot;, context&#x3D;&#123;&#39;users&#39;:persons&#125;)</span><br></pre></td></tr></table></figure>

<p>在项⽬的路由表中添加路由：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">urlpatterns &#x3D; [</span><br><span class="line"> url(&#39;admin&#x2F;&#39;, admin.site.urls),</span><br><span class="line"> url(&#39; &#39;,views.index),</span><br><span class="line"> url(r&#39;^list&#x2F;$&#39;,views.userlist), # 使用正则匹配url</span><br><span class="line"> url(&#39;list&#x2F;&#39;,views.userlist), # 有可以直接使用路径匹配</span><br><span class="line">]</span><br></pre></td></tr></table></figure>

<p>到浏览器中访问：<a href="http://localhost:9000/list/" target="_blank" rel="noopener">http://localhost:9000/list/</a></p>
<h1 id="Django-模型-M"><a href="#Django-模型-M" class="headerlink" title="Django 模型(M)"></a>Django 模型(M)</h1><p>模型使用步骤：</p>
<ol>
<li>配置数据库</li>
<li>models.py定义模型类</li>
<li>激活模型</li>
<li>使用模型</li>
</ol>
<blockquote>
<p>Django默认使用的是sqlite，但在⽣产环境中⼀般会用mysql、postgrsql、oracle等关系型数据库。</p>
</blockquote>
<h2 id="数据库配置"><a href="#数据库配置" class="headerlink" title="数据库配置"></a>数据库配置</h2><p>在虚拟开发环境(django-env)中，安装mysql的数据库驱动mysqlclient</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install mysqlclient</span><br></pre></td></tr></table></figure>

<p>在项⽬的<code>settings.py</code>⽂件中找到<code>DATABASES</code> 配置项，将其信息修改为：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">DATABASES = &#123;</span><br><span class="line">     <span class="string">'default'</span>: &#123;</span><br><span class="line">     <span class="string">'ENGINE'</span>: <span class="string">'django.db.backends.mysql'</span>, <span class="comment">#mysql数据库引擎</span></span><br><span class="line">     <span class="string">'NAME'</span>: <span class="string">'test'</span>, <span class="comment">#数据库名</span></span><br><span class="line">     <span class="string">'HOST'</span>:<span class="string">'localhost'</span>, <span class="comment">#数据库服务器地址</span></span><br><span class="line">     <span class="string">'USER'</span>: <span class="string">'test'</span>, <span class="comment">#mysql数据库用户名</span></span><br><span class="line">     <span class="string">'PASSWORD'</span>: <span class="string">'test123'</span>, <span class="comment">#密码</span></span><br><span class="line">     <span class="string">'PORT'</span>:<span class="number">3306</span>, <span class="comment">#端⼝号，可选</span></span><br><span class="line">     &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="ORM"><a href="#ORM" class="headerlink" title="ORM"></a>ORM</h2><p>对象关系映射（Oject Relational Mapping，简称ORM）模式是⼀种为了解决⾯向对象与关系数据库存在的互不匹配的现象的技术。简单的说，ORM是通过使用描述对象和数据库之间映射的元数据，⾃动⽣成sql语句，将程序中的对象⾃动保存到关系数据库中。优点：</p>
<ul>
<li>隐藏了数据库访问的细节，简化了sql的使用，提⾼了开发效率</li>
<li>解耦业务逻辑层（view）和数据处理层（model)，简化了开发流程，提⾼了系统的可移植性</li>
<li>提⾼了安全性</li>
</ul>
<p>缺点：</p>
<ul>
<li>执⾏效率低</li>
<li>对复杂的sql无能为力</li>
<li>增加了学习成本</li>
</ul>
<h3 id="基本概念"><a href="#基本概念" class="headerlink" title="基本概念"></a>基本概念</h3><table>
<thead>
<tr>
<th>面向对象概念</th>
<th>⾯向关系概念</th>
</tr>
</thead>
<tbody><tr>
<td>类</td>
<td>表</td>
</tr>
<tr>
<td>对象</td>
<td>记录(一行)</td>
</tr>
<tr>
<td>属性</td>
<td>字段(属性,列)</td>
</tr>
</tbody></table>
<ul>
<li>⼀个模型类对应⼀个表</li>
<li>每个模型类都必须继承django.db.models.Model</li>
</ul>
<h3 id="模型属性"><a href="#模型属性" class="headerlink" title="模型属性"></a>模型属性</h3><p>模型中的属性和数据库表的字段对应，必须定义。模型的属性需要定义成类属性</p>
<p>属性定义语法为：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">属性 &#x3D; models.字段类型(选项)</span><br></pre></td></tr></table></figure>

<p>实例:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">from django.db import models</span><br><span class="line"></span><br><span class="line"># Create your models here.</span><br><span class="line">class User(models.Model):</span><br><span class="line">    username &#x3D; models.CharField(max_length&#x3D;20)</span><br><span class="line">    password &#x3D; models.CharField(max_length&#x3D;128)</span><br><span class="line"></span><br><span class="line">    class Meta:</span><br><span class="line">        db_table &#x3D; &#39;user&#39; # 指定表名</span><br></pre></td></tr></table></figure>

<p>属性命名规则:</p>
<ul>
<li><p>不能是python的保留关键字</p>
</li>
<li><p>不允许使用连续的下划线，因为连续下划线在查询中会用到</p>
</li>
<li><p>定义属性时需要指定字段类型</p>
</li>
<li><p><strong>主键⼀般不用⾃⼰定义，django会⾃动创建⾃增⻓主键列，如果你⾃⼰定义了主键，则django不会再⾃动⽣成主键</strong></p>
<h4 id="字段类型"><a href="#字段类型" class="headerlink" title="字段类型"></a>字段类型</h4></li>
</ul>
<table>
<thead>
<tr>
<th>字段名称</th>
<th>字段说明</th>
<th>参数</th>
</tr>
</thead>
<tbody><tr>
<td>AutoField</td>
<td>⼀个根据实际Id⾃动增⻓的IntegerField（通常不指定 ⾃动⽣成）</td>
<td></td>
</tr>
<tr>
<td>CharField</td>
<td>字符串，默认的表单样式是TextInput</td>
<td>max_length=字符⻓度</td>
</tr>
<tr>
<td>TextField</td>
<td>⼤⽂本字段，⼀般超过4000使⽤，默认的表单控件是Textarea</td>
<td></td>
</tr>
<tr>
<td>IntegerField</td>
<td>整数</td>
<td></td>
</tr>
<tr>
<td>DecimalField</td>
<td>使⽤python的Decimal实例表示的⼗进制浮点数</td>
<td>max_digits总位数;decimal_places小数位数</td>
</tr>
<tr>
<td>FloatField</td>
<td>⽤Python的float实例来表示的 浮点数</td>
<td></td>
</tr>
<tr>
<td>BooleanField</td>
<td>true/false 字段，此字段的默认表单控制是CheckboxInput</td>
<td></td>
</tr>
<tr>
<td>NullBooleanField</td>
<td>支持null,true,false三种值</td>
<td></td>
</tr>
<tr>
<td>DateField</td>
<td>使用Python的datatime.date实例表示的日期,该字段默认对应的表单控件是⼀个TextInput</td>
<td>auto_now和 auto_now_add、default这三个参数不能同时存在</td>
</tr>
<tr>
<td>TimeField</td>
<td>使⽤Python的datetime.time实例表示的时间</td>
<td>参数同DateField</td>
</tr>
<tr>
<td>DateTimeField</td>
<td>使⽤Python的datetime.datetime实例表示的日期和时间</td>
<td>参数同DateField</td>
</tr>
<tr>
<td>ImageField</td>
<td>继承了FileField的所有属性和⽅法，但对上传的对象进⾏校验，确保它是个有效的image</td>
<td>不能同时共存</td>
</tr>
</tbody></table>
<ul>
<li>auto_now: 每次保存对象时，⾃动设置该字段为当前时间，用于”最后⼀次修改”的时间戳，它总是使用当前⽇期，默认为false</li>
<li>auto_now_add: 当对象第⼀次被创建时⾃动设置当前时间，用于创建的时间戳，它总是使用当前⽇期，默认为false</li>
</ul>
<h4 id="字段选项"><a href="#字段选项" class="headerlink" title="字段选项"></a>字段选项</h4><p>适用于任何字段，可以实现字段的约束，在⽣成字段时通过⽅法的关键字参数指定 </p>
<table>
<thead>
<tr>
<th>可选参数</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>null</td>
<td>如果 True ，Django将NULL在数据库中存储空值。默认 是 False 。不要在字符串字段上使⽤。null是数据库范畴的概念</td>
</tr>
<tr>
<td>blank</td>
<td>如果 True ，该字段允许为空。默认是 False 。同null不同， 如果字段有 blank=True ，则表单验证将允许输⼊空值。如果字段有 blank=False,则需要该字段</td>
</tr>
<tr>
<td>db_column</td>
<td>⽤于此字段的数据库列的名称。如果没有给出，Django将使⽤该字段的名称</td>
</tr>
<tr>
<td>db_index</td>
<td>如果为True ，将为此字段创建数据库常规索引。</td>
</tr>
<tr>
<td>unique</td>
<td>如果为True,该字段在整个表格中必须是唯一的</td>
</tr>
<tr>
<td>primary_key</td>
<td>如果为True,此字段是模型的主键</td>
</tr>
<tr>
<td>default</td>
<td>默认值,当前字段如果不给值则执行默认值</td>
</tr>
</tbody></table>
<h2 id="定义模型"><a href="#定义模型" class="headerlink" title="定义模型"></a>定义模型</h2><p>我们可以在应用的<code>models.py</code>中定义模型：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">from django.db import models</span><br><span class="line">class 模型名(models.Model):</span><br><span class="line">     属性名 &#x3D; models.字段名(字段选项&#x2F;参数)</span><br><span class="line">     .....</span><br><span class="line">     class Meta: #可选，任何⾮字段的设置可以写到Meta中</span><br><span class="line">         db_table &#x3D; &#39;user&#39; #指定表名为uesr</span><br></pre></td></tr></table></figure>

<ul>
<li><p>数据库的表名等于：应用名_模型名，如果想指定表名，可以在Meta中使用db_table指定</p>
</li>
<li><p>如果没有指定主键，Django将⾃动给表创建⼀个⾃增⻓主键id</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">id &#x3D; models.AutoField(primary_key&#x3D;True)</span><br></pre></td></tr></table></figure>
</li>
<li><p>Meta中常用设置：</p>
<table>
<thead>
<tr>
<th>名称</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>db_table</td>
<td>数据库中的表名</td>
</tr>
<tr>
<td>abstract</td>
<td>当设置为True时，说明当前模型是抽象基类</td>
</tr>
<tr>
<td>managed</td>
<td>如果设置False，则迁移不会创建或删除表，默认是True</td>
</tr>
<tr>
<td>ordering</td>
<td>⽤于记录排序，ordering = [‘pub_date’]或降序ordering = [‘- pub_date’]</td>
</tr>
</tbody></table>
</li>
<li><p>实例</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">from django.db import models</span><br><span class="line">from django.utils import timezone</span><br><span class="line">#用户类</span><br><span class="line">class User(models.Model):</span><br><span class="line">     uid &#x3D; models.AutoField(primary_key&#x3D;True) #⾃增主键</span><br><span class="line">     uname &#x3D; models.CharField(max_length&#x3D;60)</span><br><span class="line">     password &#x3D; models.CharField(max_length&#x3D;32)</span><br><span class="line">     user_type &#x3D; ((1,&#39;超级管理员&#39;),(2,&#39;普通用户&#39;)) </span><br><span class="line">     type &#x3D; models.IntegerField(default&#x3D;2,choices&#x3D;user_type)</span><br><span class="line">     regtime &#x3D; models.DateTimeField(default&#x3D;timezone.now) #缺省值是当前时间</span><br><span class="line">     ip &#x3D; models.IntegerField(null&#x3D;True)</span><br><span class="line">     login_type &#x3D; ((1,&#39;允许登录&#39;),(2,&#39;禁⽌登录&#39;)) #用户⾃定义类型对应mysql的enum类型</span><br><span class="line">     allowed &#x3D; models.IntegerField(default&#x3D;1,choices&#x3D;login_type)</span><br><span class="line">     email &#x3D; models.CharField(max_length&#x3D;100,null&#x3D;True)</span><br><span class="line">     memo &#x3D; models.CharField(max_length&#x3D;1000,null&#x3D;True)</span><br><span class="line">     class Meta:</span><br><span class="line">        db_table &#x3D; &#39;user&#39; #表名</span><br></pre></td></tr></table></figure>

</li>
</ul>
<h2 id="激活模型"><a href="#激活模型" class="headerlink" title="激活模型"></a>激活模型</h2><ul>
<li><p>创建迁移⽂件 （此刻表并没有创建到库中)</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python manage.py makemigrations</span><br></pre></td></tr></table></figure>
</li>
<li><p>执⾏迁移 （将模型创建到库中）</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python manage.py migrate</span><br></pre></td></tr></table></figure>

</li>
</ul>
<p>然后在应用的migrations⽬录中应该⽣成了迁移⽂件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">├── app</span><br><span class="line">│ ├── admin.py</span><br><span class="line">│ ├── apps.py</span><br><span class="line">│ ├── __init__.py</span><br><span class="line">│ ├── migrations</span><br><span class="line">│ │ ├── 0001_initial.py</span><br><span class="line">│ │ ├── __init__.py</span><br></pre></td></tr></table></figure>

<p>⽣成的表结构如下</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">CREATE TABLE &#96;user&#96; (</span><br><span class="line">    &#96;uid&#96; int(11) NOT NULL AUTO_INCREMENT,</span><br><span class="line">    &#96;uname&#96; varchar(60) NOT NULL,</span><br><span class="line">    &#96;password&#96; char(32) NOT NULL,</span><br><span class="line">    &#96;type&#96; enum(&#39;超级管理员&#39;,&#39;普通用户&#39;) DEFAULT &#39;普通用户&#39;,</span><br><span class="line">    &#96;regtime&#96; datetime DEFAULT NULL,</span><br><span class="line">    &#96;ip&#96; int(11) DEFAULT NULL,</span><br><span class="line">    &#96;allowed&#96; enum(&#39;允许登录&#39;,&#39;禁⽌登录&#39;) DEFAULT &#39;允许登录&#39;,</span><br><span class="line">    &#96;email&#96; varchar(100) DEFAULT NULL,</span><br><span class="line">    &#96;memo&#96; varchar(1000) DEFAULT NULL,</span><br><span class="line">    PRIMARY KEY (&#96;uid&#96;)</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<blockquote>
<p> <strong>注意：</strong>任何对字段或表的修改都需要重新迁移</p>
</blockquote>
<ul>
<li><p>反向迁移:可以根据数据库中表⾃动创建模型</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python manage.py inspectdb &gt; App&#x2F;models.py</span><br></pre></td></tr></table></figure>

</li>
</ul>
<h2 id="模型的使用"><a href="#模型的使用" class="headerlink" title="模型的使用"></a>模型的使用</h2><h3 id="增"><a href="#增" class="headerlink" title="增"></a>增</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">from app.models.User import User #导⼊User模型</span><br><span class="line">from hashlib import md5</span><br><span class="line">user &#x3D; User(uname&#x3D;&#39;admin&#39;,password&#x3D;md5(b&#39;123&#39;).hexdigest()) #实例化⼀个新对象</span><br><span class="line">user.save() #insert 插⼊数据库</span><br><span class="line"></span><br><span class="line">#便捷插⼊</span><br><span class="line">User.objects.create(username&#x3D;&#39;妈咪哄&#39;,password&#x3D;&#39;111&#39;)</span><br><span class="line"></span><br><span class="line"># 批量插⼊记录(不支持多对多)</span><br><span class="line">User.objects.bulk_create(User.objects.create(username&#x3D;&#39;哈哈&#39;,password&#x3D;&#39;111&#39;),User.objects.create(username&#x3D;&#39;嘻嘻&#39;,password&#x3D;&#39;111&#39;))</span><br></pre></td></tr></table></figure>

<h3 id="删"><a href="#删" class="headerlink" title="删"></a>删</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">u1 &#x3D; User.objects.get(pk&#x3D;1)</span><br><span class="line">u1.delete() # 删除该记录</span><br></pre></td></tr></table></figure>

<ul>
<li><p>数据的逻辑删除</p>
<p>对于重要数据，⼀般不会直接删除，会在表中增加⼀个字段⽐如： <code>is_deleted</code>，如果删除的话，将这个字段置为True，以后查询的时候不在查询，这种操作称为逻辑删除</p>
</li>
</ul>
<h3 id="改"><a href="#改" class="headerlink" title="改"></a>改</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">u2 &#x3D; User.objects.get(pk&#x3D;2)</span><br><span class="line">u2.uname &#x3D; &#39;⼩甜甜&#39; #update 更新</span><br><span class="line">u2.save()</span><br><span class="line"></span><br><span class="line"># 修改多条记录</span><br><span class="line">users &#x3D; User.objects.all()</span><br><span class="line">users.update(password&#x3D;md5(b&#39;345&#39;).hexdigest())</span><br></pre></td></tr></table></figure>

<h3 id="数据查询"><a href="#数据查询" class="headerlink" title="数据查询"></a>数据查询</h3><p>要从数据库检索数据，⾸先要获取⼀个查询集(QuerySet)，查询集表示从数据库获取的对象集合，它可以有零个，⼀个或多个过滤器。返回查询集的⽅法，称为过滤器，过滤器根据给定的参数缩⼩查询结果范围，相当于sql语句中where或limit。</p>
<ul>
<li>在管理器上调用过滤器⽅法会返回查询集</li>
<li>查询集经过过滤器筛选后返回新的查询集，因此可以写成链式过滤 </li>
<li>惰性执⾏：创建查询集不会带来任何数据库的访问，直到调用数据时，才会访 问数据库</li>
<li>以下对查询集求值：迭代、切⽚、序列化、与if合用、repr()/print()/len()/list()/bool()</li>
</ul>
<table>
<thead>
<tr>
<th>管理器的方法</th>
<th>返回类型</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>模型类.objects.all()</td>
<td>QuerySet</td>
<td>返回表中所有数据</td>
</tr>
<tr>
<td>模型类.objects.filter()</td>
<td>QuerySet</td>
<td>返回符合条件的数据</td>
</tr>
<tr>
<td>模型类.objects.exclude()</td>
<td>QuerySet</td>
<td>返回不符合条件的数据</td>
</tr>
<tr>
<td>模型类.objects.order_by()</td>
<td>QuerySet</td>
<td>对查询结果集进⾏排序</td>
</tr>
<tr>
<td>模型类.objects.values()</td>
<td>QuerySet</td>
<td>返回⼀个Queryset，其中每个对象为⼀个 字典</td>
</tr>
<tr>
<td>模型类.objects.values_list()</td>
<td>QuerySet</td>
<td>和values()基本相同，但每个对象是⼀个元 组</td>
</tr>
<tr>
<td>模型类.objects.reverse()</td>
<td>QuerySet</td>
<td>对排序的结果反转</td>
</tr>
<tr>
<td>模型类.objects.only(字 段)</td>
<td>QuerySet</td>
<td>只显示指定字段</td>
</tr>
<tr>
<td>模型类.objects.defer(字 段)</td>
<td>QuerySet</td>
<td>去除指定字段</td>
</tr>
<tr>
<td>模型类.objects.get()</td>
<td>模型对象</td>
<td>返回⼀个满⾜条件的对象；如果没有找到符合条件的对象，会引发模型类.DoesNotExist异常;如果找到多个，会引发模型类.MultiObjectsReturned 异常</td>
</tr>
<tr>
<td>模型类.objects.first()</td>
<td>模型对象</td>
<td>返回第⼀条数据</td>
</tr>
<tr>
<td>模型类.objects.last()</td>
<td>模型对象</td>
<td>返回最后⼀条数据</td>
</tr>
<tr>
<td>模型类.objects.earliest（）</td>
<td>模型对象</td>
<td>根据指定字段返回最早增加的记录</td>
</tr>
<tr>
<td>模型类.objects.latest(field)</td>
<td>模型对象</td>
<td>根据field字段返回最近增加记录</td>
</tr>
<tr>
<td>模型类.objects.exists()</td>
<td>bool</td>
<td>判断查询的数据是否存在</td>
</tr>
<tr>
<td>模型类.objects.count()</td>
<td>int</td>
<td>返回查询集中对象的数⽬</td>
</tr>
</tbody></table>
<h4 id="返回查询集"><a href="#返回查询集" class="headerlink" title="返回查询集"></a>返回查询集</h4><ul>
<li><p>all()</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># 获取所有数据，对应SQL：select * from User</span><br><span class="line">User.objects.all()</span><br></pre></td></tr></table></figure>
</li>
<li><p>filter(**kwargs) 返回QuerySet包含与给定查找参数匹配的新查询集</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">#等价sql：select * from User</span><br><span class="line">User.objects.filter()</span><br><span class="line"></span><br><span class="line">#等价sql：select * from User where uname &#x3D; &#39;admin&#39;</span><br><span class="line">User.objects.filter(uname&#x3D;&#39;admin&#39;)</span><br><span class="line"></span><br><span class="line">#等级sql：select * from User where uid &gt; 1 and type &#x3D; 2</span><br><span class="line">User.objects.filter(uid__gt&#x3D;1,type&#x3D;2)</span><br><span class="line"></span><br><span class="line">#链式调用，等价于User.objects.filter(uid__gt&#x3D;1,type&#x3D;2)</span><br><span class="line">User.objects.filter(uid__gt&#x3D;1).filter(type&#x3D;2)</span><br></pre></td></tr></table></figure>
</li>
<li><p>exclude(**kwargs)</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># 不匹配，对应SQL：select * from User where name !&#x3D; &#39;admin&#39;</span><br><span class="line">User.objects.exclude(name&#x3D;&#39;admin&#39;)</span><br></pre></td></tr></table></figure>
</li>
<li><p>order_by(*fields)</p>
<ul>
<li>参数是字段名,可以有多个字段名,默认是升序</li>
<li>如果要按某个字段降序,在字段名前加’-‘; “-uid”表示按uid降序排列</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">#按uid升序排列 等价于 order by uid</span><br><span class="line">User.objects().order_by(&#39;uid&#39;)</span><br><span class="line">#按uid降序排列 等价于 order by uid desc</span><br><span class="line">User.objects.order_by(&#39;-uid&#39;)</span><br><span class="line">#多列排序 等价于 order by password,uid desc</span><br><span class="line">User.objects.order_by(&#39;password&#39;,&#39;-uid&#39;)</span><br></pre></td></tr></table></figure>
</li>
<li><p>values()</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">#返回所有字段</span><br><span class="line">User.objects.values()</span><br><span class="line"></span><br><span class="line">#返回数据：</span><br><span class="line">[&#123;&#39;uid&#39;: 2, &#39;uname&#39;: &#39;⼩甜甜&#39;, &#39;password&#39;:</span><br><span class="line">&#39;59f2443a4317918ce29ad28a14e1bdb7&#39;type&#39;: &#39;普通用户&#39;, &#39;regtime&#39;:</span><br><span class="line">None, &#39;ip&#39;: None, &#39;allowed&#39;: &#39;允许登录&#39;, &#39;email&#39;: None, None&#125;,...]</span><br><span class="line"></span><br><span class="line">#返回指定字段</span><br><span class="line">User.objects.values(&#39;uname&#39;,&#39;password&#39;)</span><br><span class="line">[&#123;&#39;uname&#39;: &#39;⼩甜甜&#39;, &#39;password&#39;:&#39;59f2443a4317918ce29ad28a14e1bdb7&#39;&#125;,...]</span><br></pre></td></tr></table></figure>
</li>
<li><p>reverse()</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">User.objects.order_by(&#39;id&#39;).reverse() # 降序</span><br><span class="line">User.objects.order_by(&#39;-id&#39;).reverse() # 升序</span><br></pre></td></tr></table></figure>
</li>
<li><p>distinct() 去重</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">User.objects.values(&#39;password&#39;).distinct()</span><br></pre></td></tr></table></figure>

</li>
</ul>
<h4 id="返回单个值"><a href="#返回单个值" class="headerlink" title="返回单个值"></a>返回单个值</h4><p>下⾯这些⽅法后⾯不能再跟其他过滤⽅法，因为他们不返回查询集</p>
<ul>
<li><p>get() 只匹配一条数据</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">u &#x3D; User.objects.get(pk&#x3D;1)  # 正常</span><br><span class="line">u &#x3D; User.objects.get(uid__gt&#x3D;20)#MultipleObjectsReturned 匹配到了多条数据</span><br><span class="line">u &#x3D; USer.objects.get(uid__lt&#x3D;1)  #DoesNotExist 匹配失败</span><br></pre></td></tr></table></figure>
</li>
<li><p>first()和last()</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">User.objects.all().first() #返回结果集中第⼀条数据</span><br><span class="line">User.objects.all().last() #返回结果集中最后⼀条数据</span><br></pre></td></tr></table></figure>
</li>
<li><p>count()</p>
<ul>
<li>返回结果集记录数⽬，等价于select count(*)</li>
<li>不会返回整个结果集，相⽐len⽅法更有效</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">User.objects.count()</span><br></pre></td></tr></table></figure>
</li>
<li><p>exists()</p>
<ul>
<li><p>判断查询集中是否有记录，有返回True，否则返回False</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">User.objects.filter(uid&#x3D;3).exists()</span><br></pre></td></tr></table></figure>

</li>
</ul>
</li>
</ul>
<h4 id="查询集限制"><a href="#查询集限制" class="headerlink" title="查询集限制"></a>查询集限制</h4><p>查询集类似列表，可以使用下标进⾏限制，类似sql语句中的limit⼦句。但索引不能是负数</p>
<ul>
<li>索引</li>
<li>切⽚</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">User.objects.all()[0] #等同于：limit 0,1</span><br><span class="line">User.objects.all()[2] #等同于：limit 2,1</span><br><span class="line">User.objects.all()[0:2] #等同于limit 2</span><br><span class="line">User.objects.all()[:2] #等同于limit 2</span><br><span class="line">User.objects.all()[::2]</span><br></pre></td></tr></table></figure>

<h4 id="字段查询"><a href="#字段查询" class="headerlink" title="字段查询"></a>字段查询</h4><p>相当于sql语句中where⼦句，它可以为filter、exclude和get⽅法提供参数。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">属性名称__⽐较运算符&#x3D;值 #是两个下划线</span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th align="center">操作符</th>
<th align="center">说明</th>
<th align="center">事例</th>
</tr>
</thead>
<tbody><tr>
<td align="center">exact</td>
<td align="center">精确判等</td>
<td align="center">uname = ‘admin’<code>uname__exact = &#39;admin&#39;</code> <code>uname__exact = None</code> #uname is null</td>
</tr>
<tr>
<td align="center">iexact</td>
<td align="center">不区分⼤⼩写判等</td>
<td align="center">name__iexact = ‘admin’</td>
</tr>
<tr>
<td align="center">contains</td>
<td align="center">模糊查询，等价like  ‘% 值%’</td>
<td align="center">uname__contains = ‘admin’</td>
</tr>
<tr>
<td align="center">startswith</td>
<td align="center">以..开头</td>
<td align="center">uname__startswith = ‘a’</td>
</tr>
<tr>
<td align="center">istartswith</td>
<td align="center">（不区分⼤⼩写)以… 开头</td>
<td align="center">uname__istartswith = ‘a’</td>
</tr>
<tr>
<td align="center">endswith</td>
<td align="center">以…结尾</td>
<td align="center">uname__endswith = ‘m’</td>
</tr>
<tr>
<td align="center">iendswith</td>
<td align="center">（不区分⼤⼩写)以…结尾</td>
<td align="center">uname__iendswith = ‘m’</td>
</tr>
<tr>
<td align="center">isnull</td>
<td align="center">判空(等价 = None)</td>
<td align="center">uname__isnull = True #等价于 uname is null</td>
</tr>
<tr>
<td align="center">in</td>
<td align="center">包含</td>
<td align="center">uid__in = [1,2,4] # in后面必须是可迭代对象</td>
</tr>
<tr>
<td align="center">range</td>
<td align="center">范围测试（相当 between and)</td>
<td align="center">uid__range = [2,5] #uid&gt;=2 and uid &lt;=5</td>
</tr>
<tr>
<td align="center">gt/gte</td>
<td align="center">大于/大于等于</td>
<td align="center">uid__gt = 2</td>
</tr>
<tr>
<td align="center">lt/lte</td>
<td align="center">小于/小于等于</td>
<td align="center">uid__lte = 2</td>
</tr>
<tr>
<td align="center">regex</td>
<td align="center">正值匹配</td>
<td align="center">uname__regex= r’^a’</td>
</tr>
<tr>
<td align="center">iregex</td>
<td align="center">不区分大小写正则匹配</td>
<td align="center">uname__iregex= r’^a’</td>
</tr>
</tbody></table>
<ul>
<li><p>in后⾯可以跟⼀个⼦查询，但要求⼦查询只能返回⼀个字段</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">User.objects.filter(uid__in &#x3D; (2,3,4))</span><br><span class="line">User.objects.filter(uid__in &#x3D; [2,3,4])</span><br><span class="line">res &#x3D; User.objects.filter(uid__gt &#x3D; 1).values(&#39;uid&#39;) #查询集中只有⼀个字段uid</span><br><span class="line">User.objects.filter(uid__in &#x3D; res)</span><br></pre></td></tr></table></figure>
</li>
<li><p>⽇期查询</p>
<ul>
<li><p>year、month、day、week_day、hour、minute、second</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"> </span><br></pre></td></tr></table></figure>
<p> #等价sql: select * from User where year(regtime) = 2018<br> User.objects.filter(regtime__year = 2018)<br>​    ```</p>
</li>
</ul>
</li>
</ul>
<h4 id="统计查询"><a href="#统计查询" class="headerlink" title="统计查询"></a>统计查询</h4><p>需要先导⼊模块：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">from django.db.models import Max,Min,Sum,Avg,Count</span><br></pre></td></tr></table></figure>

<ul>
<li><p>聚合查询：对多⾏查询结果的⼀列进⾏操作</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">#统计记录总数： select count(*) from user</span><br><span class="line">User.objects.aggregate(Count(&#39;uid&#39;)) #&#123;&#39;uid__count&#39;: 4&#125;</span><br><span class="line">User.objects.aggregate(Max(&#39;uid&#39;)) #&#123;&#39;uid__max&#39;: 5&#125;</span><br><span class="line">User.objects.aggregate(Min(&#39;uid&#39;)) # &#123;&#39;uid__min&#39;:2&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>分组统计</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">#等价sql: select type,count(*) from user group by type</span><br><span class="line">res &#x3D; User.objects.values(&#39;type&#39;).annotate(Count(&#39;uid&#39;))</span><br><span class="line">#统计结果： [&#123;&#39;type&#39;: &#39;普通用户&#39;, &#39;uid__count&#39;: 3&#125;, &#123;&#39;type&#39;: &#39;超级管理员&#39;, &#39;uid__count&#39;: 1&#125;]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#查看⽣成的sql语句</span><br><span class="line">print(res.query)</span><br><span class="line">#SELECT &#96;user&#96;.&#96;type&#96;, COUNT(&#96;user&#96;.&#96;uid&#96;) AS &#96;uid__count&#96; FROM &#96;user&#96; GROUP BY &#96;user&#96;.&#96;type&#96; ORDER BY NULL</span><br></pre></td></tr></table></figure>

</li>
</ul>
<h4 id="Q对象和F对象"><a href="#Q对象和F对象" class="headerlink" title="Q对象和F对象"></a>Q对象和F对象</h4><p>需要先导⼊模块：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">from django.db.models import Q,F</span><br></pre></td></tr></table></figure>

<ul>
<li><p>Q对象可以对关键字参数进⾏封装，从⽽更好的应用多个查询，可以组合&amp;(and)、|(or)、~(not)操作符。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">#原⽣sql:select * from user where uid &#x3D; 2 or uid &#x3D; 3</span><br><span class="line">User.objects.filter(Q(uid&#x3D;2)|Q(uid&#x3D;3))</span><br><span class="line">User.objects.filter(Q(uid__gte&#x3D;2) &amp; Q(uid__lte&#x3D;3))</span><br><span class="line">User.objects.filter(~Q(uid__gte&#x3D;2))</span><br></pre></td></tr></table></figure>
</li>
<li><p>F对象：用于⽐较表中两个字段</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">#等价sql：select * from user where uid &lt; type</span><br><span class="line">User.objects.filter(uid__lte &#x3D; F(&#39;type&#39;))</span><br></pre></td></tr></table></figure>

<h4 id="原始sql"><a href="#原始sql" class="headerlink" title="原始sql"></a>原始sql</h4></li>
</ul>
<p>您可以使用它 <code>Manager.raw()</code>来执⾏原始查询并返回模型实例，或者您可以完全避免模型层并直接执⾏⾃定义SQL。</p>
<ul>
<li><p>raw</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">users &#x3D; User.objects.raw(&quot;select * from user&quot;)</span><br><span class="line">users &#x3D; User.objects.raw(&quot;select * from user where username&#x3D;&#39;&#123;&#125;&#39;&quot;.format(&#39;单强&#39;))</span><br><span class="line">print(&quot;select * from user where username&#x3D;&#39;&#123;&#125;&#39;&quot;.format(&#39;单强&#39;))</span><br><span class="line">users &#x3D; User.objects.raw(&quot;select * from user where username&#x3D;&#39;&#123;&#125;&#39;&quot;.format(&#39;单强&#39;))</span><br><span class="line">users &#x3D; User.objects.raw(&quot;select * from user where username&#x3D;%s&quot;,[&quot;sddfsdf&#39; or &#39;1&quot;])</span><br><span class="line">print(list(users))</span><br><span class="line">print(type(users))</span><br></pre></td></tr></table></figure>
</li>
<li><p>自定义sql</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">from django.db import connection</span><br><span class="line"># with语句相当与cursor&#x3D; connection.cursor() 和 cursor.close(),简化了语</span><br><span class="line">with connection.cursor() as cursor: </span><br><span class="line">     cursor.execute(&quot;UPDATE bar SET foo &#x3D; 1 WHERE baz &#x3D; %s&quot;,[para])</span><br><span class="line">     cursor.execute(&quot;SELECT foo FROM bar WHERE baz &#x3D; %s&quot;, [para2])</span><br><span class="line">     row &#x3D; cursor.fetchone()</span><br><span class="line"># 返回列表套字典</span><br><span class="line">with connection.cursor() as cursor:</span><br><span class="line">    cursor.execute(&quot;select * from publisher&quot;)</span><br><span class="line">    columns &#x3D; [col[0] for col in cursor.description]</span><br><span class="line">    res &#x3D; [dict(zip(columns, row)) for row in cursor.fetchall()]</span><br><span class="line">    print(res)</span><br></pre></td></tr></table></figure>

</li>
</ul>
<h2 id="模型成员"><a href="#模型成员" class="headerlink" title="模型成员"></a>模型成员</h2><p>模型类和数据库中表对应，模型类的对象和记录对象，模型类本身没有数据库访问功能，但模型类中有⼀个Manager类的对象，通过管理器对象可以实现和数据库的访问。</p>
<p>当我们没有为模型类定义管理器时，Django会为模型类⽣成⼀个名为objects的管理器，⾃定义管理器后，Django不再⽣成默认管理器objects</p>
<p>管理器是Django的模型进⾏数据库操作的接⼝，Django应用的每个模型都拥有⾄少⼀个管理器。Django⽀持⾃定义管理器类，继承⾃models.Manager</p>
<p>⾃定义管理器类主要用于两种情况：</p>
<ul>
<li>修改原始查询集</li>
<li>向管理器类中添加额外的⽅法，如向数据库中插⼊数据。</li>
</ul>
<h3 id="重命名管理器"><a href="#重命名管理器" class="headerlink" title="重命名管理器"></a>重命名管理器</h3><p>在模型类中⾃定义⼀个新的管理器，则原有的objects管理器不会存在，以后对数据库的操作使用⾃⼰定义的管理器</p>
<p>模型类</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">class Artical(models.Model):</span><br><span class="line">     aid &#x3D; models.AutoField(primary_key&#x3D;True)</span><br><span class="line">     title &#x3D; models.CharField(max_length&#x3D;100,null&#x3D;False)</span><br><span class="line">     content &#x3D; models.TextField(max_length&#x3D;10000,null&#x3D;True)</span><br><span class="line">     ....</span><br><span class="line">     art_manager &#x3D; models.Manager() #⾃定义了⼀个新的管理器，名字为art_manager</span><br></pre></td></tr></table></figure>

<p>视图views</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">def article_get(request):</span><br><span class="line">    articles &#x3D; Artical.art_manager.all() #使用art_manager进⾏查询</span><br><span class="line">    return render(request,&quot;articlelist.html&quot;,context&#x3D;&#123;&#39;articls&#39;:articles&#125;)</span><br></pre></td></tr></table></figure>

<h3 id="⾃定义管理器"><a href="#⾃定义管理器" class="headerlink" title="⾃定义管理器"></a>⾃定义管理器</h3><ul>
<li><p>修改原始查询集（由<code>all()</code>获取的查询集）</p>
<ul>
<li>修改管理器的<code>get_queryset</code>⽅法，可以改变all⽅法返回的原始查询集</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">#⾸先⾃定义Manager的⼦类</span><br><span class="line">class ArticleManager(models.Manager):</span><br><span class="line"> def get_queryset(self):</span><br><span class="line">    return super().get_queryset().filter(ispublished&#x3D;True) #获取已发表的⽂章</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#模型类</span><br><span class="line">class Artical(models.Model):</span><br><span class="line">    ....</span><br><span class="line">    objects &#x3D; models.Manager() #可以有多个管理器</span><br><span class="line">    publishManager &#x3D; ArticleManager()</span><br><span class="line"> </span><br><span class="line"># 视图views</span><br><span class="line">def article_publish(request):</span><br><span class="line">    published &#x3D; Artical.publishManager.all()</span><br><span class="line">    return HttpResponse(&quot;已经发表&#123;&#125;&quot;.format(published[0].title))</span><br></pre></td></tr></table></figure>
</li>
<li><p>给管理器类中添加额外的⽅法</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">class ArticleManager(models.Manager):</span><br><span class="line">    def get_queryset(self):</span><br><span class="line">    	return super().get_queryset().filter(ispublished&#x3D;True)</span><br><span class="line"></span><br><span class="line">    #新增⼀个创建对象的⽅法</span><br><span class="line">    def create(self,title,content,publishingdate,comments,likenum,ispublished):</span><br><span class="line">        article &#x3D; Artical()</span><br><span class="line">        article.title &#x3D; title</span><br><span class="line">        article.content &#x3D; content</span><br><span class="line">        article.publishingdate &#x3D; publishingdate</span><br><span class="line">        article.comments &#x3D; comments</span><br><span class="line">        article.likenum &#x3D; likenum</span><br><span class="line">        article.ispublished &#x3D; ispublished</span><br><span class="line">        article.save()</span><br><span class="line">        return article</span><br><span class="line">    </span><br><span class="line">#views.py中</span><br><span class="line">def article_add(request):</span><br><span class="line">    # art &#x3D; Artical(title&#x3D;&#39;⼩时代&#39;,content&#x3D;&quot;混乱的逻辑&quot;)</span><br><span class="line">    # art.save()</span><br><span class="line">    Artical.publishManager.create(&#39;中美贸易战&#39;,&#39;川朴⼀⾖⽐&#39;,&#39;2018-10-8&#39;,0,0,1)</span><br><span class="line">    return HttpResponse(&quot;&quot;)</span><br></pre></td></tr></table></figure>

</li>
</ul>
<h2 id="模型对应关系"><a href="#模型对应关系" class="headerlink" title="模型对应关系"></a>模型对应关系</h2><p>关系数据库最强⼤的地⽅在于“关系”，也即表和表之间是有关联的，这种关联有三种类型</p>
<ul>
<li>⼀对⼀</li>
<li>⼀对多</li>
<li>多对多</li>
</ul>
<h3 id="⼀对⼀"><a href="#⼀对⼀" class="headerlink" title="⼀对⼀"></a>⼀对⼀</h3><p>⼀个学⽣有⼀个档案，⼀个档案属于⼀个学⽣，那么学⽣表和档案表就是⼀对⼀关系。学⽣表是主表，档案表是从表，从表中有⼀个外键和学⽣表关联，并且要求外键取值唯⼀。对应关键字为：<code>OneToOneField</code></p>
<p>模型类<code>Student</code></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Student</span><span class="params">(models.Model)</span>:</span></span><br><span class="line">    sno = models.CharField(max_length=<span class="number">6</span>,primary_key=<span class="literal">True</span>)</span><br><span class="line">    sname = models.CharField(max_length=<span class="number">100</span>,null=<span class="literal">False</span>)</span><br><span class="line">    ssex = models.CharField(max_length=<span class="number">2</span>,default=<span class="string">'男'</span>,null=<span class="literal">True</span>)</span><br><span class="line">    sage = models.IntegerField(null=<span class="literal">True</span>)</span><br><span class="line">    sclass = models.CharField(max_length=<span class="number">10</span>,null=<span class="literal">True</span>)</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__str__</span><span class="params">(self)</span>:</span></span><br><span class="line">    	<span class="keyword">return</span> <span class="string">"no:&#123;&#125;,name:&#123;&#125;"</span>.format(self.sno,self.sname)</span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Meta</span>:</span></span><br><span class="line">   		db_table = <span class="string">'student'</span></span><br></pre></td></tr></table></figure>

<p>模型类<code>Archives</code></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Archives</span><span class="params">(models.Model)</span>:</span></span><br><span class="line">    idcard = models.CharField(max_length=<span class="number">18</span>, unique=<span class="literal">True</span>)</span><br><span class="line">    address = models.CharField(max_length=<span class="number">200</span>,null=<span class="literal">True</span>)</span><br><span class="line">    <span class="comment"># on_delete=models.CASCADE 级联删除，删除学⽣会连同档案⼀块删除</span></span><br><span class="line">    student = models.OneToOneField(Student, on_delete=models.CASCADE)</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__str__</span><span class="params">(self)</span>:</span></span><br><span class="line">    	<span class="keyword">return</span> <span class="string">"&#123;&#125;,&#123;&#125;"</span>.format(self.idcard,self.address)</span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Meta</span>:</span></span><br><span class="line">   		db_table = <span class="string">'archives'</span></span><br></pre></td></tr></table></figure>

<ul>
<li><p>增加数据</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">addstudent</span><span class="params">(request)</span>:</span></span><br><span class="line">    student = Student()</span><br><span class="line">    student.sno = <span class="string">'180502'</span></span><br><span class="line">    student.sname = <span class="string">'杨康'</span></span><br><span class="line">    student.sage = <span class="number">22</span></span><br><span class="line">    student.save()</span><br><span class="line">    <span class="keyword">return</span> HttpResponse(<span class="string">"增加了⼀个学⽣"</span>)</span><br><span class="line">    </span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">addarchives</span><span class="params">(request)</span>:</span></span><br><span class="line">    stu = Student.objects.get(pk=<span class="string">'180503'</span>)</span><br><span class="line">    arc = Archives()</span><br><span class="line">    arc.idcard = <span class="string">'130098384893838953'</span></span><br><span class="line">    arc.student = stu <span class="comment">#学⽣对象必须已经保存到数据库，否则错误</span></span><br><span class="line">    arc.save()</span><br><span class="line">    <span class="keyword">return</span> HttpResponse(<span class="string">"增加档案"</span>)</span><br></pre></td></tr></table></figure>
</li>
<li><p>删除数据</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">deletestudent</span><span class="params">(request)</span>:</span></span><br><span class="line">    student = Student.objects.get(pk=<span class="string">'180503'</span>)</span><br><span class="line">    student.delete()</span><br><span class="line">    <span class="keyword">return</span> HttpResponse(<span class="string">"删除学⽣"</span>)</span><br></pre></td></tr></table></figure>
</li>
<li><p>正向查询</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">findstudent</span><span class="params">(request)</span>:</span></span><br><span class="line">    <span class="comment"># 获取学⽣信息</span></span><br><span class="line">    student = Student.objects.first()</span><br><span class="line">    print(student)</span><br><span class="line">    <span class="comment"># 通过学⽣对象获取档案信息</span></span><br><span class="line">    archive = student.archives</span><br><span class="line">    print(archive)</span><br><span class="line">    <span class="keyword">return</span> HttpResponse(student)</span><br></pre></td></tr></table></figure>
</li>
<li><p>反向查询</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">findarchives</span><span class="params">(request)</span>:</span></span><br><span class="line">    <span class="comment">#获取档案记录</span></span><br><span class="line">    archive = Archives.objects.first()</span><br><span class="line">    <span class="comment">#通过档案获取关联学⽣信息</span></span><br><span class="line">    student = archive.student</span><br><span class="line">    <span class="keyword">return</span> HttpResponse(student)</span><br></pre></td></tr></table></figure>
</li>
<li><p>跨关系查询</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">lookup</span><span class="params">(request)</span>:</span></span><br><span class="line">    <span class="comment">#根据档案查学⽣</span></span><br><span class="line">    <span class="comment"># student = Student.objects.get(archives__pk=1)</span></span><br><span class="line">    student =Student.objects.get(archives__idcard=<span class="string">'13009488384383838'</span>)</span><br><span class="line">    <span class="comment">#根据学⽣查档案</span></span><br><span class="line">    archive = Archives.objects.get(student__sno=<span class="string">'180501'</span>)</span><br><span class="line">    <span class="keyword">return</span> HttpResponse(archive)</span><br></pre></td></tr></table></figure>
</li>
<li><p><code>on_delete</code></p>
<ul>
<li>CASECADE 默认，默认级联删除数据 </li>
<li>PROTECT 保护模式，当从表中存在级联记录的时候，删除主表记录会抛出保护异常，从表中不存在级联数据的时候.是允许删除的</li>
<li>SET_XXX<ul>
<li>NULL 外键字段本身必须允许为空</li>
<li>DEFAULT 外键字段本身有默认值</li>
</ul>
</li>
<li>DO_NOTHING 什么都不做</li>
</ul>
</li>
</ul>
<h3 id="⼀对多"><a href="#⼀对多" class="headerlink" title="⼀对多"></a>⼀对多</h3><p>⼀个出版社可以出版多本书，⼀本书只能被⼀个出版社出版。出版社和图书表属于⼀对多，⼀对多⼀般将主表中的主键并到从表中做外键。在模型中用<code>ForeignKey</code>表示多对⼀</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Publisher</span><span class="params">(models.Model)</span>:</span></span><br><span class="line">    pname = models.CharField(max_length=<span class="number">100</span>,null=<span class="literal">True</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__str__</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> self.pname</span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Meta</span>:</span></span><br><span class="line"> 		db_table = <span class="string">'publisher'</span></span><br><span class="line">        </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Book</span><span class="params">(models.Model)</span>:</span></span><br><span class="line">    bname = models.CharField(max_length=<span class="number">200</span>,null=<span class="literal">True</span>)</span><br><span class="line">    <span class="comment">#多对⼀模型通过ForeignKey表示多对⼀</span></span><br><span class="line">    <span class="comment">#如果publisher定义在book之后，第⼀个参数应该用字符串'Publisher'</span></span><br><span class="line">    publisher = models.ForeignKey(Publisher,on_delete=models.CASCADE,</span><br><span class="line">                                  null=<span class="literal">True</span>,</span><br><span class="line">                                  db_column=<span class="string">'pid'</span>, <span class="comment">#表中字段名</span></span><br><span class="line">                                  related_name=<span class="string">'books'</span>) <span class="comment">#通过出版社查图书时使用的关系名</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__str__</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> self.bname</span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Meta</span>:</span></span><br><span class="line">        db_table = <span class="string">'book'</span></span><br></pre></td></tr></table></figure>

<ul>
<li><p>增加</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">pub = Publisher.objects.first()</span><br><span class="line">pub.books.create(bname=<span class="string">'红岩'</span>)</span><br><span class="line">book = Book.objects.get(pk=<span class="number">1</span>)</span><br><span class="line">pub.books.add(book) <span class="comment">#book必须已经保存到数据库</span></span><br><span class="line">books = Book.objects.filter(pk__lt=<span class="number">5</span>)</span><br><span class="line">pub.books.bulk_create(list(books))</span><br></pre></td></tr></table></figure>
</li>
<li><p>删除和更新</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">pub = Publisher.objects.first()</span><br><span class="line">pub.books.all().delete() <span class="comment">#删除出版社出版的所有图书</span></span><br><span class="line">pub.books.all().update(bname=<span class="string">'ddd'</span>)</span><br></pre></td></tr></table></figure>
</li>
<li><p>正向查询</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">findpublisher</span><span class="params">(req)</span>:</span></span><br><span class="line">    pub = Publisher.objects.first()</span><br><span class="line">    print(pub)</span><br><span class="line">    <span class="comment"># pub = Publisher()</span></span><br><span class="line">    book = pub.book_set.all()</span><br><span class="line">    print(book)</span><br><span class="line">    <span class="keyword">return</span> HttpResponse(<span class="string">"查询出版社"</span>)</span><br></pre></td></tr></table></figure>
</li>
<li><p>反向查询</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">findbook</span><span class="params">(req)</span>:</span></span><br><span class="line">    book = Book.objects.first()</span><br><span class="line">    <span class="keyword">return</span> HttpResponse(book.publisher.pname)</span><br></pre></td></tr></table></figure>
</li>
<li><p>跨关系查询</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">loopup</span><span class="params">(req)</span>:</span></span><br><span class="line">    <span class="comment"># 根据图书获取出版社</span></span><br><span class="line">    pub = Publisher.objects.get(book__bname=<span class="string">'花样年华927937'</span>)</span><br><span class="line">    print(pub)</span><br><span class="line">    <span class="comment"># 根据出版社获取图书</span></span><br><span class="line">    books = Book.objects.filter(publisher__pname=<span class="string">'科技出版社5829'</span>)</span><br><span class="line">    print(books)</span><br><span class="line">    <span class="keyword">return</span> HttpResponse(<span class="string">"跨关系查询"</span>)</span><br></pre></td></tr></table></figure>

</li>
</ul>
<h3 id="多对多"><a href="#多对多" class="headerlink" title="多对多"></a>多对多</h3><p>⼀个买家可以购买多件商品，⼀件商品可以被多个买家购买，买家和商品之间构成多对多关系，多对多关系必然会⽣成⼀张中间表：买家-商品表，记录商品和买家的关系，该表包含商品表主键和买家表的主键</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">from django.db import models</span><br><span class="line"># Create your models here.</span><br><span class="line">class Buyer(models.Model):</span><br><span class="line">    bname &#x3D; models.CharField(max_length&#x3D;30)</span><br><span class="line">    level &#x3D; models.IntegerField(default&#x3D;1)</span><br><span class="line">    </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">class Goods(models.Model):</span><br><span class="line">    gname &#x3D; models.CharField(max_length&#x3D;100)</span><br><span class="line">    price &#x3D; models.FloatField()</span><br><span class="line">    buyer &#x3D; models.ManyToManyField(Buyer) #这种写法⾃动⽣成第三张表，但我们⽆法直接控制</span><br><span class="line">    def __str__(self):</span><br><span class="line">        return self.gname +&quot; &quot;+ str(self.price)</span><br><span class="line"></span><br><span class="line">#⼿动创建中间表</span><br><span class="line">class Orders(models.Model):</span><br><span class="line">    buyer &#x3D; models.ForeignKey(Buyer,on_delete&#x3D;models.CASCADE,db_column&#x3D;&#39;bid&#39;)</span><br><span class="line">    goods &#x3D; models.ForeignKey(&#39;Goods&#39;,on_delete&#x3D;models.CASCADE,db_column&#x3D;&#39;gid&#39;)</span><br><span class="line">    num &#x3D; models.Integer(default&#x3D;1)</span><br><span class="line"></span><br><span class="line">class Goods(models.Model):</span><br><span class="line">    gname &#x3D; models.CharField(max_length&#x3D;100)</span><br><span class="line">    price &#x3D; models.FloatField()</span><br><span class="line">    buyer &#x3D; models.ManyToManyField(Buyer,through&#x3D;&#39;Orders&#39;)</span><br></pre></td></tr></table></figure>

<ul>
<li><p>购买商品</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">def sellgoods(req):</span><br><span class="line">    goods &#x3D; Goods.objects.get(pk&#x3D;randint(1,Goods.objects.count())</span><br><span class="line">    goods.buyer.add(Buyer.objects.get(pk&#x3D;randint(1,Buyer.objects.count())))</span><br><span class="line">    goods.save()</span><br><span class="line">    return HttpResponse(&quot;剁⼿成功&quot;)</span><br></pre></td></tr></table></figure>
</li>
<li><p>删除商品</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">buyer &#x3D; Buyer.objects.get(pk&#x3D;13)</span><br><span class="line">goods &#x3D; Goods.objects.filter(pk__lt&#x3D;10)</span><br><span class="line">buyer.goods_set.clear() #删除所有商品</span><br><span class="line">buyer.goods_set.remove(Goods.objects.get(pk&#x3D;2)) #删除指定商品</span><br></pre></td></tr></table></figure>
</li>
<li><p>正向查询</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">def findgoods_by_buyer(req):</span><br><span class="line">    buyer &#x3D; Buyer.objects.get(pk&#x3D;13)</span><br><span class="line">    res &#x3D; buyer.goods_set.all()</span><br><span class="line">    print(res)</span><br><span class="line">    return HttpResponse(&quot;由买家查询商品&quot;)</span><br></pre></td></tr></table></figure>
</li>
<li><p>反向查询</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">def findbuyer_by_goods(request):</span><br><span class="line">    goods &#x3D; Goods.objects.last()</span><br><span class="line">    buyer &#x3D; goods.buyer.all()</span><br><span class="line">    print(buyer)</span><br><span class="line">    return HttpResponse(&quot;由商品查询买家&quot;)</span><br></pre></td></tr></table></figure>

</li>
</ul>
<h2 id="模型继承"><a href="#模型继承" class="headerlink" title="模型继承"></a>模型继承</h2><p>django中的数据库模块提供了⼀个⾮常不错的功能，就是⽀持models的⾯向对象，可以在models中添加Meta，指定是否抽象，然后进⾏继承</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Animal</span><span class="params">(models.Model)</span>:</span></span><br><span class="line">    xxx</span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Meta</span>:</span></span><br><span class="line">    	abstract = <span class="literal">True</span>/<span class="literal">False</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Dog</span><span class="params">(Animal)</span>:</span></span><br><span class="line">	xxx</span><br></pre></td></tr></table></figure>

<p>默认模型就是允许继承的，但是默认的继承处理⽅式不是很合理:</p>
<ul>
<li>默认在⽗类中定义的字段会存在⽗类的表中，⼦类的数据通用部分会存在⽗表中，⼦类特有数据会在⼦表中，⼦类通过外键进⾏级联</li>
<li>默认方式比较垃圾，效率⽐较低</li>
</ul>
<p>开发中，需要将⽗类抽象化，在元信息中使用abstract=True</p>
<ul>
<li>抽象化的父类不会再数据库⽣成表了</li>
<li>子类会将父类中的通用数据，复制到子表中</li>
</ul>
<h1 id="Django-模板-T"><a href="#Django-模板-T" class="headerlink" title="Django 模板(T)"></a>Django 模板(T)</h1><p>模板用于快速⽣成动态⻚⾯返回给客户端，模板是⼀个⽂本，用于分离⽂档的表现形式和内容。 模板定义了占位符以及各种用于规范⽂档该如何显示的模板标签。模板通常用于产⽣HTML，但是Django的模板也能产⽣任何基于⽂本格式的⽂档。 </p>
<p>模板包含两部分：</p>
<ul>
<li>html代码</li>
<li>模板标签</li>
</ul>
<h2 id="一、模板位置"><a href="#一、模板位置" class="headerlink" title="一、模板位置"></a>一、模板位置</h2><ul>
<li><p>在应用中建⽴templates⽬录，好处不需要注册，不好的地⽅，有多个应用的时候不能复用⻚⾯</p>
</li>
<li><p>第⼆种是放在⼯程的⽬录下，好处是如果有多个应用，可以调用相同的⻚⾯，需要注册</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">TEMPLATES &#x3D; [</span><br><span class="line"> &#123;</span><br><span class="line">    &#39;BACKEND&#39;:</span><br><span class="line">    &#39;django.template.backends.django.DjangoTemplates&#39;,</span><br><span class="line">    &#39;DIRS&#39;: [os.path.join(BASE_DIR, &#39;templates&#39;)], #模板绝对路径</span><br><span class="line">    &#39;APP_DIRS&#39;: True, #是否在应用⽬录下查找模板⽂件</span><br><span class="line">    &#39;OPTIONS&#39;: &#123;</span><br><span class="line">        &#39;context_processors&#39;: [</span><br><span class="line">        &#39;django.template.context_processors.debug&#39;,</span><br><span class="line">        &#39;django.template.context_processors.request&#39;,</span><br><span class="line">        &#39;django.contrib.auth.context_processors.auth&#39;,</span><br><span class="line">        &#39;django.contrib.messages.context_processors.messages&#39;,</span><br><span class="line">        ],</span><br><span class="line">    &#125;,</span><br><span class="line"> &#125;,</span><br><span class="line">]</span><br></pre></td></tr></table></figure>

</li>
</ul>
<p>Django 模板查找机制： Django 查找模板的过程是在每个 app 的 templates⽂件夹中找（⽽不只是当前 app 中的代码只在当前的 app 的 templates ⽂件夹中找）。各个 app 的 templates 形成⼀个⽂件夹列表，Django 遍历这个列 </p>
<p>表，⼀个个⽂件夹进⾏查找，当在某⼀个⽂件夹找到的时候就停⽌，所有的都遍历完了还找不到指定的模板的时候就是 Template Not Found （过程类似于Python找包）。这样设计有利当然也有弊，有利是的地⽅是⼀个app可以用另⼀个app的模板⽂件，弊是有可能会找错了。所以我们使用的时候在templates 中建⽴⼀个 app 同名的⽂件夹，这样就好了。</p>
<h2 id="二、模板的渲染"><a href="#二、模板的渲染" class="headerlink" title="二、模板的渲染"></a>二、模板的渲染</h2><h3 id="loader加载"><a href="#loader加载" class="headerlink" title="loader加载"></a>loader加载</h3><p>好处是可以加载⼀次模板，然后进⾏多次渲染</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">from django.template import loader #导⼊loader</span><br><span class="line">def index(request):</span><br><span class="line">    temp &#x3D; loader.get_template(&#39;index.html&#39;)</span><br><span class="line">    print(temp.__dict__)</span><br><span class="line">    # 渲染模板，⽣出html源码</span><br><span class="line">    res &#x3D; temp.render(context&#x3D;&#123;&#39;content&#39;:&#39;hello index&#39;&#125;)</span><br><span class="line">    print(res)</span><br><span class="line">    return HttpResponse(res)</span><br></pre></td></tr></table></figure>

<h3 id="render加载"><a href="#render加载" class="headerlink" title="render加载"></a>render加载</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">from django.shortcuts import render</span><br><span class="line">render(request,templatesname,context&#x3D;None)</span><br><span class="line">参数：</span><br><span class="line"> request： 请求对象</span><br><span class="line"> templatesname：模板名称</span><br><span class="line"> context：参数字典，必须是字典</span><br></pre></td></tr></table></figure>

<p>##三、模板语法</p>
<p>django模板中包括两部分：变量和内置标签。变量会在模板渲染时被其值代替，内置标签负责逻辑控制</p>
<h3 id="变量"><a href="#变量" class="headerlink" title="变量"></a>变量</h3><p>变量在模板中的表示为：<code></code>，变量名就是render中context中的键。变量可以基本类型中的数值、字符串、布尔，也可以是字典、对象、列表等。django提供了点号来访问复杂数据结构。</p>
<ul>
<li>列表、元组的元素可以使用索引引用，不能使用负索引，语法：变量.索引</li>
<li>字典： 字典变量.key</li>
<li>对象： 对象.属性 对象.⽅法名（⽅法不能有参数）</li>
</ul>
<p>当模板系统在变量名中遇到点时，按照以下顺序尝试进行查找</p>
<ul>
<li><p>字典类型查找</p>
</li>
<li><p>属性查找</p>
</li>
<li><p>⽅法调用</p>
</li>
<li><p>列表类型索引</p>
</li>
</ul>
<p>如果模板中引用变量未传值，则会被置为空，不会报错，除⾮你对其进行了操作</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">def handle_var(request):</span><br><span class="line">    num &#x3D; 10</span><br><span class="line">    name &#x3D; &quot;伟大的意大利左后卫&quot;</span><br><span class="line">    students &#x3D; [10,20,30,[50,60]]</span><br><span class="line">    student &#x3D; &#123;&#39;name&#39;:&#39;马尔蒂尼&#39;,&#39;age&#39;:30&#125;</span><br><span class="line">    # locals(): 返回包含当前范围的局部变量的字典。</span><br><span class="line">    return render(request,&quot;变量.html&quot;,locals())</span><br><span class="line">      </span><br><span class="line">    </span><br><span class="line">&#123;# 变量  #&#125;</span><br><span class="line">&#123;# 复杂类型的访问可以使用点，但不能使用下标 #&#125;</span><br><span class="line">&#123;&#123; num &#125;&#125;</span><br><span class="line">&#123;&#123; name &#125;&#125;</span><br><span class="line">&#123;#   --&#123;&#123; students[1] &#125;&#125;  不能使用下标 #&#125;</span><br><span class="line">&#123;&#123; students.0 &#125;&#125;----&#123;&#123; students.3.0 &#125;&#125;</span><br><span class="line">&#123;&#123; student.name &#125;&#125;</span><br></pre></td></tr></table></figure>

<h3 id="过滤器"><a href="#过滤器" class="headerlink" title="过滤器"></a>过滤器</h3><p>过滤器是在变量显示之前修改它的值的⼀个⽅法，过滤器使用管道符。过滤器可以串联调用</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123; 变量|方法&#125;&#125;</span><br></pre></td></tr></table></figure>

<p>常见的过滤器方法:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">|     方法名      |            作用             |                       示例                        |</span><br><span class="line">|     default     |           缺省值            |            &#123;&#123; li|default:&quot;缺省值&quot; &#125;&#125;           </span><br><span class="line">| default_if_none | 如果变量是none 则显示缺省值 |       &#123;&#123; value|default_if_none:&#39;hello&#39; &#125;&#125;        |</span><br><span class="line">|       cut       |    从字符中删除指定字符     |     &#123;&#123; value | cut:&#39; &#39; &#125;&#125; 删除value所有空格      |</span><br><span class="line">|     length      |   获取字符串或列表的⻓度    |                 &#123;&#123; str1\|length&#125;&#125;                 |</span><br><span class="line">|      lower      |    将所有字⺟都变为⼩写     |                                                   |</span><br><span class="line">|      upper      |    将所有字⺟都变为⼤写     |                                                   |</span><br><span class="line">|  truncatechars  |     截取字符串前n个字符     |           &#123;&#123; value|truncatechars:9 &#125;&#125;            |</span><br><span class="line">|      date       |      格式化⽇期字符串       |          &#123;&#123;value|date:&quot;Y-m-d H:i:s&quot;  &#125;&#125;          |</span><br><span class="line">|       add       |        增加变量的值         |                 &#123;&#123; num|add:&#39;3&#39;&#125;&#125;                 |</span><br><span class="line">|   divisibleby   |    把变量的值除以指定值     |           &#123;&#123; value|divisibleby:&quot;3&quot; &#125;&#125;            |</span><br><span class="line">|      first      |     获取列表第一个元素      |                &#123;&#123; value|first &#125;&#125;                 |</span><br><span class="line">|      last       |    获取列表最后一个元素     |                                                   |</span><br><span class="line">|      join       | 将列表内容连接为一个字符串  |               &#123;&#123; value|join:&#39;-&#39; &#125;&#125;               |</span><br><span class="line">|   autoescape    |       设置或取消转译        | &#123;% autoescape off %&#125;&#123;&#123; data &#125;&#125;&#123;% endautoescape %&#125; |</span><br></pre></td></tr></table></figure>





<h4 id="⾃定义过滤器"><a href="#⾃定义过滤器" class="headerlink" title="⾃定义过滤器"></a>⾃定义过滤器</h4><p>内置过滤器功能有限，如果不能满足需求，可以自己定义过滤器。</p>
<ul>
<li><p>在app里创建⼀个包：templatetags</p>
</li>
<li><p>在包里创建⼀个py⽂件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">from django import template</span><br><span class="line"># 实例化⾃定义过滤器注册对象</span><br><span class="line">register &#x3D; template.Library()</span><br><span class="line"># name代表在模板中使用的过滤器的名称</span><br><span class="line">@register.filter(name&#x3D;&#39;hello&#39;)</span><br><span class="line">def hello(value,arg):</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line">    :param value: 传给hello过滤的值</span><br><span class="line">    :param arg: hello自带的参数</span><br><span class="line">    :return:</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line">	return value + str(arg)</span><br></pre></td></tr></table></figure>
</li>
<li><p>在模板中使用</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&#123;% load customfilter %&#125; #加载自定义过滤器的模块</span><br><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html lang&#x3D;&quot;en&quot;&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line"> &lt;meta charset&#x3D;&quot;UTF-8&quot;&gt;</span><br><span class="line"> &lt;title&gt;Title&lt;&#x2F;title&gt;</span><br><span class="line">&lt;&#x2F;head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&#123;&#123; name |hello:&#39; how are you&#39; &#125;&#125; #使用自定义过滤器</span><br><span class="line">&lt;&#x2F;body&gt;</span><br><span class="line">&lt;&#x2F;html&gt;</span><br></pre></td></tr></table></figure>

</li>
</ul>
<h3 id="内置标签"><a href="#内置标签" class="headerlink" title="内置标签"></a>内置标签</h3><p>语法：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;% tag %&#125;</span><br></pre></td></tr></table></figure>

<h4 id="if标签"><a href="#if标签" class="headerlink" title="if标签"></a>if标签</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&#123;% if express1 %&#125;</span><br><span class="line"> # to do</span><br><span class="line">&#123;% elif express2 %&#125;</span><br><span class="line"> # to do</span><br><span class="line">&#123;% else %&#125;</span><br><span class="line"> # to do</span><br><span class="line">&#123;% endif %&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>if表达式中使用以下运算符（优先级从高到低）：<ul>
<li>&lt; &gt;= &lt;= == !=</li>
<li>in 、not in</li>
<li>is、is not</li>
<li>not</li>
<li>and</li>
<li>or</li>
</ul>
</li>
<li>不要在表达式中使用（），可以使用if嵌套实现功能</li>
<li>不⽀持 if 3 &lt; b &lt; 5这种写法</li>
</ul>
<h4 id="for"><a href="#for" class="headerlink" title="for"></a>for</h4><p>遍历可迭代对象</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;% for x in y %&#125;</span><br><span class="line"> ...</span><br><span class="line">&#123;% endfor %&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li><p>反向迭代(reversed)</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;% for value in c [1,2,3,4,5] reversed %&#125;</span><br><span class="line"> &lt;span&gt;&#123;&#123; value &#125;&#125;---&lt;&#x2F;span&gt;</span><br><span class="line">&#123;% endfor %&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>empty 当可迭代对象为空或不存在时执⾏，否则不执行</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#123;% for value in c %&#125;</span><br><span class="line"> &lt;span&gt;&#123;&#123; value &#125;&#125;---&lt;&#x2F;span&gt;</span><br><span class="line">&#123;% empty %&#125;</span><br><span class="line"> 数据不存在</span><br><span class="line">&#123;% endfor %&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>字典迭代</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># e &#x3D; &#123;&#39;a1&#39;:20,&#39;b1&#39;:40&#125;</span><br><span class="line">&#123;% for k,v in e.items %&#125;</span><br><span class="line"> &lt;div&gt;&#123;&#123; k &#125;&#125;---&#123;&#123; v &#125;&#125;&lt;&#x2F;div&gt;</span><br><span class="line">&#123;% endfor%&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>获取for循环迭代的状态</p>
<table>
<thead>
<tr>
<th align="center">变量名称</th>
<th align="center">变量说明</th>
</tr>
</thead>
<tbody><tr>
<td align="center">forloop.counter</td>
<td align="center">获取迭代的索引 从1开始</td>
</tr>
<tr>
<td align="center">forloop.counter0</td>
<td align="center">获取迭代的索引 从0开始</td>
</tr>
<tr>
<td align="center">forloop.revcounter</td>
<td align="center">迭代的索引从最⼤递减到1</td>
</tr>
<tr>
<td align="center">forloop.revcounter0</td>
<td align="center">迭代的索引从最⼤递减到0</td>
</tr>
<tr>
<td align="center">forloop.first</td>
<td align="center">是否为第⼀次迭代</td>
</tr>
<tr>
<td align="center">forloop.last</td>
<td align="center">是否为最后⼀次迭代</td>
</tr>
<tr>
<td align="center">forloop.parentloop</td>
<td align="center">获取上层的迭代对象</td>
</tr>
</tbody></table>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&#123;% for i in c %&#125;</span><br><span class="line"> &lt;li&gt;&#123;&#123; forloop.first &#125;&#125;&lt;&#x2F;li&gt;</span><br><span class="line"> &lt;li&gt;&#123;&#123; forloop.last &#125;&#125;&lt;&#x2F;li&gt;</span><br><span class="line"> &lt;li&gt;&#123;&#123; forloop.counter &#125;&#125;&lt;&#x2F;li&gt;</span><br><span class="line"> &lt;li&gt;&#123;&#123; forloop.counter0 &#125;&#125;&lt;&#x2F;li&gt;</span><br><span class="line"> &lt;li&gt;&#123;&#123; forloop.revcounter &#125;&#125;&lt;&#x2F;li&gt;</span><br><span class="line"> &lt;li&gt;&#123;&#123; forloop.revcounter0 &#125;&#125;&lt;&#x2F;li&gt;</span><br><span class="line">&#123;% endfor %&#125;</span><br></pre></td></tr></table></figure>

</li>
</ul>
<h4 id="ifequal-ifnotequal"><a href="#ifequal-ifnotequal" class="headerlink" title="ifequal/ifnotequal"></a>ifequal/ifnotequal</h4><p>用于判断两个值相等或不等的</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&#123;% ifequal var var %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% endifequal %&#125;</span><br><span class="line">&#123;% ifnotequal var var %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% endifnotequal %&#125;</span><br></pre></td></tr></table></figure>

<h4 id="注释"><a href="#注释" class="headerlink" title="注释"></a>注释</h4><p>单⾏注释</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;# 注释的内容 #&#125;</span><br></pre></td></tr></table></figure>

<p>多⾏注释</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;% comment %&#125;</span><br><span class="line"> ...</span><br><span class="line">&#123;% endcomment %&#125;</span><br></pre></td></tr></table></figure>

<h4 id="跨站请求伪造-csrf"><a href="#跨站请求伪造-csrf" class="headerlink" title="跨站请求伪造 csrf"></a>跨站请求伪造 csrf</h4><p>防⽌⽹站受第三⽅服务器的恶意攻击（确定表单到底是不是本⽹站的表单传递过来的）。csrf相当于在表达中增加了⼀个隐藏的input框，用于向服务器提交⼀个唯⼀的随机字符串用于服务器验证表单是否是本服务器的表单。</p>
<p>使用：</p>
<p>settings.py</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">MIDDLEWARE &#x3D; [</span><br><span class="line"> &#39;django.middleware.csrf.CsrfViewMiddleware&#39;, </span><br><span class="line"> ]</span><br></pre></td></tr></table></figure>

<p>表单⾥</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;form action&#x3D;&quot;&quot; method&#x3D;&quot;post&quot;&gt;</span><br><span class="line"> &#123;% csrf_token %&#125;</span><br><span class="line"> &lt;input type&#x3D;&quot;text&quot; name&#x3D;&quot;username&quot;&gt;</span><br><span class="line"> &lt;p&gt;&lt;input type&#x3D;&quot;submit&quot;&gt;&lt;&#x2F;p&gt;</span><br><span class="line">&lt;&#x2F;form&gt;</span><br></pre></td></tr></table></figure>

<ul>
<li><p>全局禁用csrf</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">#在settings中设置</span><br><span class="line">MIDDLEWARE &#x3D; [</span><br><span class="line"> &#39;django.middleware.security.SecurityMiddleware&#39;,</span><br><span class="line"> &#39;django.contrib.sessions.middleware.SessionMiddleware&#39;,</span><br><span class="line"> &#39;django.middleware.common.CommonMiddleware&#39;,</span><br><span class="line"> #&#39;django.middleware.csrf.CsrfViewMiddleware&#39;,</span><br><span class="line"> &#39;django.contrib.auth.middleware.AuthenticationMiddleware&#39;,</span><br><span class="line"> &#39;django.contrib.messages.middleware.MessageMiddleware&#39;,</span><br><span class="line"> &#39;django.middleware.clickjacking.XFrameOptionsMiddleware&#39;,</span><br><span class="line">]</span><br></pre></td></tr></table></figure>
</li>
<li><p>局部禁用csrf</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">#在不想检验csrf的视图函数前添加装饰器@csrf_exempt。</span><br><span class="line">from django.views.decorators.csrf import csrf_exempt,csrf_protect</span><br><span class="line">@csrf_exempt</span><br><span class="line">def csrf1(request):</span><br><span class="line"> pass</span><br></pre></td></tr></table></figure>
</li>
<li><p>ajax验证csrf</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">Ajax提交数据时候，携带CSRF：</span><br><span class="line">a. 放置在data中携带</span><br><span class="line">&lt;form method&#x3D;&quot;POST&quot; action&#x3D;&quot;&#x2F;csrf1.html&quot;&gt;</span><br><span class="line">     &#123;% csrf_token %&#125;</span><br><span class="line">     &lt;input id&#x3D;&quot;username&quot; type&#x3D;&quot;text&quot; name&#x3D;&quot;username&quot; &#x2F;&gt;</span><br><span class="line">     &lt;input type&#x3D;&quot;submit&quot; value&#x3D;&quot;提交&quot;&#x2F;&gt;</span><br><span class="line">     &lt;a onclick&#x3D;&quot;submitForm();&quot;&gt;Ajax提交&lt;&#x2F;a&gt;</span><br><span class="line">&lt;&#x2F;form&gt;</span><br><span class="line">&lt;script src&#x3D;&quot;&#x2F;static&#x2F;jquery-1.12.4.js&quot;&gt;&lt;&#x2F;script&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line"> function submitForm()&#123;</span><br><span class="line">     var csrf &#x3D; $(&#39;input[name&#x3D;&quot;csrfmiddlewaretoken&quot;]&#39;).val();</span><br><span class="line">     var user &#x3D; $(&#39;#user&#39;).val();</span><br><span class="line">     $.ajax(&#123;</span><br><span class="line">         url: &#39;&#x2F;csrf1.html&#39;,</span><br><span class="line">         type: &#39;POST&#39;,</span><br><span class="line">         data: &#123; &quot;user&quot;:user,&#39;csrfmiddlewaretoken&#39;: csrf&#125;,</span><br><span class="line">         success:function(arg)&#123;</span><br><span class="line">             console.log(arg);</span><br><span class="line">         &#125;</span><br><span class="line">     &#125;)</span><br><span class="line"> &#125;</span><br><span class="line">&lt;&#x2F;script&gt;</span><br></pre></td></tr></table></figure>

<p><strong>注意:</strong>csrf的意义在于给每⼀个表单都设置⼀个唯⼀的csrf的值并且cookie也存储⼀份当提交表单过来的时候判断cookie中的值和csrf_token中的值是否都为本⽹站⽣成的如果验证通过则提交否则403</p>
</li>
</ul>
<h4 id="模板导⼊标签（-include）"><a href="#模板导⼊标签（-include）" class="headerlink" title="模板导⼊标签（ include）"></a>模板导⼊标签（ include）</h4><p>可以把指定html⽂件代码导⼊到当前⽂件，实现模板代码的复用/重用。语法格 式</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;% include &#39;路径&#x2F;xxx.html&#39; %&#125;</span><br></pre></td></tr></table></figure>

<h4 id="url标签"><a href="#url标签" class="headerlink" title="url标签"></a>url标签</h4><p>在模板中url标签可用于反向解析</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;h2&gt;&lt;a href&#x3D;&quot;&#123;% url &#39;App:index&#39; %&#125;&quot;&gt;动态⽣成路由地址不带参的跳转&lt;&#x2F;a&gt;&lt;&#x2F;h2&gt;</span><br><span class="line">&lt;h2&gt;&lt;a href&#x3D;&quot;&#123;% url &#39;App:args1&#39; 1 2 %&#125;&quot;&gt;动态⽣成路由地址带参的跳转&lt;&#x2F;a&gt;&lt;&#x2F;h2&gt;</span><br><span class="line">&lt;h2&gt;&lt;a href&#x3D;&quot;&#123;% url &#39;App:args1&#39; num1&#x3D;1 num2&#x3D;2 %&#125;&quot;&gt;动态⽣成路由地址带关键字参数的跳转&lt;&#x2F;a&gt;&lt;&#x2F;h2&gt;</span><br></pre></td></tr></table></figure>

<h2 id="四、模板继承"><a href="#四、模板继承" class="headerlink" title="四、模板继承"></a>四、模板继承</h2><p>在整个⽹站中，如何减少共用⻚⾯区域（比如站点导航）所引起的重复和冗余代码？Django 解决此类问题的⾸选⽅法是使用⼀种优雅的策略—— 模板继承 。</p>
<p>本质上来说，模板继承就是先构造⼀个基础框架模板，⽽后在其⼦模板中对它所包含站点公用部分和定义块进行重载</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;% extends %&#125;继承父模板</span><br><span class="line">&#123;% block %&#125;子模板可以重载这部分内容</span><br><span class="line">&#123;&#123;block.super&#125;&#125;调用父模板的代码</span><br></pre></td></tr></table></figure>

<p>使用继承的⼀种常⻅⽅式是下⾯的三层法</p>
<ul>
<li>创建base.html模板，在其中定义站点的主要外观感受。这些都是不常修改甚⾄从不修改的部分。</li>
<li>为每种类型的⻚⾯创建独⽴的模板，例如论坛⻚⾯或者图⽚库。这些模板拓展相应的区域模板</li>
<li>⾃⼰的⻚⾯继承⾃模板，覆盖⽗模板中指定block</li>
</ul>
<p>注意事项：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">1. 如果在模板中使用 &#123;% extends %&#125; ，必须保证其为模板中的第⼀个模板标记。否则，模板继承将不起作用</span><br><span class="line">2. ⼀般来说，基础模板中的 &#123;% block %&#125; 标签越多越好。</span><br><span class="line">3. 如果发觉⾃⼰在多个模板之间有重复代码，你应该考虑将该代码放置到⽗模板的某个 &#123;% block %&#125; 中。</span><br><span class="line">4. 不在同⼀个模板中定义多个同名的 &#123;% block %&#125; 。</span><br><span class="line">5. 多数情况下， &#123;% extends %&#125; 的参数应该是字符，但是如果直到运⾏时⽅能确定⽗模板名称，这个参数也 可以是个变量。</span><br></pre></td></tr></table></figure>

<h2 id="五、静态资源配置"><a href="#五、静态资源配置" class="headerlink" title="五、静态资源配置"></a>五、静态资源配置</h2><blockquote>
<p>什么是静态资源：css、js、images 需要从外部导⼊的资源</p>
</blockquote>
<ol>
<li><p>创建static⽂件夹（通常放在根⽬录下)</p>
</li>
<li><p>需要在settings注册</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">STATIC_URL &#x3D; &#39;&#x2F;static&#x2F;&#39;</span><br><span class="line">STATICFILES_DIRS &#x3D; [</span><br><span class="line"> os.path.join(BASE_DIR, &#39;static&#39;),</span><br><span class="line">]</span><br></pre></td></tr></table></figure>
</li>
<li><p>在模板中使用静态资源</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;% load static %&#125; #放置到模板开头</span><br><span class="line">&lt;img src&#x3D;&quot;&#x2F;static&#x2F;img&#x2F;img.jpeg&quot; alt&#x3D;&quot;&quot;&gt; #硬编码</span><br><span class="line">&lt;img src&#x3D;&quot;&#123;% static &#39;img&#x2F;img.jpeg&#39; %&#125;&quot; alt&#x3D;&quot;&quot;&gt; #动态写法，建议用这种</span><br></pre></td></tr></table></figure>

</li>
</ol>
<h2 id="六、jinja2模板引擎配置"><a href="#六、jinja2模板引擎配置" class="headerlink" title="六、jinja2模板引擎配置"></a>六、jinja2模板引擎配置</h2><ul>
<li><p>安装jinja2模板引擎</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install jinja2</span><br></pre></td></tr></table></figure>
</li>
<li><p>设置jinja2环境变量</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"># 在应用⽬录下，创建jinja2_env.py配置⽂件</span><br><span class="line">from django.contrib.staticfiles.storage import staticfiles_storage</span><br><span class="line">from django.urls import reverse</span><br><span class="line">from jinja2 import Environment</span><br><span class="line">def environment(**options):</span><br><span class="line">     env &#x3D; Environment(**options)</span><br><span class="line">     env.globals.update(&#123;</span><br><span class="line">     &#39;static&#39;: staticfiles_storage.url,</span><br><span class="line">     &#39;url&#39;: reverse,</span><br><span class="line"> 	&#125;)</span><br><span class="line"> 	return env</span><br></pre></td></tr></table></figure>
</li>
<li><p>配置（setting.py）</p>
<ul>
<li><p>独⽴使用jinja2，不使用Django模板引擎</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#独⽴使用jinja2</span></span><br><span class="line">INSTALLED_APPS = [</span><br><span class="line">     <span class="comment">#'django.contrib.admin', # 注释了admin</span></span><br><span class="line">     .....</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"><span class="comment">#模板配置</span></span><br><span class="line">TEMPLATES = [&#123;</span><br><span class="line"> <span class="string">'BACKEND'</span>:<span class="string">'django.template.backends.jinja2.Jinja2'</span>,<span class="comment">#jinja2模版</span></span><br><span class="line"> <span class="string">'DIRS'</span>: [</span><br><span class="line">	 os.path.join(BASE_DIR, <span class="string">'templates'</span>),<span class="comment">#模版⽂件位置</span></span><br><span class="line"> ],</span><br><span class="line"> <span class="string">'APP_DIRS'</span>: <span class="literal">True</span>, </span><br><span class="line"> <span class="string">'OPTIONS'</span>: &#123;</span><br><span class="line">     <span class="string">'context_processors'</span>: [</span><br><span class="line">     <span class="string">'django.template.context_processors.debug'</span>,</span><br><span class="line">     <span class="string">'django.template.context_processors.request'</span>,</span><br><span class="line">     <span class="string">'django.contrib.auth.context_processors.auth'</span>,</span><br><span class="line">     <span class="string">'django.contrib.messages.context_processors.messages'</span>,</span><br><span class="line"> 	],</span><br><span class="line"> <span class="string">'environment'</span>: <span class="string">'App.jinja2_env.environment'</span>, <span class="comment"># 配置环境,jinja的配置⽂件位置</span></span><br><span class="line"> &#125;,</span><br><span class="line"> &#125;,</span><br><span class="line">]</span><br></pre></td></tr></table></figure>
</li>
<li><p>两个同时使用</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#模板配置</span></span><br><span class="line">TEMPLATES = [&#123;</span><br><span class="line"> <span class="string">'BACKEND'</span>: <span class="string">'django.template.backends.jinja2.Jinja2'</span>,<span class="comment">#jinja2模版</span></span><br><span class="line"> <span class="string">'DIRS'</span>: [</span><br><span class="line"> 	os.path.join(BASE_DIR, <span class="string">'templates2'</span>),<span class="comment">#修改模版⽂件位置</span></span><br><span class="line"> ],</span><br><span class="line"> <span class="string">'APP_DIRS'</span>: <span class="literal">True</span>, </span><br><span class="line"> <span class="string">'OPTIONS'</span>: &#123;</span><br><span class="line">     <span class="string">'context_processors'</span>: [</span><br><span class="line">     <span class="string">'django.template.context_processors.debug'</span>,</span><br><span class="line">     <span class="string">'django.template.context_processors.request'</span>,</span><br><span class="line">     <span class="string">'django.contrib.auth.context_processors.auth'</span>, </span><br><span class="line">     <span class="string">'django.contrib.messages.context_processors.messages'</span>,</span><br><span class="line">     ],</span><br><span class="line"> <span class="string">'environment'</span>: <span class="string">'App.jinja2_env.environment'</span>, <span class="comment"># 配置环境,jinja的配置⽂件位置</span></span><br><span class="line"> &#125;,</span><br><span class="line"> &#125;,</span><br><span class="line"> &#123;</span><br><span class="line"> <span class="string">'BACKEND'</span>: <span class="string">'django.template.backends.django.DjangoTemplates'</span>,</span><br><span class="line"> <span class="string">'DIRS'</span>: [os.path.join(BASE_DIR, <span class="string">'templates'</span>)]</span><br><span class="line"> ,</span><br><span class="line"> <span class="string">'APP_DIRS'</span>: <span class="literal">True</span>,</span><br><span class="line"> <span class="string">'OPTIONS'</span>: &#123;</span><br><span class="line">     <span class="string">'context_processors'</span>: [</span><br><span class="line">     <span class="string">'django.template.context_processors.debug'</span>,</span><br><span class="line">     <span class="string">'django.template.context_processors.request'</span>,</span><br><span class="line">     <span class="string">'django.contrib.auth.context_processors.auth'</span>, </span><br><span class="line">     <span class="string">'django.contrib.messages.context_processors.messages'</span>,</span><br><span class="line">     ],</span><br><span class="line"> &#125;,</span><br><span class="line"> &#125;,</span><br><span class="line">]</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p>静态资源和url</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;p&gt;</span><br><span class="line"> &lt;a href&#x3D;&quot;&#123;&#123; url(&#39;app:index&#39;) &#125;&#125;&quot;&gt;dddd&lt;&#x2F;a&gt;</span><br><span class="line">&lt;&#x2F;p&gt;</span><br><span class="line">&lt;img src&#x3D;&quot;&#123;&#123; static(&#39;images&#x2F;1.jpg&#39;) &#125;&#125;&quot; alt&#x3D;&quot;&quot;&gt;</span><br></pre></td></tr></table></figure>

</li>
</ul>
<h1 id="Django-视图和路由-V"><a href="#Django-视图和路由-V" class="headerlink" title="Django 视图和路由(V)"></a>Django 视图和路由(V)</h1><p>Django中的视图主要用来接受Web请求，并做出响应。此响应可以是⽹⻚，重定向或404错误，XML⽂档或图像等的HTML内容。在mvt模式中，视图负责从模型中获取数据，然后展示在模板中，是联系模型和模板的桥梁，是业务逻辑层</p>
<p>视图响应的过程：</p>
<p>当用户从浏览器发起⼀次请求时，⾸先django获取用户的请求，然后通过路由（urls）将请求分配到指定的是视图函数。视图函数负责进⾏相应的业务处理，处理完毕后把结果（可能是json、html等）浏览器</p>
<h2 id="路由"><a href="#路由" class="headerlink" title="路由"></a>路由</h2><p>当用户在您的Web应用程序上发出⻚⾯请求时，Django会获取url中请求路径（端⼝之后的部分），然后通过urls.py⽂件查找与路径相匹配的视图，然后返回HTML响应或404未找到的错误（如果未找到）。在urls.py中，最重要的是 “urlpatterns”列表。这是您定义URL和视图之间映射的地⽅。映射是URL模式中的path对象，例如</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">from django.conf.urls import patterns, include</span><br><span class="line">from app import views</span><br><span class="line">urlpatterns &#x3D; [</span><br><span class="line"> path(&#39;hello&#x2F;&#39;, views.hello, name&#x3D;&#39;hello&#39;),</span><br><span class="line"> path(&#39;blog&#x2F;&#39;, include(&#39;blog.urls&#39;)),</span><br><span class="line">]</span><br></pre></td></tr></table></figure>

<p><strong>path对象有四个参数</strong></p>
<ul>
<li>模式串：匹配用户请求路径的字符串（和flflask⼀样）</li>
<li>视图函数：匹配上用户指定请求路径后调用的是视图函数名</li>
<li>kwargs：可选参数，需要额外传递的参数，是⼀个字典</li>
<li>名称（name）：给路由命名，在代码中可以使用name进⾏反向解析（由name获取用户请求路劲）</li>
</ul>
<blockquote>
<p>另外，如果path中模式串如果不能满⾜你路由规则，还可以使用re_path对象，re_path对象中模式串是正则表达式，其他三个参数和path对象⼀致</p>
</blockquote>
<h3 id="模式"><a href="#模式" class="headerlink" title="模式"></a>模式</h3><p>path中的模式串是⼀个普通字符串，用于匹配用户的请求路径。如果这种⽅式无法满⾜复杂路由请求的话，可以使用<code>re_path</code>完成路由映射，<code>re_path</code>中模式包含了⼀个上尖括号(^)和⼀个美元符号($)。这些都是正则符号，上尖括号表示从字符串开头匹配。美元符号表示匹配字符串的结尾，这两个符号和到⼀起就表示模式必须完全匹配路径，⽽不是包含⼀部分。⽐如对于模式：</p>
<p><code>r&#39;^hello/$&#39;</code>如果不包含美元符，也就是<code>r&#39;^hello/&#39;</code>，任何以/hello/的url都可以匹配，例如：/hello/world/、/hello/1/2/等，同样如果不以上尖括号开头，则任何以hello/做结尾的url都可以匹配。</p>
<blockquote>
<p>Django检查url模式之前会移除模式前的/，所以url模式前⾯的/可以不写，但如果在地址栏⾥请求的时候不带尾斜杠，则会引起重定向，重定向到带尾斜杠的地址， 所以请求的时候要带尾斜杠</p>
</blockquote>
<p>模式匹配的时候要注意：</p>
<ul>
<li>Django从上往下进行模式匹配，一旦匹配成功就不会往下继续匹配了</li>
<li>⼀个视图函数可以有多个模式匹配</li>
<li>模式前⾯不需要加/</li>
<li>如果匹配不上，则会引起异常，Django会调用错误处理视图处理（关闭调试模式）</li>
</ul>
<h3 id="URL配置"><a href="#URL配置" class="headerlink" title="URL配置"></a>URL配置</h3><p>在setting中指定根级url配置⽂件，对应的属性<code>ROOT_URLCONF</code></p>
<ol>
<li><p>urlpatterns：⼀个url实例的列表，全在根配置中搞定</p>
</li>
<li><p>导⼊其它url配置: 在应用中创建<code>urls.py</code>⽂件,编写匹配规则，在⼯程<code>urls.py</code>中进⾏导⼊包含</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">from django.urls import include</span><br><span class="line">urlpatterns &#x3D; [ path(&#39;xxx&#x2F;&#39;,include(&#39;App.urls&#39;)) ]</span><br></pre></td></tr></table></figure>

</li>
</ol>
<p>Django的请求处理流程：</p>
<ul>
<li><p>Django获取用户发出请求</p>
</li>
<li><p>Django在⼯程配置⽂件settings.py中通过ROOT URLCOF配置来确定根URLconf</p>
</li>
<li><p>Django在URLconf中的所有URL模式中，查找第⼀个配的条⽬。</p>
</li>
<li><p>如果找到匹配，将调用相应的视图函数，并将HttpReuest对象传⼊</p>
</li>
<li><p>视图函数回⼀个HttpResponse响应</p>
</li>
</ul>
<p><img src="http://cdn.panyucable.cn/zysheep/QQ%E6%88%AA%E5%9B%BE20200819091718.png" alt=""></p>
<h3 id="动态url"><a href="#动态url" class="headerlink" title="动态url"></a>动态url</h3><p>前⾯写的url都是静态的，⽆法给视图函数传递数据，要想给视图函数传参数，url必须是动态，带有参数，但Django主张漂亮简介的url，所以不会使用查询字符串（/hello?name=tom），⽽是采用通配符：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">path(&quot;hello&#x2F;&lt;name&gt;&#x2F;&quot;,views.hello)</span><br><span class="line">path(&quot;show&#x2F;&lt;name&gt;&#x2F;&lt;int:age&gt;&quot;,views.show)</span><br><span class="line">re_path(r&#39;^hello&#x2F;(\w+)&#x2F;$&#39;,views.hello) </span><br><span class="line">#http:&#x2F;&#x2F;localhost:8000&#x2F;hello&#x2F;tom&#x2F;</span><br></pre></td></tr></table></figure>

<p>在path中使用&lt;参数名&gt;表示所传参数，视图函数中的参数名必须和&lt;&gt;中参数名⼀致。参数可以是以下类型:</p>
<ul>
<li>str：如果没有指定参数类型，默认是字符串类型。字符串参数可以匹配除/和空字符外的其他字符串</li>
<li>int：匹配0和正整数，视图函数的参数将得到⼀个整型值</li>
<li>slug：匹配由数字、字⺟、-和_组成的字符串参数</li>
<li>path：匹配任何⾮空字符串，包括/。</li>
</ul>
<p>在<code>re_path</code>中，（）部分是正则的组， django在进⾏url匹配时，就会⾃动把匹配成功的内容，作为参数传递给视图函数</p>
<ul>
<li><p>位置参数：url中的正则表达式组，和视图函数中的参数⼀⼀对应，函数中的参数名可以随意指定。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">#位置参数：hello&#x2F;name&#x2F;age</span><br><span class="line">re_path(r&#39;^hello&#x2F;(\w+)&#x2F;(\d&#123;1,2&#125;)&#x2F;$&#39;,views.hello)</span><br><span class="line">#视图函数</span><br><span class="line">def hello(req,value1,value2): #参数名字随意，但从左往右和url中分组对应</span><br><span class="line"> return HttpResponse(&quot;哈喽:&quot; + value1 + &quot; age&#x3D; &#123;&#125;&quot;.format(value2))</span><br></pre></td></tr></table></figure>
</li>
<li><p>关键字参数：对正则表达式分组进⾏命名</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">?P&lt;组名&gt;</span><br><span class="line">url(r&#39;^hello&#x2F;(?P&lt;name&gt;\w+)&#x2F;(?P&lt;age&gt;\d&#123;1,2&#125;)&#x2F;$&#39;,views.hello),</span><br><span class="line">#视图函数</span><br><span class="line">def hello(req,name,age): #参数名字必须是name和age，和url中命名⼀致，但顺序随意</span><br><span class="line"> return HttpResponse(&quot;哈喽:&quot; + name + &quot; age&#x3D; &#123;&#125;&quot;.format(age))</span><br></pre></td></tr></table></figure>

</li>
</ul>
<p><strong>匹配/分组算法：</strong></p>
<ul>
<li><p>在⼀个匹配模式中要么使用命名分组，要么使用⽆命名分组，不能同时使用</p>
</li>
<li><p>请求的URL被看做是⼀个普通的Python字符串， URLconf在其上查找并匹配。进⾏匹配时将不包括GET或POST请求⽅式的参数以及域名。换句话讲，对同⼀个URL的⽆论是POST请求、GET请求、或HEAD请求⽅法等等 —— 都将路由到相同的函数。</p>
</li>
<li><p>每个捕获的参数都作为⼀个普通的Python字符串传递给视图，⽆论正则表达 </p>
<p>式使用的是什么匹配⽅式</p>
</li>
<li><p>每个捕获的参数都作为⼀个普通的Python字符串传递给视图，⽆论正则表达式使用的是什么匹配⽅式</p>
</li>
</ul>
<h2 id="视图"><a href="#视图" class="headerlink" title="视图"></a>视图</h2><p>视图本质上是⼀个函数（类）。这个函数第⼀个参数的类型是<code>HttpReuest</code>；它返回⼀个 <code>HttpResponse</code>实例。为了使⼀个Python的函数成为⼀个Django可识别的视图，它必须 ⾜这两个条件。</p>
<p>作用：接收并处理请求，调用模型和模板，响应请求（返回<code>HttpResponse</code>或其⼦类）</p>
<ul>
<li>响应模板</li>
<li>重定向</li>
<li>直接响应字符串</li>
<li>响应错误模板</li>
<li>json数据</li>
</ul>
<h3 id="HttpRequest"><a href="#HttpRequest" class="headerlink" title="HttpRequest"></a>HttpRequest</h3><p><code>HttpRequest</code>是从web服务器传递过来的请求对象，经过Django框架封装产⽣的，封装了原始的Http请求</p>
<ul>
<li>服务器接收到http请求后，django框架会⾃动根据服务器传递的环境变量创建HttpRequest对象</li>
<li>视图的第⼀个参数必须是HttpRequest类型的对象</li>
<li>在django.http模块中定义了HttpRequest对象的API</li>
<li>使用HttpRequest对象的不同属性值，可以获取请求中多种信息</li>
</ul>
<table>
<thead>
<tr>
<th align="center">属性</th>
<th align="center">说明</th>
</tr>
</thead>
<tbody><tr>
<td align="center">content-type</td>
<td align="center">请求的mime类型</td>
</tr>
<tr>
<td align="center">GET</td>
<td align="center">⼀个类似于字典的QueryDict对象，包含get请求⽅式的所有参 数，也就是“?”后⾯的内容</td>
</tr>
<tr>
<td align="center">POST</td>
<td align="center">⼀个类似于字典的QueryDict对象，包含post请求⽅式的所有参 数</td>
</tr>
<tr>
<td align="center">COOKIES</td>
<td align="center">⼀个标准的Python字典，包含所有的cookie，键和值都为字符串</td>
</tr>
<tr>
<td align="center">SESSION</td>
<td align="center">⼀个类似于字典的对象，表示当前的会话，只有当Django启⽤会 话的⽀持时才可⽤</td>
</tr>
<tr>
<td align="center">PATH</td>
<td align="center">⼀个字符串，表示请求的⻚⾯的完整路径，不包含域名</td>
</tr>
<tr>
<td align="center">method</td>
<td align="center">⼀个字符串，表示请求使⽤的HTTP⽅法，常⽤值包括：GET、 POST，</td>
</tr>
<tr>
<td align="center">FILES</td>
<td align="center">⼀个类似于字典的QueryDict对象，包含所有的上传⽂件</td>
</tr>
<tr>
<td align="center">META</td>
<td align="center">请求的请求头的源信息（请求头中的键值对）</td>
</tr>
<tr>
<td align="center">encoding</td>
<td align="center">字符编码</td>
</tr>
<tr>
<td align="center">scheme</td>
<td align="center">协议</td>
</tr>
</tbody></table>
<p> META中常用的键:</p>
<table>
<thead>
<tr>
<th align="center">键</th>
<th align="center">说明</th>
</tr>
</thead>
<tbody><tr>
<td align="center">HTTP_REFERER</td>
<td align="center">来源⻚⾯</td>
</tr>
<tr>
<td align="center">REMOTE_ADDR</td>
<td align="center">客户端ip</td>
</tr>
<tr>
<td align="center">REMOTE_HOST</td>
<td align="center">客户端主机</td>
</tr>
</tbody></table>
<p> 下⾯是常用的⽅法</p>
<table>
<thead>
<tr>
<th align="center">方法名</th>
<th align="center">说明</th>
</tr>
</thead>
<tbody><tr>
<td align="center">get_host()</td>
<td align="center">获取主机名+端⼝</td>
</tr>
<tr>
<td align="center">get_full_path()</td>
<td align="center">获取请求路径+查询字符串</td>
</tr>
<tr>
<td align="center">is_ajax()</td>
<td align="center">如果是ajax请求返回True</td>
</tr>
<tr>
<td align="center">build_absolute_uri()</td>
<td align="center">完整的url</td>
</tr>
</tbody></table>
<h4 id="QueryDict"><a href="#QueryDict" class="headerlink" title="QueryDict"></a>QueryDict</h4><p><code>QueryDict</code>是Dict的⼦类，和Dict最⼤的不同是，值都是列表。用于存储从请求中传递过来的参数，例如对于表单中select、checkbox等多值参数，QueryDict⾮常合适。get、post、fifiles请求都对应⼀个<code>QueryDict</code></p>
<ul>
<li>HttpRequest中QueryDict是不可变的，只能获取值,不能修改</li>
<li>QueryDict键值对都是字符串</li>
<li>QueryDict中⼀个键可以对应多个值</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">#QueryDict</span><br><span class="line">&#123;&#39;hobby&#39;:[&#39;打篮球&#39;,&#39;玩游戏&#39;,&#39;k歌&#39;],&#39;name&#39;:[&#39;tom&#39;],&#39;age&#39;:&#39;21&#39;&#125;</span><br></pre></td></tr></table></figure>

<p>常用操作</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"># 1.判断get或post请求中包含指定键</span><br><span class="line">if &#39;name&#39; in req.GET</span><br><span class="line"> # to do</span><br><span class="line"> </span><br><span class="line"># 2.获取get或post请求中指定键对应的单⼀值</span><br><span class="line"> print(req.GET.get(&#39;name&#39;,&#39;⽆名&#39;))</span><br><span class="line"> print(req.GET[&#39;name&#39;])</span><br><span class="line"> #两种⽅式的区别，如果用下标，键不存在，则包keyerror，get⽅法则会得到默认</span><br><span class="line">值，如果没有默认值则返回None</span><br><span class="line"> </span><br><span class="line">#3 获取指定键对应的多个值(列表)</span><br><span class="line"> print(req.GET.getlist(&#39;name&#39;))</span><br><span class="line">#4 获取所有键值对</span><br><span class="line"> for x in req.GET.lists():</span><br><span class="line"> print(x)</span><br></pre></td></tr></table></figure>

<h3 id="HttpResponse"><a href="#HttpResponse" class="headerlink" title="HttpResponse"></a>HttpResponse</h3><p>每⼀个视图函数必须返回⼀个响应对象，HttResponse对象由程序员创建并返回。</p>
<table>
<thead>
<tr>
<th align="center">属性</th>
<th align="center">说明</th>
</tr>
</thead>
<tbody><tr>
<td align="center">content</td>
<td align="center">字节字符串</td>
</tr>
<tr>
<td align="center">charset</td>
<td align="center">字符编码</td>
</tr>
<tr>
<td align="center">status_code</td>
<td align="center">http状态码</td>
</tr>
<tr>
<td align="center">content_type</td>
<td align="center">指定输出的MIME类型</td>
</tr>
</tbody></table>
<h4 id="不调用模板，直接返回内容"><a href="#不调用模板，直接返回内容" class="headerlink" title="不调用模板，直接返回内容"></a>不调用模板，直接返回内容</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">def hello(req):</span><br><span class="line"> return HttpResponse(&quot;hello world&quot;)</span><br><span class="line">def goodbye(req):</span><br><span class="line"> res &#x3D; HttpResponse()</span><br><span class="line"> res.content &#x3D; b&#39;good bye&#39;</span><br><span class="line"> res.charset &#x3D; &quot;utf-8&quot;</span><br><span class="line"> res.content_type &#x3D; &#39;text&#x2F;html&#39;</span><br><span class="line"> return res</span><br></pre></td></tr></table></figure>

<h4 id="调用模板返回"><a href="#调用模板返回" class="headerlink" title="调用模板返回"></a>调用模板返回</h4><p>⼀般用<code>render</code>函数返回，<code>render</code>只是HttpResponse的包装，还是会返回⼀个HttpResponse对象</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">def render_to_response(template_name, context&#x3D;None, content_type&#x3D;None,status&#x3D;None, using&#x3D;None):</span><br></pre></td></tr></table></figure>

<ul>
<li>template_name ： 模板名称。</li>
<li>context： ⼀组字典的值添加到模板中。默认情况下，这是⼀个空的字典。</li>
<li>content_type ：MIME类型用于⽣成⽂档</li>
<li>status ：为响应状态代码。默认值为200</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">def studentlist(req):</span><br><span class="line"> for key in req.GET.lists():</span><br><span class="line"> print(key)</span><br><span class="line"> allstudent &#x3D; Student.objects.all()</span><br><span class="line"> return render(req,&#39;studentlist.html&#39;,context&#x3D;&#123;&#39;data&#39;:allstudent&#125;)</span><br></pre></td></tr></table></figure>

<p>常用⽅法：</p>
<ul>
<li>write(content) 设置内容 == obj.content</li>
<li>set_cookie() 设置cookie</li>
<li>delete_cookie() 删除cookie</li>
</ul>
<h3 id="JsonResponse"><a href="#JsonResponse" class="headerlink" title="JsonResponse"></a>JsonResponse</h3><p><code>JsonResponse</code> 是HttpResponse的⼦类，用于向客户端返回<code>json</code>数据。⼀般用于ajax请求。它的<code>content-type</code>缺省值(默认值)为：<code>application/json</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">from django.http import JsonResponse #导包</span><br><span class="line">class JsonResponse(data, encoder&#x3D;DjangoJSONEncoder, safe&#x3D;True,json_dumps_params&#x3D;None, **kwargs)</span><br></pre></td></tr></table></figure>

<p>参数：</p>
<ul>
<li>data：可以是字典(或者内置对象)，如果safe设置为False，也可以是json序列化对象</li>
<li>encoder：编码格式，缺省是django.core.serializers.json.DjangoJSONEncoder</li>
<li>safe：默认是True，如果传递非字典给data，则报TypeError</li>
</ul>
<h4 id="系统模块⾃带的json和JsonResponse"><a href="#系统模块⾃带的json和JsonResponse" class="headerlink" title="系统模块⾃带的json和JsonResponse"></a>系统模块⾃带的json和JsonResponse</h4> <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">from django.http import JsonResponse</span><br><span class="line">import json as myJson</span><br><span class="line">#返回json数据</span><br><span class="line">def json(req):</span><br><span class="line"> jsonStr &#x3D; JsonResponse(&#123;&#39;name&#39;:&#39;zhangsan&#39;,&#39;age&#39;:18&#125;)</span><br><span class="line"> jsonStr &#x3D; myJson.dumps(&#123;&#39;name&#39;:&#39;zhangsan&#39;,&#39;age&#39;:18&#125;)</span><br><span class="line"> return HttpResponse(jsonStr)</span><br></pre></td></tr></table></figure>

<p><code>json.dumps</code>给ajax返回数据以后 js代码中需要将json数据使用<code>Json.parse()</code>进⾏解析成<code>js对象</code> ⽽JsonResponse会⾃动转换为js对象（少了异步Json.parse()的转换）</p>
<h4 id="QuerySet转Json"><a href="#QuerySet转Json" class="headerlink" title="QuerySet转Json"></a>QuerySet转Json</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">def courselist(req):</span><br><span class="line"> courses &#x3D; Course.objects.all() #QuerySet</span><br><span class="line"> data &#x3D; &#123;&#39;course&#39;:list(courses.values())&#125; #查询结果集QuerySet转字典</span><br><span class="line"> return JsonResponse(data) #传字典给JsonResponse</span><br><span class="line"> </span><br><span class="line"># 返回数据格式</span><br><span class="line">&#123;&#39;course&#39;: [&#123;&#39;cname&#39;: &#39;计算机组成原理&#39;, &#39;cid&#39;: 1&#125;, &#123;&#39;cname&#39;: &#39;英语&#39;,&#39;cid&#39;: 2&#125;, &#123;&#39;cname&#39;: &#39;数学&#39;, &#39;cidame&#39;: &#39;c语⾔程序设计&#39;, &#39;cid&#39;: 4&#125;,&#123;&#39;cname&#39;: &#39;python从⼊⻔到精通&#39;, &#39;cid&#39;: 5&#125;]&#125;</span><br><span class="line"></span><br><span class="line">def courselist(req):</span><br><span class="line"> courses &#x3D; Course.objects.all()</span><br><span class="line"> data &#x3D; json.dumps(list(courses.values())) #查询结果集QuerySet转Json字符串，序列化</span><br><span class="line"> return JsonResponse(data,safe&#x3D;False) #safe必须设置为False</span><br><span class="line"></span><br><span class="line"># 返回的数据格式</span><br><span class="line">[&#123;&quot;cname&quot;: &quot;\u8ba1\u7b97\u673a\u7ec4\u6210\u539f\u7406&quot;, &quot;cid&quot;: 1&#125;,&#123;&quot;cname&quot;: &quot;\u82f1\u8bed&quot;, &quot;cid&quot;: 2&#125;, &#123;&quot;cname&quot;: &quot;\u6570\u5b66&quot;, &quot;cid&quot;:3&#125;,&#123;&quot;cname&quot;:&quot;c\u8bed\u8a00\u7a0b\u5e8f\u8bbe\u8ba1&quot;, &quot;cid&quot;: 4&#125;,&#123;&quot;cname&quot;: &quot;python\u4ece\u5165\u95e8\u5230\u7cbe\u901a&quot;, &quot;cid&quot;: 5&#125;]</span><br></pre></td></tr></table></figure>

<h4 id="模型转Json"><a href="#模型转Json" class="headerlink" title="模型转Json"></a>模型转Json</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">class Course(models.Model):</span><br><span class="line"> cname &#x3D; models.CharField(max_length&#x3D;50)</span><br><span class="line"> cid &#x3D; models.AutoField(primary_key&#x3D;True)</span><br><span class="line"> # 给模型添加to_dict⽅法</span><br><span class="line"> def to_dict(self):</span><br><span class="line"> 	return dict([(key, self.__dict__[key]) for key in self.__dict__.keys() if key !&#x3D;&quot;_state&quot;])</span><br><span class="line"></span><br><span class="line"># 视图函数</span><br><span class="line">def courseshow(req):</span><br><span class="line"> course &#x3D; Course.objects.get(pk&#x3D;1) # 返回的是对象，不是QuerySet</span><br><span class="line"> return JsonResponse(course.to_dict())</span><br></pre></td></tr></table></figure>

<h3 id="重定向"><a href="#重定向" class="headerlink" title="重定向"></a>重定向</h3><p>当浏览器向server发送⼀个请求，要求获取⼀个资源时，在server接收到这个请求后发现请求的这个资源实际存放在另⼀个位置，于是server在返回的response中写⼊那个请求资源的正确的URL，并设置reponse的状态码为301（表示这是⼀个要求浏览器重定向的response)，当client接受到这个response后就会根据新的URL重新发起请求。重定向有⼀个典型的特症，即：当⼀个请求被重定向以后，最终浏览器上显示的URL往往不再是开始时请求的那个URL了。这就是重定向的由来。</p>
<p>HttpResponseRedirect是HttpResponse的⼦类，可以完成⻚⾯的重定向，当执⾏完特定动作或出现错误时，我们会希望执⾏的⻚⾯，如果判定用户没有登录则转到登录⻚⾯。重定向可以使用</p>
<ul>
<li>HttpResponseRedirect</li>
<li>redirect（是HttpResponseRedirect的简写）</li>
</ul>
<p>HttpResponseRedirect只⽀持硬编码url，不能直接使用命名url，在使用URL命名时，我们需要先通过URL反向解析⽅法reverse先对命名URL进⾏解析，然后再使用HttpReponseRedirect定向。</p>
<h4 id="不带参数重定向"><a href="#不带参数重定向" class="headerlink" title="不带参数重定向"></a>不带参数重定向</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">#urls.py</span><br><span class="line">urlpatterns &#x3D; [</span><br><span class="line">     path(&#39;&#39;,views.index),</span><br><span class="line">     re_path(r&#39;^list&#x2F;$&#39;,views.list_user),</span><br><span class="line">     #redirect 重定向路由地址</span><br><span class="line">     url(r&#39;^redirect&#x2F;$&#39;,views.Redirect)</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line">#views.py</span><br><span class="line">def index(req):</span><br><span class="line">     return render(req,&#39;index.html&#39;)</span><br><span class="line">def list_user():</span><br><span class="line">     return HttpResponse(&quot;list user&quot;)</span><br><span class="line">def Redirect(req):</span><br><span class="line">     # return redirect(&#39;http:&#x2F;&#x2F;localhost:9000&#x2F;&#39;)</span><br><span class="line">     # return redirect(&#39;&#x2F;&#39;)</span><br><span class="line">     return redirect(&quot;list&#x2F;&quot;)</span><br></pre></td></tr></table></figure>

<h4 id="带参数重定向"><a href="#带参数重定向" class="headerlink" title="带参数重定向"></a>带参数重定向</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">#urls.py</span><br><span class="line">path(&#39;repath&#x2F;&lt;int:num&gt;&#x2F;&#39;, views.repath),</span><br><span class="line">re_path(r&#39;^parameter&#x2F;(?P&lt;num1&gt;\d+)&#x2F;(?P&lt;num2&gt;\d+)&#x2F;$&#39;,views.parameter),</span><br><span class="line"></span><br><span class="line">#views.py</span><br><span class="line">def repath(req,num):</span><br><span class="line">     return redirect(&quot;parameter&#x2F;3&#x2F;5&quot;)</span><br><span class="line">def index(request):</span><br><span class="line">     return HttpResponse(&quot;⾸⻚&quot;)</span><br><span class="line">def parameter(req,num1, num2):</span><br><span class="line">     return HttpResponse(&quot;num1&#x3D;&#123;&#125;,num2&#x3D;&#123;&#125;&quot;.format(num1,num2)</span><br></pre></td></tr></table></figure>

<h4 id="反向解析"><a href="#反向解析" class="headerlink" title="反向解析"></a>反向解析</h4><p>根据namespace 和 name 查找真实路径：</p>
<ul>
<li>namespace 在根url 包含⼦url时指定</li>
<li>name 在具体的函数后 指定,子url指定</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"># urls.py中</span><br><span class="line">app_name &#x3D; &#39;App&#39; # namespace 命名空间</span><br><span class="line">urlpatterns &#x3D; [</span><br><span class="line">     path(&#39;&#39;, views.index),</span><br><span class="line">     path(&#39;para&#x2F;&lt;int:num1&gt;&#x2F;&lt;int:num2&gt;&#x2F;&#39;),</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#python代码中写法</span><br><span class="line">def repath(req):</span><br><span class="line"> #res &#x3D; reverse(&quot;App:index&quot;)</span><br><span class="line"> # print(res,type(res))</span><br><span class="line"> #return redirect(res)</span><br><span class="line"> # path中参数或re_path中的位置参数，args可以是列表或元组</span><br><span class="line"> # return redirect(reverse(&quot;App:para&quot;,args&#x3D;(1,2)))</span><br><span class="line"> # re_path中命名组，带关键字参数</span><br><span class="line"> return redirect(reverse(&quot;App:para&quot;,kwargs&#x3D;&#123;&#39;num1&#39;:1,&#39;num2&#39;:3&#125;))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 模板中的写法：</span><br><span class="line">&lt;h2&gt;&lt;a href&#x3D;&quot;&#x2F;form&#x2F;&quot;&gt;展示表单&lt;&#x2F;a&gt;&lt;&#x2F;h2&gt;</span><br><span class="line">&lt;h2&gt;&lt;a href&#x3D;&quot;&#x2F;index&#x2F;&quot;&gt;死链接⽆参的跳转&lt;&#x2F;a&gt;&lt;&#x2F;h2&gt;</span><br><span class="line">&lt;h2&gt;&lt;a href&#x3D;&quot;&#x2F;args&#x2F;1&#x2F;2&#x2F;&quot;&gt;死链接带参的跳转&lt;&#x2F;a&gt;&lt;&#x2F;h2&gt;</span><br><span class="line">&lt;h2&gt;&lt;a href&#x3D;&quot;&#123;% url &#39;App:index&#39; %&#125;&quot;&gt;动态⽣成路由地址不带参的跳转&lt;&#x2F;a&gt;&lt;&#x2F;h2&gt;</span><br><span class="line">&lt;h2&gt;&lt;a href&#x3D;&quot;&#123;% url &#39;App:args1&#39; 1 2 %&#125;&quot;&gt;动态⽣成路由地址带参的跳转&lt;&#x2F;a&gt;&lt;&#x2F;h2&gt;</span><br><span class="line">&lt;h2&gt;&lt;a href&#x3D;&quot;&#123;% url &#39;App:args1&#39; num1&#x3D;1 num2&#x3D;2 %&#125;&quot;&gt;re_path中命名组，动态⽣成路由地址带关键字参数的跳转&lt;&#x2F;a&gt;&lt;&#x2F;h2&gt;</span><br></pre></td></tr></table></figure>

<h3 id="错误视图"><a href="#错误视图" class="headerlink" title="错误视图"></a>错误视图</h3><p>Django内置了处理HTTP错误的视图（在django.views.defaults包下），主要错误及视图包括：</p>
<ul>
<li>403错误：permission_denied （权限拒绝）</li>
<li>404错误：page_not_found （找不到指定⽂件)</li>
<li>500错误：server_error （服务器内部错误)</li>
</ul>
<h4 id="404错误及视图"><a href="#404错误及视图" class="headerlink" title="404错误及视图"></a>404错误及视图</h4><p>url匹配失败后，django会调用内置的 django.views.defaults.page_not_found()函数，该视图函数会调用 404.html的模板进⾏显示。开发阶段可以开启调试模式，但产品上线后，要关闭调试模式。关闭调试模式后，会显示⼀个标准的错误⻚⾯。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"># 在项⽬的settings配置⽂件中设置</span><br><span class="line"># 关闭调试模式(开发模式)</span><br><span class="line">DEBUG &#x3D; False</span><br></pre></td></tr></table></figure>

<p>404错误界⾯可以⾃定义： 在项⽬templates⽬录⾯创建404.html，django找不到界⾯时，就会显示该界⾯了。缺省会传递参数request_path，就是出错的url</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html lang&#x3D;&quot;en&quot;&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line"> &lt;meta charset&#x3D;&quot;UTF-8&quot;&gt;</span><br><span class="line"> &lt;title&gt;404 Not Found&lt;&#x2F;title&gt;</span><br><span class="line">&lt;&#x2F;head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;h2&gt;对不起 您所访问的地址被外星⼈抓⾛了....&lt;&#x2F;h2&gt;</span><br><span class="line">&lt;h4&gt;请求的地址为 &#123;&#123; request_path &#125;&#125;&lt;&#x2F;h4&gt;</span><br><span class="line">&lt;&#x2F;body&gt;</span><br><span class="line">&lt;&#x2F;html&gt;</span><br></pre></td></tr></table></figure>

<h4 id="500错误及视图"><a href="#500错误及视图" class="headerlink" title="500错误及视图"></a>500错误及视图</h4><p>若是在执⾏视图函数时出现运⾏时错误，Django会默认会调用django.views.defaults.server_error 视图，加载并显示 500.html 模板，可以在项⽬的templates⽬录下，创建500.html来⾃定义该界面</p>
</div><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="mailto:undefined">三月三</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="https://zysheep.cn/2020/04/07/Python/%E5%AD%A6%E4%B9%A0Django/">https://zysheep.cn/2020/04/07/Python/学习Django/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://zysheep.cn" target="_blank">三月三</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/Python/">Python</a><a class="post-meta__tags" href="/tags/Django/">Django</a></div><div class="post_share"><div class="social-share" data-image="http://cdn.panyucable.cn/zysheep/wallhaven-n673pw.png" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css"/><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js"></script></div></div><div class="post-reward"><a class="reward-button button--primary button--animated"> <i class="fa fa-qrcode"></i> 打赏<div class="reward-main"><ul class="reward-all"><li class="reward-item"><img class="post-qr-code__img" src="https://cdn.jsdelivr.net/gh/zysheep/picgo-imgs/imgwechat.png" alt="微信"/><div class="post-qr-code__desc">微信</div></li><li class="reward-item"><img class="post-qr-code__img" src="https://cdn.jsdelivr.net/gh/zysheep/picgo-imgs/imgalipay.jpg" alt="支付寶"/><div class="post-qr-code__desc">支付寶</div></li></ul></div></a></div><nav class="pagination_post" id="pagination"><div class="prev-post pull_left"><a href="/2020/06/01/%E5%85%B3%E4%BA%8E%E6%88%91/"><img class="prev_cover" src="http://cdn.panyucable.cn/zysheep/wallhaven-n673pw.png" onerror="onerror=null;src='/img/404.jpg'"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">About me</div></div></a></div><div class="next-post pull_right"><a href="/2020/04/07/Python/Centos7%E5%AE%89%E8%A3%85Python%E7%8E%AF%E5%A2%83/"><img class="next_cover" src="http://cdn.panyucable.cn/zysheep/QQ截图20200818165742.png" onerror="onerror=null;src='/img/404.jpg'"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">Centos7安装Python环境</div></div></a></div></nav><div class="relatedPosts"><div class="relatedPosts_headline"><i class="fa fa-fw fa-thumbs-up" aria-hidden="true"></i><span> 相关推荐</span></div><div class="relatedPosts_list"><div class="relatedPosts_item"><a href="/2020/04/07/Python/Centos7安装Python环境/" title="Centos7安装Python环境"><img class="relatedPosts_cover" src="http://cdn.panyucable.cn/zysheep/QQ截图20200818165742.png"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="fa fa-calendar fa-fw" aria-hidden="true"></i> 2020-04-07</div><div class="relatedPosts_title">Centos7安装Python环境</div></div></a></div><div class="relatedPosts_item"><a href="/2020/04/06/Python/学习Flask/" title="Flask学习"><img class="relatedPosts_cover" src="http://cdn.panyucable.cn/zysheep/flask_cover1.jpg"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="fa fa-calendar fa-fw" aria-hidden="true"></i> 2020-04-06</div><div class="relatedPosts_title">Flask学习</div></div></a></div><div class="relatedPosts_item"><a href="/2020/04/04/Python/虚拟环境管理/" title="虚拟环境管理"><img class="relatedPosts_cover" src="http://cdn.panyucable.cn/zysheep/QQ截图20200818165742.png"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="fa fa-calendar fa-fw" aria-hidden="true"></i> 2020-04-04</div><div class="relatedPosts_title">虚拟环境管理</div></div></a></div><div class="relatedPosts_item"><a href="/2020/04/04/Python/uWSGI,WSGI和uwsgi/" title="WSGI，uWSGI和uwsgi区别详解"><img class="relatedPosts_cover" src="http://cdn.panyucable.cn/zysheep/QQ截图20200818165742.png"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="fa fa-calendar fa-fw" aria-hidden="true"></i> 2020-04-04</div><div class="relatedPosts_title">WSGI，uWSGI和uwsgi区别详解</div></div></a></div><div class="relatedPosts_item"><a href="/2020/04/03/Python/Python几问/" title="Python3简介"><img class="relatedPosts_cover" src="http://cdn.panyucable.cn/zysheep/QQ截图20200818165742.png"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="fa fa-calendar fa-fw" aria-hidden="true"></i> 2020-04-03</div><div class="relatedPosts_title">Python3简介</div></div></a></div></div><div class="clear_both"></div></div><hr><div id="post-comment"><div class="comment_headling"><i class="fa fa-comments fa-fw" aria-hidden="true"></i><span> 评论</span></div><div id="gitalk-container"></div><script>var gitalk = new Gitalk({
  clientID: '502b8308721b081071a5',
  clientSecret: '35220d15c7f8aaf585d6822cf5d49fedf5b602d6',
  repo: 'blog-comment',
  owner: 'zysheep',
  admin: ['zysheep'],
  id: md5(decodeURI(location.pathname)),
  language: 'zh-CN',
  perPage: 10,
  distractionFreeMode: false,
  pagerDirection: 'last',
  createIssueManually: false,
  updateCountCallback: commentCount
})
gitalk.render('gitalk-container')

function commentCount(n){
  try {
    document.getElementsByClassName('gitalk-comment-count')[0].innerHTML= n
  } catch (e) {
    return false
  }
}</script></div></article></main><footer id="footer" style="background-image: url(http://cdn.panyucable.cn/zysheep/django_top.jpg)" data-type="photo"><div id="footer-wrap"><div class="copyright">&copy;2019 - 2020 By 三月三</div><div class="footer_custom_text">生活不只是眼前的苟且,还有诗和远方</div></div></footer></div><section class="rightside" id="rightside"><div id="rightside-config-hide"><i class="fa fa-book" id="readmode" title="阅读模式"></i><i class="fa fa-plus" id="font_plus" title="放大字体"></i><i class="fa fa-minus" id="font_minus" title="缩小字体"></i><a class="translate_chn_to_cht" id="translateLink" href="javascript:translatePage();" title="简繁转换" target="_self">繁</a><i class="darkmode fa fa-moon-o" id="darkmode" title="夜间模式"></i></div><div id="rightside-config-show"><div id="rightside_config" title="设置"><i class="fa fa-cog" aria-hidden="true"></i></div><a id="to_comment" href="#post-comment" title="直达评论"><i class="scroll_to_comment fa fa-comments">  </i></a><i class="fa fa-list-ul close" id="mobile-toc-button" title="目录" aria-hidden="true"></i><i class="fa fa-arrow-up" id="go-up" title="回到顶部" aria-hidden="true"></i></div></section><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.jsdelivr.net/npm/medium-zoom/dist/medium-zoom.min.js"></script><script src="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.js"></script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script src="/js/third-party/click_heart.js"></script><script src="https://cdn.jsdelivr.net/gh/sviptzk/HexoStaticFile@master/Hexo/js/hideCategory.min.js"></script><script>var endLoading = function () {
  document.body.style.overflow = 'auto';
  document.getElementById('loading-box').classList.add("loaded")
}
window.addEventListener('load',endLoading)</script></body></html>