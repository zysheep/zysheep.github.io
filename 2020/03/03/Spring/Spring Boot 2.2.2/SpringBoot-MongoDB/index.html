<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>SpringBoot整合MongDB | 三月三</title><meta name="description" content="MongoDB是什么 ? MongoDB 是由C++语言编写的，是一个基于分布式文件存储的开源数据库系统。 在高负载的情况下，添加更多的节点，可以保证服务器性能。 MongoDB 旨在为WEB应用提供可扩展的高性能数据存储解决方案。 MongoDB 将数据存储为一个文档，数据结构由键值(key&#x3D;&gt;value)对组成。MongoDB文档类似于 JSON 对象。字段值可以包含其他文档，数组及文档"><meta name="keywords" content="Spring,Spring Boot2.2.2"><meta name="author" content="三月三"><meta name="copyright" content="三月三"><meta name="format-detection" content="telephone=no"><link rel="shortcut icon" href="http://cdn.panyucable.cn/zysheep/ico.png"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="dns-prefetch" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="https://hm.baidu.com"/><link rel="dns-prefetch" href="https://hm.baidu.com"/><link rel="preconnect" href="https://fonts.googleapis.com" crossorigin="crossorigin"/><link rel="dns-prefetch" href="https://fonts.googleapis.com"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="dns-prefetch" href="//busuanzi.ibruce.info"/><meta name="twitter:card" content="summary"><meta name="twitter:title" content="SpringBoot整合MongDB"><meta name="twitter:description" content="MongoDB是什么 ? MongoDB 是由C++语言编写的，是一个基于分布式文件存储的开源数据库系统。 在高负载的情况下，添加更多的节点，可以保证服务器性能。 MongoDB 旨在为WEB应用提供可扩展的高性能数据存储解决方案。 MongoDB 将数据存储为一个文档，数据结构由键值(key&#x3D;&gt;value)对组成。MongoDB文档类似于 JSON 对象。字段值可以包含其他文档，数组及文档"><meta name="twitter:image" content="http://cdn.panyucable.cn/zysheep/springboot_cover_mongodb.png"><meta property="og:type" content="article"><meta property="og:title" content="SpringBoot整合MongDB"><meta property="og:url" content="https://zysheep.cn/2020/03/03/Spring/Spring%20Boot%202.2.2/SpringBoot-MongoDB/"><meta property="og:site_name" content="三月三"><meta property="og:description" content="MongoDB是什么 ? MongoDB 是由C++语言编写的，是一个基于分布式文件存储的开源数据库系统。 在高负载的情况下，添加更多的节点，可以保证服务器性能。 MongoDB 旨在为WEB应用提供可扩展的高性能数据存储解决方案。 MongoDB 将数据存储为一个文档，数据结构由键值(key&#x3D;&gt;value)对组成。MongoDB文档类似于 JSON 对象。字段值可以包含其他文档，数组及文档"><meta property="og:image" content="http://cdn.panyucable.cn/zysheep/springboot_cover_mongodb.png"><meta property="article:published_time" content="2020-03-03T02:30:45.000Z"><meta property="article:modified_time" content="2020-06-29T09:53:30.481Z"><script src="https://cdn.jsdelivr.net/npm/js-cookie/dist/js.cookie.min.js"></script><script>var autoChangeMode = '1'
var t = Cookies.get("theme")
if (autoChangeMode == '1'){
  var isDarkMode = window.matchMedia("(prefers-color-scheme: dark)").matches
  var isLightMode = window.matchMedia("(prefers-color-scheme: light)").matches
  var isNotSpecified = window.matchMedia("(prefers-color-scheme: no-preference)").matches
  var hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified

  if (t === undefined){
    if (isLightMode) activateLightMode()
    else if (isDarkMode) activateDarkMode()
    else if (isNotSpecified || hasNoSupport){
      console.log('You specified no preference for a color scheme or your browser does not support it. I Schedule dark mode during night time.')
      var now = new Date()
      var hour = now.getHours()
      var isNight = hour < 6 || hour >= 18
      isNight ? activateDarkMode() : activateLightMode()
  }
  } else if (t == 'light') activateLightMode()
  else activateDarkMode()

} else if (autoChangeMode == '2'){
  now = new Date();
  hour = now.getHours();
  isNight = hour < 6 || hour >= 18
  if(t === undefined) isNight? activateDarkMode() : activateLightMode()
  else if (t === 'light') activateLightMode()
  else activateDarkMode() 
} else {
  if ( t == 'dark' ) activateDarkMode()
  else if ( t == 'light') activateLightMode()
}

function activateDarkMode(){
  document.documentElement.setAttribute('data-theme', 'dark')
  if (document.querySelector('meta[name="theme-color"]') !== null){
    document.querySelector('meta[name="theme-color"]').setAttribute('content','#000')
  }
}
function activateLightMode(){
  document.documentElement.setAttribute('data-theme', 'light')
  if (document.querySelector('meta[name="theme-color"]') !== null){
  document.querySelector('meta[name="theme-color"]').setAttribute('content','#fff')
  }
}</script><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@latest/css/font-awesome.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.css"><link rel="canonical" href="https://zysheep.cn/2020/03/03/Spring/Spring%20Boot%202.2.2/SpringBoot-MongoDB/"><link rel="prev" title="SpringBoot整合JPA" href="https://zysheep.cn/2020/03/03/Spring/Spring%20Boot%202.2.2/SpringBoot-Jpa/"><link rel="next" title="SpringBoot整合Mybatis-XML版" href="https://zysheep.cn/2020/03/03/Spring/Spring%20Boot%202.2.2/SpringBoot-Mybatis-xml/"><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/gitalk/dist/gitalk.min.css"><script src="https://cdn.jsdelivr.net/npm/gitalk@latest/dist/gitalk.min.js"></script><script src="https://cdn.jsdelivr.net/npm/blueimp-md5/js/md5.min.js"></script><script>var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?7f671f0f6d996680d21d5c32a23a9313";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Titillium+Web"><script>var GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: {"defaultEncoding":2,"translateDelay":0,"cookieDomain":"https://zysheep.github.io/","msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"簡"},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  bookmark: {
    message_prev: '按',
    message_next: '键将本页加入书签'
  },
  runtime_unit: '天',
  runtime: true,
  copyright: undefined,
  ClickShowText: undefined,
  medium_zoom: true,
  fancybox: false,
  Snackbar: {"bookmark":{"message_prev":"按","message_next":"键将本页加入书签"},"chs_to_cht":"你已切换为繁体","cht_to_chs":"你已切换为简体","day_to_night":"你已切换为深色模式","night_to_day":"你已切换为浅色模式","bgLight":"#49b1f5","bgDark":"#2d3035","position":"bottom-left"},
  baiduPush: false,
  highlightCopy: true,
  highlightLang: true,
  highlightShrink: 'false',
  isFontAwesomeV5: false,
  isPhotoFigcaption: true,
  islazyload: false,
  isanchor: false
  
}</script><script>var GLOBAL_CONFIG_SITE = { 
  isPost: true,
  isHome: false,
  isSidebar: true  
  }</script><noscript><style>
#page-header {
  opacity: 1
}
.justified-gallery img{
  opacity: 1
}
</style></noscript><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/sviptzk/HexoStaticFile@master/Hexo/css/hideCategory.min.css"><meta name="generator" content="Hexo 4.2.1"></head><body><div id="loading-box"><div class="loading-left-bg"></div><div class="loading-right-bg"></div><div class="spinner-box"><div class="configure-border-1"><div class="configure-core"></div></div><div class="configure-border-2"><div class="configure-core"></div></div><div class="loading-word">加载中...</div></div></div><div id="mobile-sidebar"><div id="menu_mask"></div><div id="mobile-sidebar-menus"><div class="mobile_author_icon"><img class="avatar-img" src="http://cdn.panyucable.cn/zysheep/xiaoman.png" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="mobile_post_data"><div class="mobile_data_item is-center"><div class="mobile_data_link"><a href="/archives/"><div class="headline">文章</div><div class="length_num">210</div></a></div></div><div class="mobile_data_item is-center">      <div class="mobile_data_link"><a href="/tags/"><div class="headline">标签</div><div class="length_num">47</div></a></div></div><div class="mobile_data_item is-center">     <div class="mobile_data_link"><a href="/categories/"><div class="headline">分类</div><div class="length_num">69</div></a></div></div></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> 主页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fa fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fa fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page"><i class="fa-fw fa fa-bug" aria-hidden="true"></i><span> 编程路线</span><i class="fa fa-chevron-down menus-expand" aria-hidden="true"></i></a><ul class="menus_item_child"><li><a class="site-page" href="/java/"><i class="fa-fw fa fa-coffee"></i><span> Java</span></a></li><li><a class="site-page" href="/python/"><i class="fa-fw fa fa-binoculars"></i><span> Python</span></a></li></ul></div><div class="menus_item"><a class="site-page"><i class="fa-fw fa fa-folder-open" aria-hidden="true"></i><span> 面试宝典</span><i class="fa fa-chevron-down menus-expand" aria-hidden="true"></i></a><ul class="menus_item_child"><li><a class="site-page" href="/interview/"><i class="fa-fw fa fa-file-text-o"></i><span> Java面试题</span></a></li></ul></div><div class="menus_item"><a class="site-page"><i class="fa-fw fa fa-list" aria-hidden="true"></i><span> 我的生活</span><i class="fa fa-chevron-down menus-expand" aria-hidden="true"></i></a><ul class="menus_item_child"><li><a class="site-page" href="/gallery/"><i class="fa-fw fa fa-picture-o"></i><span> Gallery</span></a></li></ul></div></div></div></div><i class="fa fa-arrow-right on" id="toggle-sidebar" aria-hidden="true">     </i><div id="sidebar"><div class="sidebar-toc"><div class="sidebar-toc__title">目录</div><div class="sidebar-toc__progress"><span class="progress-notice">你已经读了</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc__progress-bar">     </div></div><div class="sidebar-toc__content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#MongoDB是什么"><span class="toc-number">1.</span> <span class="toc-text">MongoDB是什么 ?</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#主要特点"><span class="toc-number">1.1.</span> <span class="toc-text">主要特点</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#MongoDB管理-工具"><span class="toc-number">1.2.</span> <span class="toc-text">MongoDB管理 工具</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#MongoDB-基本概念"><span class="toc-number">2.</span> <span class="toc-text">MongoDB 基本概念</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#数据库"><span class="toc-number">2.1.</span> <span class="toc-text">数据库</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#文档-Document"><span class="toc-number">2.2.</span> <span class="toc-text">文档(Document)</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#集合"><span class="toc-number">2.3.</span> <span class="toc-text">集合</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#合法的集合名"><span class="toc-number">2.3.1.</span> <span class="toc-text">合法的集合名</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#capped-collections"><span class="toc-number">2.3.2.</span> <span class="toc-text">capped collections</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#元数据"><span class="toc-number">2.4.</span> <span class="toc-text">元数据</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#MongoDB-数据类型"><span class="toc-number">3.</span> <span class="toc-text">MongoDB 数据类型</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#ObjectId"><span class="toc-number">3.1.</span> <span class="toc-text">ObjectId</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#字符串"><span class="toc-number">3.2.</span> <span class="toc-text">字符串</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#时间戳"><span class="toc-number">3.3.</span> <span class="toc-text">时间戳</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#日期"><span class="toc-number">3.4.</span> <span class="toc-text">日期</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#MongoDB基本命令"><span class="toc-number">4.</span> <span class="toc-text">MongoDB基本命令</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#MongoDB-创建数据库"><span class="toc-number">4.1.</span> <span class="toc-text">MongoDB 创建数据库</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#语法"><span class="toc-number">4.1.1.</span> <span class="toc-text">语法</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#实例"><span class="toc-number">4.1.2.</span> <span class="toc-text">实例</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#MongoDB-删除数据库"><span class="toc-number">4.2.</span> <span class="toc-text">MongoDB 删除数据库</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#语法-1"><span class="toc-number">4.2.1.</span> <span class="toc-text">语法</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#实例-1"><span class="toc-number">4.2.2.</span> <span class="toc-text">实例</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#删除集合"><span class="toc-number">4.2.3.</span> <span class="toc-text">删除集合</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#MongoDB-创建集合"><span class="toc-number">4.3.</span> <span class="toc-text">MongoDB 创建集合</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#语法-2"><span class="toc-number">4.3.1.</span> <span class="toc-text">语法</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#实例-2"><span class="toc-number">4.3.2.</span> <span class="toc-text">实例</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#MongoDB-删除集合"><span class="toc-number">4.4.</span> <span class="toc-text">MongoDB 删除集合</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#语法-3"><span class="toc-number">4.4.1.</span> <span class="toc-text">语法</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#实例-3"><span class="toc-number">4.4.2.</span> <span class="toc-text">实例</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#MongoDB-插入文档"><span class="toc-number">4.5.</span> <span class="toc-text">MongoDB 插入文档</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#语法-4"><span class="toc-number">4.5.1.</span> <span class="toc-text">语法</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#实例-4"><span class="toc-number">4.5.2.</span> <span class="toc-text">实例</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#MongoDB-更新文档"><span class="toc-number">4.6.</span> <span class="toc-text">MongoDB 更新文档</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#update-方法"><span class="toc-number">4.6.1.</span> <span class="toc-text">update() 方法</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#语法-5"><span class="toc-number">4.6.1.1.</span> <span class="toc-text">语法</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#实例-5"><span class="toc-number">4.6.1.2.</span> <span class="toc-text">实例</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#save-方法"><span class="toc-number">4.6.2.</span> <span class="toc-text">save() 方法</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#语法-6"><span class="toc-number">4.6.2.1.</span> <span class="toc-text">语法</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#实例-6"><span class="toc-number">4.6.2.2.</span> <span class="toc-text">实例</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#MongoDB-删除文档"><span class="toc-number">4.7.</span> <span class="toc-text">MongoDB 删除文档</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#语法-7"><span class="toc-number">4.7.1.</span> <span class="toc-text">语法</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#实例-7"><span class="toc-number">4.7.2.</span> <span class="toc-text">实例</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#注意"><span class="toc-number">4.7.3.</span> <span class="toc-text">注意</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#MongoDB-查询文档"><span class="toc-number">4.8.</span> <span class="toc-text">MongoDB 查询文档</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#语法-8"><span class="toc-number">4.8.1.</span> <span class="toc-text">语法</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#MongoDB-与-RDBMS-Where-语句比较"><span class="toc-number">4.8.1.1.</span> <span class="toc-text">MongoDB 与 RDBMS Where 语句比较</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#MongoDB-AND-条件"><span class="toc-number">4.8.1.2.</span> <span class="toc-text">MongoDB AND 条件</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#MongoDB-OR-条件"><span class="toc-number">4.8.1.3.</span> <span class="toc-text">MongoDB OR 条件</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#实例-8"><span class="toc-number">4.8.1.3.1.</span> <span class="toc-text">实例</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#AND-和-OR-联合使用"><span class="toc-number">4.8.1.4.</span> <span class="toc-text">AND 和 OR 联合使用</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#docker-部署-mongodb"><span class="toc-number">5.</span> <span class="toc-text">docker 部署 mongodb</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#拉取镜像"><span class="toc-number">5.1.</span> <span class="toc-text">拉取镜像</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#docker-安装-mongodb"><span class="toc-number">5.2.</span> <span class="toc-text">docker 安装 mongodb</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#进入容器"><span class="toc-number">5.3.</span> <span class="toc-text">进入容器.</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#mongodb的使用"><span class="toc-number">5.4.</span> <span class="toc-text">mongodb的使用</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#用户的创建"><span class="toc-number">5.4.1.</span> <span class="toc-text">用户的创建</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#创建用户"><span class="toc-number">5.4.2.</span> <span class="toc-text">创建用户</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#数据库的建立"><span class="toc-number">5.4.3.</span> <span class="toc-text">数据库的建立</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#mongo-是否正常启动的校验"><span class="toc-number">5.5.</span> <span class="toc-text">mongo 是否正常启动的校验</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#远程连接的开启"><span class="toc-number">5.6.</span> <span class="toc-text">远程连接的开启</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#SpringBoot之mongoTemplate的使用"><span class="toc-number">6.</span> <span class="toc-text">SpringBoot之mongoTemplate的使用</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1、引入springboot-mongo依赖"><span class="toc-number">6.1.</span> <span class="toc-text">1、引入springboot mongo依赖</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2、mongo的IP和端口"><span class="toc-number">6.2.</span> <span class="toc-text">2、mongo的IP和端口</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3、使用mongoTemplate"><span class="toc-number">6.3.</span> <span class="toc-text">3、使用mongoTemplate</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#多数据源-MongoDB-的使用"><span class="toc-number">7.</span> <span class="toc-text">多数据源 MongoDB 的使用</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#pom"><span class="toc-number">7.1.</span> <span class="toc-text">pom</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#yml"><span class="toc-number">7.2.</span> <span class="toc-text">yml</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#MongoConfig"><span class="toc-number">7.3.</span> <span class="toc-text">MongoConfig</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Person"><span class="toc-number">7.4.</span> <span class="toc-text">Person</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#测试"><span class="toc-number">7.5.</span> <span class="toc-text">测试</span></a></li></ol></li></ol></div></div></div><div id="body-wrap"><div class="post-bg" id="nav" style="background-image: url(http://cdn.panyucable.cn/zysheep/springboot_top_mongodb.png)"><div id="page-header"><span class="pull_left" id="blog_name"><a class="blog_title" id="site-name" href="/">三月三</a></span><span class="pull_right menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> 主页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fa fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fa fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page"><i class="fa-fw fa fa-bug" aria-hidden="true"></i><span> 编程路线</span><i class="fa fa-chevron-down menus-expand" aria-hidden="true"></i></a><ul class="menus_item_child"><li><a class="site-page" href="/java/"><i class="fa-fw fa fa-coffee"></i><span> Java</span></a></li><li><a class="site-page" href="/python/"><i class="fa-fw fa fa-binoculars"></i><span> Python</span></a></li></ul></div><div class="menus_item"><a class="site-page"><i class="fa-fw fa fa-folder-open" aria-hidden="true"></i><span> 面试宝典</span><i class="fa fa-chevron-down menus-expand" aria-hidden="true"></i></a><ul class="menus_item_child"><li><a class="site-page" href="/interview/"><i class="fa-fw fa fa-file-text-o"></i><span> Java面试题</span></a></li></ul></div><div class="menus_item"><a class="site-page"><i class="fa-fw fa fa-list" aria-hidden="true"></i><span> 我的生活</span><i class="fa fa-chevron-down menus-expand" aria-hidden="true"></i></a><ul class="menus_item_child"><li><a class="site-page" href="/gallery/"><i class="fa-fw fa fa-picture-o"></i><span> Gallery</span></a></li></ul></div></div><span class="toggle-menu close"><a class="site-page"><i class="fa fa-bars fa-fw" aria-hidden="true"></i></a></span></span></div><div id="post-info"><div id="post-title"><div class="posttitle">SpringBoot整合MongDB</div></div><div id="post-meta"><div class="meta-firstline"><time class="post-meta__date"><span class="post-meta__date-created" title="发表于 2020-03-03 10:30:45"><i class="fa fa-calendar" aria-hidden="true"></i> 发表于 2020-03-03</span><span class="post-meta__separator">|</span><span class="post-meta__date-updated" title="更新于 2020-06-29 17:53:30"><i class="fa fa-history" aria-hidden="true"></i> 更新于 2020-06-29</span></time><span class="post-meta__categories"><span class="post-meta__separator">|</span><i class="fa fa-inbox post-meta__icon" aria-hidden="true"></i><a class="post-meta__categories" href="/categories/Spring%E5%85%A8%E5%AE%B6%E6%A1%B6/">Spring全家桶</a><i class="fa fa-angle-right post-meta__separator" aria-hidden="true"></i><i class="fa fa-inbox post-meta__icon" aria-hidden="true"></i><a class="post-meta__categories" href="/categories/Spring%E5%85%A8%E5%AE%B6%E6%A1%B6/Spring-Boot2-2-2/">Spring Boot2.2.2</a></span></div><div class="meta-secondline"> <span class="post-meta-wordcount"><i class="post-meta__icon fa fa-file-word-o" aria-hidden="true"></i><span>字数总计:</span><span class="word-count">11.3k</span><span class="post-meta__separator">|</span><i class="post-meta__icon fa fa-clock-o" aria-hidden="true"></i><span>阅读时长: 50 分钟</span></span></div><div class="meta-thirdline"><span class="post-meta-pv-cv"><span class="post-meta__separator">|</span><i class="fa fa-eye post-meta__icon" aria-hidden="true"> </i><span>阅读量:</span><span id="busuanzi_value_page_pv"></span></span><span class="post-meta-commentcount"><span class="post-meta__separator">|</span><i class="post-meta__icon fa fa-comment-o" aria-hidden="true"></i><span>评论数:</span><a href="/2020/03/03/Spring/Spring%20Boot%202.2.2/SpringBoot-MongoDB/#post-comment"><span class="gitalk-comment-count comment-count"></span></a></span></div></div></div></div><main class="layout_post" id="content-inner"><article id="post"><div class="post-content" id="article-container"><h1 id="MongoDB是什么"><a href="#MongoDB是什么" class="headerlink" title="MongoDB是什么 ?"></a>MongoDB是什么 ?</h1><ul>
<li>MongoDB 是由C++语言编写的，是一个基于分布式文件存储的开源数据库系统。</li>
<li>在高负载的情况下，添加更多的节点，可以保证服务器性能。</li>
<li>MongoDB 旨在为WEB应用提供可扩展的高性能数据存储解决方案。</li>
<li>MongoDB 将数据存储为一个文档，数据结构由键值(<code>key=&gt;value</code>)对组成。<code>MongoDB</code>文档类似于 JSON 对象。字段值可以包含其他文档，数组及文档数组。</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">      user: &quot;admin&quot;,    ---&gt;key&#x3D;&gt;value</span><br><span class="line">      pwd: &quot;123456&quot;,	---&gt;key&#x3D;&gt;value</span><br><span class="line">      roles: [ &#123; role: &quot;userAdminAnyDatabase&quot;, db: &quot;admin&quot; &#125; ]</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>

<h2 id="主要特点"><a href="#主要特点" class="headerlink" title="主要特点"></a>主要特点</h2><ul>
<li>MongoDB 是一个面向文档存储的数据库，操作起来比较简单和容易。</li>
<li>你可以在MongoDB记录中设置任何属性的索引 (如：FirstName=”Sameer”,Address=”8 Gandhi Road”)来实现更快的排序。</li>
<li>你可以通过本地或者网络创建数据镜像，这使得MongoDB有更强的扩展性。</li>
<li>如果负载的增加（需要更多的存储空间和更强的处理能力） ，它可以分布在计算机网络中的其他节点上这就是所谓的分片。</li>
<li>Mongo支持丰富的查询表达式。查询指令使用JSON形式的标记，可轻易查询文档中内嵌的对象及数组。</li>
<li>MongoDb 使用update()命令可以实现替换完成的文档（数据）或者一些指定的数据字段 。</li>
<li>Mongodb中的Map/reduce主要是用来对数据进行批量处理和聚合操作。</li>
<li>Map和Reduce。Map函数调用emit(key,value)遍历集合中所有的记录，将key与value传给Reduce函数进行处理。</li>
<li>Map函数和Reduce函数是使用Javascript编写的，并可以通过db.runCommand或mapreduce命令来执行MapReduce操作。</li>
<li>GridFS是MongoDB中的一个内置功能，可以用于存放大量小文件。</li>
<li>MongoDB允许在服务端执行脚本，可以用Javascript编写某个函数，直接在服务端执行，也可以把函数的定义存储在服务端，下次直接调用即可。</li>
<li>MongoDB支持各种编程语言:RUBY，PYTHON，JAVA，C++，PHP，C#等多种语言。</li>
<li>MongoDB安装简单。</li>
</ul>
<h2 id="MongoDB管理-工具"><a href="#MongoDB管理-工具" class="headerlink" title="MongoDB管理 工具"></a>MongoDB管理 工具</h2><ul>
<li>Fang of Mongo – 网页式,由Django和jQuery所构成。</li>
<li>Futon4Mongo – 一个CouchDB Futon web的mongodb山寨版。</li>
<li>Mongo3 – Ruby写成。</li>
<li>MongoHub – 适用于OSX的应用程序。</li>
<li>Opricot – 一个基于浏览器的MongoDB控制台, 由PHP撰写而成。</li>
<li>Database Master — Windows的mongodb管理工具</li>
<li>RockMongo — 最好的PHP语言的MongoDB管理工具，轻量级, 支持多国语言.</li>
</ul>
<h1 id="MongoDB-基本概念"><a href="#MongoDB-基本概念" class="headerlink" title="MongoDB 基本概念"></a>MongoDB 基本概念</h1><p>在mongodb中基本的概念是文档、集合、数据库</p>
<table>
<thead>
<tr>
<th align="center">SQL术语/概念</th>
<th align="center">MongoDB术语/概念</th>
<th align="center">解释/说明</th>
</tr>
</thead>
<tbody><tr>
<td align="center">database</td>
<td align="center">database</td>
<td align="center">数据库</td>
</tr>
<tr>
<td align="center">table</td>
<td align="center">collection</td>
<td align="center">数据库表/集合</td>
</tr>
<tr>
<td align="center">row</td>
<td align="center">document</td>
<td align="center">数据记录行/文档</td>
</tr>
<tr>
<td align="center">column</td>
<td align="center">field</td>
<td align="center">数据字段/域</td>
</tr>
<tr>
<td align="center">index</td>
<td align="center">index</td>
<td align="center">索引</td>
</tr>
<tr>
<td align="center">table joins</td>
<td align="center"></td>
<td align="center">表连接,MongoDB不支持</td>
</tr>
<tr>
<td align="center">primary key</td>
<td align="center">primary key</td>
<td align="center">主键,MongoDB自动将_id字段设置为主键</td>
</tr>
</tbody></table>
<p>通过下图实例，我们也可以更直观的了解Mongo中的一些概念：</p>
<p><img src="http://cdn.panyucable.cn/zysheep/Figure-1-Mapping-Table-to-Collection-1.png" alt=""></p>
<h2 id="数据库"><a href="#数据库" class="headerlink" title="数据库"></a>数据库</h2><p>一个mongodb中可以建立多个数据库。MongoDB的默认数据库为”db”，该数据库存储在data目录中。MongoDB的单个实例可以容纳多个独立的数据库，每一个都有自己的集合和权限，不同的数据库也放置在不同的文件中。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;</span><span class="bash"> show dbs   <span class="comment"># 命令可以显示所有数据的列表。</span></span></span><br><span class="line">admin   0.000GB</span><br><span class="line">config  0.000GB</span><br><span class="line">demo    0.000GB</span><br><span class="line">local   0.000GB</span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> db	  <span class="comment"># 显示当前数据库对象或集合。</span></span></span><br><span class="line">test</span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> use demo  <span class="comment"># 连接到一个指定的数据库。</span></span></span><br><span class="line">switched to db demo</span><br></pre></td></tr></table></figure>

<p>有一些数据库名是保留的，可以直接访问这些有特殊作用的数据库。</p>
<ul>
<li><strong>admin</strong>： 从权限的角度来看，这是”root”数据库。要是将一个用户添加到这个数据库，这个用户自动继承所有数据库的权限。一些特定的服务器端命令也只能从这个数据库运行，比如列出所有的数据库或者关闭服务器。</li>
<li><strong>local:</strong> 这个数据永远不会被复制，可以用来存储限于本地单台服务器的任意集合</li>
<li><strong>config</strong>: 当Mongo用于分片设置时，config数据库在内部使用，用于保存分片的相关信息。</li>
</ul>
<h2 id="文档-Document"><a href="#文档-Document" class="headerlink" title="文档(Document)"></a>文档(Document)</h2><p>文档是一组键值(<code>key-value</code>)对(即 <code>BSON</code>)。MongoDB 的文档不需要设置相同的字段，并且相同的字段不需要相同的数据类型，这与关系型数据库有很大的区别，也是 MongoDB 非常突出的特点。</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;<span class="attr">"site"</span>:<span class="string">"www.zysheep.cn"</span>, <span class="attr">"name"</span>:<span class="string">"三月三"</span>&#125;</span><br></pre></td></tr></table></figure>

<p>下表列出了 RDBMS 与 MongoDB 对应的术语：</p>
<table>
<thead>
<tr>
<th align="center">RDBMS</th>
<th align="center">MongoDB</th>
</tr>
</thead>
<tbody><tr>
<td align="center">数据库</td>
<td align="center">数据库</td>
</tr>
<tr>
<td align="center">表格</td>
<td align="center">集合</td>
</tr>
<tr>
<td align="center">行</td>
<td align="center">文档</td>
</tr>
<tr>
<td align="center">列</td>
<td align="center">字段</td>
</tr>
<tr>
<td align="center">表联合</td>
<td align="center">嵌入文档</td>
</tr>
<tr>
<td align="center">主键</td>
<td align="center">主键 (MongoDB 提供了 key 为 _id )</td>
</tr>
</tbody></table>
<p>需要注意的是：</p>
<ol>
<li>文档中的键/值对是有序的。</li>
<li>文档中的值不仅可以是在双引号里面的字符串，还可以是其他几种数据类型（甚至可以是整个嵌入的文档)。</li>
<li>MongoDB区分类型和大小写。</li>
<li>MongoDB的文档不能有重复的键。</li>
<li>文档的键是字符串。除了少数例外情况，键可以使用任意UTF-8字符。</li>
</ol>
<p>文档键命名规范：</p>
<ul>
<li>键不能含有\0 (空字符)。这个字符用来表示键的结尾。</li>
<li>.和$有特别的意义，只有在特定环境下才能使用。</li>
<li>以下划线”_”开头的键是保留的(不是严格要求的)。</li>
</ul>
<h2 id="集合"><a href="#集合" class="headerlink" title="集合"></a>集合</h2><p>集合就是 MongoDB 文档组，类似于 RDBMS （关系数据库管理系统：Relational Database Management System)中的表格。集合存在于数据库中，集合没有固定的结构，这意味着你在对集合可以插入不同格式和类型的数据，但通常情况下我们插入集合的数据都会有一定的关联性。</p>
<p>比如，我们可以将以下不同数据结构的文档插入到集合中：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;<span class="attr">"site"</span>:<span class="string">"www.baidu.com"</span>&#125;</span><br><span class="line">&#123;<span class="attr">"site"</span>:<span class="string">"www.zysheep.cn"</span>,<span class="attr">"name"</span>:<span class="string">"三月三"</span>&#125;</span><br><span class="line">&#123;<span class="attr">"site"</span>:<span class="string">"www.zysheep.cn"</span>,<span class="attr">"name"</span>:<span class="string">"三月三热爱生活"</span>,<span class="attr">"num"</span>:<span class="number">5</span>&#125;</span><br></pre></td></tr></table></figure>

<h3 id="合法的集合名"><a href="#合法的集合名" class="headerlink" title="合法的集合名"></a>合法的集合名</h3><ul>
<li>集合名不能是空字符串””。</li>
<li>集合名不能含有\0字符（空字符)，这个字符表示集合名的结尾。</li>
<li>集合名不能以”system.”开头，这是为系统集合保留的前缀。</li>
<li>用户创建的集合名字不能含有保留字符。有些驱动程序的确支持在集合名里面包含，这是因为某些系统生成的集合中包含该字符。除非你要访问这种系统创建的集合，否则千万不要在名字里出现$。　</li>
</ul>
<p>如下实例：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.col.findOne()</span><br></pre></td></tr></table></figure>

<h3 id="capped-collections"><a href="#capped-collections" class="headerlink" title="capped collections"></a>capped collections</h3><p>Capped collections 就是固定大小的collection。它有很高的性能以及队列过期的特性(过期按照插入的顺序). 有点和 “RRD” 概念类似。Capped collections 是高性能自动的维护对象的插入顺序。它非常适合类似记录日志的功能和标准的 collection 不同，你必须要显式的创建一个capped collection，指定一个 collection 的大小，单位是字节。collection 的数据存储空间值提前分配的。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.createCollection(&quot;mycoll&quot;, &#123;capped:true, size:100000&#125;)</span><br></pre></td></tr></table></figure>

<ul>
<li>在 capped collection 中，你能添加新的对象。</li>
<li>能进行更新，然而，对象不会增加存储空间。如果增加，更新就会失败 。</li>
<li>使用 Capped Collection 不能删除一个文档，可以使用 drop() 方法删除 collection 所有的行。</li>
<li>删除之后，你必须显式的重新创建这个 collection。</li>
<li>在32bit机器中，capped collection 最大存储为 1e9( 1X109)个字节。</li>
</ul>
<h2 id="元数据"><a href="#元数据" class="headerlink" title="元数据"></a>元数据</h2><p>数据库的信息是存储在集合中。它们使用了系统的命名空间：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dbname.system.*</span><br></pre></td></tr></table></figure>

<p>在MongoDB数据库中名字空间 <dbname>.system.* 是包含多种系统信息的特殊集合(Collection)，如下:\</p>
<table>
<thead>
<tr>
<th align="center">集合命名空间</th>
<th align="center">描述</th>
</tr>
</thead>
<tbody><tr>
<td align="center">dbname.system.namespaces</td>
<td align="center">列出所有名字空间。</td>
</tr>
<tr>
<td align="center">dbname.system.indexes</td>
<td align="center">列出所有索引。</td>
</tr>
<tr>
<td align="center">dbname.system.profile</td>
<td align="center">包含数据库概要(profile)信息。</td>
</tr>
<tr>
<td align="center">dbname.system.users</td>
<td align="center">列出所有可访问数据库的用户。</td>
</tr>
<tr>
<td align="center">dbname.local.sources</td>
<td align="center">包含复制对端（slave）的服务器信息和状态。</td>
</tr>
</tbody></table>
<h1 id="MongoDB-数据类型"><a href="#MongoDB-数据类型" class="headerlink" title="MongoDB 数据类型"></a>MongoDB 数据类型</h1><table>
<thead>
<tr>
<th align="center">数据类型</th>
<th align="center">描述</th>
</tr>
</thead>
<tbody><tr>
<td align="center">String</td>
<td align="center">字符串。存储数据常用的数据类型。在 MongoDB 中，UTF-8 编码的字符串才是合法的。</td>
</tr>
<tr>
<td align="center">Integer</td>
<td align="center">整型数值。用于存储数值。根据你所采用的服务器，可分为 32 位或 64 位。</td>
</tr>
<tr>
<td align="center">Boolean</td>
<td align="center">布尔值。用于存储布尔值（真/假）。</td>
</tr>
<tr>
<td align="center">Double</td>
<td align="center">双精度浮点值。用于存储浮点值。</td>
</tr>
<tr>
<td align="center">Min/Max keys</td>
<td align="center">将一个值与 BSON（二进制的 JSON）元素的最低值和最高值相对比。</td>
</tr>
<tr>
<td align="center">Array</td>
<td align="center">用于将数组或列表或多个值存储为一个键。</td>
</tr>
<tr>
<td align="center">Timestamp</td>
<td align="center">时间戳。记录文档修改或添加的具体时间。</td>
</tr>
<tr>
<td align="center">Object</td>
<td align="center">用于内嵌文档。</td>
</tr>
<tr>
<td align="center">Null</td>
<td align="center">用于创建空值。</td>
</tr>
<tr>
<td align="center">Symbol</td>
<td align="center">符号。该数据类型基本上等同于字符串类型，但不同的是，它一般用于采用特殊符号类型的语言。</td>
</tr>
<tr>
<td align="center">Date</td>
<td align="center">日期时间。用 UNIX 时间格式来存储当前日期或时间。你可以指定自己的日期时间：创建 Date 对象，传入年月日信息。</td>
</tr>
<tr>
<td align="center">Object ID</td>
<td align="center">对象 ID。用于创建文档的 ID。</td>
</tr>
<tr>
<td align="center">Binary Data</td>
<td align="center">二进制数据。用于存储二进制数据。</td>
</tr>
<tr>
<td align="center">Code</td>
<td align="center">代码类型。用于在文档中存储 JavaScript 代码。</td>
</tr>
<tr>
<td align="center">Regular expression</td>
<td align="center">正则表达式类型。用于存储正则表达式。</td>
</tr>
</tbody></table>
<h2 id="ObjectId"><a href="#ObjectId" class="headerlink" title="ObjectId"></a>ObjectId</h2><p>ObjectId 类似唯一主键，可以很快的去生成和排序，包含 12 bytes，含义是：</p>
<ul>
<li>前 4 个字节表示创建 <strong>unix</strong> 时间戳,格林尼治时间 <strong>UTC</strong> 时间，比北京时间晚了 8 个小时</li>
<li>接下来的 3 个字节是机器标识码</li>
<li>紧接的两个字节由进程 id 组成 PID</li>
<li>最后三个字节是随机数</li>
</ul>
<p><img src="http://cdn.panyucable.cn/zysheep/2875754375-5a19268f0fd9b_articlex.jpeg" alt=""></p>
<p>MongoDB 中存储的文档必须有一个 _id 键。这个键的值可以是任何类型的，默认是个 ObjectId 对象</p>
<p>由于 ObjectId 中保存了创建的时间戳，所以你不需要为你的文档保存时间戳字段，你可以通过 getTimestamp 函数来获取文档的创建时间:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&gt; var newObject &#x3D; ObjectId()</span><br><span class="line">&gt; newObject.getTimestamp()</span><br><span class="line">ISODate(&quot;2020-06-02T00:41:51Z&quot;)</span><br></pre></td></tr></table></figure>

<p>ObjectId 转为字符串</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&gt; newObject.str</span><br><span class="line">5ed5a04fb5ebb889810105cf</span><br></pre></td></tr></table></figure>

<h2 id="字符串"><a href="#字符串" class="headerlink" title="字符串"></a>字符串</h2><p><strong>BSON 字符串都是 UTF-8 编码。</strong></p>
<h2 id="时间戳"><a href="#时间戳" class="headerlink" title="时间戳"></a>时间戳</h2><p>BSON 有一个特殊的时间戳类型用于 MongoDB 内部使用，与普通的 日期 类型不相关。 时间戳值是一个 64 位的值。其中：</p>
<ul>
<li>前32位是一个 time_t 值（与Unix新纪元相差的秒数）</li>
<li>后32位是在某秒中操作的一个递增的<code>序数</code></li>
</ul>
<p>在单个 mongod 实例中，时间戳值通常是唯一的。在复制集中， oplog 有一个 ts 字段。这个字段中的值使用BSON时间戳表示了操作时间。</p>
<blockquote>
<p>BSON 时间戳类型主要用于 MongoDB 内部使用。在大多数情况下的应用开发中，你可以使用 BSON 日期类型。</p>
</blockquote>
<h2 id="日期"><a href="#日期" class="headerlink" title="日期"></a>日期</h2><p>表示当前距离 Unix新纪元（1970年1月1日）的毫秒数。日期类型是有符号的, 负数表示 1970 年之前的日期。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&gt; var mydate1 &#x3D; new Date() </span><br><span class="line">&gt; mydate1</span><br><span class="line">ISODate(&quot;2020-06-02T00:43:59.056Z&quot;)</span><br><span class="line">&gt; typeof mydate1</span><br><span class="line">object</span><br></pre></td></tr></table></figure>

<p>这样创建的时间是日期类型，可以使用 JS 中的 Date 类型的方法。</p>
<p>返回一个时间类型的字符串：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&gt;  var mydate1str &#x3D; mydate1.toString()</span><br><span class="line">&gt; mydate1str</span><br><span class="line">Tue Jun 02 2020 00:43:59 GMT+0000 (UTC)</span><br><span class="line">&gt;  typeof mydate1str</span><br><span class="line">string</span><br></pre></td></tr></table></figure>

<p>或者</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&gt; Date()</span><br><span class="line">Tue Jun 02 2020 00:45:23 GMT+0000 (UTC)</span><br></pre></td></tr></table></figure>

<h1 id="MongoDB基本命令"><a href="#MongoDB基本命令" class="headerlink" title="MongoDB基本命令"></a>MongoDB基本命令</h1><h2 id="MongoDB-创建数据库"><a href="#MongoDB-创建数据库" class="headerlink" title="MongoDB 创建数据库"></a>MongoDB 创建数据库</h2><h3 id="语法"><a href="#语法" class="headerlink" title="语法"></a>语法</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">use DATABASE_NAME</span><br></pre></td></tr></table></figure>

<p>如果数据库不存在，则创建数据库，否则切换到指定数据库。</p>
<h3 id="实例"><a href="#实例" class="headerlink" title="实例"></a>实例</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;</span><span class="bash"> use zysheep  <span class="comment"># 创建数据库zysheep</span></span></span><br><span class="line">switched to db zysheep</span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> show dbs    <span class="comment"># 查看所有数据库</span></span></span><br><span class="line">admin   0.000GB</span><br><span class="line">config  0.000GB</span><br><span class="line">demo    0.000GB</span><br><span class="line">local   0.000GB</span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> db.zysheep.insert(&#123;<span class="string">"sate"</span>:<span class="string">"zysheep"</span>&#125;)  </span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 创建的数据库 zysheep 并不在数据库的列表中， 要显示它，我们需要向 zysheep 数据库插入一些数据。</span></span><br><span class="line">WriteResult(&#123; "nInserted" : 1 &#125;)</span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> show dbs</span></span><br><span class="line">admin    0.000GB</span><br><span class="line">config   0.000GB</span><br><span class="line">demo     0.000GB</span><br><span class="line">local    0.000GB</span><br><span class="line">zysheep  0.000GB</span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> db  <span class="comment"># 查看当前所在数据库</span></span></span><br><span class="line">zysheep</span><br></pre></td></tr></table></figure>

<p>MongoDB 中默认的数据库为 <code>test</code>，如果你没有创建新的数据库，集合将存放在 test 数据库中。</p>
<blockquote>
<p><strong>注意:</strong> 在 MongoDB 中，集合只有在内容插入后才会创建! 就是说，创建集合(数据表)后要再插入一个文档(记录)，集合才会真正创建</p>
</blockquote>
<h2 id="MongoDB-删除数据库"><a href="#MongoDB-删除数据库" class="headerlink" title="MongoDB 删除数据库"></a>MongoDB 删除数据库</h2><h3 id="语法-1"><a href="#语法-1" class="headerlink" title="语法"></a>语法</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.dropDatabase()</span><br></pre></td></tr></table></figure>

<p>删除当前数据库，默认为<code>test</code>，你可以使用 <code>db</code> 命令查看当前数据库名。</p>
<h3 id="实例-1"><a href="#实例-1" class="headerlink" title="实例"></a>实例</h3><p>以下实例我们删除了数据库 zysheep。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&gt; show dbs  # 查看所有数据库</span><br><span class="line">admin    0.000GB</span><br><span class="line">config   0.000GB</span><br><span class="line">demo     0.000GB</span><br><span class="line">local    0.000GB</span><br><span class="line">zysheep  0.000GB</span><br><span class="line">&gt; db   # 查看当前数据库</span><br><span class="line">zysheep</span><br><span class="line">&gt; db.dropDatabase()  # 删除当前数据库</span><br><span class="line">&#123; &quot;dropped&quot; : &quot;zysheep&quot;, &quot;ok&quot; : 1 &#125;</span><br><span class="line">&gt; show dbs   # 查看是否删除</span><br><span class="line">admin   0.000GB</span><br><span class="line">config  0.000GB</span><br><span class="line">demo    0.000GB</span><br><span class="line">local   0.000GB</span><br></pre></td></tr></table></figure>

<h3 id="删除集合"><a href="#删除集合" class="headerlink" title="删除集合"></a>删除集合</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&gt; show dbs</span><br><span class="line">admin   0.000GB</span><br><span class="line">config  0.000GB</span><br><span class="line">demo    0.000GB</span><br><span class="line">local   0.000GB</span><br><span class="line">&gt; use zysheep</span><br><span class="line">switched to db zysheep</span><br><span class="line">&gt; db.createCollection(&quot;zysheep&quot;)    # 先创建集合，类似数据库中的表</span><br><span class="line">&#123; &quot;ok&quot; : 1 &#125;</span><br><span class="line">&gt; show tables  # show collections 命令会更加准确点</span><br><span class="line">zysheep</span><br><span class="line">&gt; db.zysheep.drop()</span><br><span class="line">true</span><br><span class="line">&gt; show tables</span><br></pre></td></tr></table></figure>

<h2 id="MongoDB-创建集合"><a href="#MongoDB-创建集合" class="headerlink" title="MongoDB 创建集合"></a>MongoDB 创建集合</h2><h3 id="语法-2"><a href="#语法-2" class="headerlink" title="语法"></a>语法</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.createCollection(name, options)</span><br></pre></td></tr></table></figure>

<ul>
<li>name: 要创建的集合名称</li>
<li>options: 可选参数, 指定有关内存大小及索引的选项</li>
</ul>
<p>options 可以是如下参数：</p>
<table>
<thead>
<tr>
<th align="center">字段</th>
<th align="center">类型</th>
<th align="center">描述</th>
</tr>
</thead>
<tbody><tr>
<td align="center">capped</td>
<td align="center">布尔</td>
<td align="center">（可选）如果为 true，则创建固定集合。固定集合是指有着固定大小的集合，当达到最大值时，它会自动覆盖最早的文档。 <strong>当该值为 true 时，必须指定 size 参数。</strong></td>
</tr>
<tr>
<td align="center">autoIndexId</td>
<td align="center">布尔</td>
<td align="center">（可选）如为 true，自动在 _id 字段创建索引。默认为 false。</td>
</tr>
<tr>
<td align="center">size</td>
<td align="center">数值</td>
<td align="center">（可选）为固定集合指定一个最大值，以千字节计（KB）。 <strong>如果 capped 为 true，也需要指定该字段。</strong></td>
</tr>
<tr>
<td align="center">max</td>
<td align="center">数值</td>
<td align="center">（可选）指定固定集合中包含文档的最大数量。</td>
</tr>
</tbody></table>
<p>在插入文档时，MongoDB 首先检查固定集合的 size 字段，然后检查 max 字段。</p>
<h3 id="实例-2"><a href="#实例-2" class="headerlink" title="实例"></a>实例</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;</span><span class="bash"> use demo <span class="comment">#创建 demo 数据库</span></span></span><br><span class="line">switched to db demo</span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> db.createCollection(<span class="string">"demo"</span>) <span class="comment"># 创建 demo 集合</span></span></span><br><span class="line">&#123; "ok" : 1 &#125;</span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> show collections  <span class="comment"># 查看已有集合</span></span></span><br><span class="line">demo</span><br><span class="line">info</span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> show tables <span class="comment"># 查看已有集合</span></span></span><br><span class="line">demo</span><br><span class="line">info</span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> db.createCollection(<span class="string">"mycol"</span>, &#123; capped : <span class="literal">true</span>, autoIndexId : <span class="literal">true</span>, size : </span></span><br><span class="line">...    6142800, max : 10000 &#125; )   # 创建固定集合 mycol</span><br><span class="line">&#123;</span><br><span class="line">	"note" : "the autoIndexId option is deprecated and will be removed in a future release",</span><br><span class="line">	"ok" : 1</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> show tables   <span class="comment"># 查看已有集合</span></span></span><br><span class="line">demo</span><br><span class="line">info</span><br><span class="line">mycol</span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> db.myclo2.insert(&#123;<span class="string">"name"</span>:<span class="string">"三月三"</span>&#125;) </span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 在 MongoDB 中，你不需要创建集合。当你插入一些文档时，MongoDB 会自动创建集合。</span></span><br><span class="line">WriteResult(&#123; "nInserted" : 1 &#125;)</span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> show tables</span></span><br><span class="line">demo</span><br><span class="line">info</span><br><span class="line">myclo2</span><br><span class="line">mycol</span><br></pre></td></tr></table></figure>

<h2 id="MongoDB-删除集合"><a href="#MongoDB-删除集合" class="headerlink" title="MongoDB 删除集合"></a>MongoDB 删除集合</h2><h3 id="语法-3"><a href="#语法-3" class="headerlink" title="语法"></a>语法</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.collection.drop()</span><br></pre></td></tr></table></figure>

<p>如果成功删除选定集合，则 drop() 方法返回 true，否则返回 false。</p>
<h3 id="实例-3"><a href="#实例-3" class="headerlink" title="实例"></a>实例</h3><p>在数据库<code>mydb</code>中，我们可以先通过 <code>show collections</code> 命令查看已存在的集合：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;</span><span class="bash"> use demo  <span class="comment"># 使用demo数据库</span></span></span><br><span class="line">switched to db demo</span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> show tables  <span class="comment"># 查看当前数据库所有集合</span></span></span><br><span class="line">demo</span><br><span class="line">info</span><br><span class="line">myclo2</span><br><span class="line">mycol</span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> db.demo.drop() <span class="comment"># 删除demo集合</span></span></span><br><span class="line">true</span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> show tables;</span></span><br><span class="line">info</span><br><span class="line">myclo2</span><br><span class="line">mycol</span><br><span class="line"><span class="meta">&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="MongoDB-插入文档"><a href="#MongoDB-插入文档" class="headerlink" title="MongoDB 插入文档"></a>MongoDB 插入文档</h2><p>文档的数据结构和 <code>JSON</code>基本一样。所有存储在集合中的数据都是<code>BSON</code> 格式。<code>BSON</code> 是一种类似 JSON 的二进制形式的存储格式，是 <code>Binary JSON</code>的简称。</p>
<h3 id="语法-4"><a href="#语法-4" class="headerlink" title="语法"></a>语法</h3><p>MongoDB 使用 insert() 或 save() 方法向集合中插入文档，语法如下：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">db.COLLECTION_NAME.insert(document)</span><br><span class="line">或</span><br><span class="line">db.COLLECTION_NAME.save(document)</span><br></pre></td></tr></table></figure>

<ul>
<li>save()：如果 _id 主键存在则更新数据，如果不存在就插入数据。该方法新版本中已废弃，可以使用 <strong>db.collection.insertOne()</strong> 或 <strong>db.collection.replaceOne()</strong> 来代替。</li>
<li>insert(): 若插入的数据主键已经存在，则会抛 <strong>org.springframework.dao.DuplicateKeyException</strong> 异常，提示主键重复，不保存当前数据</li>
</ul>
<p><strong>3.2 版本之后新增了 db.collection.insertOne() 和 db.collection.insertMany()。</strong></p>
<p>db.collection.insertOne() 用于向集合插入一个新文档，语法格式如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"># 语法</span><br><span class="line">db.collection.insertOne(</span><br><span class="line">   &lt;document&gt;,</span><br><span class="line">   &#123;</span><br><span class="line">      writeConcern: &lt;document&gt;</span><br><span class="line">   &#125;</span><br><span class="line">)</span><br><span class="line"># 实例</span><br><span class="line">&gt; var document &#x3D; db.collection.insertOne(&#123;&quot;a&quot;: 3&#125;)</span><br><span class="line">&gt; document</span><br><span class="line">&#123;</span><br><span class="line">	&quot;acknowledged&quot; : true,</span><br><span class="line">	&quot;insertedId&quot; : ObjectId(&quot;5ed5a93256fa4269b4e255ff&quot;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>db.collection.insertMany() 用于向集合插入一个多个文档，语法格式如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"># 语法</span><br><span class="line">db.collection.insertMany(</span><br><span class="line">   [ &lt;document 1&gt; , &lt;document 2&gt;, ... ],</span><br><span class="line">   &#123;</span><br><span class="line">      writeConcern: &lt;document&gt;,</span><br><span class="line">      ordered: &lt;boolean&gt;</span><br><span class="line">   &#125;</span><br><span class="line">)</span><br><span class="line"># 实例</span><br><span class="line">&gt; var res &#x3D; db.collection.insertMany([&#123;&quot;b&quot;: 3&#125;, &#123;&#39;c&#39;: 4&#125;])</span><br><span class="line">&gt; res</span><br><span class="line">&#123;</span><br><span class="line">	&quot;acknowledged&quot; : true,</span><br><span class="line">	&quot;insertedIds&quot; : [</span><br><span class="line">		ObjectId(&quot;5ed5a93f56fa4269b4e25600&quot;),</span><br><span class="line">		ObjectId(&quot;5ed5a93f56fa4269b4e25601&quot;)</span><br><span class="line">	]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>document：要写入的文档。</li>
<li>writeConcern：写入策略，默认为 1，即要求确认写操作，0 是不要求。</li>
<li>ordered：指定是否按顺序写入，默认 true，按顺序写入。</li>
</ul>
<h3 id="实例-4"><a href="#实例-4" class="headerlink" title="实例"></a>实例</h3><p>以下文档可以存储在 MongoDB 的 demo数据库 的 col 集合中：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&gt;db.col.insert(&#123;title: &#39;MongoDB 教程&#39;, </span><br><span class="line">    description: &#39;MongoDB 是一个 Nosql 数据库&#39;,</span><br><span class="line">    by: &#39;菜鸟教程&#39;,</span><br><span class="line">    url: &#39;http:&#x2F;&#x2F;www.runoob.com&#39;,</span><br><span class="line">    tags: [&#39;mongodb&#39;, &#39;database&#39;, &#39;NoSQL&#39;],</span><br><span class="line">    likes: 100</span><br><span class="line">&#125;)</span><br><span class="line">&gt;WriteResult(&#123; &quot;nInserted&quot; : 1 &#125;)</span><br></pre></td></tr></table></figure>

<p>以上实例中 col 是我们的集合名，如果该集合不在该数据库中， MongoDB 会自动创建该集合并插入文档。</p>
<p>查看已插入文档：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&gt; db.col.find()</span><br><span class="line">&gt;&#123; &quot;_id&quot; : ObjectId(&quot;5ed5a7e356fa4269b4e255fd&quot;), &quot;title&quot; : &quot;MongoDB 教程&quot;, &quot;description&quot; : &quot;MongoDB 是一个 Nosql 数据库&quot;, &quot;by&quot; : &quot;菜鸟教程&quot;, &quot;url&quot; : &quot;http:&#x2F;&#x2F;www.runoob.com&quot;, &quot;tags&quot; : [ &quot;mongodb&quot;, &quot;database&quot;, &quot;NoSQL&quot; ], &quot;likes&quot; : 100 &#125;</span><br></pre></td></tr></table></figure>

<p>我们也可以将数据定义为一个变量，如下所示：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">document&#x3D;(&#123;title: &#39;MongoDB 教程&#39;, </span><br><span class="line">   description: &#39;MongoDB 是一个 Nosql 数据库&#39;,</span><br><span class="line">   by: &#39;菜鸟教程&#39;,</span><br><span class="line">   url: &#39;http:&#x2F;&#x2F;www.runoob.com&#39;,</span><br><span class="line">   tags: [&#39;mongodb&#39;, &#39;database&#39;, &#39;NoSQL&#39;],</span><br><span class="line">   likes: 100</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p> 执行后显示结果如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">	&quot;title&quot; : &quot;MongoDB 教程&quot;,</span><br><span class="line">	&quot;description&quot; : &quot;MongoDB 是一个 Nosql 数据库&quot;,</span><br><span class="line">	&quot;by&quot; : &quot;菜鸟教程&quot;,</span><br><span class="line">	&quot;url&quot; : &quot;http:&#x2F;&#x2F;www.runoob.com&quot;,</span><br><span class="line">	&quot;tags&quot; : [</span><br><span class="line">		&quot;mongodb&quot;,</span><br><span class="line">		&quot;database&quot;,</span><br><span class="line">		&quot;NoSQL&quot;</span><br><span class="line">	],</span><br><span class="line">	&quot;likes&quot; : 100</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>执行插入操作：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&gt;db.col.insert(document)</span><br><span class="line">WriteResult(&#123; &quot;nInserted&quot; : 1 &#125;)</span><br></pre></td></tr></table></figure>

<p>插入文档你也可以使用 <code>db.col.save(document)</code>命令。如果不指定 _id 字段 save() 方法类似于 insert() 方法。如果指定 _id 字段，则会更新该 _id 的数据。</p>
<h2 id="MongoDB-更新文档"><a href="#MongoDB-更新文档" class="headerlink" title="MongoDB 更新文档"></a>MongoDB 更新文档</h2><p>MongoDB 使用 <strong>update()</strong> 和 <strong>save()</strong> 方法来更新集合中的文档。接下来让我们详细来看下两个函数的应用及其区别。</p>
<h3 id="update-方法"><a href="#update-方法" class="headerlink" title="update() 方法"></a>update() 方法</h3><h4 id="语法-5"><a href="#语法-5" class="headerlink" title="语法"></a>语法</h4><p>update() 方法用于更新已存在的文档。语法格式如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">db.collection.update(</span><br><span class="line">   &lt;query&gt;,</span><br><span class="line">   &lt;update&gt;,</span><br><span class="line">   &#123;</span><br><span class="line">     upsert: &lt;boolean&gt;,</span><br><span class="line">     multi: &lt;boolean&gt;,</span><br><span class="line">     writeConcern: &lt;document&gt;</span><br><span class="line">   &#125;</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>query</strong> : update的查询条件，类似sql update查询内where后面的。</li>
<li><strong>update</strong> : update的对象和一些更新的操作符（如$,$inc…）等，也可以理解为sql update查询内set后面的</li>
<li><strong>upsert</strong> : 可选，这个参数的意思是，如果不存在update的记录，是否插入objNew,true为插入，默认是false，不插入。</li>
<li><strong>multi</strong> : 可选，mongodb 默认是false,只更新找到的第一条记录，如果这个参数为true,就把按条件查出来多条记录全部更新。</li>
<li><strong>writeConcern</strong> :可选，抛出异常的级别。</li>
</ul>
<h4 id="实例-5"><a href="#实例-5" class="headerlink" title="实例"></a>实例</h4><p>我们在集合 col 中插入如下数据：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">db.col.insert(&#123;</span><br><span class="line">     title: &#39;MongoDB 教程&#39;, </span><br><span class="line">     description: &#39;MongoDB 是一个 Nosql 数据库&#39;,</span><br><span class="line">     by: &#39;菜鸟教程&#39;,</span><br><span class="line">     url: &#39;http:&#x2F;&#x2F;www.runoob.com&#39;,</span><br><span class="line">     tags: [&#39;mongodb&#39;, &#39;database&#39;, &#39;NoSQL&#39;],</span><br><span class="line">     likes: 100</span><br><span class="line"> &#125;)</span><br><span class="line">WriteResult(&#123; &quot;nInserted&quot; : 1 &#125;)</span><br></pre></td></tr></table></figure>

<p>接着我们通过 update() 方法来更新标题(title):</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">&gt;db.col.update(&#123;&#39;title&#39;:&#39;MongoDB 教程&#39;&#125;,&#123;$set:&#123;&#39;title&#39;:&#39;MongoDB&#39;&#125;&#125;)</span><br><span class="line">WriteResult(&#123; &quot;nMatched&quot; : 1, &quot;nUpserted&quot; : 0, &quot;nModified&quot; : 1 &#125;)</span><br><span class="line">&gt; db.col.find().pretty()</span><br><span class="line">&#123;</span><br><span class="line">	&quot;_id&quot; : ObjectId(&quot;5ed5a7e356fa4269b4e255fd&quot;),</span><br><span class="line">	&quot;title&quot; : &quot;MongoDB&quot;,</span><br><span class="line">	&quot;description&quot; : &quot;MongoDB 是一个 Nosql 数据库&quot;,</span><br><span class="line">	&quot;by&quot; : &quot;菜鸟教程&quot;,</span><br><span class="line">	&quot;url&quot; : &quot;http:&#x2F;&#x2F;www.runoob.com&quot;,</span><br><span class="line">	&quot;tags&quot; : [</span><br><span class="line">		&quot;mongodb&quot;,</span><br><span class="line">		&quot;database&quot;,</span><br><span class="line">		&quot;NoSQL&quot;</span><br><span class="line">	],</span><br><span class="line">	&quot;likes&quot; : 100</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>可以看到标题(title)由原来的 “MongoDB 教程” 更新为了 “MongoDB”。</p>
<p>以上语句只会修改第一条发现的文档，如果你要修改多条相同的文档，则需要设置 multi 参数为 true。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&gt;db.col.update(&#123;&#39;title&#39;:&#39;MongoDB 教程&#39;&#125;,&#123;$set:&#123;&#39;title&#39;:&#39;MongoDB&#39;&#125;&#125;,&#123;multi:true&#125;)</span><br></pre></td></tr></table></figure>

<h3 id="save-方法"><a href="#save-方法" class="headerlink" title="save() 方法"></a>save() 方法</h3><h4 id="语法-6"><a href="#语法-6" class="headerlink" title="语法"></a>语法</h4><p>save() 方法通过传入的文档来替换已有文档，_id 主键存在就更新，不存在就插入。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">db.collection.save(</span><br><span class="line">   &lt;document&gt;,</span><br><span class="line">   &#123;</span><br><span class="line">     writeConcern: &lt;document&gt;</span><br><span class="line">   &#125;</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>document</strong> : 文档数据。</li>
<li><strong>writeConcern</strong> :可选，抛出异常的级别。</li>
</ul>
<h4 id="实例-6"><a href="#实例-6" class="headerlink" title="实例"></a>实例</h4><p>以下实例中我们替换了 _id 为 5ed5a7e356fa4269b4e255fd的文档数据：</p>
<p>原数据</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;</span><span class="bash"> db.col.find().pretty()</span></span><br><span class="line">&#123;</span><br><span class="line">	"_id" : ObjectId("5ed5a7e356fa4269b4e255fd"),</span><br><span class="line">	"title" : "MongoDB",</span><br><span class="line">	"description" : "MongoDB 是一个 Nosql 数据库",</span><br><span class="line">	"by" : "菜鸟教程",</span><br><span class="line">	"url" : "http://www.runoob.com",</span><br><span class="line">	"tags" : [</span><br><span class="line">		"mongodb",</span><br><span class="line">		"database",</span><br><span class="line">		"NoSQL"</span><br><span class="line">	],</span><br><span class="line">	"likes" : 100</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>执行更新</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">db.col.save(&#123;</span><br><span class="line">   &quot;_id&quot; : ObjectId(&quot;5ed5a7e356fa4269b4e255fd&quot;),</span><br><span class="line">   &quot;title&quot; : &quot;MongoDB_Zysheep&quot;,</span><br><span class="line">   &quot;description&quot; : &quot;MongoDB 是一个 Nosql 数据库&quot;,</span><br><span class="line">   &quot;by&quot; : &quot;Zysheep&quot;,</span><br><span class="line">   &quot;url&quot; : &quot;http:&#x2F;&#x2F;www.zysheep.cn&quot;,</span><br><span class="line">   &quot;tags&quot; : [</span><br><span class="line">           &quot;mongodb&quot;,</span><br><span class="line">           &quot;NoSQL&quot;,</span><br><span class="line">           &quot;zysheep&quot;</span><br><span class="line">   ],</span><br><span class="line">   &quot;likes&quot; : 120</span><br><span class="line">&#125;)</span><br><span class="line">WriteResult(&#123; &quot;nMatched&quot; : 1, &quot;nUpserted&quot; : 0, &quot;nModified&quot; : 1 &#125;)</span><br></pre></td></tr></table></figure>

<p>替换成功后，我们可以通过 find() 命令来查看替换后的数据</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">db.col.find().pretty()</span><br><span class="line">&#123;</span><br><span class="line">&quot;_id&quot; : ObjectId(&quot;5ed5a7e356fa4269b4e255fd&quot;),</span><br><span class="line">&quot;title&quot; : &quot;MongoDB_Zysheep&quot;,</span><br><span class="line">&quot;description&quot; : &quot;MongoDB 是一个 Nosql 数据库&quot;,</span><br><span class="line">&quot;by&quot; : &quot;Zysheep&quot;,</span><br><span class="line">&quot;url&quot; : &quot;http:&#x2F;&#x2F;www.zysheep.cn&quot;,</span><br><span class="line">&quot;tags&quot; : [</span><br><span class="line">	&quot;mongodb&quot;,</span><br><span class="line">	&quot;NoSQL&quot;,</span><br><span class="line">	&quot;zysheep&quot;</span><br><span class="line">],</span><br><span class="line">&quot;likes&quot; : 120</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="MongoDB-删除文档"><a href="#MongoDB-删除文档" class="headerlink" title="MongoDB 删除文档"></a>MongoDB 删除文档</h2><p>MongoDB <code>remove()</code>函数是用来移除集合中的数据。MongoDB数据更新可以使用<code>update()</code>函数。在执行<code>remove()</code>函数前先执行<code>find()</code>命令来判断执行的条件是否正确，这是一个比较好的习惯。</p>
<h3 id="语法-7"><a href="#语法-7" class="headerlink" title="语法"></a>语法</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">db.collection.remove(</span><br><span class="line">   &lt;query&gt;,</span><br><span class="line">   &lt;justOne&gt;</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>query</strong> :（可选）删除的文档的条件。</li>
<li><strong>justOne</strong> : （可选）如果设为 true 或 1，则只删除一个文档，如果不设置该参数，或使用默认值 false，则删除所有匹配条件的文档。</li>
<li><strong>writeConcern</strong> :（可选）抛出异常的级别。</li>
</ul>
<h3 id="实例-7"><a href="#实例-7" class="headerlink" title="实例"></a>实例</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"># 查询所有数据</span><br><span class="line">&gt; db.col.find()</span><br><span class="line">&#123; &quot;_id&quot; : ObjectId(&quot;5ed5a7e356fa4269b4e255fd&quot;), &quot;title&quot; : &quot;MongoDB_Zysheep&quot;, &quot;description&quot; : &quot;MongoDB 是一个 Nosql 数据库&quot;, &quot;by&quot; : &quot;Zysheep&quot;, &quot;url&quot; : &quot;http:&#x2F;&#x2F;www.zysheep.cn&quot;, &quot;tags&quot; : [ &quot;mongodb&quot;, &quot;NoSQL&quot;, &quot;zysheep&quot; ], &quot;likes&quot; : 120 &#125;</span><br><span class="line">&#123; &quot;_id&quot; : ObjectId(&quot;5ed5a81856fa4269b4e255fe&quot;), &quot;title&quot; : &quot;MongoDB&quot;, &quot;description&quot; : &quot;MongoDB 是一个 Nosql 数据库&quot;, &quot;by&quot; : &quot;菜鸟教程&quot;, &quot;url&quot; : &quot;http:&#x2F;&#x2F;www.runoob.com&quot;, &quot;tags&quot; : [ &quot;mongodb&quot;, &quot;database&quot;, &quot;NoSQL&quot; ], &quot;likes&quot; : 100 &#125;</span><br><span class="line">&#123; &quot;_id&quot; : ObjectId(&quot;5ed5aa2156fa4269b4e25602&quot;), &quot;title&quot; : &quot;MongoDB&quot;, &quot;description&quot; : &quot;MongoDB 是一个 Nosql 数据库&quot;, &quot;by&quot; : &quot;菜鸟教程&quot;, &quot;url&quot; : &quot;http:&#x2F;&#x2F;www.runoob.com&quot;, &quot;tags&quot; : [ &quot;mongodb&quot;, &quot;database&quot;, &quot;NoSQL&quot; ], &quot;likes&quot; : 100 &#125;</span><br><span class="line"># 移除 title 为 &#39;MongoDB&#39; 的文档</span><br><span class="line">&gt;db.col.remove(&#123;&#39;title&#39;:&#39;MongoDB&#39;&#125;)</span><br><span class="line">WriteResult(&#123; &quot;nRemoved&quot; : 2 &#125;)   </span><br><span class="line"># 再次查询所有文档</span><br><span class="line">&gt;db.col.find()</span><br></pre></td></tr></table></figure>

<p>如果你只想删除第一条找到的记录可以设置 justOne 为 1</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&gt;db.COLLECTION_NAME.remove(DELETION_CRITERIA,1)</span><br></pre></td></tr></table></figure>

<h3 id="注意"><a href="#注意" class="headerlink" title="注意"></a>注意</h3><p><code>remove()</code>方法已经过时了，现在官方推荐使用<code>deleteOne()</code>和 <code>deleteMany()</code>方法。</p>
<p>如删除集合下全部文档：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.COLLECTION_NAME.deleteMany(&#123;&#125;)</span><br></pre></td></tr></table></figure>

<p>删除 status 等于 A 的全部文档：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.COLLECTION_NAME.deleteMany(&#123; status : &quot;A&quot; &#125;)</span><br></pre></td></tr></table></figure>

<p>删除 status 等于 D 的一个文档：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.COLLECTION_NAME.deleteOne( &#123; status: &quot;D&quot; &#125; )</span><br></pre></td></tr></table></figure>

<h2 id="MongoDB-查询文档"><a href="#MongoDB-查询文档" class="headerlink" title="MongoDB 查询文档"></a>MongoDB 查询文档</h2><p>MongoDB 查询文档使用 find() 方法。</p>
<h3 id="语法-8"><a href="#语法-8" class="headerlink" title="语法"></a>语法</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&gt;db.collection.find(query, projection)</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>query</strong> ：可选，使用查询操作符指定查询条件</li>
<li><strong>projection</strong> ：可选，使用投影操作符指定返回的键。查询时返回文档中所有键值， 只需省略该参数即可（默认省略）。</li>
</ul>
<p>如果你需要以易读的方式来读取数据，可以使用 pretty() 方法，语法格式如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&gt;db.col.find().pretty()</span><br></pre></td></tr></table></figure>

<p><code>pretty()</code>方法以格式化的方式来显示所有文档。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&gt; db.col.find().pretty()</span><br><span class="line">&#123;</span><br><span class="line">        &quot;_id&quot; : ObjectId(&quot;56063f17ade2f21f36b03133&quot;),</span><br><span class="line">        &quot;title&quot; : &quot;MongoDB 教程&quot;,</span><br><span class="line">        &quot;description&quot; : &quot;MongoDB 是一个 Nosql 数据库&quot;,</span><br><span class="line">        &quot;by&quot; : &quot;菜鸟教程&quot;,</span><br><span class="line">        &quot;url&quot; : &quot;http:&#x2F;&#x2F;www.runoob.com&quot;,</span><br><span class="line">        &quot;tags&quot; : [</span><br><span class="line">                &quot;mongodb&quot;,</span><br><span class="line">                &quot;database&quot;,</span><br><span class="line">                &quot;NoSQL&quot;</span><br><span class="line">        ],</span><br><span class="line">        &quot;likes&quot; : 100</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="MongoDB-与-RDBMS-Where-语句比较"><a href="#MongoDB-与-RDBMS-Where-语句比较" class="headerlink" title="MongoDB 与 RDBMS Where 语句比较"></a>MongoDB 与 RDBMS Where 语句比较</h4><table>
<thead>
<tr>
<th align="center">操作</th>
<th align="center">格式</th>
<th>范例</th>
<th align="center">RDBMS中的类似语句</th>
</tr>
</thead>
<tbody><tr>
<td align="center">等于</td>
<td align="center"><code>{&lt;key&gt;:&lt;value&gt;</code>}</td>
<td><code>db.col.find({&quot;by&quot;:&quot;菜鸟教程&quot;}).pretty()</code></td>
<td align="center"><code>where by = &#39;菜鸟教程&#39;</code></td>
</tr>
<tr>
<td align="center">小于</td>
<td align="center"><code>{&lt;key&gt;:{$lt:&lt;value&gt;}}</code></td>
<td><code>db.col.find({&quot;likes&quot;:{$lt:50}}).pretty()</code></td>
<td align="center"><code>where likes &lt; 50</code></td>
</tr>
<tr>
<td align="center">小于或等于</td>
<td align="center"><code>{&lt;key&gt;:{$lte:&lt;value&gt;}}</code></td>
<td><code>db.col.find({&quot;likes&quot;:{$lte:50}}).pretty()</code></td>
<td align="center"><code>where likes &lt;= 50</code></td>
</tr>
<tr>
<td align="center">大于</td>
<td align="center"><code>{&lt;key&gt;:{$gt:&lt;value&gt;}}</code></td>
<td><code>db.col.find({&quot;likes&quot;:{$gt:50}}).pretty()</code></td>
<td align="center"><code>where likes &gt; 50</code></td>
</tr>
<tr>
<td align="center">大于或等于</td>
<td align="center"><code>{&lt;key&gt;:{$gte:&lt;value&gt;}}</code></td>
<td><code>db.col.find({&quot;likes&quot;:{$gte:50}}).pretty()</code></td>
<td align="center"><code>where likes &gt;= 50</code></td>
</tr>
<tr>
<td align="center">不等于</td>
<td align="center"><code>{&lt;key&gt;:{$ne:&lt;value&gt;}}</code></td>
<td><code>db.col.find({&quot;likes&quot;:{$ne:50}}).pretty()</code></td>
<td align="center"><code>where likes != 50</code></td>
</tr>
</tbody></table>
<p>MongoDB中条件操作符有：</p>
<ul>
<li>(&gt;) 大于 - $gt</li>
<li>(&lt;) 小于 - $lt</li>
<li>(&gt;=) 大于等于 - $gte</li>
<li>(&lt;= ) 小于等于 - $lte</li>
</ul>
<h4 id="MongoDB-AND-条件"><a href="#MongoDB-AND-条件" class="headerlink" title="MongoDB AND 条件"></a>MongoDB AND 条件</h4><p>MongoDB 的 find() 方法可以传入多个键(key)，每个键(key)以逗号隔开，即常规 SQL 的 AND 条件。</p>
<p>语法格式如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&gt;db.col.find(&#123;key1:value1, key2:value2&#125;).pretty()</span><br></pre></td></tr></table></figure>

<p>#####实例</p>
<p>以下实例通过 <strong>by</strong> 和 <strong>title</strong> 键来查询 <strong>菜鸟教程</strong> 中 <strong>MongoDB 教程</strong> 的数据</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&gt; db.col.find(&#123;&quot;by&quot;:&quot;菜鸟教程&quot;, &quot;title&quot;:&quot;MongoDB 教程&quot;&#125;).pretty()</span><br><span class="line">&#123;</span><br><span class="line">        &quot;_id&quot; : ObjectId(&quot;56063f17ade2f21f36b03133&quot;),</span><br><span class="line">        &quot;title&quot; : &quot;MongoDB 教程&quot;,</span><br><span class="line">        &quot;description&quot; : &quot;MongoDB 是一个 Nosql 数据库&quot;,</span><br><span class="line">        &quot;by&quot; : &quot;菜鸟教程&quot;,</span><br><span class="line">        &quot;url&quot; : &quot;http:&#x2F;&#x2F;www.runoob.com&quot;,</span><br><span class="line">        &quot;tags&quot; : [</span><br><span class="line">                &quot;mongodb&quot;,</span><br><span class="line">                &quot;database&quot;,</span><br><span class="line">                &quot;NoSQL&quot;</span><br><span class="line">        ],</span><br><span class="line">        &quot;likes&quot; : 100</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>以上实例中类似于 WHERE 语句：<strong>WHERE by=’菜鸟教程’ AND title=’MongoDB 教程’</strong></p>
<h4 id="MongoDB-OR-条件"><a href="#MongoDB-OR-条件" class="headerlink" title="MongoDB OR 条件"></a>MongoDB OR 条件</h4><p>MongoDB OR 条件语句使用了关键字 <strong>$or</strong>,语法格式如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&gt;db.col.find(</span><br><span class="line">   &#123;</span><br><span class="line">      $or: [</span><br><span class="line">         &#123;key1: value1&#125;, &#123;key2:value2&#125;</span><br><span class="line">      ]</span><br><span class="line">   &#125;</span><br><span class="line">).pretty()</span><br></pre></td></tr></table></figure>

<h5 id="实例-8"><a href="#实例-8" class="headerlink" title="实例"></a>实例</h5><p>以下实例中，我们演示了查询键 <strong>by</strong> 值为 菜鸟教程 或键 <strong>title</strong> 值为 <strong>MongoDB 教程</strong> 的文档。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&gt;db.col.find(&#123;$or:[&#123;&quot;by&quot;:&quot;菜鸟教程&quot;&#125;,&#123;&quot;title&quot;: &quot;MongoDB 教程&quot;&#125;]&#125;).pretty()</span><br><span class="line">&#123;</span><br><span class="line">        &quot;_id&quot; : ObjectId(&quot;56063f17ade2f21f36b03133&quot;),</span><br><span class="line">        &quot;title&quot; : &quot;MongoDB 教程&quot;,</span><br><span class="line">        &quot;description&quot; : &quot;MongoDB 是一个 Nosql 数据库&quot;,</span><br><span class="line">        &quot;by&quot; : &quot;菜鸟教程&quot;,</span><br><span class="line">        &quot;url&quot; : &quot;http:&#x2F;&#x2F;www.runoob.com&quot;,</span><br><span class="line">        &quot;tags&quot; : [</span><br><span class="line">                &quot;mongodb&quot;,</span><br><span class="line">                &quot;database&quot;,</span><br><span class="line">                &quot;NoSQL&quot;</span><br><span class="line">        ],</span><br><span class="line">        &quot;likes&quot; : 100</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="AND-和-OR-联合使用"><a href="#AND-和-OR-联合使用" class="headerlink" title="AND 和 OR 联合使用"></a>AND 和 OR 联合使用</h4><p>以下实例演示了 AND 和 OR 联合使用，类似常规 SQL 语句为： <strong>‘where likes&gt;50 AND (by = ‘菜鸟教程’ OR title = ‘MongoDB 教程’)’</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&gt;db.col.find(&#123;&quot;likes&quot;: &#123;$gt:50&#125;, $or: [&#123;&quot;by&quot;: &quot;菜鸟教程&quot;&#125;,&#123;&quot;title&quot;: &quot;MongoDB 教程&quot;&#125;]&#125;).pretty()</span><br><span class="line">&#123;</span><br><span class="line">        &quot;_id&quot; : ObjectId(&quot;56063f17ade2f21f36b03133&quot;),</span><br><span class="line">        &quot;title&quot; : &quot;MongoDB 教程&quot;,</span><br><span class="line">        &quot;description&quot; : &quot;MongoDB 是一个 Nosql 数据库&quot;,</span><br><span class="line">        &quot;by&quot; : &quot;菜鸟教程&quot;,</span><br><span class="line">        &quot;url&quot; : &quot;http:&#x2F;&#x2F;www.runoob.com&quot;,</span><br><span class="line">        &quot;tags&quot; : [</span><br><span class="line">                &quot;mongodb&quot;,</span><br><span class="line">                &quot;database&quot;,</span><br><span class="line">                &quot;NoSQL&quot;</span><br><span class="line">        ],</span><br><span class="line">        &quot;likes&quot; : 100</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="docker-部署-mongodb"><a href="#docker-部署-mongodb" class="headerlink" title="docker 部署 mongodb"></a>docker 部署 mongodb</h1><h2 id="拉取镜像"><a href="#拉取镜像" class="headerlink" title="拉取镜像"></a>拉取镜像</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker pull mongo</span><br></pre></td></tr></table></figure>

<p>可以查看镜像是否下载成功</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker images | grep mongo</span><br></pre></td></tr></table></figure>

<p><img src="C:%5CUsers%5CL15096000421%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5C1591003616968.png" alt="1591003616968"></p>
<h2 id="docker-安装-mongodb"><a href="#docker-安装-mongodb" class="headerlink" title="docker 安装 mongodb"></a>docker 安装 mongodb</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run --name mongodb -v &#x2F;data&#x2F;mongodb0:&#x2F;data&#x2F;db -p 27017:27017 -d mongo</span><br></pre></td></tr></table></figure>

<p>执行上述命令之后, 一个挂载了 mongo镜像的容器就开始运行了</p>
<ul>
<li><code>--name</code> 设置了容器的名字</li>
<li><code>-v</code> 设置了路径的映射, 将本地路径映射到容器中. 此处, 路径可以自定义</li>
<li><code>-p</code> 设置了端口的映射, 将容器的27017(右侧) 映射到了本地的27017(右侧)</li>
</ul>
<h2 id="进入容器"><a href="#进入容器" class="headerlink" title="进入容器."></a>进入容器.</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker exec -it mongodb bash</span><br></pre></td></tr></table></figure>

<p>上述命令的意思如下:使用交互的形式, 在 名字为 <code>mongodb</code> 的容器中实行 <code>bash</code>这个命令</p>
<h2 id="mongodb的使用"><a href="#mongodb的使用" class="headerlink" title="mongodb的使用"></a><code>mongodb</code>的使用</h2><h3 id="用户的创建"><a href="#用户的创建" class="headerlink" title="用户的创建"></a>用户的创建</h3><p>输入以下命令进入 <code>mongo</code></p>
<h3 id="创建用户"><a href="#创建用户" class="headerlink" title="创建用户"></a>创建用户</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta"> #</span><span class="bash"> 进入 admin 的数据库</span></span><br><span class="line"><span class="meta"> &gt;</span><span class="bash"> use admin</span></span><br><span class="line">switched to db admin</span><br><span class="line"><span class="meta">#</span><span class="bash"> 创建管理员用户</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> db.createUser(</span></span><br><span class="line">...    &#123;</span><br><span class="line">...      user: "admin",</span><br><span class="line">...      pwd: "123456",</span><br><span class="line">...      roles: [ &#123; role: "userAdminAnyDatabase", db: "admin" &#125; ]</span><br><span class="line">...    &#125;</span><br><span class="line">...  )</span><br><span class="line">Successfully added user: &#123;</span><br><span class="line">	"user" : "admin",</span><br><span class="line">	"roles" : [</span><br><span class="line">		&#123;</span><br><span class="line">			"role" : "userAdminAnyDatabase",</span><br><span class="line">			"db" : "admin"</span><br><span class="line">		&#125;</span><br><span class="line">	]</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta"> #</span><span class="bash"> 创建有可读写权限的用户. 对于一个特定的数据库, 比如<span class="string">'demo'</span></span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">  db.createUser(&#123;</span></span><br><span class="line">...      user: 'test',</span><br><span class="line">...      pwd: '123456',</span><br><span class="line">...      roles: [&#123;role: "read", db: "demo"&#125;]</span><br><span class="line">...  &#125;)</span><br><span class="line">Successfully added user: &#123;</span><br><span class="line">	"user" : "test",</span><br><span class="line">	"roles" : [</span><br><span class="line">		&#123;</span><br><span class="line">			"role" : "read",</span><br><span class="line">			"db" : "demo"</span><br><span class="line">		&#125;</span><br><span class="line">	]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="数据库的建立"><a href="#数据库的建立" class="headerlink" title="数据库的建立"></a>数据库的建立</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">use demo;</span><br></pre></td></tr></table></figure>

<h2 id="mongo-是否正常启动的校验"><a href="#mongo-是否正常启动的校验" class="headerlink" title="mongo 是否正常启动的校验"></a>mongo 是否正常启动的校验</h2><p>先写入一条数据</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.info.save(&#123;name: 'test', age: '22'&#125;)</span><br></pre></td></tr></table></figure>

<p>查看写入的数据</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.info.find();</span><br></pre></td></tr></table></figure>

<p>结果如下</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 数据库的建立</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> use demo;</span></span><br><span class="line">switched to db demo</span><br><span class="line"><span class="meta">#</span><span class="bash"> 先写入一条数据</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> db.info.save(&#123;name: <span class="string">'test'</span>, age: <span class="string">'22'</span>&#125;)</span></span><br><span class="line">WriteResult(&#123; "nInserted" : 1 &#125;)</span><br><span class="line"><span class="meta">#</span><span class="bash"> </span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> db.info.find();</span></span><br><span class="line">&#123; "_id" : ObjectId("5ed4cc9c3f1db5d1d0e02f01"), "name" : "test", "age" : "22" &#125;</span><br></pre></td></tr></table></figure>

<h2 id="远程连接的开启"><a href="#远程连接的开启" class="headerlink" title="远程连接的开启"></a>远程连接的开启</h2><p>在 <code>mongodb</code> 的容器当中</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">#更新源</span><br><span class="line">apt-get update</span><br><span class="line"># 安装 vim</span><br><span class="line">apt-get install vim</span><br><span class="line"># 修改 mongo 配置文件</span><br><span class="line">vim &#x2F;etc&#x2F;mongod.conf.orig</span><br></pre></td></tr></table></figure>

<p>将其中的<code>bindIp: 127.0.0.1</code>注释掉<code># bindIp: 127.0.0.1</code>或者改成<code>bindIp: 0.0.0.0</code>即可开启远程连接</p>
<h1 id="SpringBoot之mongoTemplate的使用"><a href="#SpringBoot之mongoTemplate的使用" class="headerlink" title="SpringBoot之mongoTemplate的使用"></a>SpringBoot之mongoTemplate的使用</h1><h2 id="1、引入springboot-mongo依赖"><a href="#1、引入springboot-mongo依赖" class="headerlink" title="1、引入springboot mongo依赖"></a>1、引入springboot mongo依赖</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;org.springframework.boot&lt;&#x2F;groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;spring-boot-starter-data-mongodb&lt;&#x2F;artifactId&gt;</span><br><span class="line">&lt;&#x2F;dependency&gt;</span><br></pre></td></tr></table></figure>

<h2 id="2、mongo的IP和端口"><a href="#2、mongo的IP和端口" class="headerlink" title="2、mongo的IP和端口"></a>2、mongo的IP和端口</h2><p>在resources下的application.yml中加入如下内容,端口默认:<code>27017</code></p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">data:</span></span><br><span class="line">    <span class="attr">mongodb:</span></span><br><span class="line">      <span class="attr">uri:</span> <span class="string">mongodb://172.16.0.192/test</span></span><br></pre></td></tr></table></figure>

<h2 id="3、使用mongoTemplate"><a href="#3、使用mongoTemplate" class="headerlink" title="3、使用mongoTemplate"></a>3、使用mongoTemplate</h2><p>###User</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> cn.zysheep.springboot.entity;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> lombok.AllArgsConstructor;</span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"><span class="keyword">import</span> lombok.NoArgsConstructor;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.Serializable;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span> v1.0.0</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@ProjectName</span>: springboot-learning-examples</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@ClassName</span>: User</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Author</span>: 三月三</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="meta">@NoArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">User</span> <span class="keyword">implements</span> <span class="title">Serializable</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line">    <span class="keyword">private</span> String userName;</span><br><span class="line">    <span class="keyword">private</span> String passWord;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>###UserRepository</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> cn.zysheep.springboot.repository;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> cn.zysheep.springboot.entity.User;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span> v1.0.0</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@ProjectName</span>: springboot-learning-examples</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@ClassName</span>: UserRepository</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Author</span>: 三月三</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">UserRepository</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">saveUser</span><span class="params">(User user)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testFindAll</span><span class="params">()</span> </span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> User <span class="title">findUserByUserName</span><span class="params">(String userName)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">long</span> <span class="title">updateUser</span><span class="params">(User user)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">deleteUserById</span><span class="params">(Long id)</span></span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>###UserPerpositoryImpl</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> cn.zysheep.springboot.repository.impl;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> cn.zysheep.springboot.entity.User;</span><br><span class="line"><span class="keyword">import</span> cn.zysheep.springboot.repository.UserRepository;</span><br><span class="line"><span class="keyword">import</span> com.mongodb.client.result.UpdateResult;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.data.domain.PageRequest;</span><br><span class="line"><span class="keyword">import</span> org.springframework.data.domain.Pageable;</span><br><span class="line"><span class="keyword">import</span> org.springframework.data.mongodb.core.MongoTemplate;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.data.mongodb.core.query.Criteria;</span><br><span class="line"><span class="keyword">import</span> org.springframework.data.mongodb.core.query.Query;</span><br><span class="line"><span class="keyword">import</span> org.springframework.data.mongodb.core.query.Update;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> org.springframework.data.mongodb.core.query.Criteria.*;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span> v1.0.0</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@ProjectName</span>: springboot-learning-examples</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@ClassName</span>: UserPerpositoryImpl</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Author</span>: 三月三</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserPerpositoryImpl</span> <span class="keyword">implements</span> <span class="title">UserRepository</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> MongoTemplate mongoTemplate;</span><br><span class="line"></span><br><span class="line">   <span class="comment">/**</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@author</span>: 三月三</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@description</span>: 保存</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@param</span>: [user]</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@return</span>: void</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">saveUser</span><span class="params">(User user)</span> </span>&#123;</span><br><span class="line">        mongoTemplate.insert(user);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@author</span>: 三月三</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@description</span>: 查找所有文档</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span>: []</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span>: void</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testFindAll</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        List&lt;User&gt; all = mongoTemplate.findAll(User<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">        all.forEach(System.out::println);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@author</span>: 三月三</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@description</span>: 根据名字查找</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span>: [userName]</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span>: cn.zysheep.springboot.entity.User</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> User <span class="title">findUserByUserName</span><span class="params">(String userName)</span> </span>&#123;</span><br><span class="line">        Query query=<span class="keyword">new</span> Query(Criteria.where(<span class="string">"userName"</span>).is(userName));</span><br><span class="line">        User user =  mongoTemplate.findOne(query , User<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">        <span class="keyword">return</span> user;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@author</span>: 三月三</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@description</span>: 修改文档记录</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span>: [user]</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span>: long</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">long</span> <span class="title">updateUser</span><span class="params">(User user)</span> </span>&#123;</span><br><span class="line">        Query query=<span class="keyword">new</span> Query(Criteria.where(<span class="string">"id"</span>).is(user.getId()));</span><br><span class="line">        Update update= <span class="keyword">new</span> Update().set(<span class="string">"userName"</span>, user.getUserName()).set(<span class="string">"passWord"</span>, user.getPassWord());</span><br><span class="line">        <span class="comment">//更新查询返回结果集的第一条</span></span><br><span class="line">        UpdateResult result =mongoTemplate.updateFirst(query,update,User<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">        <span class="comment">//更新查询返回结果集的所有</span></span><br><span class="line">        <span class="comment">// mongoTemplate.updateMulti(query,update,UserEntity.class);</span></span><br><span class="line">        <span class="keyword">if</span>(result!=<span class="keyword">null</span>)</span><br><span class="line">            <span class="keyword">return</span> result.getMatchedCount();</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@author</span>: 三月三</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@description</span>: 根据id删除文档记录</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span>: [id]</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span>: void</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">deleteUserById</span><span class="params">(Long id)</span> </span>&#123;</span><br><span class="line">        Query query=<span class="keyword">new</span> Query(Criteria.where(<span class="string">"id"</span>).is(id));</span><br><span class="line">        mongoTemplate.remove(query,User<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>为了方便测试,封装了MongodbUtils</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br></pre></td><td class="code"><pre><span class="line">package cn.zysheep.springboot.utils;</span><br><span class="line"></span><br><span class="line">import java.util.ArrayList;</span><br><span class="line">import java.util.List;</span><br><span class="line">import java.util.Map;</span><br><span class="line">import java.util.regex.Pattern;</span><br><span class="line">import javax.annotation.PostConstruct;</span><br><span class="line"></span><br><span class="line">import cn.zysheep.springboot.entity.User;</span><br><span class="line">import org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line">import org.springframework.data.domain.Sort;</span><br><span class="line">import org.springframework.data.mongodb.core.MongoTemplate;</span><br><span class="line">import org.springframework.data.mongodb.core.aggregation.Aggregation;</span><br><span class="line">import org.springframework.data.mongodb.core.aggregation.GroupOperation;</span><br><span class="line">import org.springframework.data.mongodb.core.aggregation.MatchOperation;</span><br><span class="line">import org.springframework.data.mongodb.core.index.Index;</span><br><span class="line">import org.springframework.data.mongodb.core.query.Criteria;</span><br><span class="line">import org.springframework.data.mongodb.core.query.Query;</span><br><span class="line">import org.springframework.data.mongodb.core.query.Update;</span><br><span class="line">import org.springframework.stereotype.Component;</span><br><span class="line">import org.springframework.util.StringUtils;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#x2F;**</span><br><span class="line"> * @version v1.0.0</span><br><span class="line"> * @ProjectName: springboot-learning-examples</span><br><span class="line"> * @ClassName: MongodbUtils</span><br><span class="line"> * @Author: 三月三</span><br><span class="line"> *&#x2F;</span><br><span class="line"></span><br><span class="line">@Component</span><br><span class="line">public class MongodbUtils &#123;</span><br><span class="line"></span><br><span class="line">    public static MongodbUtils mongodbUtil;</span><br><span class="line"></span><br><span class="line">    @PostConstruct</span><br><span class="line">    public void init() &#123;</span><br><span class="line">        mongodbUtil &#x3D; this;</span><br><span class="line">        mongodbUtil.mongoTemplate &#x3D; this.mongoTemplate;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Autowired</span><br><span class="line">    private MongoTemplate mongoTemplate;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &#x2F;**</span><br><span class="line">     * 保存对象List到指定集合中</span><br><span class="line">     * &lt;p&gt;</span><br><span class="line">     * 也可以在实体类上使用@Document(collection&#x3D;“集合名称”)指定集合名称，未指定则默认实体类的类名为集合名称</span><br><span class="line">     *</span><br><span class="line">     * @param entiys</span><br><span class="line">     *&#x2F;</span><br><span class="line">    public static void saveAll(String collName, List&lt;?&gt; entiys) &#123;</span><br><span class="line">        for (Object entiy : entiys) &#123;</span><br><span class="line">            saveData(collName, entiy);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &#x2F;**</span><br><span class="line">     * 保存单个对象到指定集合中</span><br><span class="line">     *</span><br><span class="line">     * @param collName 集合名称</span><br><span class="line">     * @param entiy    实体名称</span><br><span class="line">     *&#x2F;</span><br><span class="line">    public static void saveOne(String collName, Object entiy) &#123;</span><br><span class="line">        saveData(collName, entiy);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    &#x2F;**</span><br><span class="line">     * 根据id倒序查询 集合中的数据</span><br><span class="line">     *</span><br><span class="line">     * @param entiy     数据实体</span><br><span class="line">     * @param collName  集合名称</span><br><span class="line">     * @param direction 倒序&#x2F;正序 Direction.DESC&#x2F;ASC</span><br><span class="line">     * @param</span><br><span class="line">     *&#x2F;</span><br><span class="line">    public static Object findSortById(Class&lt;?&gt; entiy, String collName, Sort.Direction direction) &#123;</span><br><span class="line">        Query query &#x3D; new Query().with(Sort.by(direction, &quot;id&quot;));</span><br><span class="line">        return mongodbUtil.mongoTemplate.find(query, entiy, collName);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    &#x2F;**</span><br><span class="line">     * 查询返回指定字段</span><br><span class="line">     *</span><br><span class="line">     * @param fields   需要返回的指定字段</span><br><span class="line">     * @param clazz    数据实体类class</span><br><span class="line">     * @param collName 集合名称</span><br><span class="line">     * @param map      Map&lt;查询条件key,查询条件value&gt;</span><br><span class="line">     *                 &lt;p&gt;</span><br><span class="line">     *                 返回字段的时候id默认为返回，不返回id则field设置  fieldObj.put(&quot;id&quot;,false)</span><br><span class="line">     * @return</span><br><span class="line">     *&#x2F;</span><br><span class="line">    public static Object findDesignField(List&lt;String&gt; fields, Map&lt;String, Object&gt; map, Class&lt;?&gt; clazz, String collName, boolean returnId) &#123;</span><br><span class="line">        Criteria criteria &#x3D; null;</span><br><span class="line">        if (map.containsKey(null)) &#123;</span><br><span class="line">            return &quot;查询条件key不能为Null~&quot;;</span><br><span class="line">        &#125;</span><br><span class="line">        for (String key : map.keySet()) &#123;</span><br><span class="line">            criteria &#x3D; Criteria.where(key).is(map.get(key));</span><br><span class="line">        &#125;</span><br><span class="line">        Query query &#x3D; new Query(criteria);</span><br><span class="line">        for (String field : fields) &#123;</span><br><span class="line">            query.fields().include(field);</span><br><span class="line">        &#125;</span><br><span class="line">        if (!returnId) &#123;</span><br><span class="line">            query.fields().exclude(&quot;id&quot;);</span><br><span class="line">        &#125;</span><br><span class="line">        return mongodbUtil.mongoTemplate.find(query, clazz, collName);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &#x2F;**</span><br><span class="line">     * 查询指定集合中的所有数据</span><br><span class="line">     *</span><br><span class="line">     * @param entiy    数据实体类</span><br><span class="line">     * @param collName 集合名称</span><br><span class="line">     *&#x2F;</span><br><span class="line">    public static Object findAll(Class&lt;?&gt; entiy, String collName) &#123;</span><br><span class="line">        return mongodbUtil.mongoTemplate.findAll(entiy, collName);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    &#x2F;**</span><br><span class="line">     * 模糊查询 根据 key 可以到 collName 中进行模糊查询 并排序</span><br><span class="line">     *</span><br><span class="line">     * @param param     匹配的参数</span><br><span class="line">     * @param collName  集合名称</span><br><span class="line">     * @param direction Direction.desc &#x2F;asc 倒序&#x2F;正序</span><br><span class="line">     * @param sortField 排序字段</span><br><span class="line">     * @return</span><br><span class="line">     *&#x2F;</span><br><span class="line">    public static Object findLikeByParam(String param, String collName, String sortField, Sort.Direction direction,Class&lt;?&gt; entiy) &#123;</span><br><span class="line">        Pattern pattern &#x3D; Pattern.compile(&quot;^.*&quot; + param + &quot;.*$&quot;, Pattern.CASE_INSENSITIVE);</span><br><span class="line">        Query query &#x3D; new Query(Criteria.where(&quot;name&quot;).regex(pattern)).with(Sort.by(direction, sortField));</span><br><span class="line">        return mongodbUtil.mongoTemplate.find(query, entiy, collName);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    &#x2F;**</span><br><span class="line">     * 向指定集合设置索引</span><br><span class="line">     *</span><br><span class="line">     * @param collName  集合名称</span><br><span class="line">     * @param indexName 索引名称</span><br><span class="line">     * @param map       map.put(&quot;添加索引的字段&quot;,Direction.ASC&#x2F;DESC)</span><br><span class="line">     *&#x2F;</span><br><span class="line">    public static void createIndex(String collName, String indexName, Map&lt;String, Sort.Direction&gt; map) throws Exception &#123;</span><br><span class="line">        if (map.containsKey(null)) &#123;</span><br><span class="line">            throw new Exception(&quot;添加索引的字段不能为null&quot;);</span><br><span class="line">        &#125;</span><br><span class="line">        Index index &#x3D; new Index().named(indexName);</span><br><span class="line">        for (String key : map.keySet()) &#123;</span><br><span class="line">            index.on(key, map.get(key));</span><br><span class="line">        &#125;</span><br><span class="line">        mongodbUtil.mongoTemplate.indexOps(collName).ensureIndex(index);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    &#x2F;**</span><br><span class="line">     * 获取指定集合中的索引信息</span><br><span class="line">     *</span><br><span class="line">     * @param collName 集合名称</span><br><span class="line">     * @return</span><br><span class="line">     *&#x2F;</span><br><span class="line">    public static Object getIndexInfo(String collName) &#123;</span><br><span class="line">        return mongodbUtil.mongoTemplate.indexOps(collName).getIndexInfo();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &#x2F;**</span><br><span class="line">     * 根据索引名称删除索引</span><br><span class="line">     *</span><br><span class="line">     * @param indexName 索引名称</span><br><span class="line">     * @param collName  集合名称</span><br><span class="line">     *&#x2F;</span><br><span class="line">    public static void removeIndexByName(String collName, String indexName) &#123;</span><br><span class="line">        mongodbUtil.mongoTemplate.indexOps(collName).dropIndex(indexName);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &#x2F;**</span><br><span class="line">     * 删除指定集合中得所有索引</span><br><span class="line">     *</span><br><span class="line">     * @param collName 集合名称</span><br><span class="line">     *&#x2F;</span><br><span class="line">    public static void removeIndexByName(String collName) &#123;</span><br><span class="line">        mongodbUtil.mongoTemplate.indexOps(collName).dropAllIndexes();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    &#x2F;**</span><br><span class="line">     * 根据指定key 和value到指定collName集合中删除数据</span><br><span class="line">     *</span><br><span class="line">     * @param key</span><br><span class="line">     * @param value</span><br><span class="line">     * @param collName</span><br><span class="line">     *&#x2F;</span><br><span class="line">    public static void removeAllByParam(String key, String value, String collName) &#123;</span><br><span class="line">        Criteria criteria &#x3D; Criteria.where(key).is(value);</span><br><span class="line">        Query query &#x3D; Query.query(criteria);</span><br><span class="line">        mongodbUtil.mongoTemplate.remove(query, collName);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &#x2F;**</span><br><span class="line">     * 根据指定条件查询 并排序</span><br><span class="line">     *</span><br><span class="line">     * @param obj      数据对象</span><br><span class="line">     * @param map      Map&lt;&quot;查询条件key&quot;，查询条件值&gt; map</span><br><span class="line">     * @param collName 集合名称</span><br><span class="line">     * @return</span><br><span class="line">     *&#x2F;</span><br><span class="line">    public static List&lt;? extends Object&gt; findSortByParam(Object obj, String collName, Map&lt;String, Object&gt; map, String sortField, Sort.Direction direction) &#123;</span><br><span class="line">        if (map.containsKey(null)) &#123;</span><br><span class="line">            return new ArrayList&lt;&gt;();</span><br><span class="line">        &#125;</span><br><span class="line">        Criteria criteria &#x3D; null;</span><br><span class="line">        criteria &#x3D; getCriteria(criteria, map);</span><br><span class="line">        if (criteria &#x3D;&#x3D; null) &#123;</span><br><span class="line">            return new ArrayList&lt;&gt;();</span><br><span class="line">        &#125;</span><br><span class="line">        Query query &#x3D; Query.query(criteria).with(Sort.by(direction, sortField));</span><br><span class="line">        return mongodbUtil.mongoTemplate.find(query, obj.getClass(), collName);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &#x2F;**</span><br><span class="line">     * 范围查询</span><br><span class="line">     * &lt;p&gt;</span><br><span class="line">     * 查询大于等于begin  小于等于end范围内条件匹配得数据并排序</span><br><span class="line">     *</span><br><span class="line">     * @param obj           数据对象</span><br><span class="line">     * @param collName      集合名称</span><br><span class="line">     * @param map           Map&lt;&quot;查询条件key&quot;，查询条件值&gt; map</span><br><span class="line">     * @param sortField     排序字段</span><br><span class="line">     * @param direction     排序方式  Direction.asc   &#x2F; Direction.desc</span><br><span class="line">     * @param rangeCriteria 示例： lt小于  lte 小于等于  gt大于  gte大于等于 eq等于 ne不等于</span><br><span class="line">     *                      &lt;p&gt;</span><br><span class="line">     *                      Criteria rangeCriteria&#x3D;Criteria.where(&quot;createDate&quot;).gte(begin).lte(end));</span><br><span class="line">     *                      &lt;p&gt;</span><br><span class="line">     *                      createDate:数据库中的时间字段，gegin:起始时间  end:结束时间</span><br><span class="line">     * @return</span><br><span class="line">     *&#x2F;</span><br><span class="line">    public static List&lt;? extends Object&gt; findRangeByParam(Object obj, String collName, Map&lt;String, Object&gt; map,</span><br><span class="line">                                                          String sortField, Sort.Direction direction, Criteria rangeCriteria) &#123;</span><br><span class="line">        if (map.containsKey(null)) &#123;</span><br><span class="line">            return new ArrayList&lt;&gt;();</span><br><span class="line">        &#125;</span><br><span class="line">        Criteria criteria &#x3D; null;</span><br><span class="line">        criteria &#x3D; getCriteria(criteria, map);</span><br><span class="line">        if (criteria &#x3D;&#x3D; null) &#123;</span><br><span class="line">            return new ArrayList&lt;&gt;();</span><br><span class="line">        &#125;</span><br><span class="line">        Query query &#x3D; new Query().addCriteria(rangeCriteria).addCriteria(criteria).with(Sort.by(direction, sortField));</span><br><span class="line">        return mongodbUtil.mongoTemplate.find(query, obj.getClass(), collName);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &#x2F;**</span><br><span class="line">     * 根据指定key value到指定集合中查询匹配得数量</span><br><span class="line">     *</span><br><span class="line">     * @param collName</span><br><span class="line">     * @param key</span><br><span class="line">     * @param value</span><br><span class="line">     * @return</span><br><span class="line">     *&#x2F;</span><br><span class="line">    public static long count(String collName, String key, String value) &#123;</span><br><span class="line">        Query query &#x3D; Query.query(Criteria.where(key).is(value));</span><br><span class="line">        return mongodbUtil.mongoTemplate.count(query, &quot;goods&quot;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &#x2F;**</span><br><span class="line">     * 在指定范围内查询匹配条件的数量</span><br><span class="line">     *</span><br><span class="line">     * @param clazz         数据实体类</span><br><span class="line">     * @param collName      集合名称</span><br><span class="line">     * @param map           查询条件map</span><br><span class="line">     * @param rangeCriteria 范围条件  Criteria rangeCriteria&#x3D; Criteria.where(&quot;数据库字段&quot;).gt&#x2F;gte（起始范围）.lt&#x2F;lte（结束范围）</span><br><span class="line">     * @return</span><br><span class="line">     *&#x2F;</span><br><span class="line">    public static Long countRangeCondition(Class&lt;?&gt; clazz, String collName, Criteria rangeCriteria, Map&lt;String, Object&gt; map) &#123;</span><br><span class="line">        Criteria criteria &#x3D; null;</span><br><span class="line">        if (map.containsKey(null)) &#123;</span><br><span class="line">            return null;</span><br><span class="line">        &#125;</span><br><span class="line">        for (String key : map.keySet()) &#123;</span><br><span class="line">            criteria &#x3D; Criteria.where(key).is(map.get(key));</span><br><span class="line">        &#125;</span><br><span class="line">        Query query &#x3D; new Query();</span><br><span class="line">        if (criteria !&#x3D; null) &#123;</span><br><span class="line">            query.addCriteria(criteria);</span><br><span class="line">        &#125;</span><br><span class="line">        query.addCriteria(rangeCriteria);</span><br><span class="line">        return mongodbUtil.mongoTemplate.count(query, clazz, collName);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &#x2F;**</span><br><span class="line">     * 指定集合 根据条件查询出符合的第一条数据</span><br><span class="line">     *</span><br><span class="line">     * @param entiy          数据对象</span><br><span class="line">     * @param map            条件map  Map&lt;条件key,条件value&gt; map</span><br><span class="line">     * @param collectionName 集合名</span><br><span class="line">     * @return</span><br><span class="line">     *&#x2F;</span><br><span class="line">    public static Object findSortFirst(Class&lt;?&gt; entiy, Map&lt;String, Object&gt; map, String collectionName, String field, Sort.Direction direction) &#123;</span><br><span class="line">        if (map.containsKey(null)) &#123;</span><br><span class="line">            return &quot;查询条件不能为null~&quot;;</span><br><span class="line">        &#125;</span><br><span class="line">        Criteria criteria &#x3D; null;</span><br><span class="line">        criteria &#x3D; getCriteria(criteria, map);</span><br><span class="line">        Query query &#x3D; Query.query(criteria).with(Sort.by(direction, field));</span><br><span class="line">        return mongodbUtil.mongoTemplate.findOne(query, entiy, collectionName);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    &#x2F;**</span><br><span class="line">     * 指定集合 修改数据，且修改所找到的所有数据</span><br><span class="line">     *</span><br><span class="line">     * @param accordingKey   修改条件 key</span><br><span class="line">     * @param accordingValue 修改条件 value</span><br><span class="line">     * @param map            Map&lt;修改内容 key数组,修改内容 value数组&gt;</span><br><span class="line">     * @param collName       集合名</span><br><span class="line">     * @param type           修改操作类型  1:修改第一条数据  0：修改所有匹配得数据</span><br><span class="line">     *&#x2F;</span><br><span class="line">    public static void updateMulti(String accordingKey, Object accordingValue, Map&lt;String, Object&gt; map,</span><br><span class="line">                                   String collName, Integer type) &#123;</span><br><span class="line">        if (map.containsKey(null)) &#123;</span><br><span class="line">            return;</span><br><span class="line">        &#125;</span><br><span class="line">        Criteria criteria &#x3D; Criteria.where(accordingKey).is(accordingValue);</span><br><span class="line">        Query query &#x3D; Query.query(criteria);</span><br><span class="line">        Update update &#x3D; new Update();</span><br><span class="line"></span><br><span class="line">        for (String key : map.keySet()) &#123;</span><br><span class="line">            update.set(key, map.get(key));</span><br><span class="line">        &#125;</span><br><span class="line">        if (type &#x3D;&#x3D; 1) &#123;</span><br><span class="line">            mongodbUtil.mongoTemplate.updateFirst(query, update, collName);</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">            mongodbUtil.mongoTemplate.updateMulti(query, update, collName);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    &#x2F;**</span><br><span class="line">     * 对某字段做sum求和</span><br><span class="line">     *</span><br><span class="line">     * @param clazz         数据实体类</span><br><span class="line">     * @param map           Map&lt;查询条件key,查询条件value&gt; map</span><br><span class="line">     * @param collName      集合名称</span><br><span class="line">     * @param sumField      求和字段</span><br><span class="line">     * @param rangeCriteria 范围条件</span><br><span class="line">     * @return Criteria rangeCriteria &#x3D; Criteria.where(字段).gt(起始范围).lt(结束范围)</span><br><span class="line">     *&#x2F;</span><br><span class="line">    public static Object findSum(Class&lt;?&gt; clazz, Map&lt;String, Object&gt; map, String collName, String sumField, Criteria rangeCriteria) &#123;</span><br><span class="line">        if (map.containsKey(null)) &#123;</span><br><span class="line">            return &quot;查询条件key不能为Null&quot;;</span><br><span class="line">        &#125;</span><br><span class="line">        Criteria criteria &#x3D; null;</span><br><span class="line">        MatchOperation match &#x3D; null;</span><br><span class="line">        for (String key : map.keySet()) &#123;</span><br><span class="line">            criteria &#x3D; Criteria.where(key).is(map.get(key));</span><br><span class="line">        &#125;</span><br><span class="line">        if (criteria !&#x3D; null) &#123;</span><br><span class="line">            match &#x3D; Aggregation.match(criteria);</span><br><span class="line">        &#125;</span><br><span class="line">        GroupOperation count &#x3D; Aggregation.group().sum(sumField).as(sumField);</span><br><span class="line">        return mongodbUtil.mongoTemplate.aggregate(Aggregation.newAggregation(match, count), collName, clazz).getMappedResults();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    &#x2F;**</span><br><span class="line">     * 分页查询</span><br><span class="line">     *</span><br><span class="line">     * @param entiy     数据实体类</span><br><span class="line">     * @param collName  集合名称</span><br><span class="line">     * @param map       Map&lt;&quot;查询条件key&quot;，查询条件值&gt; map 若 keys&#x2F;values 为null,则查询集合中所有数据</span><br><span class="line">     * @param pageNo    当前页</span><br><span class="line">     * @param pageSize  当前页数据条数</span><br><span class="line">     * @param direction Direction.Desc&#x2F;ASC 排序方式</span><br><span class="line">     * @param sortField 排序字段</span><br><span class="line">     * @return</span><br><span class="line">     *&#x2F;</span><br><span class="line">    public static PageModel findSortPageCondition(Class&lt;?&gt; entiy, String collName, Map&lt;String, Object&gt; map,</span><br><span class="line">                                                  int pageNo, int pageSize, Sort.Direction direction, String sortField) &#123;</span><br><span class="line"></span><br><span class="line">        Criteria criteria &#x3D; getCriteria(new Criteria(), map);</span><br><span class="line"></span><br><span class="line">        long count;</span><br><span class="line"></span><br><span class="line">        if (criteria &#x3D;&#x3D; null) &#123;</span><br><span class="line">            count &#x3D; mongodbUtil.mongoTemplate.count(new Query(), entiy, collName);</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">            count &#x3D; mongodbUtil.mongoTemplate.count(new Query(criteria), entiy, collName);</span><br><span class="line">        &#125;</span><br><span class="line">        int pages &#x3D; (int) Math.ceil((double) count &#x2F; (double) pageSize);</span><br><span class="line">        if (pageNo &lt;&#x3D; 0 || pageNo &gt; pages) &#123;</span><br><span class="line">            pageNo &#x3D; 1;</span><br><span class="line">        &#125;</span><br><span class="line">        int skip &#x3D; pageSize * (pageNo - 1);</span><br><span class="line">        Query query &#x3D; new Query().skip(skip).limit(pageSize);</span><br><span class="line">        query.with(Sort.by(direction, sortField));</span><br><span class="line">        if (criteria !&#x3D; null) &#123;</span><br><span class="line">            query.addCriteria(criteria);</span><br><span class="line">        &#125;</span><br><span class="line">        List&lt;?&gt; list &#x3D; mongodbUtil.mongoTemplate.find(query, entiy, collName);</span><br><span class="line">        PageModel pageModel &#x3D; new PageModel();</span><br><span class="line">        pageModel.setPageNo(pageNo);</span><br><span class="line">        pageModel.setPagesize(pageSize);</span><br><span class="line">        pageModel.setTotal(count);</span><br><span class="line">        pageModel.setPages(pages);</span><br><span class="line">        pageModel.setList(list);</span><br><span class="line">        return pageModel;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    private static void saveData(String collName, Object entiy) &#123;</span><br><span class="line">        if (StringUtils.isEmpty(collName)) &#123;</span><br><span class="line">            mongodbUtil.mongoTemplate.save(entiy);</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">            mongodbUtil.mongoTemplate.save(entiy, collName);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    private static Criteria getCriteria(Criteria criteria, Map&lt;String, Object&gt; map) &#123;</span><br><span class="line">        if (map &#x3D;&#x3D; null) &#123;</span><br><span class="line">            return null;</span><br><span class="line">        &#125;</span><br><span class="line">        int i &#x3D; 0;</span><br><span class="line">        for (String key : map.keySet()) &#123;</span><br><span class="line">            if (i &#x3D;&#x3D; 0) &#123;</span><br><span class="line">                criteria &#x3D; Criteria.where(key).is(map.get(key));</span><br><span class="line">                i++;</span><br><span class="line">            &#125; else &#123;</span><br><span class="line">                criteria.and(key).is(map.get(key));</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        return criteria;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br></pre></td><td class="code"><pre><span class="line">package cn.zysheep.springboot.utils;</span><br><span class="line"></span><br><span class="line">import java.io.Serializable;</span><br><span class="line">import java.util.List;</span><br><span class="line"></span><br><span class="line">&#x2F;**</span><br><span class="line"> * @version v1.0.0</span><br><span class="line"> * @ProjectName: springboot-learning-examples</span><br><span class="line"> * @ClassName: PageModel</span><br><span class="line"> * @Author: 三月三</span><br><span class="line"> *&#x2F;</span><br><span class="line">public class PageModel implements Serializable &#123;</span><br><span class="line">    private static final long serialVersionUID &#x3D; 1L;</span><br><span class="line">    &#x2F;**</span><br><span class="line">     * 当前页</span><br><span class="line">     *&#x2F;</span><br><span class="line">    private Integer pageNo &#x3D; 1;</span><br><span class="line">    &#x2F;**</span><br><span class="line">     * 当前页条数</span><br><span class="line">     *&#x2F;</span><br><span class="line">    private Integer pagesize &#x3D; 10;</span><br><span class="line">    &#x2F;**</span><br><span class="line">     * 总共的条数</span><br><span class="line">     *&#x2F;</span><br><span class="line">    private Long total;</span><br><span class="line">    &#x2F;**</span><br><span class="line">     * 总共的页数</span><br><span class="line">     *&#x2F;</span><br><span class="line">    private Integer pages;</span><br><span class="line">    &#x2F;**</span><br><span class="line">     * 实体类集合</span><br><span class="line">     *&#x2F;</span><br><span class="line">    private List&lt;?&gt; list;</span><br><span class="line"></span><br><span class="line">    public Integer getPageNo() &#123;</span><br><span class="line">        return pageNo;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setPageNo(Integer pageNo) &#123;</span><br><span class="line">        this.pageNo &#x3D; pageNo;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public Integer getPagesize() &#123;</span><br><span class="line">        return pagesize;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setPagesize(Integer pagesize) &#123;</span><br><span class="line">        this.pagesize &#x3D; pagesize;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public Long getTotal() &#123;</span><br><span class="line">        return total;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    &#x2F;**</span><br><span class="line">     * 总数由0开始计数</span><br><span class="line">     * @param total</span><br><span class="line">     *&#x2F;</span><br><span class="line">    public void setTotal(Long total) &#123;</span><br><span class="line">        this.total &#x3D; total + 1;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public Integer getPages() &#123;</span><br><span class="line">        return pages;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setPages(Integer pages) &#123;</span><br><span class="line">        this.pages &#x3D; pages;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public List&lt;?&gt; getList() &#123;</span><br><span class="line">        return list;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setList(List&lt;?&gt; list) &#123;</span><br><span class="line">        this.list &#x3D; list;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public PageModel(Integer pageNo, Integer pagesize, Long total, Integer pages, List&lt;?&gt; list) &#123;</span><br><span class="line">        this.pageNo &#x3D; pageNo;</span><br><span class="line">        this.pagesize &#x3D; pagesize;</span><br><span class="line">        this.total &#x3D; total;</span><br><span class="line">        this.pages &#x3D; pages;</span><br><span class="line">        this.list &#x3D; list;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public PageModel() &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public String toString() &#123;</span><br><span class="line">        return &quot;PageModel&#123;&quot; +</span><br><span class="line">                &quot;pageNo&#x3D;&quot; + pageNo +</span><br><span class="line">                &quot;, pagesize&#x3D;&quot; + pagesize +</span><br><span class="line">                &quot;, total&#x3D;&quot; + total +</span><br><span class="line">                &quot;, pages&#x3D;&quot; + pages +</span><br><span class="line">                &quot;, list&#x3D;&quot; + list +</span><br><span class="line">                &#39;&#125;&#39;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>###测试</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br></pre></td><td class="code"><pre><span class="line">package cn.zysheep.springboot;</span><br><span class="line"></span><br><span class="line">import cn.zysheep.springboot.entity.User;</span><br><span class="line">import cn.zysheep.springboot.repository.UserRepository;</span><br><span class="line">import cn.zysheep.springboot.utils.MongodbUtils;</span><br><span class="line">import org.junit.jupiter.api.Test;</span><br><span class="line">import org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line">import org.springframework.boot.test.context.SpringBootTest;</span><br><span class="line"></span><br><span class="line">import java.util.ArrayList;</span><br><span class="line">import java.util.List;</span><br><span class="line"></span><br><span class="line">@SpringBootTest</span><br><span class="line">class Springboot06DataMongodbApplicationTests &#123;</span><br><span class="line"></span><br><span class="line">    @Autowired</span><br><span class="line">    private UserRepository userRepository;</span><br><span class="line"></span><br><span class="line">    @Autowired</span><br><span class="line">    private MongodbUtils mongodbUtils;</span><br><span class="line"></span><br><span class="line">    &#x2F;&#x2F; 测试添加文档</span><br><span class="line">    @Test</span><br><span class="line">    public void testSaveUser() throws Exception &#123;</span><br><span class="line">        User user&#x3D;new User();</span><br><span class="line">        user.setId(1l);</span><br><span class="line">        user.setUserName(&quot;明世隐&quot;);</span><br><span class="line">        user.setPassWord(&quot;123456&quot;);</span><br><span class="line">        userRepository.saveUser(user);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &#x2F;&#x2F; 测试根据名字查询文档</span><br><span class="line">    @Test</span><br><span class="line">    public void findUserByUserName()&#123;</span><br><span class="line">        User user&#x3D; userRepository.findUserByUserName(&quot;明世隐&quot;);</span><br><span class="line">        System.out.println(&quot;user is &quot;+user);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    &#x2F;&#x2F; 测试修改文档</span><br><span class="line">    @Test</span><br><span class="line">    public void updateUser()&#123;</span><br><span class="line">        User user&#x3D;new User();</span><br><span class="line">        user.setId(2l);</span><br><span class="line">        user.setUserName(&quot;韩信&quot;);</span><br><span class="line">        user.setPassWord(&quot;123456789&quot;);</span><br><span class="line">        userRepository.updateUser(user);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    &#x2F;&#x2F; 测试删除</span><br><span class="line">    @Test</span><br><span class="line">    public void deleteUserById()&#123;</span><br><span class="line">        userRepository.deleteUserById(1l);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    @Test</span><br><span class="line">    void test1()&#123;</span><br><span class="line">        List&lt;User&gt; user &#x3D; (List&lt;User&gt;)MongodbUtils.findAll(User.class, &quot;user&quot;);</span><br><span class="line">        user.forEach(System.out::println);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    @Test</span><br><span class="line">    void test2()&#123;</span><br><span class="line">        MongodbUtils.saveOne(&quot;user&quot;,new User(5L,&quot;干将莫邪&quot;,&quot;123123&quot;));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    @Test</span><br><span class="line">    void test3()&#123;</span><br><span class="line">        ArrayList&lt;User&gt; list &#x3D; new ArrayList&lt;&gt;();</span><br><span class="line"></span><br><span class="line">        list.add(new User(6L,&quot;荆轲&quot;,&quot;123123&quot;));</span><br><span class="line">        list.add(new User(7L,&quot;赵云&quot;,&quot;12312&quot;));</span><br><span class="line">        list.add(new User(8L,&quot;公孙离&quot;,&quot;asdfasdf&quot;));</span><br><span class="line">        list.add(new User(9L,&quot;伽罗&quot;,&quot;hdfgsdfg&quot;));</span><br><span class="line"></span><br><span class="line">        MongodbUtils.saveAll(&quot;user&quot;,list);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="多数据源-MongoDB-的使用"><a href="#多数据源-MongoDB-的使用" class="headerlink" title="多数据源 MongoDB 的使用"></a>多数据源 MongoDB 的使用</h1><h2 id="pom"><a href="#pom" class="headerlink" title="pom"></a>pom</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;org.springframework.boot&lt;&#x2F;groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;spring-boot-starter-data-mongodb&lt;&#x2F;artifactId&gt;</span><br><span class="line">&lt;&#x2F;dependency&gt;</span><br></pre></td></tr></table></figure>

<h2 id="yml"><a href="#yml" class="headerlink" title="yml"></a>yml</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">spring:</span><br><span class="line">  data:</span><br><span class="line">    mongodb:</span><br><span class="line">      host1: 172.16.0.192</span><br><span class="line">      host2: 172.16.0.192</span><br><span class="line">    dbName:</span><br><span class="line">      primaryDb: primary</span><br><span class="line">      secondaryDb: secondary</span><br></pre></td></tr></table></figure>

<h2 id="MongoConfig"><a href="#MongoConfig" class="headerlink" title="MongoConfig"></a>MongoConfig</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line">package cn.zysheep.springboot.config;</span><br><span class="line"></span><br><span class="line">import com.mongodb.MongoClient;</span><br><span class="line">import org.springframework.beans.factory.annotation.Value;</span><br><span class="line">import org.springframework.context.annotation.Bean;</span><br><span class="line">import org.springframework.context.annotation.Configuration;</span><br><span class="line">import org.springframework.context.annotation.Primary;</span><br><span class="line">import org.springframework.data.mongodb.core.MongoTemplate;</span><br><span class="line">import org.springframework.data.mongodb.core.SimpleMongoDbFactory;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#x2F;**</span><br><span class="line"> * @version v1.0.0</span><br><span class="line"> * @ProjectName: springboot-learning-examples</span><br><span class="line"> * @ClassName: MongoConfig</span><br><span class="line"> * @Author: 三月三</span><br><span class="line"> *&#x2F;</span><br><span class="line">@Configuration</span><br><span class="line">public class MongoConfig &#123;</span><br><span class="line">    &#x2F;&#x2F;读取配置文件里的值，部署后IP或者数据库名变化，不需重新打包</span><br><span class="line">    @Value(&quot;$&#123;spring.data.mongodb.host1&#125;&quot;)</span><br><span class="line">    private String mongohost1;</span><br><span class="line">    @Value(&quot;$&#123;spring.data.mongodb.host2&#125;&quot;)</span><br><span class="line">    private String mongohost2;</span><br><span class="line">    @Value(&quot;$&#123;spring.data.dbName.primaryDb&#125;&quot;)</span><br><span class="line">    private String primaryDb;</span><br><span class="line">    @Value(&quot;$&#123;spring.data.dbName.secondaryDb&#125;&quot;)</span><br><span class="line">    private String secondaryDb;</span><br><span class="line">    @Bean</span><br><span class="line">    @Primary</span><br><span class="line">    public MongoClient mongoClient() &#123;</span><br><span class="line">        return new MongoClient(mongohost1);</span><br><span class="line">    &#125;</span><br><span class="line">    @Bean</span><br><span class="line">    public  MongoClient mongoClient2() &#123;</span><br><span class="line">        return new MongoClient(mongohost2);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Bean</span><br><span class="line">    @Primary</span><br><span class="line">    public   MongoTemplate primaryMongoTemplate() &#123;</span><br><span class="line">        return new MongoTemplate(mongoClient(), primaryDb);</span><br><span class="line">    &#125;</span><br><span class="line">    @Bean</span><br><span class="line">    public   MongoTemplate secondaryMongoTemplate() &#123;</span><br><span class="line">        return  new MongoTemplate(new SimpleMongoDbFactory(mongoClient(), secondaryDb));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="Person"><a href="#Person" class="headerlink" title="Person"></a>Person</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">package cn.zysheep.springboot.entity;</span><br><span class="line"></span><br><span class="line">import lombok.Data;</span><br><span class="line">import org.springframework.stereotype.Component;</span><br><span class="line"></span><br><span class="line">&#x2F;**</span><br><span class="line"> * @version v1.0.0</span><br><span class="line"> * @ProjectName: springboot-learning-examples</span><br><span class="line"> * @ClassName: Person</span><br><span class="line"> * @Author: 三月三</span><br><span class="line"> *&#x2F;</span><br><span class="line"></span><br><span class="line">@Component</span><br><span class="line">@Data</span><br><span class="line">public class Person &#123;</span><br><span class="line">    private String id;</span><br><span class="line">    private String name;</span><br><span class="line">    private int age;</span><br><span class="line"></span><br><span class="line">    public Person() &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public Person(String id, String name, int age) &#123;</span><br><span class="line">        this.id &#x3D; id;</span><br><span class="line">        this.name &#x3D; name;</span><br><span class="line">        this.age &#x3D; age;</span><br><span class="line">    &#125;</span><br><span class="line">    @Override</span><br><span class="line">    public String toString() &#123;</span><br><span class="line">        return &quot;Person&#123;&quot; +</span><br><span class="line">                &quot;id&#x3D;&#39;&quot; + id + &#39;\&#39;&#39; +</span><br><span class="line">                &quot;, name&#x3D;&#39;&quot; + name + &#39;\&#39;&#39; +</span><br><span class="line">                &quot;, age&#x3D;&quot; + age +</span><br><span class="line">                &#39;&#125;&#39;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="测试"><a href="#测试" class="headerlink" title="测试"></a>测试</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">package cn.zysheep.springboot;</span><br><span class="line">import cn.zysheep.springboot.entity.Person;</span><br><span class="line">import org.junit.jupiter.api.Test;</span><br><span class="line">import org.springframework.boot.test.context.SpringBootTest;</span><br><span class="line">import org.springframework.data.mongodb.core.MongoTemplate;</span><br><span class="line">import org.springframework.data.mongodb.core.query.Criteria;</span><br><span class="line">import org.springframework.data.mongodb.core.query.Query;</span><br><span class="line">import javax.annotation.Resource;</span><br><span class="line"></span><br><span class="line">@SpringBootTest</span><br><span class="line">class Springboot06DataMultiMongodb22XApplicationTests &#123;</span><br><span class="line">    &#x2F;&#x2F;这里用Resource，没有用Autoware</span><br><span class="line">    @Resource</span><br><span class="line">    private MongoTemplate primaryMongoTemplate;</span><br><span class="line">    @Resource</span><br><span class="line">    private MongoTemplate secondaryMongoTemplate;</span><br><span class="line"></span><br><span class="line">   &#x2F;&#x2F;右键运行，看看两个库是否同时插入了数据</span><br><span class="line">    @Test</span><br><span class="line">    public void insert()&#123;</span><br><span class="line">        Person p&#x3D;new Person(&quot;001&quot;,&quot;tom&quot;,88);</span><br><span class="line">        primaryMongoTemplate.insert(p);</span><br><span class="line">        Person p2&#x3D;new Person(&quot;N0012&quot;,&quot;zhangsan&quot;,14);</span><br><span class="line">        secondaryMongoTemplate.insert(p2);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Test</span><br><span class="line">    public void queryon()&#123;</span><br><span class="line">        Person qp &#x3D; primaryMongoTemplate.findOne(new Query(new Criteria(&quot;name&quot;).is(&quot;tom&quot;)), Person.class);</span><br><span class="line">        System.out.println(qp);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Test</span><br><span class="line">    public void getOne()&#123;</span><br><span class="line">        &#x2F;&#x2F;不指定数据集，根据实体类的类名获取数据集。 这里Person也会被当作collectionName</span><br><span class="line">        Person zz &#x3D; primaryMongoTemplate.findOne(new Query(new Criteria(&quot;name&quot;).is(&quot;tom&quot;)), Person.class);</span><br><span class="line">        &#x2F;&#x2F;指定数据集   同一个数据库下，建了一个user集合，跟person结构相同，这时就要指定了</span><br><span class="line">        Person one &#x3D; primaryMongoTemplate.findOne(new Query(new Criteria(&quot;name&quot;).is(&quot;tom&quot;)), Person.class,&quot;primary&quot;);</span><br><span class="line">        System.out.println(one);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>





</div><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="mailto:undefined">三月三</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="https://zysheep.cn/2020/03/03/Spring/Spring%20Boot%202.2.2/SpringBoot-MongoDB/">https://zysheep.cn/2020/03/03/Spring/Spring Boot 2.2.2/SpringBoot-MongoDB/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://zysheep.cn" target="_blank">三月三</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/Spring/">Spring</a><a class="post-meta__tags" href="/tags/Spring-Boot2-2-2/">Spring Boot2.2.2</a></div><div class="post_share"><div class="social-share" data-image="http://cdn.panyucable.cn/zysheep/wallhaven-n673pw.png" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css"/><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js"></script></div></div><div class="post-reward"><a class="reward-button button--primary button--animated"> <i class="fa fa-qrcode"></i> 打赏<div class="reward-main"><ul class="reward-all"><li class="reward-item"><img class="post-qr-code__img" src="https://cdn.jsdelivr.net/gh/zysheep/picgo-imgs/imgwechat.png" alt="微信"/><div class="post-qr-code__desc">微信</div></li><li class="reward-item"><img class="post-qr-code__img" src="https://cdn.jsdelivr.net/gh/zysheep/picgo-imgs/imgalipay.jpg" alt="支付寶"/><div class="post-qr-code__desc">支付寶</div></li></ul></div></a></div><nav class="pagination_post" id="pagination"><div class="prev-post pull_left"><a href="/2020/03/03/Spring/Spring%20Boot%202.2.2/SpringBoot-Jpa/"><img class="prev_cover" src="http://cdn.panyucable.cn/zysheep/springboot_cover_JPA_1.png" onerror="onerror=null;src='/img/404.jpg'"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">SpringBoot整合JPA</div></div></a></div><div class="next-post pull_right"><a href="/2020/03/03/Spring/Spring%20Boot%202.2.2/SpringBoot-Mybatis-xml/"><img class="next_cover" src="http://cdn.panyucable.cn/zysheep/springboot_cover_mybaits.png" onerror="onerror=null;src='/img/404.jpg'"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">SpringBoot整合Mybatis-XML版</div></div></a></div></nav><div class="relatedPosts"><div class="relatedPosts_headline"><i class="fa fa-fw fa-thumbs-up" aria-hidden="true"></i><span> 相关推荐</span></div><div class="relatedPosts_list"><div class="relatedPosts_item"><a href="/2020/04/08/Spring/SpringBoot后端接口规范/" title="SpringBoot后端接口规范"><img class="relatedPosts_cover" src="http://cdn.panyucable.cn/zysheep/spring-framework-logo.png"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="fa fa-calendar fa-fw" aria-hidden="true"></i> 2020-04-08</div><div class="relatedPosts_title">SpringBoot后端接口规范</div></div></a></div><div class="relatedPosts_item"><a href="/2020/04/01/Spring/Spring Boot 2.2.2/SpringBoot-h2/" title="SpringBoot整合H2"><img class="relatedPosts_cover" src="http://cdn.panyucable.cn/zysheep/1652x1101.jfif"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="fa fa-calendar fa-fw" aria-hidden="true"></i> 2020-04-01</div><div class="relatedPosts_title">SpringBoot整合H2</div></div></a></div><div class="relatedPosts_item"><a href="/2020/03/05/Spring/Spring Boot 2.2.2/SpringBoot与nacos/" title="Spring Boot与Nacos"><img class="relatedPosts_cover" src="http://cdn.panyucable.cn/zysheep/springboot_cover_nacos.png"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="fa fa-calendar fa-fw" aria-hidden="true"></i> 2020-03-05</div><div class="relatedPosts_title">Spring Boot与Nacos</div></div></a></div><div class="relatedPosts_item"><a href="/2020/03/03/Spring/Spring Boot 2.2.2/SpringBoot-Jpa/" title="SpringBoot整合JPA"><img class="relatedPosts_cover" src="http://cdn.panyucable.cn/zysheep/springboot_cover_JPA_1.png"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="fa fa-calendar fa-fw" aria-hidden="true"></i> 2020-03-03</div><div class="relatedPosts_title">SpringBoot整合JPA</div></div></a></div><div class="relatedPosts_item"><a href="/2020/03/03/Spring/Spring Boot 2.2.2/SpringBoot-Mybatis-xml/" title="SpringBoot整合Mybatis-XML版"><img class="relatedPosts_cover" src="http://cdn.panyucable.cn/zysheep/springboot_cover_mybaits.png"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="fa fa-calendar fa-fw" aria-hidden="true"></i> 2020-03-03</div><div class="relatedPosts_title">SpringBoot整合Mybatis-XML版</div></div></a></div><div class="relatedPosts_item"><a href="/2020/03/03/Spring/Spring Boot 2.2.2/SpringBoot-Lombok/" title="SpringBoot集成Lombok"><img class="relatedPosts_cover" src="http://cdn.panyucable.cn/zysheep/springboot_cover_lombok_1.png"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="fa fa-calendar fa-fw" aria-hidden="true"></i> 2020-03-03</div><div class="relatedPosts_title">SpringBoot集成Lombok</div></div></a></div></div><div class="clear_both"></div></div><hr><div id="post-comment"><div class="comment_headling"><i class="fa fa-comments fa-fw" aria-hidden="true"></i><span> 评论</span></div><div id="gitalk-container"></div><script>var gitalk = new Gitalk({
  clientID: '502b8308721b081071a5',
  clientSecret: '35220d15c7f8aaf585d6822cf5d49fedf5b602d6',
  repo: 'blog-comment',
  owner: 'zysheep',
  admin: ['zysheep'],
  id: md5(decodeURI(location.pathname)),
  language: 'zh-CN',
  perPage: 10,
  distractionFreeMode: false,
  pagerDirection: 'last',
  createIssueManually: false,
  updateCountCallback: commentCount
})
gitalk.render('gitalk-container')

function commentCount(n){
  try {
    document.getElementsByClassName('gitalk-comment-count')[0].innerHTML= n
  } catch (e) {
    return false
  }
}</script></div></article></main><footer id="footer" style="background-image: url(http://cdn.panyucable.cn/zysheep/springboot_top_mongodb.png)" data-type="photo"><div id="footer-wrap"><div class="copyright">&copy;2019 - 2020 By 三月三</div><div class="footer_custom_text">生活不只是眼前的苟且,还有诗和远方</div></div></footer></div><section class="rightside" id="rightside"><div id="rightside-config-hide"><i class="fa fa-book" id="readmode" title="阅读模式"></i><i class="fa fa-plus" id="font_plus" title="放大字体"></i><i class="fa fa-minus" id="font_minus" title="缩小字体"></i><a class="translate_chn_to_cht" id="translateLink" href="javascript:translatePage();" title="简繁转换" target="_self">繁</a><i class="darkmode fa fa-moon-o" id="darkmode" title="夜间模式"></i></div><div id="rightside-config-show"><div id="rightside_config" title="设置"><i class="fa fa-cog" aria-hidden="true"></i></div><a id="to_comment" href="#post-comment" title="直达评论"><i class="scroll_to_comment fa fa-comments">  </i></a><i class="fa fa-list-ul close" id="mobile-toc-button" title="目录" aria-hidden="true"></i><i class="fa fa-arrow-up" id="go-up" title="回到顶部" aria-hidden="true"></i></div></section><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.jsdelivr.net/npm/medium-zoom/dist/medium-zoom.min.js"></script><script src="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.js"></script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script src="/js/third-party/click_heart.js"></script><script src="https://cdn.jsdelivr.net/gh/sviptzk/HexoStaticFile@master/Hexo/js/hideCategory.min.js"></script><script>var endLoading = function () {
  document.body.style.overflow = 'auto';
  document.getElementById('loading-box').classList.add("loaded")
}
window.addEventListener('load',endLoading)</script></body></html>