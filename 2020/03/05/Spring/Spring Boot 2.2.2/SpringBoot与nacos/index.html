<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Spring Boot与Nacos | 三月三</title><meta name="description" content="什么是服务发现微服务架构为适应企业的业务发展，提高软件研发的生产力，降低软件研发的成本，软件架构也作了升级和优化，将一个独立 的系统拆分成若干小的服务，每个小服务运行在不同的进程中，服务与服务之间采用RESTful、RPC等协议传输数据，每个服务所拥有的功能具有独立性强的特点，这样的设计就实现了单个服务的高内聚，服务与服务之间的低耦合效果，这些小服务就是微服务，基于这种方法设计的系统架构即微服务架"><meta name="keywords" content="Spring,Spring Boot2.2.2"><meta name="author" content="三月三"><meta name="copyright" content="三月三"><meta name="format-detection" content="telephone=no"><link rel="shortcut icon" href="http://cdn.panyucable.cn/zysheep/ico.png"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="dns-prefetch" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="https://hm.baidu.com"/><link rel="dns-prefetch" href="https://hm.baidu.com"/><link rel="preconnect" href="https://fonts.googleapis.com" crossorigin="crossorigin"/><link rel="dns-prefetch" href="https://fonts.googleapis.com"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="dns-prefetch" href="//busuanzi.ibruce.info"/><meta name="twitter:card" content="summary"><meta name="twitter:title" content="Spring Boot与Nacos"><meta name="twitter:description" content="什么是服务发现微服务架构为适应企业的业务发展，提高软件研发的生产力，降低软件研发的成本，软件架构也作了升级和优化，将一个独立 的系统拆分成若干小的服务，每个小服务运行在不同的进程中，服务与服务之间采用RESTful、RPC等协议传输数据，每个服务所拥有的功能具有独立性强的特点，这样的设计就实现了单个服务的高内聚，服务与服务之间的低耦合效果，这些小服务就是微服务，基于这种方法设计的系统架构即微服务架"><meta name="twitter:image" content="http://cdn.panyucable.cn/zysheep/springboot_cover_nacos.png"><meta property="og:type" content="article"><meta property="og:title" content="Spring Boot与Nacos"><meta property="og:url" content="https://zysheep.cn/2020/03/05/Spring/Spring%20Boot%202.2.2/SpringBoot%E4%B8%8Enacos/"><meta property="og:site_name" content="三月三"><meta property="og:description" content="什么是服务发现微服务架构为适应企业的业务发展，提高软件研发的生产力，降低软件研发的成本，软件架构也作了升级和优化，将一个独立 的系统拆分成若干小的服务，每个小服务运行在不同的进程中，服务与服务之间采用RESTful、RPC等协议传输数据，每个服务所拥有的功能具有独立性强的特点，这样的设计就实现了单个服务的高内聚，服务与服务之间的低耦合效果，这些小服务就是微服务，基于这种方法设计的系统架构即微服务架"><meta property="og:image" content="http://cdn.panyucable.cn/zysheep/springboot_cover_nacos.png"><meta property="article:published_time" content="2020-03-05T02:30:45.000Z"><meta property="article:modified_time" content="2020-06-29T09:54:20.895Z"><script src="https://cdn.jsdelivr.net/npm/js-cookie/dist/js.cookie.min.js"></script><script>var autoChangeMode = '1'
var t = Cookies.get("theme")
if (autoChangeMode == '1'){
  var isDarkMode = window.matchMedia("(prefers-color-scheme: dark)").matches
  var isLightMode = window.matchMedia("(prefers-color-scheme: light)").matches
  var isNotSpecified = window.matchMedia("(prefers-color-scheme: no-preference)").matches
  var hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified

  if (t === undefined){
    if (isLightMode) activateLightMode()
    else if (isDarkMode) activateDarkMode()
    else if (isNotSpecified || hasNoSupport){
      console.log('You specified no preference for a color scheme or your browser does not support it. I Schedule dark mode during night time.')
      var now = new Date()
      var hour = now.getHours()
      var isNight = hour < 6 || hour >= 18
      isNight ? activateDarkMode() : activateLightMode()
  }
  } else if (t == 'light') activateLightMode()
  else activateDarkMode()

} else if (autoChangeMode == '2'){
  now = new Date();
  hour = now.getHours();
  isNight = hour < 6 || hour >= 18
  if(t === undefined) isNight? activateDarkMode() : activateLightMode()
  else if (t === 'light') activateLightMode()
  else activateDarkMode() 
} else {
  if ( t == 'dark' ) activateDarkMode()
  else if ( t == 'light') activateLightMode()
}

function activateDarkMode(){
  document.documentElement.setAttribute('data-theme', 'dark')
  if (document.querySelector('meta[name="theme-color"]') !== null){
    document.querySelector('meta[name="theme-color"]').setAttribute('content','#000')
  }
}
function activateLightMode(){
  document.documentElement.setAttribute('data-theme', 'light')
  if (document.querySelector('meta[name="theme-color"]') !== null){
  document.querySelector('meta[name="theme-color"]').setAttribute('content','#fff')
  }
}</script><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@latest/css/font-awesome.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.css"><link rel="canonical" href="https://zysheep.cn/2020/03/05/Spring/Spring%20Boot%202.2.2/SpringBoot%E4%B8%8Enacos/"><link rel="prev" title="Linux安装Nginx" href="https://zysheep.cn/2020/03/05/Linux/Linux%E5%AE%89%E8%A3%85Nginx/"><link rel="next" title="Vue.js入门宝典" href="https://zysheep.cn/2020/03/05/Vue/Vue.js/"><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/gitalk/dist/gitalk.min.css"><script src="https://cdn.jsdelivr.net/npm/gitalk@latest/dist/gitalk.min.js"></script><script src="https://cdn.jsdelivr.net/npm/blueimp-md5/js/md5.min.js"></script><script>var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?7f671f0f6d996680d21d5c32a23a9313";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Titillium+Web"><script>var GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: {"defaultEncoding":2,"translateDelay":0,"cookieDomain":"https://zysheep.github.io/","msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"簡"},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  bookmark: {
    message_prev: '按',
    message_next: '键将本页加入书签'
  },
  runtime_unit: '天',
  runtime: true,
  copyright: undefined,
  ClickShowText: undefined,
  medium_zoom: true,
  fancybox: false,
  Snackbar: {"bookmark":{"message_prev":"按","message_next":"键将本页加入书签"},"chs_to_cht":"你已切换为繁体","cht_to_chs":"你已切换为简体","day_to_night":"你已切换为深色模式","night_to_day":"你已切换为浅色模式","bgLight":"#49b1f5","bgDark":"#2d3035","position":"bottom-left"},
  baiduPush: false,
  highlightCopy: true,
  highlightLang: true,
  highlightShrink: 'false',
  isFontAwesomeV5: false,
  isPhotoFigcaption: true,
  islazyload: false,
  isanchor: false
  
}</script><script>var GLOBAL_CONFIG_SITE = { 
  isPost: true,
  isHome: false,
  isSidebar: true  
  }</script><noscript><style>
#page-header {
  opacity: 1
}
.justified-gallery img{
  opacity: 1
}
</style></noscript><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/sviptzk/HexoStaticFile@master/Hexo/css/hideCategory.min.css"><meta name="generator" content="Hexo 4.2.1"></head><body><div id="loading-box"><div class="loading-left-bg"></div><div class="loading-right-bg"></div><div class="spinner-box"><div class="configure-border-1"><div class="configure-core"></div></div><div class="configure-border-2"><div class="configure-core"></div></div><div class="loading-word">加载中...</div></div></div><div id="mobile-sidebar"><div id="menu_mask"></div><div id="mobile-sidebar-menus"><div class="mobile_author_icon"><img class="avatar-img" src="http://cdn.panyucable.cn/zysheep/xiaoman.png" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="mobile_post_data"><div class="mobile_data_item is-center"><div class="mobile_data_link"><a href="/archives/"><div class="headline">文章</div><div class="length_num">217</div></a></div></div><div class="mobile_data_item is-center">      <div class="mobile_data_link"><a href="/tags/"><div class="headline">标签</div><div class="length_num">49</div></a></div></div><div class="mobile_data_item is-center">     <div class="mobile_data_link"><a href="/categories/"><div class="headline">分类</div><div class="length_num">70</div></a></div></div></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> 主页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fa fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fa fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page"><i class="fa-fw fa fa-bug" aria-hidden="true"></i><span> 编程路线</span><i class="fa fa-chevron-down menus-expand" aria-hidden="true"></i></a><ul class="menus_item_child"><li><a class="site-page" href="/java/"><i class="fa-fw fa fa-coffee"></i><span> Java</span></a></li><li><a class="site-page" href="/python/"><i class="fa-fw fa fa-binoculars"></i><span> Python</span></a></li></ul></div><div class="menus_item"><a class="site-page"><i class="fa-fw fa fa-folder-open" aria-hidden="true"></i><span> 面试宝典</span><i class="fa fa-chevron-down menus-expand" aria-hidden="true"></i></a><ul class="menus_item_child"><li><a class="site-page" href="/interview/"><i class="fa-fw fa fa-file-text-o"></i><span> Java面试题</span></a></li></ul></div><div class="menus_item"><a class="site-page"><i class="fa-fw fa fa-list" aria-hidden="true"></i><span> 我的生活</span><i class="fa fa-chevron-down menus-expand" aria-hidden="true"></i></a><ul class="menus_item_child"><li><a class="site-page" href="/gallery/"><i class="fa-fw fa fa-picture-o"></i><span> Gallery</span></a></li></ul></div></div></div></div><i class="fa fa-arrow-right on" id="toggle-sidebar" aria-hidden="true">     </i><div id="sidebar"><div class="sidebar-toc"><div class="sidebar-toc__title">目录</div><div class="sidebar-toc__progress"><span class="progress-notice">你已经读了</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc__progress-bar">     </div></div><div class="sidebar-toc__content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#什么是服务发现"><span class="toc-number">1.</span> <span class="toc-text">什么是服务发现</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#微服务架构"><span class="toc-number">1.1.</span> <span class="toc-text">微服务架构</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#理解服务发现"><span class="toc-number">1.2.</span> <span class="toc-text">理解服务发现</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#测试环境"><span class="toc-number">1.2.1.</span> <span class="toc-text">测试环境</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#创建springboot-20-nacos父工程"><span class="toc-number">1.2.1.1.</span> <span class="toc-text">创建springboot-20-nacos父工程</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Service-B（服务生产者）"><span class="toc-number">1.2.1.2.</span> <span class="toc-text">Service B（服务生产者）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Service-A（服务消费者）"><span class="toc-number">1.2.1.3.</span> <span class="toc-text">Service A（服务消费者）</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#服务发现流程"><span class="toc-number">1.2.2.</span> <span class="toc-text">服务发现流程</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Nacos-服务发现"><span class="toc-number">2.</span> <span class="toc-text">Nacos 服务发现</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Nacos简介"><span class="toc-number">2.1.</span> <span class="toc-text">Nacos简介</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#服务发现产品对比"><span class="toc-number">2.1.1.</span> <span class="toc-text">服务发现产品对比</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Nacos简介-1"><span class="toc-number">2.1.2.</span> <span class="toc-text">Nacos简介</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Nacos特性"><span class="toc-number">2.1.3.</span> <span class="toc-text">Nacos特性</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#安装Nacos-Server"><span class="toc-number">2.2.</span> <span class="toc-text">安装Nacos Server</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#预备环境准备"><span class="toc-number">2.2.1.</span> <span class="toc-text">预备环境准备</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#下载源码或者安装包"><span class="toc-number">2.2.2.</span> <span class="toc-text">下载源码或者安装包</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#从-Github-上下载源码方式"><span class="toc-number">2.2.2.1.</span> <span class="toc-text">从 Github 上下载源码方式</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#下载编译后压缩包方式"><span class="toc-number">2.2.2.2.</span> <span class="toc-text">下载编译后压缩包方式</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#启动服务器"><span class="toc-number">2.2.3.</span> <span class="toc-text">启动服务器</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#外部mysql数据库支持"><span class="toc-number">2.2.4.</span> <span class="toc-text">外部mysql数据库支持</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#测试环境-1"><span class="toc-number">2.2.5.</span> <span class="toc-text">测试环境</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#服务注册"><span class="toc-number">2.2.6.</span> <span class="toc-text">服务注册</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#服务发现"><span class="toc-number">2.2.7.</span> <span class="toc-text">服务发现</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#负载均衡"><span class="toc-number">2.2.8.</span> <span class="toc-text">负载均衡</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#总结"><span class="toc-number">2.2.9.</span> <span class="toc-text">总结</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Dubbo服务架构"><span class="toc-number">2.2.10.</span> <span class="toc-text">Dubbo服务架构</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#测试环境-2"><span class="toc-number">2.2.11.</span> <span class="toc-text">测试环境</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#service2微服务"><span class="toc-number">2.2.12.</span> <span class="toc-text">service2微服务</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#定义service2-api"><span class="toc-number">2.2.12.1.</span> <span class="toc-text">定义service2-api</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#定义service2-server"><span class="toc-number">2.2.12.2.</span> <span class="toc-text">定义service2-server</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#application1调用service2"><span class="toc-number">2.2.13.</span> <span class="toc-text">application1调用service2</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#引用service2"><span class="toc-number">2.2.13.1.</span> <span class="toc-text">引用service2</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#实现远程调用"><span class="toc-number">2.2.13.2.</span> <span class="toc-text">实现远程调用</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#service1微服务"><span class="toc-number">2.2.14.</span> <span class="toc-text">service1微服务</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#定义service1-api"><span class="toc-number">2.2.14.1.</span> <span class="toc-text">定义service1-api</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#定义service1-server"><span class="toc-number">2.2.14.2.</span> <span class="toc-text">定义service1-server</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#application1调用service1"><span class="toc-number">2.2.15.</span> <span class="toc-text">application1调用service1</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#扩展配置优先级"><span class="toc-number">2.2.16.</span> <span class="toc-text">扩展配置优先级</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#总结-1"><span class="toc-number">3.</span> <span class="toc-text">总结</span></a></li></ol></div></div></div><div id="body-wrap"><div class="post-bg" id="nav" style="background-image: url(http://cdn.panyucable.cn/zysheep/springboot_top_nacos.png)"><div id="page-header"><span class="pull_left" id="blog_name"><a class="blog_title" id="site-name" href="/">三月三</a></span><span class="pull_right menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> 主页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fa fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fa fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page"><i class="fa-fw fa fa-bug" aria-hidden="true"></i><span> 编程路线</span><i class="fa fa-chevron-down menus-expand" aria-hidden="true"></i></a><ul class="menus_item_child"><li><a class="site-page" href="/java/"><i class="fa-fw fa fa-coffee"></i><span> Java</span></a></li><li><a class="site-page" href="/python/"><i class="fa-fw fa fa-binoculars"></i><span> Python</span></a></li></ul></div><div class="menus_item"><a class="site-page"><i class="fa-fw fa fa-folder-open" aria-hidden="true"></i><span> 面试宝典</span><i class="fa fa-chevron-down menus-expand" aria-hidden="true"></i></a><ul class="menus_item_child"><li><a class="site-page" href="/interview/"><i class="fa-fw fa fa-file-text-o"></i><span> Java面试题</span></a></li></ul></div><div class="menus_item"><a class="site-page"><i class="fa-fw fa fa-list" aria-hidden="true"></i><span> 我的生活</span><i class="fa fa-chevron-down menus-expand" aria-hidden="true"></i></a><ul class="menus_item_child"><li><a class="site-page" href="/gallery/"><i class="fa-fw fa fa-picture-o"></i><span> Gallery</span></a></li></ul></div></div><span class="toggle-menu close"><a class="site-page"><i class="fa fa-bars fa-fw" aria-hidden="true"></i></a></span></span></div><div id="post-info"><div id="post-title"><div class="posttitle">Spring Boot与Nacos</div></div><div id="post-meta"><div class="meta-firstline"><time class="post-meta__date"><span class="post-meta__date-created" title="发表于 2020-03-05 10:30:45"><i class="fa fa-calendar" aria-hidden="true"></i> 发表于 2020-03-05</span><span class="post-meta__separator">|</span><span class="post-meta__date-updated" title="更新于 2020-06-29 17:54:20"><i class="fa fa-history" aria-hidden="true"></i> 更新于 2020-06-29</span></time><span class="post-meta__categories"><span class="post-meta__separator">|</span><i class="fa fa-inbox post-meta__icon" aria-hidden="true"></i><a class="post-meta__categories" href="/categories/Spring%E5%85%A8%E5%AE%B6%E6%A1%B6/">Spring全家桶</a><i class="fa fa-angle-right post-meta__separator" aria-hidden="true"></i><i class="fa fa-inbox post-meta__icon" aria-hidden="true"></i><a class="post-meta__categories" href="/categories/Spring%E5%85%A8%E5%AE%B6%E6%A1%B6/Spring-Boot2-2-2/">Spring Boot2.2.2</a></span></div><div class="meta-secondline"> <span class="post-meta-wordcount"><i class="post-meta__icon fa fa-file-word-o" aria-hidden="true"></i><span>字数总计:</span><span class="word-count">12.6k</span><span class="post-meta__separator">|</span><i class="post-meta__icon fa fa-clock-o" aria-hidden="true"></i><span>阅读时长: 52 分钟</span></span></div><div class="meta-thirdline"><span class="post-meta-pv-cv"><span class="post-meta__separator">|</span><i class="fa fa-eye post-meta__icon" aria-hidden="true"> </i><span>阅读量:</span><span id="busuanzi_value_page_pv"></span></span><span class="post-meta-commentcount"><span class="post-meta__separator">|</span><i class="post-meta__icon fa fa-comment-o" aria-hidden="true"></i><span>评论数:</span><a href="/2020/03/05/Spring/Spring%20Boot%202.2.2/SpringBoot%E4%B8%8Enacos/#post-comment"><span class="gitalk-comment-count comment-count"></span></a></span></div></div></div></div><main class="layout_post" id="content-inner"><article id="post"><div class="post-content" id="article-container"><h1 id="什么是服务发现"><a href="#什么是服务发现" class="headerlink" title="什么是服务发现"></a>什么是服务发现</h1><h2 id="微服务架构"><a href="#微服务架构" class="headerlink" title="微服务架构"></a>微服务架构</h2><p>为适应企业的业务发展，提高软件研发的生产力，降低软件研发的成本，软件架构也作了升级和优化，将一个独立 的系统拆分成若干小的服务，每个小服务运行在不同的进程中，服务与服务之间采用<code>RESTful</code>、<code>RPC</code>等协议传输数据，每个服务所拥有的功能具有独立性强的特点，这样的设计就实现了单个服务的高内聚，服务与服务之间的低耦合效果，这些小服务就是微服务，基于这种方法设计的系统架构即微服务架构。</p>
<p>下图是基于微服务架构的电商系统：</p>
<p><img src="http://cdn.panyucable.cn/zysheep/QQ%E6%88%AA%E5%9B%BE20200608172338.png" alt=""></p>
<p>特点： </p>
<ol>
<li>服务层按业务拆分为一个一个的微服务。 </li>
<li>微服务的职责单一。 </li>
<li>微服务之间采用RESTful、RPC等轻量级协议传输。 </li>
<li>有利于采用前后端分离架构。  </li>
</ol>
<h2 id="理解服务发现"><a href="#理解服务发现" class="headerlink" title="理解服务发现"></a>理解服务发现</h2><h3 id="测试环境"><a href="#测试环境" class="headerlink" title="测试环境"></a>测试环境</h3><p> 在微服务架构中，整个系统会按职责能力划分为多个服务，通过服务之间协作来实现业务目标。这样在我们的代码中免不了要进行服务间的远程调用，服务的消费方要调用服务的生产方，为了完成一次请求，消费方需要知道服务生产方的网络位置(IP地址和端口号)。我们的代码可以通过读取配置文件的方式读取服务生产方网络位置，如下：</p>
<p><img src="http://cdn.panyucable.cn/zysheep/QQ%E6%88%AA%E5%9B%BE20200608172646.png" alt=""></p>
<p>我们通过Spring boot技术很容易实现： </p>
<h4 id="创建springboot-20-nacos父工程"><a href="#创建springboot-20-nacos父工程" class="headerlink" title="创建springboot-20-nacos父工程"></a>创建springboot-20-nacos父工程</h4><p>pom.xml如下:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version&#x3D;&quot;1.0&quot; encoding&#x3D;&quot;UTF-8&quot;?&gt;</span><br><span class="line">&lt;project xmlns&#x3D;&quot;http:&#x2F;&#x2F;maven.apache.org&#x2F;POM&#x2F;4.0.0&quot; xmlns:xsi&#x3D;&quot;http:&#x2F;&#x2F;www.w3.org&#x2F;2001&#x2F;XMLSchema-instance&quot;</span><br><span class="line">         xsi:schemaLocation&#x3D;&quot;http:&#x2F;&#x2F;maven.apache.org&#x2F;POM&#x2F;4.0.0 https:&#x2F;&#x2F;maven.apache.org&#x2F;xsd&#x2F;maven-4.0.0.xsd&quot;&gt;</span><br><span class="line">    &lt;modelVersion&gt;4.0.0&lt;&#x2F;modelVersion&gt;</span><br><span class="line">    &lt;modules&gt;</span><br><span class="line">        &lt;module&gt;nacos-restful-provider&lt;&#x2F;module&gt;</span><br><span class="line">        &lt;module&gt;nacos-restful-consumer&lt;&#x2F;module&gt;</span><br><span class="line">    &lt;&#x2F;modules&gt;</span><br><span class="line"></span><br><span class="line">    &lt;groupId&gt;cn.zysheep&lt;&#x2F;groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;springboot-20-nacos&lt;&#x2F;artifactId&gt;</span><br><span class="line">    &lt;version&gt;0.0.1-SNAPSHOT&lt;&#x2F;version&gt;</span><br><span class="line">    &lt;packaging&gt;pom&lt;&#x2F;packaging&gt;</span><br><span class="line">    &lt;!--统一管理依赖版本--&gt;</span><br><span class="line">    &lt;properties&gt;</span><br><span class="line">        &lt;project.build.sourceEncoding&gt;UTF-8&lt;&#x2F;project.build.sourceEncoding&gt;</span><br><span class="line">        &lt;project.reporting.outputEncoding&gt;UTF-8&lt;&#x2F;project.reporting.outputEncoding&gt;</span><br><span class="line">        &lt;java.version&gt;1.8&lt;&#x2F;java.version&gt;</span><br><span class="line">    &lt;&#x2F;properties&gt;</span><br><span class="line"></span><br><span class="line">    &lt;!--依赖定义--&gt;</span><br><span class="line">    &lt;!--dependencyManagement 定义依赖版本号。子工程直接加依赖即可，不需要再次加版本号，便于统一维护版本号--&gt;</span><br><span class="line">    &lt;dependencyManagement&gt;</span><br><span class="line">        &lt;dependencies&gt;</span><br><span class="line">            &lt;dependency&gt;</span><br><span class="line">                &lt;groupId&gt;org.springframework.boot&lt;&#x2F;groupId&gt;</span><br><span class="line">                &lt;artifactId&gt;spring-boot-starter-parent&lt;&#x2F;artifactId&gt;</span><br><span class="line">                &lt;version&gt;2.2.2.RELEASE&lt;&#x2F;version&gt;</span><br><span class="line">                &lt;type&gt;pom&lt;&#x2F;type&gt;</span><br><span class="line">                &lt;scope&gt;import&lt;&#x2F;scope&gt;</span><br><span class="line">            &lt;&#x2F;dependency&gt;</span><br><span class="line">        &lt;&#x2F;dependencies&gt;</span><br><span class="line">    &lt;&#x2F;dependencyManagement&gt;</span><br><span class="line">&lt;&#x2F;project&gt;</span><br></pre></td></tr></table></figure>

<h4 id="Service-B（服务生产者）"><a href="#Service-B（服务生产者）" class="headerlink" title="Service B（服务生产者）"></a>Service B（服务生产者）</h4><p>创建服务提供者<code>nacos-restful-provider</code></p>
<p>pom.xml</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version&#x3D;&quot;1.0&quot; encoding&#x3D;&quot;UTF-8&quot;?&gt;</span><br><span class="line">&lt;project xmlns&#x3D;&quot;http:&#x2F;&#x2F;maven.apache.org&#x2F;POM&#x2F;4.0.0&quot;</span><br><span class="line">         xmlns:xsi&#x3D;&quot;http:&#x2F;&#x2F;www.w3.org&#x2F;2001&#x2F;XMLSchema-instance&quot;</span><br><span class="line">         xsi:schemaLocation&#x3D;&quot;http:&#x2F;&#x2F;maven.apache.org&#x2F;POM&#x2F;4.0.0 http:&#x2F;&#x2F;maven.apache.org&#x2F;xsd&#x2F;maven-4.0.0.xsd&quot;&gt;</span><br><span class="line">    &lt;parent&gt;</span><br><span class="line">        &lt;artifactId&gt;springboot-20-nacos&lt;&#x2F;artifactId&gt;</span><br><span class="line">        &lt;groupId&gt;cn.zysheep&lt;&#x2F;groupId&gt;</span><br><span class="line">        &lt;version&gt;0.0.1-SNAPSHOT&lt;&#x2F;version&gt;</span><br><span class="line">    &lt;&#x2F;parent&gt;</span><br><span class="line">    &lt;modelVersion&gt;4.0.0&lt;&#x2F;modelVersion&gt;</span><br><span class="line"></span><br><span class="line">    &lt;artifactId&gt;nacos-restful-provider&lt;&#x2F;artifactId&gt;</span><br><span class="line"></span><br><span class="line">    &lt;dependencies&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;org.springframework.boot&lt;&#x2F;groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;spring-boot-starter-web&lt;&#x2F;artifactId&gt;</span><br><span class="line">        &lt;&#x2F;dependency&gt;</span><br><span class="line">    &lt;&#x2F;dependencies&gt;</span><br><span class="line">&lt;&#x2F;project&gt;</span><br></pre></td></tr></table></figure>

<p><code>Service B</code>是服务的生产方，暴露<code>/service</code>服务地址，实现代码如下： </p>
<p>1、创建Controller</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">@RestController</span><br><span class="line">public class RestProviderController &#123;</span><br><span class="line">    @GetMapping(&quot;&#x2F;service&quot;)&#x2F;&#x2F;暴露服务</span><br><span class="line">    public String service()&#123;</span><br><span class="line">        System.out.println(&quot;provider invoke&quot;);</span><br><span class="line">        return &quot;provider invoke&quot;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>2、创建启动类 </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">@SpringBootApplication</span><br><span class="line">public class SpringRestProviderApplication &#123;</span><br><span class="line">    public static void main(String[] args) &#123;</span><br><span class="line">        SpringApplication.run(SpringRestProviderApplication.class,args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>yml配置文件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">server:</span><br><span class="line">  port: 56010</span><br></pre></td></tr></table></figure>

<h4 id="Service-A（服务消费者）"><a href="#Service-A（服务消费者）" class="headerlink" title="Service A（服务消费者）"></a>Service A（服务消费者）</h4><p>创建<code>nacos-restful-consumer</code> 服务消费工程。</p>
<p>pom.xml如下</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version&#x3D;&quot;1.0&quot; encoding&#x3D;&quot;UTF-8&quot;?&gt;</span><br><span class="line">&lt;project xmlns&#x3D;&quot;http:&#x2F;&#x2F;maven.apache.org&#x2F;POM&#x2F;4.0.0&quot;</span><br><span class="line">         xmlns:xsi&#x3D;&quot;http:&#x2F;&#x2F;www.w3.org&#x2F;2001&#x2F;XMLSchema-instance&quot;</span><br><span class="line">         xsi:schemaLocation&#x3D;&quot;http:&#x2F;&#x2F;maven.apache.org&#x2F;POM&#x2F;4.0.0 http:&#x2F;&#x2F;maven.apache.org&#x2F;xsd&#x2F;maven-4.0.0.xsd&quot;&gt;</span><br><span class="line">    &lt;parent&gt;</span><br><span class="line">        &lt;artifactId&gt;springboot-20-nacos&lt;&#x2F;artifactId&gt;</span><br><span class="line">        &lt;groupId&gt;cn.zysheep&lt;&#x2F;groupId&gt;</span><br><span class="line">        &lt;version&gt;0.0.1-SNAPSHOT&lt;&#x2F;version&gt;</span><br><span class="line">    &lt;&#x2F;parent&gt;</span><br><span class="line">    &lt;modelVersion&gt;4.0.0&lt;&#x2F;modelVersion&gt;</span><br><span class="line"></span><br><span class="line">    &lt;artifactId&gt;nacos-restful-consumer&lt;&#x2F;artifactId&gt;</span><br><span class="line">    &lt;dependencies&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;org.springframework.boot&lt;&#x2F;groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;spring-boot-starter-web&lt;&#x2F;artifactId&gt;</span><br><span class="line">        &lt;&#x2F;dependency&gt;</span><br><span class="line">    &lt;&#x2F;dependencies&gt;</span><br><span class="line">&lt;&#x2F;project&gt;</span><br></pre></td></tr></table></figure>

<p><code>consumer</code>做为消费方对提供方进行消费。代码实现:</p>
<p>1、创建controller </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">@RestController</span><br><span class="line">public class RestConsumerController &#123;</span><br><span class="line"></span><br><span class="line">    @Value(&quot;$&#123;provider.address&#125;&quot;)</span><br><span class="line">    private String providerAddress;</span><br><span class="line"></span><br><span class="line">    @GetMapping(value &#x3D; &quot;&#x2F;service&quot;)</span><br><span class="line">    public String service()&#123;</span><br><span class="line">        RestTemplate restTemplate &#x3D; new RestTemplate();</span><br><span class="line">        &#x2F;&#x2F;调用服务</span><br><span class="line">        String providerResult &#x3D; restTemplate.getForObject(&quot;http:&#x2F;&#x2F;&quot; + providerAddress + &quot;&#x2F;service&quot;,String.class);</span><br><span class="line">        return &quot;consumer invoke | &quot; + providerResult;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>2、创建启动类 </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">@SpringBootApplication</span><br><span class="line">public class SpringRestConsumerApplication &#123;</span><br><span class="line">    public static void main(String[] args) &#123;</span><br><span class="line">        SpringApplication.run(SpringRestConsumerApplication.class,args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p> 3、application.yml，内容如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">server:</span><br><span class="line">  port: 56020</span><br><span class="line"># 服务生产方地址</span><br><span class="line">provider:</span><br><span class="line">  address: 127.0.0.1:56010</span><br></pre></td></tr></table></figure>

<p>访问<a href="http://127.0.0.1:56020/service，输出以下内容：" target="_blank" rel="noopener">http://127.0.0.1:56020/service，输出以下内容：</a> </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">consumer invoke | provider invoke</span><br></pre></td></tr></table></figure>

<h3 id="服务发现流程"><a href="#服务发现流程" class="headerlink" title="服务发现流程"></a>服务发现流程</h3><p>上边的例子看上去很完美，但是，仔细考虑以下，此方案对于微服务应用而言行不通。首先，微服务可能是部署在 云环境的，服务实例的网络位置或许是动态分配的。另外，每一个服务一般会有多个实例来做负载均衡，由于宕机 或升级，服务实例网络地址会经常动态改变。再者，每一个服务也可能应对临时访问压力增加新的服务节点。正如 下图所示：</p>
<p><img src="http://cdn.panyucable.cn/zysheep/QQ%E6%88%AA%E5%9B%BE20200609081525.png" alt=""></p>
<p>基于以上的问题，服务之间如何相互发现？服务如何管理？这就是服务发现的问题了。 </p>
<p>服务发现就是服务消费方通过服务发现中心智能发现服务提供方，从而进行远程调用的过程。</p>
<p>如下图： </p>
<p><img src="http://cdn.panyucable.cn/zysheep/QQ%E6%88%AA%E5%9B%BE20200609081541.png" alt=""></p>
<p>上图中服务实例本身并不记录服务生产方的网络地址，所有服务实例内部都会包含服务发现客户端。</p>
<ol>
<li>在每个服务启动时会向服务发现中心上报自己的网络位置。这样，在服务发现中心内部会形成一个服务注册 表，服务注册表是服务发现的核心部分，是包含所有服务实例的网络地址的数据库。</li>
<li>服务发现客户端会定期从服务发现中心同步服务注册表 ，并缓存在客户端。</li>
<li>当需要对某服务进行请求时，服务实例通过该注册表，定位目标服务网络地址。若目标服务存在多个网络地 址，则使用负载均衡算法从多个服务实例中选择出一个，然后发出请求。 </li>
</ol>
<blockquote>
<p>总结，在微服务环境中，由于服务运行实例的网络地址是不断动态变化的，服务实例数量的动态变化 ，因此无法使用固定的配置文件来记录服务提供方的网络地址，必须使用动态的服务发现机制用于实现微服务间的相互感知。 各服务实例会上报自己的网络地址，这样服务中心就形成了一个完整的服务注册表，各服务实例会通过服务发现中 心来获取访问目标服务的网络地址，从而实现服务发现的机制。 </p>
</blockquote>
<h1 id="Nacos-服务发现"><a href="#Nacos-服务发现" class="headerlink" title="Nacos 服务发现"></a>Nacos 服务发现</h1><h2 id="Nacos简介"><a href="#Nacos简介" class="headerlink" title="Nacos简介"></a>Nacos简介</h2><h3 id="服务发现产品对比"><a href="#服务发现产品对比" class="headerlink" title="服务发现产品对比"></a>服务发现产品对比</h3><p>目前市面上用的比较多的服务发现中心有：Nacos、Eureka、Consul和Zookeeper。</p>
<table>
<thead>
<tr>
<th>对比项目</th>
<th>Nacos</th>
<th>Eureka</th>
<th>Consul</th>
<th>Zookeeper</th>
</tr>
</thead>
<tbody><tr>
<td>一致性协议</td>
<td>支持AP和CP模型</td>
<td>AP模型</td>
<td>CP模型</td>
<td>CP模型</td>
</tr>
<tr>
<td>健康检查</td>
<td>TCP/HTTP/MYSQL/Client Beat</td>
<td>Client Beat</td>
<td>TCP/HTTP/gRPC/Cmd</td>
<td>Keep Alive</td>
</tr>
<tr>
<td>负载均衡策略</td>
<td>权重/metadata/Selecto</td>
<td>Ribbon</td>
<td>Fabio</td>
<td>-</td>
</tr>
<tr>
<td>雪崩保护</td>
<td>有</td>
<td>有</td>
<td>无</td>
<td>无</td>
</tr>
<tr>
<td>自动注销实例</td>
<td>支持</td>
<td>支持</td>
<td>不支持</td>
<td>支持</td>
</tr>
<tr>
<td>访问协议</td>
<td>HTTP/DNS</td>
<td>HTTP</td>
<td>HTTP/DNS</td>
<td>TCP</td>
</tr>
<tr>
<td>监听支持</td>
<td>支持</td>
<td>支持</td>
<td>支持</td>
<td>支持</td>
</tr>
<tr>
<td>多数据中心</td>
<td>支持</td>
<td>支持</td>
<td>支持</td>
<td>不支持</td>
</tr>
<tr>
<td>跨注册中心同步</td>
<td>支持</td>
<td>不支持</td>
<td>支持</td>
<td>不支持</td>
</tr>
<tr>
<td>SpringCloud集成</td>
<td>支持</td>
<td>支持</td>
<td>支持</td>
<td>不支持</td>
</tr>
<tr>
<td>Dubbo集成</td>
<td>支持</td>
<td>不支持</td>
<td>不支持</td>
<td>支持</td>
</tr>
<tr>
<td>k8s集成</td>
<td>支持</td>
<td>不支持</td>
<td>支持</td>
<td>不支持</td>
</tr>
</tbody></table>
<p>从上面对比可以了解到，Nacos作为服务发现中心，具备更多的功能支持项，且从长远来看Nacos在以后的版本会 支持SpringCLoud+Kubernetes的组合，填补 2 者的鸿沟，在两套体系下可以采用同一套服务发现和配置管理的解 决方案，这将大大的简化使用和维护的成本。另外，Nacos 计划实现 Service Mesh，也是未来微服务发展的趋 势。</p>
<h3 id="Nacos简介-1"><a href="#Nacos简介-1" class="headerlink" title="Nacos简介"></a>Nacos简介</h3><p><img src="http://cdn.panyucable.cn/zysheep/QQ%E6%88%AA%E5%9B%BE20200609111728.png" alt=""></p>
<p>Nacos是阿里的一个开源产品，它是针对微服务架构中的服务发现、配置管理、服务治理的综合型解决方案。</p>
<p>官方介绍:</p>
<blockquote>
<p>Nacos 致力于帮助您发现、配置和管理微服务。Nacos 提供了一组简单易用的特性集，帮助您实现动态服务 发现、服务配置管理、服务及流量管理。 Nacos 帮助您更敏捷和容易地构建、交付和管理微服务平台。 Nacos 是构建以“服务”为中心的现代应用架构的服务基础设施。</p>
</blockquote>
<p>官网地址：<a href="https://nacos.io" target="_blank" rel="noopener">https://nacos.io</a> </p>
<h3 id="Nacos特性"><a href="#Nacos特性" class="headerlink" title="Nacos特性"></a>Nacos特性</h3><p>Nacos主要提供以下四大功能:</p>
<ol>
<li>服务发现与服务健康检查 <ul>
<li>Nacos使服务更容易注册，并通过DNS或HTTP接口发现其他服务，Nacos还提供服务的实时健康检查，以防止向不健康的主机或服务实例发送请求。 </li>
</ul>
</li>
<li>动态配置管理<ul>
<li>动态配置服务允许您在所有环境中以集中和动态的方式管理所有服务的配置。Nacos消除了在更新配置时重新部署应用程序，这使配置的更改更加高效和灵活。</li>
</ul>
</li>
<li>动态DNS服务 <ul>
<li>Nacos提供基于DNS 协议的服务发现能力，旨在支持异构语言的服务发现，支持将注册在Nacos上的服务以 域名的方式暴露端点，让三方应用方便的查阅及发现。</li>
</ul>
</li>
<li>服务和元数据管理 <ul>
<li>Nacos 能让您从微服务平台建设的视角管理数据中心的所有服务及元数据，包括管理服务的描述、生命周期、服务的静态依赖分析、服务的健康状态、服务的流量管理、路由及安全策略。</li>
</ul>
</li>
</ol>
<h2 id="安装Nacos-Server"><a href="#安装Nacos-Server" class="headerlink" title="安装Nacos Server"></a>安装Nacos Server</h2><h3 id="预备环境准备"><a href="#预备环境准备" class="headerlink" title="预备环境准备"></a>预备环境准备</h3><p>Nacos 依赖 Java 环境来运行。如果您是从代码开始构建并运行Nacos，还需要为此配置 Maven环境，请确保是在 以下版本环境中安装使用: </p>
<ul>
<li>64 bit OS，支持 Linux/Unix/Mac/Windows，推荐选用 Linux/Unix/Mac</li>
<li>64 bit JDK 1.8+；</li>
<li>Maven 3.2.x+；</li>
</ul>
<h3 id="下载源码或者安装包"><a href="#下载源码或者安装包" class="headerlink" title="下载源码或者安装包"></a>下载源码或者安装包</h3><p>你可以通过源码和发行包两种方式来获取 Nacos。 </p>
<h4 id="从-Github-上下载源码方式"><a href="#从-Github-上下载源码方式" class="headerlink" title="从 Github 上下载源码方式"></a>从 Github 上下载源码方式</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">git clone https:&#x2F;&#x2F;github.com&#x2F;alibaba&#x2F;nacos.git </span><br><span class="line">cd nacos&#x2F; </span><br><span class="line">mvn ‐Prelease‐nacos clean install ‐U </span><br><span class="line">ls ‐al distribution&#x2F;target&#x2F; </span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F; change the $version to your actual path </span><br><span class="line">cd distribution&#x2F;target&#x2F;nacos‐server‐$version&#x2F;nacos&#x2F;bin</span><br></pre></td></tr></table></figure>

<h4 id="下载编译后压缩包方式"><a href="#下载编译后压缩包方式" class="headerlink" title="下载编译后压缩包方式"></a>下载编译后压缩包方式</h4><p>您可以从 最新稳定版本 下载 <code>nacos-server-$version.zip</code> 包，本教程使用nacos-server-1.1.3版本。 </p>
<p>下载地址：<a href="https://github.com/alibaba/nacos/releases" target="_blank" rel="noopener">https://github.com/alibaba/nacos/releases</a> </p>
<p>下载后解压：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">unzip nacos‐server‐$version.zip 或者 tar ‐xvf nacos‐server‐$version.tar.gz </span><br><span class="line">cd nacos&#x2F;bin</span><br></pre></td></tr></table></figure>

<h3 id="启动服务器"><a href="#启动服务器" class="headerlink" title="启动服务器"></a>启动服务器</h3><p>nacos的默认端口是8848，需要保证8848默认端口没有被其他进程占用。进入安装程序的bin目录： </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">#Linux&#x2F;Unix&#x2F;Mac启动方式：</span><br><span class="line">启动命令(standalone代表着单机模式运行，非集群模式)</span><br><span class="line">sh startup.sh -m standalone</span><br><span class="line">如果您使用的是ubuntu系统，或者运行脚本报错提示[[符号找不到，可尝试如下运行</span><br><span class="line">bash startup.sh -m standalone</span><br><span class="line">#Windows启动方式：</span><br><span class="line">cmd startup.cmd</span><br><span class="line">或者双击startup.cmd运行文件。</span><br></pre></td></tr></table></figure>

<p>启动成功，可通过浏览器访问 <a href="http://127.0.0.1:8848/nacos" target="_blank" rel="noopener">http://127.0.0.1:8848/nacos</a> ，打开如下nacos控制台登录页面：</p>
<p><img src="http://cdn.panyucable.cn/zysheep/QQ%E6%88%AA%E5%9B%BE20200609112723.png" alt=""></p>
<p>使用默认用户名：<code>nacos</code>，默认密码：<code>nacos</code>登录即可打开主页面。  <img src="http://cdn.panyucable.cn/zysheep/QQ%E6%88%AA%E5%9B%BE20200609112743.png" alt=""></p>
<h3 id="外部mysql数据库支持"><a href="#外部mysql数据库支持" class="headerlink" title="外部mysql数据库支持"></a>外部mysql数据库支持</h3><p>单机模式时<code>nacos</code>默认使用嵌入式数据库实现数据的存储，若想使用外部mysql存储nacos数据，需要进行以下步 骤： </p>
<ul>
<li><p>安装数据库，版本要求：5.6.5+ ，mysql 8 以下 </p>
</li>
<li><p>初始化mysql数据库，新建数据库nacos_confifig，数据库初始化文件：${nacoshome}/conf/nacos-mysql.sql </p>
</li>
<li><p>修改${nacoshome}/conf/application.properties文件，增加支持mysql数据源配置（目前只支持 mysql），添加mysql数据源的url、用户名和密码。 </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">spring.datasource.platform&#x3D;mysql </span><br><span class="line"></span><br><span class="line">db.num&#x3D;1 </span><br><span class="line">db.url.0&#x3D;jdbc:mysql:&#x2F;&#x2F;11.162.196.16:3306&#x2F;nacos_configcharacterEncoding&#x3D;utf8&amp;connectTimeout&#x3D;1000&amp;socketTimeout&#x3D;3000&amp;autoReconnect&#x3D;true </span><br><span class="line">db.user&#x3D;nacos_devtest </span><br><span class="line">db.password&#x3D;youdontknow</span><br></pre></td></tr></table></figure>

</li>
</ul>
<p>##RESTful服务发现</p>
<h3 id="测试环境-1"><a href="#测试环境-1" class="headerlink" title="测试环境"></a>测试环境</h3><p>Spring Cloud是一套微服务开发框架集合，包括微服务开发的方方页面，Spring Cloud是一套微服务开发的标准， 集成了很多优秀的开源框架，比如有名的<code>Netflflix</code>公司的众多项目。</p>
<blockquote>
<p>Spring Cloud 项目地址：<a href="https://spring.io/projects/spring-cloud" target="_blank" rel="noopener">https://spring.io/projects/spring-cloud</a> </p>
</blockquote>
<p>本测试环境采用阿里开源的Spring Cloud Alibaba微服务开发框架，Spring Cloud Alibaba是阿里巴巴公司基于 Spring Cloud标准实现一套微服务开发框架集合，它和Netflflix一样都是Spring Cloud微服务开发实现方案。</p>
<blockquote>
<p>Spring Cloud Alibaba项目地址：<a href="https://github.com/alibaba/spring-cloud-alibaba" target="_blank" rel="noopener">https://github.com/alibaba/spring-cloud-alibaba</a> </p>
</blockquote>
<p>通过Spring Cloud Alibaba实现解决： </p>
<ul>
<li>服务发现客户端从服务发现中心获取服务列表 </li>
<li>服务消费方通过负载均衡获取服务地址</li>
</ul>
<p>父工程<code>springboot-20-nacos-restful</code>的POM.xml</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version&#x3D;&quot;1.0&quot; encoding&#x3D;&quot;UTF-8&quot;?&gt;</span><br><span class="line">&lt;project xmlns&#x3D;&quot;http:&#x2F;&#x2F;maven.apache.org&#x2F;POM&#x2F;4.0.0&quot;</span><br><span class="line">         xmlns:xsi&#x3D;&quot;http:&#x2F;&#x2F;www.w3.org&#x2F;2001&#x2F;XMLSchema-instance&quot;</span><br><span class="line">         xsi:schemaLocation&#x3D;&quot;http:&#x2F;&#x2F;maven.apache.org&#x2F;POM&#x2F;4.0.0 http:&#x2F;&#x2F;maven.apache.org&#x2F;xsd&#x2F;maven-4.0.0.xsd&quot;&gt;</span><br><span class="line">    &lt;modelVersion&gt;4.0.0&lt;&#x2F;modelVersion&gt;</span><br><span class="line"></span><br><span class="line">    &lt;groupId&gt;cn.zysheep&lt;&#x2F;groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;springboot-20-nacos-restful&lt;&#x2F;artifactId&gt;</span><br><span class="line">    &lt;packaging&gt;pom&lt;&#x2F;packaging&gt;</span><br><span class="line">    &lt;version&gt;1.0-SNAPSHOT&lt;&#x2F;version&gt;</span><br><span class="line">    &lt;modules&gt;</span><br><span class="line">        &lt;module&gt;nacos-restful-provider&lt;&#x2F;module&gt;</span><br><span class="line">        &lt;module&gt;nacos-restful-consumer&lt;&#x2F;module&gt;</span><br><span class="line">    &lt;&#x2F;modules&gt;</span><br><span class="line"></span><br><span class="line">    &lt;!--统一管理依赖版本--&gt;</span><br><span class="line">    &lt;properties&gt;</span><br><span class="line">        &lt;project.build.sourceEncoding&gt;UTF-8&lt;&#x2F;project.build.sourceEncoding&gt;</span><br><span class="line">        &lt;project.reporting.outputEncoding&gt;UTF-8&lt;&#x2F;project.reporting.outputEncoding&gt;</span><br><span class="line">        &lt;java.version&gt;1.8&lt;&#x2F;java.version&gt;</span><br><span class="line">    &lt;&#x2F;properties&gt;</span><br><span class="line"></span><br><span class="line">    &lt;!--依赖定义--&gt;</span><br><span class="line">    &lt;!--dependencyManagement 定义依赖版本号。子工程直接加依赖即可，不需要再次加版本号，便于统一维护版本号--&gt;</span><br><span class="line">    &lt;dependencyManagement&gt;</span><br><span class="line">        &lt;dependencies&gt;</span><br><span class="line">            &lt;dependency&gt;</span><br><span class="line">                &lt;groupId&gt;org.springframework.boot&lt;&#x2F;groupId&gt;</span><br><span class="line">                &lt;artifactId&gt;spring-boot-starter-parent&lt;&#x2F;artifactId&gt;</span><br><span class="line">                &lt;version&gt;2.2.2.RELEASE&lt;&#x2F;version&gt;</span><br><span class="line">                &lt;type&gt;pom&lt;&#x2F;type&gt;</span><br><span class="line">                &lt;scope&gt;import&lt;&#x2F;scope&gt;</span><br><span class="line">            &lt;&#x2F;dependency&gt;</span><br><span class="line">            &lt;!-- https:&#x2F;&#x2F;mvnrepository.com&#x2F;artifact&#x2F;org.springframework.cloud&#x2F;spring-cloud-dependencies --&gt;</span><br><span class="line">            &lt;dependency&gt;</span><br><span class="line">                &lt;groupId&gt;org.springframework.cloud&lt;&#x2F;groupId&gt;</span><br><span class="line">                &lt;artifactId&gt;spring-cloud-dependencies&lt;&#x2F;artifactId&gt;</span><br><span class="line">                &lt;version&gt;Greenwich.RELEASE&lt;&#x2F;version&gt;</span><br><span class="line">                &lt;type&gt;pom&lt;&#x2F;type&gt;</span><br><span class="line">                &lt;scope&gt;runtime&lt;&#x2F;scope&gt;</span><br><span class="line">            &lt;&#x2F;dependency&gt;</span><br><span class="line"></span><br><span class="line">            &lt;!-- https:&#x2F;&#x2F;mvnrepository.com&#x2F;artifact&#x2F;com.alibaba.cloud&#x2F;spring-cloud-alibaba-dependencies --&gt;</span><br><span class="line">            &lt;dependency&gt;</span><br><span class="line">                &lt;groupId&gt;com.alibaba.cloud&lt;&#x2F;groupId&gt;</span><br><span class="line">                &lt;artifactId&gt;spring-cloud-alibaba-dependencies&lt;&#x2F;artifactId&gt;</span><br><span class="line">                &lt;version&gt;2.1.0.RELEASE&lt;&#x2F;version&gt;</span><br><span class="line">                &lt;type&gt;pom&lt;&#x2F;type&gt;</span><br><span class="line">                &lt;scope&gt;import&lt;&#x2F;scope&gt;</span><br><span class="line">            &lt;&#x2F;dependency&gt;</span><br><span class="line"></span><br><span class="line">        &lt;&#x2F;dependencies&gt;</span><br><span class="line">    &lt;&#x2F;dependencyManagement&gt;</span><br><span class="line">&lt;&#x2F;project&gt;</span><br></pre></td></tr></table></figure>

<p>分别在服务提供及服务消费工程中添加依赖，此依赖的作用是服务发现 </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;com.alibaba.cloud&lt;&#x2F;groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;spring-cloud-starter-alibaba-nacos-discovery&lt;&#x2F;artifactId&gt;</span><br><span class="line">&lt;&#x2F;dependency&gt;</span><br></pre></td></tr></table></figure>

<h3 id="服务注册"><a href="#服务注册" class="headerlink" title="服务注册"></a>服务注册</h3><p>在服务提供工程<code>nacos-restful-provider</code>中配置nacos服务发现相关的配置：  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">server:</span><br><span class="line">  port: 56010</span><br><span class="line">spring:</span><br><span class="line">  application:</span><br><span class="line">    name: nacos-restful-provider</span><br><span class="line">  cloud:</span><br><span class="line">    nacos:</span><br><span class="line">      discovery:</span><br><span class="line">        server-addr: 127.0.0.1:8848</span><br></pre></td></tr></table></figure>

<p>启动nacos ,启动服务提供,观察nacos服务列表，nacos-restful-provider注册成功\</p>
<p><img src="http://cdn.panyucable.cn/zysheep/QQ%E6%88%AA%E5%9B%BE20200609115921.png" alt=""> </p>
<ul>
<li><p>服务名称：每个服务在服务注册中心的标识，相当于Java中的类名</p>
</li>
<li><p>服务实例：网络中提供服务的实例，具有IP和端口，相当于Java中的对象，一个实例即为运行在服务器上的一个进程。</p>
</li>
</ul>
<h3 id="服务发现"><a href="#服务发现" class="headerlink" title="服务发现"></a>服务发现</h3><p>在服务消费工程<code>nacos-restful-consumer</code>中配置nacos服务发现相关的配置： </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">server:</span><br><span class="line">  port: 56020</span><br><span class="line"># 服务生产方地址</span><br><span class="line">provider:</span><br><span class="line">  address: 127.0.0.1:56010</span><br><span class="line"></span><br><span class="line">spring:</span><br><span class="line">  application:</span><br><span class="line">    name: nacos-restful-consumer</span><br><span class="line">  cloud:</span><br><span class="line">    nacos:</span><br><span class="line">      discovery:</span><br><span class="line">        server-addr: 127.0.0.1:8848</span><br></pre></td></tr></table></figure>

<p>修改Controller中远程调用的代码：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">@RestController</span><br><span class="line">public class RestConsumerController &#123;</span><br><span class="line"></span><br><span class="line">    &#x2F;&#x2F;服务id即注册中心的中的服务名</span><br><span class="line">    private String serviceId&#x3D;&quot;nacos-restful-provider&quot;;</span><br><span class="line"></span><br><span class="line">    @Autowired</span><br><span class="line">    private LoadBalancerClient loadBalancerClient;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    @GetMapping(value &#x3D; &quot;&#x2F;service2&quot;)</span><br><span class="line">    public String service2()&#123;</span><br><span class="line"></span><br><span class="line">        RestTemplate restTemplate &#x3D; new RestTemplate();</span><br><span class="line"></span><br><span class="line">        ServiceInstance instance &#x3D; loadBalancerClient.choose(serviceId);</span><br><span class="line">        URI uri &#x3D; instance.getUri();</span><br><span class="line">        System.out.println(uri);</span><br><span class="line">        &#x2F;&#x2F;调用服务</span><br><span class="line">        String providerResult &#x3D; restTemplate.getForObject(uri+ &quot;&#x2F;service&quot;,String.class);</span><br><span class="line">        return &quot;consumer invoke | &quot; + providerResult+&quot;port:&quot;+uri.getPort();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>执行流程：</p>
<ol>
<li>服务提供方将自己注册到服务注册中心 </li>
<li>服务消费方从注册中心获取服务地址 </li>
<li>进行远程调用 </li>
</ol>
<h3 id="负载均衡"><a href="#负载均衡" class="headerlink" title="负载均衡"></a>负载均衡</h3><p>在RESTful服务发现的流程中，ServiceA通过负载均衡调用ServiceB，下边来了解一下负载均衡:</p>
<p>负载均衡就是将用户请求（流量）通过一定的策略，分摊在多个服务实例上执行，它是系统处理高并发、缓解网络 压力和进行服务端扩容的重要手段之一。它分为服务端负载均衡和客户端负载均衡。</p>
<p><strong>服务器端负载均衡：</strong></p>
<p><img src="http://cdn.panyucable.cn/zysheep/QQ%E6%88%AA%E5%9B%BE20200609120244.png" alt=""></p>
<p>在负载均衡器中维护一个可用的服务实例清单，当客户端请求来临时，负载均衡服务器按照某种配置好的规则(负 载均衡算法)从可用服务实例清单中选取其一去处理客户端的请求。这就是服务端负载均衡。</p>
<blockquote>
<p>例如Nginx，通过Nginx进行负载均衡，客户端发送请求至Nginx，Nginx通过负载均衡算法，在多个服务器 之间选择一个进行访问。即在服务器端再进行负载均衡算法分配。 </p>
</blockquote>
<p><strong>客户端服务负载均衡：</strong></p>
<p><img src="http://cdn.panyucable.cn/zysheep/QQ%E6%88%AA%E5%9B%BE20200609120252.png" alt=""></p>
<blockquote>
<p>上边使用的LoadBalancerClient就是一个客户端负载均衡器，具体使用的是Ribbon客户端负载均衡器。 Ribbon在发送请求前通过负载均衡算法选择一个服务实例，然后进行访问，这是客户端负载均衡。即在客户 端就进行负载均衡的分配</p>
</blockquote>
<p>Ribbon是一个客户端负载均衡器，它的责任是从一组实例列表中挑选合适的实例，如何挑选？取决于负载均衡策 略 </p>
<p>Ribbon核心组件IRule是负载均衡策略接口，它有如下实现：</p>
<ul>
<li>RoundRobinRule(默认):轮询，即按一定的顺序轮换获取实例的地址。 </li>
<li>RandomRule:随机，即以随机的方式获取实例的地址。</li>
<li>AvailabilityFilteringRule: 会先过滤掉由于多次访问故障而处于断路器跳闸状态的服务,以及并发的连接数量 超过阈值的服务,然后对剩余的服务列表按照轮询策略进行访问;</li>
<li>WeightedResponseTimeRule: 根据平均响应时间计算所有服务的权重,响应时间越快,服务权重越大,被选中的 机率越高;刚启动时,如果统计信息不足,则使用RoundRobinRule策略,等统计信息足够时,会切换到 WeightedResponseTimeRule </li>
<li>RetryRule: 先按照RoundRobinRule的策略获取服务,如果获取服务失败,则在指定时间内会进行重试,获取可用 的服务; </li>
<li>BestAvailableRule: 会先过滤掉由于多次访问故障而处于断路器跳闸状态的服务,然后选择一个并发量最小的 服务; </li>
<li>ZoneAvoidanceRule: 默认规则,复合判断server所在区域的性能和server的可用性选择服务器; </li>
</ul>
<h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h3><p>服务注册与发现流程： </p>
<ol>
<li>服务提供方将自己注册到服务注册中心 </li>
<li>服务消费方从注册中心获取服务地址</li>
<li>通过客户端负载均衡器进行远程调用 </li>
</ol>
<p>##Dubbo服务发现</p>
<p>Dubbo是阿里巴巴公司开源的RPC框架，在国内有着非常大的用户群体，但是其微服务开发组件相对Spring Cloud 来说并不那么完善。</p>
<p>Spring Cloud Alibaba微服务开发框架集成了Dubbo，可实现微服务对外暴露Dubbo协议的接口，Dubbo协议相 比RESTful协议速度更快。 </p>
<p>RPC：RPC是远程过程调用（Remote Procedure Call）的缩写形式，调用RPC远程方法就像调用本地方法一样，非常方便，后边案例讲解具体过程。</p>
<h3 id="Dubbo服务架构"><a href="#Dubbo服务架构" class="headerlink" title="Dubbo服务架构"></a>Dubbo服务架构</h3><p>下图是微服务采用Dubbo协议的系统架构图:</p>
<p><img src="http://cdn.panyucable.cn/zysheep/QQ%E6%88%AA%E5%9B%BE20200609135607.png" alt=""></p>
<p>组件说明： </p>
<ol>
<li>客户端：前端或外部系统 </li>
<li>API网关：系统唯一入口，路由转发 </li>
<li>application-1 ：应用1，前端提供Http接口，接收用户的交互请求 </li>
<li>service-1 ：微服务1，提供业务逻辑处理服务 </li>
<li>service-2：微服务2，提供业务逻辑处理服务</li>
</ol>
<p>交互流程： </p>
<ol>
<li>网关负责客户端请求的统一入口，路由转发，前端通过网关请求后端服务。 </li>
<li>网关收到前端请求，转发请求给应用。 </li>
<li>应用接收前端请求，调用微服务进行业务逻辑处理 </li>
<li>微服务为应用提供业务逻辑处理的支撑，为应用提供Dubbo协议接口 </li>
</ol>
<p>优势分析： </p>
<blockquote>
<p>此架构同时提供RESTful和Dubbo接口服务，应用层对前端提供RESTful接口，RESTful是互联网通用的轻量级交互协议，方便前端接入系统；微服务层向应用层提供Dubbo接口，Dubbo接口基于RPC通信协议速度更快。 本架构采用阿里开源的Nacos，集服务发现和配置中心于一身，支持RESTful及Dubbo服务的注册。 </p>
</blockquote>
<h3 id="测试环境-2"><a href="#测试环境-2" class="headerlink" title="测试环境"></a>测试环境</h3><p>父工程：仍然使用springboot-21-nacos-dubbo。 </p>
<p>application1：nacos-dubbo-consumer。 </p>
<p>service1微服务：nacos‐dubbo‐service1</p>
<p> service2微服务：nacos‐dubbo‐service2</p>
<p>父工程<code>springboot-21-nacos-dubbo</code>Pom.xml</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version&#x3D;&quot;1.0&quot; encoding&#x3D;&quot;UTF-8&quot;?&gt;</span><br><span class="line">&lt;project xmlns&#x3D;&quot;http:&#x2F;&#x2F;maven.apache.org&#x2F;POM&#x2F;4.0.0&quot;</span><br><span class="line">         xmlns:xsi&#x3D;&quot;http:&#x2F;&#x2F;www.w3.org&#x2F;2001&#x2F;XMLSchema-instance&quot;</span><br><span class="line">         xsi:schemaLocation&#x3D;&quot;http:&#x2F;&#x2F;maven.apache.org&#x2F;POM&#x2F;4.0.0 http:&#x2F;&#x2F;maven.apache.org&#x2F;xsd&#x2F;maven-4.0.0.xsd&quot;&gt;</span><br><span class="line">    &lt;modelVersion&gt;4.0.0&lt;&#x2F;modelVersion&gt;</span><br><span class="line"></span><br><span class="line">    &lt;groupId&gt;cn.zysheep&lt;&#x2F;groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;springboot-21-nacos-dubbo&lt;&#x2F;artifactId&gt;</span><br><span class="line">    &lt;packaging&gt;pom&lt;&#x2F;packaging&gt;</span><br><span class="line">    &lt;version&gt;1.0-SNAPSHOT&lt;&#x2F;version&gt;</span><br><span class="line">    &lt;modules&gt;</span><br><span class="line">        &lt;module&gt;nacos‐dubbo‐service2&lt;&#x2F;module&gt;</span><br><span class="line">        &lt;module&gt;nacos-dubbo-consumer&lt;&#x2F;module&gt;</span><br><span class="line">        &lt;module&gt;nacos‐dubbo‐service1&lt;&#x2F;module&gt;</span><br><span class="line">    &lt;&#x2F;modules&gt;</span><br><span class="line">    &lt;!--统一管理依赖版本--&gt;</span><br><span class="line">    &lt;properties&gt;</span><br><span class="line">        &lt;project.build.sourceEncoding&gt;UTF-8&lt;&#x2F;project.build.sourceEncoding&gt;</span><br><span class="line">        &lt;project.reporting.outputEncoding&gt;UTF-8&lt;&#x2F;project.reporting.outputEncoding&gt;</span><br><span class="line">        &lt;java.version&gt;1.8&lt;&#x2F;java.version&gt;</span><br><span class="line">    &lt;&#x2F;properties&gt;</span><br><span class="line"></span><br><span class="line">    &lt;!--依赖定义--&gt;</span><br><span class="line">    &lt;!--dependencyManagement 定义依赖版本号。子工程直接加依赖即可，不需要再次加版本号，便于统一维护版本号--&gt;</span><br><span class="line"></span><br><span class="line">    &lt;dependencyManagement&gt;</span><br><span class="line">        &lt;dependencies&gt;</span><br><span class="line">            &lt;dependency&gt;</span><br><span class="line">                &lt;groupId&gt;org.springframework.boot&lt;&#x2F;groupId&gt;</span><br><span class="line">                &lt;artifactId&gt;spring-boot-starter-parent&lt;&#x2F;artifactId&gt;</span><br><span class="line">                &lt;version&gt;2.2.2.RELEASE&lt;&#x2F;version&gt;</span><br><span class="line">                &lt;type&gt;pom&lt;&#x2F;type&gt;</span><br><span class="line">                &lt;scope&gt;import&lt;&#x2F;scope&gt;</span><br><span class="line">            &lt;&#x2F;dependency&gt;</span><br><span class="line">            &lt;!-- https:&#x2F;&#x2F;mvnrepository.com&#x2F;artifact&#x2F;org.springframework.cloud&#x2F;spring-cloud-dependencies --&gt;</span><br><span class="line">            &lt;dependency&gt;</span><br><span class="line">                &lt;groupId&gt;org.springframework.cloud&lt;&#x2F;groupId&gt;</span><br><span class="line">                &lt;artifactId&gt;spring-cloud-dependencies&lt;&#x2F;artifactId&gt;</span><br><span class="line">                &lt;version&gt;Greenwich.RELEASE&lt;&#x2F;version&gt;</span><br><span class="line">                &lt;type&gt;pom&lt;&#x2F;type&gt;</span><br><span class="line">                &lt;scope&gt;runtime&lt;&#x2F;scope&gt;</span><br><span class="line">            &lt;&#x2F;dependency&gt;</span><br><span class="line"></span><br><span class="line">            &lt;!-- https:&#x2F;&#x2F;mvnrepository.com&#x2F;artifact&#x2F;com.alibaba.cloud&#x2F;spring-cloud-alibaba-dependencies --&gt;</span><br><span class="line">            &lt;dependency&gt;</span><br><span class="line">                &lt;groupId&gt;com.alibaba.cloud&lt;&#x2F;groupId&gt;</span><br><span class="line">                &lt;artifactId&gt;spring-cloud-alibaba-dependencies&lt;&#x2F;artifactId&gt;</span><br><span class="line">                &lt;version&gt;2.1.0.RELEASE&lt;&#x2F;version&gt;</span><br><span class="line">                &lt;type&gt;pom&lt;&#x2F;type&gt;</span><br><span class="line">                &lt;scope&gt;import&lt;&#x2F;scope&gt;</span><br><span class="line">            &lt;&#x2F;dependency&gt;</span><br><span class="line">        &lt;&#x2F;dependencies&gt;</span><br><span class="line">    &lt;&#x2F;dependencyManagement&gt;</span><br><span class="line"></span><br><span class="line">&lt;&#x2F;project&gt;</span><br></pre></td></tr></table></figure>

<h3 id="service2微服务"><a href="#service2微服务" class="headerlink" title="service2微服务"></a>service2微服务</h3><p>service2对外暴露dubbo协议的接口，考虑远程接口可能 会被其它多个服务调用，这里将service2的接口单独抽取 出api工程，service2微服务工程的结构如下： </p>
<p><img src="http://cdn.panyucable.cn/zysheep/QQ%E6%88%AA%E5%9B%BE20200609140658.png" alt=""></p>
<p>service2-api：存放接口，独立成一个工程方便被其它服务工程依赖。 </p>
<p>service2-server：存放接口实现，即dubbo服务的实现部分。 </p>
<h4 id="定义service2-api"><a href="#定义service2-api" class="headerlink" title="定义service2-api"></a>定义service2-api</h4><p>创建service2工程 </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version&#x3D;&quot;1.0&quot; encoding&#x3D;&quot;UTF-8&quot;?&gt;</span><br><span class="line">&lt;project xmlns&#x3D;&quot;http:&#x2F;&#x2F;maven.apache.org&#x2F;POM&#x2F;4.0.0&quot;</span><br><span class="line">         xmlns:xsi&#x3D;&quot;http:&#x2F;&#x2F;www.w3.org&#x2F;2001&#x2F;XMLSchema-instance&quot;</span><br><span class="line">         xsi:schemaLocation&#x3D;&quot;http:&#x2F;&#x2F;maven.apache.org&#x2F;POM&#x2F;4.0.0 http:&#x2F;&#x2F;maven.apache.org&#x2F;xsd&#x2F;maven-4.0.0.xsd&quot;&gt;</span><br><span class="line">    &lt;parent&gt;</span><br><span class="line">        &lt;artifactId&gt;springboot-21-nacos-dubbo&lt;&#x2F;artifactId&gt;</span><br><span class="line">        &lt;groupId&gt;cn.zysheep&lt;&#x2F;groupId&gt;</span><br><span class="line">        &lt;version&gt;1.0-SNAPSHOT&lt;&#x2F;version&gt;</span><br><span class="line">    &lt;&#x2F;parent&gt;</span><br><span class="line">    &lt;modelVersion&gt;4.0.0&lt;&#x2F;modelVersion&gt;</span><br><span class="line">    &lt;artifactId&gt;nacos‐dubbo‐service2&lt;&#x2F;artifactId&gt;</span><br><span class="line">    &lt;packaging&gt;pom&lt;&#x2F;packaging&gt;</span><br><span class="line">    &lt;modules&gt;</span><br><span class="line">        &lt;module&gt;service2‐api&lt;&#x2F;module&gt;</span><br><span class="line">        &lt;module&gt;service2‐server&lt;&#x2F;module&gt;</span><br><span class="line">    &lt;&#x2F;modules&gt;</span><br><span class="line"></span><br><span class="line">&lt;&#x2F;project&gt;</span><br></pre></td></tr></table></figure>

<p>创建service2-api工程</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version&#x3D;&quot;1.0&quot; encoding&#x3D;&quot;UTF-8&quot;?&gt;</span><br><span class="line">&lt;project xmlns&#x3D;&quot;http:&#x2F;&#x2F;maven.apache.org&#x2F;POM&#x2F;4.0.0&quot;</span><br><span class="line">         xmlns:xsi&#x3D;&quot;http:&#x2F;&#x2F;www.w3.org&#x2F;2001&#x2F;XMLSchema-instance&quot;</span><br><span class="line">         xsi:schemaLocation&#x3D;&quot;http:&#x2F;&#x2F;maven.apache.org&#x2F;POM&#x2F;4.0.0 http:&#x2F;&#x2F;maven.apache.org&#x2F;xsd&#x2F;maven-4.0.0.xsd&quot;&gt;</span><br><span class="line">    &lt;parent&gt;</span><br><span class="line">        &lt;artifactId&gt;nacos‐dubbo‐service2&lt;&#x2F;artifactId&gt;</span><br><span class="line">        &lt;groupId&gt;cn.zysheep&lt;&#x2F;groupId&gt;</span><br><span class="line">        &lt;version&gt;1.0-SNAPSHOT&lt;&#x2F;version&gt;</span><br><span class="line">    &lt;&#x2F;parent&gt;</span><br><span class="line">    &lt;modelVersion&gt;4.0.0&lt;&#x2F;modelVersion&gt;</span><br><span class="line"></span><br><span class="line">    &lt;artifactId&gt;service2‐api&lt;&#x2F;artifactId&gt;</span><br><span class="line"></span><br><span class="line">&lt;&#x2F;project&gt;</span><br></pre></td></tr></table></figure>

<p>定义接口 </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">package cn.zysheep.microservice.api;</span><br><span class="line"></span><br><span class="line">public interface Service2Api &#123;</span><br><span class="line">    public String dubboService2();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="定义service2-server"><a href="#定义service2-server" class="headerlink" title="定义service2-server"></a>定义service2-server</h4><p>创建service2-server工程 </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version&#x3D;&quot;1.0&quot; encoding&#x3D;&quot;UTF-8&quot;?&gt;</span><br><span class="line">&lt;project xmlns&#x3D;&quot;http:&#x2F;&#x2F;maven.apache.org&#x2F;POM&#x2F;4.0.0&quot;</span><br><span class="line">         xmlns:xsi&#x3D;&quot;http:&#x2F;&#x2F;www.w3.org&#x2F;2001&#x2F;XMLSchema-instance&quot;</span><br><span class="line">         xsi:schemaLocation&#x3D;&quot;http:&#x2F;&#x2F;maven.apache.org&#x2F;POM&#x2F;4.0.0 http:&#x2F;&#x2F;maven.apache.org&#x2F;xsd&#x2F;maven-4.0.0.xsd&quot;&gt;</span><br><span class="line">    &lt;parent&gt;</span><br><span class="line">        &lt;artifactId&gt;nacos‐dubbo‐service2&lt;&#x2F;artifactId&gt;</span><br><span class="line">        &lt;groupId&gt;cn.zysheep&lt;&#x2F;groupId&gt;</span><br><span class="line">        &lt;version&gt;1.0-SNAPSHOT&lt;&#x2F;version&gt;</span><br><span class="line">    &lt;&#x2F;parent&gt;</span><br><span class="line">    &lt;modelVersion&gt;4.0.0&lt;&#x2F;modelVersion&gt;</span><br><span class="line"></span><br><span class="line">    &lt;artifactId&gt;service2‐server&lt;&#x2F;artifactId&gt;</span><br><span class="line"></span><br><span class="line">    &lt;dependencies&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;cn.zysheep&lt;&#x2F;groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;service2‐api&lt;&#x2F;artifactId&gt;</span><br><span class="line">            &lt;version&gt;1.0-SNAPSHOT&lt;&#x2F;version&gt;</span><br><span class="line">        &lt;&#x2F;dependency&gt;</span><br><span class="line">        &lt;!--dubbo--&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;com.alibaba.cloud&lt;&#x2F;groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;spring-cloud-starter-dubbo&lt;&#x2F;artifactId&gt;</span><br><span class="line">        &lt;&#x2F;dependency&gt;</span><br><span class="line">        &lt;!--dubbo--&gt;</span><br><span class="line">        &lt;!--nacos-discovery--&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;com.alibaba.cloud&lt;&#x2F;groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;spring-cloud-starter-alibaba-nacos-discovery&lt;&#x2F;artifactId&gt;</span><br><span class="line">        &lt;&#x2F;dependency&gt;</span><br><span class="line">        &lt;!--nacos-discovery--&gt;</span><br><span class="line"></span><br><span class="line">    &lt;&#x2F;dependencies&gt;</span><br><span class="line">&lt;&#x2F;project&gt;</span><br></pre></td></tr></table></figure>

<p>定义接口实现</p>
<blockquote>
<p> 注意：使用@org.apache.dubbo.confifig.annotation.Service标记dubbo服务 </p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">package cn.zysheep.microservice.service;</span><br><span class="line"></span><br><span class="line">import cn.zysheep.microservice.api.Service2Api;</span><br><span class="line">import org.apache.dubbo.config.annotation.Service;</span><br><span class="line"></span><br><span class="line">&#x2F;**</span><br><span class="line"> * @version v1.0</span><br><span class="line"> * @ProjectName: springboot-learning-examples</span><br><span class="line"> * @ClassName: Service2ApiImpl</span><br><span class="line"> * @Description: 对内暴露dubbo协议给上层Application应用调用</span><br><span class="line"> * @Author: 三月三</span><br><span class="line"> *&#x2F;</span><br><span class="line"></span><br><span class="line">@Service</span><br><span class="line">public class Service2ApiImpl implements Service2Api &#123;</span><br><span class="line">    public String dubboService2() &#123;</span><br><span class="line">        return &quot;dubboService2&quot;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>定义启动类</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">package cn.zysheep.microservice;</span><br><span class="line"></span><br><span class="line">import org.springframework.boot.SpringApplication;</span><br><span class="line">import org.springframework.boot.autoconfigure.SpringBootApplication;</span><br><span class="line"></span><br><span class="line">&#x2F;**</span><br><span class="line"> * @version v1.0</span><br><span class="line"> * @ProjectName: springboot-learning-examples</span><br><span class="line"> * @ClassName: Service2Bootstrap</span><br><span class="line"> * @Description: 启动类</span><br><span class="line"> * @Author: 三月三</span><br><span class="line"> *&#x2F;</span><br><span class="line">@SpringBootApplication</span><br><span class="line">public class Service2Bootstrap &#123;</span><br><span class="line">    public static void main(String[] args) &#123;</span><br><span class="line">        SpringApplication.run(Service2Bootstrap.class,args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>定义配置文件bootstrap.yml </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">server:</span><br><span class="line">  port: 56040 #启动端口 命令行注入</span><br><span class="line"></span><br><span class="line">spring:</span><br><span class="line">  application:</span><br><span class="line">    name: dubbo-service2</span><br><span class="line">  main:</span><br><span class="line">    allow-bean-definition-overriding: true # Spring Boot 2.1 需要设定</span><br><span class="line">  cloud:</span><br><span class="line">    nacos:</span><br><span class="line">      discovery:</span><br><span class="line">        server-addr: 127.0.0.1:8848</span><br><span class="line">dubbo:</span><br><span class="line">  scan:</span><br><span class="line">    # dubbo 服务扫描基准包</span><br><span class="line">    base-packages: cn.zysheep.microservice.service</span><br><span class="line">  protocol:</span><br><span class="line">    # dubbo 协议</span><br><span class="line">    name: dubbo</span><br><span class="line">    # dubbo 协议端口</span><br><span class="line">    port: 20891</span><br><span class="line">  registry:</span><br><span class="line">    address: nacos:&#x2F;&#x2F;127.0.0.1:8848</span><br><span class="line">  application:</span><br><span class="line">    qos-enable: false #dubbo运维服务是否开启</span><br><span class="line">  consumer:</span><br><span class="line">    check: false  #启动时就否检查依赖的服务</span><br></pre></td></tr></table></figure>

<p>bootstrap.yml内容中以dubbo开头的为dubbo服务 的配置：</p>
<ul>
<li><p>dubbo.scan.base-packages : 指定 Dubbo 服务实现类的扫描基准包，将 @org.apache.dubbo.confifig.annotation.Service注解标注的service暴露为dubbo服务。 </p>
</li>
<li><p>dubbo.protocol : Dubbo 服务暴露的协议配置，其中子属性 name 为协议名称， port 为dubbo协议端口可以指定多协议，如：dubbo.protocol.rmi.port=1099 </p>
</li>
<li><p>dubbo.registry : Dubbo 服务注册中心配置，其中子属性 address 的值 “nacos://127.0.0.1:8848”，说明dubbo服务注册到nacos 相当于原生dubbo的xml配置中的 &lt;dubbo:registry address=”10.20.153.10:9090” /&gt; </p>
<p>bootstrap.yml内容的上半部分为SpringCloud的相关配置：  </p>
</li>
<li><p>spring.application.name : Spring 应用名称，用于 Spring Cloud 服务注册和发现</p>
<blockquote>
<p>该值在 Dubbo Spring Cloud 加持下被视作 dubbo.application.name ，因此，无需再显示地配置 </p>
<p>dubbo.application.name </p>
</blockquote>
</li>
<li><p>spring.cloud.nacos.discovery : Nacos 服务发现与注册配置，其中子属性 server-addr 指定 Nacos 服务器 主机和端口 </p>
</li>
</ul>
<h3 id="application1调用service2"><a href="#application1调用service2" class="headerlink" title="application1调用service2"></a>application1调用service2</h3><p>根据dubbo服务的架构图，nacos-dubbo-consumer作为application1，实现application1调用 service2。</p>
<h4 id="引用service2"><a href="#引用service2" class="headerlink" title="引用service2"></a>引用service2</h4><p>  在nacos-dubbo-consumer工程中引用service2依赖 在pom.xml中引入service2-api的依赖 </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;cn.zysheep&lt;&#x2F;groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;service2‐api&lt;&#x2F;artifactId&gt;</span><br><span class="line">    &lt;version&gt;1.0-SNAPSHOT&lt;&#x2F;version&gt;</span><br><span class="line">&lt;&#x2F;dependency&gt;</span><br></pre></td></tr></table></figure>

<p>引入 spring-cloud-starter-dubbo依赖，它会根据接口生成代理对象 </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;!--dubbo--&gt;</span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;com.alibaba.cloud&lt;&#x2F;groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;spring-cloud-starter-dubbo&lt;&#x2F;artifactId&gt;</span><br><span class="line">&lt;&#x2F;dependency&gt;</span><br><span class="line">&lt;!--dubbo--&gt;</span><br></pre></td></tr></table></figure>

<h4 id="实现远程调用"><a href="#实现远程调用" class="headerlink" title="实现远程调用"></a>实现远程调用</h4><p>修改nacos-dubbo-consumer工程的RestConsumerController： ​    </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">package cn.zysheep.springboot.controller;</span><br><span class="line"></span><br><span class="line">import cn.zysheep.microservice.api.Service2Api;</span><br><span class="line">import org.apache.dubbo.config.annotation.Reference;</span><br><span class="line">import org.springframework.web.bind.annotation.GetMapping;</span><br><span class="line">import org.springframework.web.bind.annotation.RestController;</span><br><span class="line"></span><br><span class="line">&#x2F;**</span><br><span class="line"> * @version v1.0</span><br><span class="line"> * @ProjectName: springboot-learning-examples</span><br><span class="line"> * @ClassName: DubboConsumerController</span><br><span class="line"> * @Description: TODO(一句话描述该类的功能)</span><br><span class="line"> * @Author: 三月三</span><br><span class="line"> *&#x2F;</span><br><span class="line">@RestController</span><br><span class="line">public class DubboConsumerService2Controller &#123;</span><br><span class="line"></span><br><span class="line">    @Reference</span><br><span class="line">    private Service2Api service2Api;</span><br><span class="line"></span><br><span class="line">    @GetMapping(&quot;&#x2F;service2&quot;)</span><br><span class="line">    public String service2()&#123;</span><br><span class="line">        return  &quot;consumer dubbo invoke | &quot;+service2Api.dubboService2();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>Note：注意：这里的 @Reference 注解是 org.apache.dubbo.config.annotation.Reference</p>
</blockquote>
<p>请求：<a href="http://127.0.0.1:56020/service2" target="_blank" rel="noopener">http://127.0.0.1:56020/service2</a> 显示：consumer dubbo invoke | dubboService2 表明service2调用成功</p>
<h3 id="service1微服务"><a href="#service1微服务" class="headerlink" title="service1微服务"></a>service1微服务</h3><p>service1采用和service2相同的工程结构。 实现service1对外暴露dubbo接口，并用实现service1调用service2。 </p>
<h4 id="定义service1-api"><a href="#定义service1-api" class="headerlink" title="定义service1-api"></a>定义service1-api</h4><p>创建service1工程 </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version&#x3D;&quot;1.0&quot; encoding&#x3D;&quot;UTF-8&quot;?&gt;</span><br><span class="line">&lt;project xmlns&#x3D;&quot;http:&#x2F;&#x2F;maven.apache.org&#x2F;POM&#x2F;4.0.0&quot;</span><br><span class="line">         xmlns:xsi&#x3D;&quot;http:&#x2F;&#x2F;www.w3.org&#x2F;2001&#x2F;XMLSchema-instance&quot;</span><br><span class="line">         xsi:schemaLocation&#x3D;&quot;http:&#x2F;&#x2F;maven.apache.org&#x2F;POM&#x2F;4.0.0 http:&#x2F;&#x2F;maven.apache.org&#x2F;xsd&#x2F;maven-4.0.0.xsd&quot;&gt;</span><br><span class="line">    &lt;parent&gt;</span><br><span class="line">        &lt;artifactId&gt;springboot-21-nacos-dubbo&lt;&#x2F;artifactId&gt;</span><br><span class="line">        &lt;groupId&gt;cn.zysheep&lt;&#x2F;groupId&gt;</span><br><span class="line">        &lt;version&gt;1.0-SNAPSHOT&lt;&#x2F;version&gt;</span><br><span class="line">    &lt;&#x2F;parent&gt;</span><br><span class="line">    &lt;modelVersion&gt;4.0.0&lt;&#x2F;modelVersion&gt;</span><br><span class="line">    &lt;artifactId&gt;nacos‐dubbo‐service1&lt;&#x2F;artifactId&gt;</span><br><span class="line">    &lt;packaging&gt;pom&lt;&#x2F;packaging&gt;</span><br><span class="line">    &lt;modules&gt;</span><br><span class="line">        &lt;module&gt;service1‐api&lt;&#x2F;module&gt;</span><br><span class="line">        &lt;module&gt;service1‐server&lt;&#x2F;module&gt;</span><br><span class="line">    &lt;&#x2F;modules&gt;</span><br><span class="line">&lt;&#x2F;project&gt;</span><br></pre></td></tr></table></figure>

<p>创建service1-api工程</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version&#x3D;&quot;1.0&quot; encoding&#x3D;&quot;UTF-8&quot;?&gt;</span><br><span class="line">&lt;project xmlns&#x3D;&quot;http:&#x2F;&#x2F;maven.apache.org&#x2F;POM&#x2F;4.0.0&quot;</span><br><span class="line">         xmlns:xsi&#x3D;&quot;http:&#x2F;&#x2F;www.w3.org&#x2F;2001&#x2F;XMLSchema-instance&quot;</span><br><span class="line">         xsi:schemaLocation&#x3D;&quot;http:&#x2F;&#x2F;maven.apache.org&#x2F;POM&#x2F;4.0.0 http:&#x2F;&#x2F;maven.apache.org&#x2F;xsd&#x2F;maven-4.0.0.xsd&quot;&gt;</span><br><span class="line">    &lt;parent&gt;</span><br><span class="line">        &lt;artifactId&gt;nacos‐dubbo‐service1&lt;&#x2F;artifactId&gt;</span><br><span class="line">        &lt;groupId&gt;cn.zysheep&lt;&#x2F;groupId&gt;</span><br><span class="line">        &lt;version&gt;1.0-SNAPSHOT&lt;&#x2F;version&gt;</span><br><span class="line">    &lt;&#x2F;parent&gt;</span><br><span class="line">    &lt;modelVersion&gt;4.0.0&lt;&#x2F;modelVersion&gt;</span><br><span class="line">    &lt;artifactId&gt;service1‐api&lt;&#x2F;artifactId&gt;</span><br><span class="line">&lt;&#x2F;project&gt;</span><br></pre></td></tr></table></figure>

<p>定义接口 </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">package cn.zysheep.microservice.service1.api;</span><br><span class="line"></span><br><span class="line">public interface Service1Api &#123;</span><br><span class="line">    public String dubboService1();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="定义service1-server"><a href="#定义service1-server" class="headerlink" title="定义service1-server"></a>定义service1-server</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version&#x3D;&quot;1.0&quot; encoding&#x3D;&quot;UTF-8&quot;?&gt;</span><br><span class="line">&lt;project xmlns&#x3D;&quot;http:&#x2F;&#x2F;maven.apache.org&#x2F;POM&#x2F;4.0.0&quot;</span><br><span class="line">         xmlns:xsi&#x3D;&quot;http:&#x2F;&#x2F;www.w3.org&#x2F;2001&#x2F;XMLSchema-instance&quot;</span><br><span class="line">         xsi:schemaLocation&#x3D;&quot;http:&#x2F;&#x2F;maven.apache.org&#x2F;POM&#x2F;4.0.0 http:&#x2F;&#x2F;maven.apache.org&#x2F;xsd&#x2F;maven-4.0.0.xsd&quot;&gt;</span><br><span class="line">    &lt;parent&gt;</span><br><span class="line">        &lt;artifactId&gt;nacos‐dubbo‐service1&lt;&#x2F;artifactId&gt;</span><br><span class="line">        &lt;groupId&gt;cn.zysheep&lt;&#x2F;groupId&gt;</span><br><span class="line">        &lt;version&gt;1.0-SNAPSHOT&lt;&#x2F;version&gt;</span><br><span class="line">    &lt;&#x2F;parent&gt;</span><br><span class="line">    &lt;modelVersion&gt;4.0.0&lt;&#x2F;modelVersion&gt;</span><br><span class="line"></span><br><span class="line">    &lt;artifactId&gt;service1‐server&lt;&#x2F;artifactId&gt;</span><br><span class="line"></span><br><span class="line">    &lt;dependencies&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;cn.zysheep&lt;&#x2F;groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;service1‐api&lt;&#x2F;artifactId&gt;</span><br><span class="line">            &lt;version&gt;1.0-SNAPSHOT&lt;&#x2F;version&gt;</span><br><span class="line">        &lt;&#x2F;dependency&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;cn.zysheep&lt;&#x2F;groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;service2‐api&lt;&#x2F;artifactId&gt;</span><br><span class="line">            &lt;version&gt;1.0-SNAPSHOT&lt;&#x2F;version&gt;</span><br><span class="line">        &lt;&#x2F;dependency&gt;</span><br><span class="line"></span><br><span class="line">        &lt;!--dubbo--&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;com.alibaba.cloud&lt;&#x2F;groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;spring-cloud-starter-dubbo&lt;&#x2F;artifactId&gt;</span><br><span class="line">        &lt;&#x2F;dependency&gt;</span><br><span class="line">        &lt;!--dubbo--&gt;</span><br><span class="line">        &lt;!--nacos-discovery--&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;com.alibaba.cloud&lt;&#x2F;groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;spring-cloud-starter-alibaba-nacos-discovery&lt;&#x2F;artifactId&gt;</span><br><span class="line">        &lt;&#x2F;dependency&gt;</span><br><span class="line">        &lt;!--nacos-discovery--&gt;</span><br><span class="line">    &lt;&#x2F;dependencies&gt;</span><br><span class="line"></span><br><span class="line">&lt;&#x2F;project&gt;</span><br></pre></td></tr></table></figure>

<p>定义接口实现 </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">package cn.zysheep.microservice.service1.service;</span><br><span class="line"></span><br><span class="line">import cn.zysheep.microservice.api.Service2Api;</span><br><span class="line">import cn.zysheep.microservice.service1.api.Service1Api;</span><br><span class="line">import org.apache.dubbo.config.annotation.Reference;</span><br><span class="line">import org.apache.dubbo.config.annotation.Service;</span><br><span class="line"></span><br><span class="line">&#x2F;**</span><br><span class="line"> * @version v1.0</span><br><span class="line"> * @ProjectName: springboot-learning-examples</span><br><span class="line"> * @ClassName: Service1ApiImpl</span><br><span class="line"> * @Description: TODO(一句话描述该类的功能)</span><br><span class="line"> * @Author: 三月三</span><br><span class="line"> *&#x2F;</span><br><span class="line"></span><br><span class="line">@Service</span><br><span class="line">public class Service1ApiImpl implements Service1Api &#123;</span><br><span class="line"></span><br><span class="line">    @Reference</span><br><span class="line">    private Service2Api service2Api;</span><br><span class="line"></span><br><span class="line">    public String dubboService1() &#123;</span><br><span class="line">        return &quot;dubboService1 invoke&quot;+service2Api.dubboService2();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>定义启动类 </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">package cn.zysheep.microservice.service1;</span><br><span class="line"></span><br><span class="line">import org.springframework.boot.SpringApplication;</span><br><span class="line">import org.springframework.boot.autoconfigure.SpringBootApplication;</span><br><span class="line"></span><br><span class="line">&#x2F;**</span><br><span class="line"> * @version v1.0</span><br><span class="line"> * @ProjectName: springboot-learning-examples</span><br><span class="line"> * @ClassName: Service1Bootstrap</span><br><span class="line"> * @Description: TODO(一句话描述该类的功能)</span><br><span class="line"> * @Author: 三月三</span><br><span class="line"> *&#x2F;</span><br><span class="line">@SpringBootApplication</span><br><span class="line">public class Service1Bootstrap &#123;</span><br><span class="line">    public static void main(String[] args) &#123;</span><br><span class="line">        SpringApplication.run(Service1Bootstrap.class,args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>定义配置文件bootstrap.yml </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">server:</span><br><span class="line">  port: 56030 #启动端口 命令行注入</span><br><span class="line"></span><br><span class="line">spring:</span><br><span class="line">  application:</span><br><span class="line">    name: dubbo-service1</span><br><span class="line">  main:</span><br><span class="line">    allow-bean-definition-overriding: true # Spring Boot 2.1 需要设定</span><br><span class="line">  cloud:</span><br><span class="line">    nacos:</span><br><span class="line">      discovery:</span><br><span class="line">        server-addr: 127.0.0.1:8848</span><br><span class="line">dubbo:</span><br><span class="line">  scan:</span><br><span class="line">    # dubbo 服务扫描基准包</span><br><span class="line">    base-packages: cn.zysheep.microservice.service1.service</span><br><span class="line">  protocol:</span><br><span class="line">    # dubbo 协议</span><br><span class="line">    name: dubbo</span><br><span class="line">    # dubbo 协议端口</span><br><span class="line">    port: 20881</span><br><span class="line">  registry:</span><br><span class="line">    address: nacos:&#x2F;&#x2F;127.0.0.1:8848</span><br><span class="line">  application:</span><br><span class="line">    qos-enable: false #dubbo运维服务是否开启</span><br><span class="line">  consumer:</span><br><span class="line">    check: false  #启动时就否检查依赖的服务</span><br></pre></td></tr></table></figure>

<h3 id="application1调用service1"><a href="#application1调用service1" class="headerlink" title="application1调用service1"></a>application1调用service1</h3><p>参考 application1调用service2的方法实现。</p>
<ol>
<li><p>在application1引入 service1-api的依赖</p>
</li>
<li><p>在application1的controller中调用service1接口 </p>
</li>
<li><p>3、测试，请求<a href="http://127.0.0.1:56020/service3" target="_blank" rel="noopener">http://127.0.0.1:56020/service3</a> </p>
<p>显示 ：consumer dubbo invoke | dubboService1|dubboService2，表明调用service1成功，service1调用 </p>
<p>service2成功。 </p>
</li>
<li><pre><code>package cn.zysheep.springboot.controller;

import cn.zysheep.microservice.service1.api.Service1Api;
import org.apache.dubbo.config.annotation.Reference;
import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.RestController;

/**
 * @version v1.0
 * @ProjectName: springboot-learning-examples
 * @ClassName: DubboConsumerController
 * @Description: TODO(一句话描述该类的功能)
 * @Author: 三月三
 */
@RestController
public class DubboConsumerService1Controller {
    @Reference
    private Service1Api service1Api;

    @GetMapping(&quot;/service1&quot;)
    public String service1(){
        return  &quot;consumer dubbo invoke | &quot;+service1Api.dubboService1();
    }
}
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">   测试，请求http:&#x2F;&#x2F;127.0.0.1:56020&#x2F;service3 ;显示 ：&#96;consumer dubbo invoke | dubboService1|dubboService2&#96;，表明调用service1成功，service1调用service2成功。</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">## 服务发现数据模型</span><br><span class="line"></span><br><span class="line">### Namespace 隔离设计 </span><br><span class="line"></span><br><span class="line">命名空间(Namespace)用于进行租户粒度的隔离，Namespace 的常用场景之一是不同环境的隔离，例如开发测试 环境和生产环境的资源（如配置、服务）隔离等。 </span><br><span class="line"></span><br><span class="line">### 命名空间管理</span><br><span class="line"></span><br><span class="line">命名空间(Namespace)是用于隔离多个环境的（如开发、测试、生产），而每个应用在不同环境的同一个配置（如数据库数据源）的值是不一样的。因此，我们应针对企业项目实际研发流程、环境进行规划。 如某软件公司拥有开发、测试、生产三套环境，那么我们应该针对这三个环境分别建立三个namespace。 </span><br><span class="line"></span><br><span class="line">![](http:&#x2F;&#x2F;cdn.panyucable.cn&#x2F;zysheep&#x2F;QQ截图20200609142622.png)</span><br><span class="line"></span><br><span class="line">&gt; Note: namesace 为 public 是 nacos 的一个保留空间，如果您需要创建自己的 namespace，不要和 public 重名，以一个实际业务场景有具体语义的名字来命名，以免带来字面上不容易区分自己是哪一个 namespace。 </span><br><span class="line"></span><br><span class="line">&gt; Note：在编写程序获取配置集时，指定的namespace参数一定要填写命名空间ID，而不是名称 </span><br><span class="line"></span><br><span class="line">### 数据模型</span><br><span class="line"></span><br><span class="line">Nacos在经过阿里内部多年生产经验后提炼出的数据模型，则是一种服务-集群-实例的三层模型，这样基本可以满 足服务在所有场景下的数据存储和管理。 </span><br><span class="line"></span><br><span class="line">![](http:&#x2F;&#x2F;cdn.panyucable.cn&#x2F;zysheep&#x2F;QQ截图20200609142741.png)</span><br><span class="line"></span><br><span class="line">nacos服务发现的数据模型如下：</span><br><span class="line"></span><br><span class="line">**服务:**对外提供的软件功能，通过网络访问预定义的接口。</span><br><span class="line"></span><br><span class="line">**服务名 :**服务提供的标识，通过该标识可以唯一确定要访问的服务</span><br><span class="line"></span><br><span class="line">**实例:**提供一个或多个服务的具有可访问网络地址（IP:Port）的进程，启动一个服务，就产生了一个服务实例。</span><br><span class="line"></span><br><span class="line">**元信息:**Nacos数据（如配置和服务）描述信息，如服务版本、权重、容灾策略、负载均衡策略、鉴权配置、各种自定义标 签 (label)，从作用范围来看，分为服务级别的元信息、集群的元信息及实例的元信息。 </span><br><span class="line"></span><br><span class="line">**集群:**服务实例的集合，服务实例组成一个默认集群, 集群可以被进一步按需求划分，划分的单位可以是虚拟集群，相同 集群下的实例才能相互感知。</span><br><span class="line"></span><br><span class="line">通过数据模型可知：</span><br><span class="line"></span><br><span class="line">&gt; 应用通过Namespace、Service、Cluster(DEFAULT)的配置，描述了该服务向哪个环境（如开发环境）的哪个集群 注册实例</span><br><span class="line"></span><br><span class="line">例子如下：</span><br></pre></td></tr></table></figure>
spring:
application:
 name: nacos-config-test
cloud:
 nacos:
   discovery:
     server-addr: 127.0.0.1:8848 # 注册中心地址
     namespace: fbbcbf8a-5d5f-45fc-9074-9b96677c1adb   #  开发环境
     cluster‐name: DEFAULT # 默认集群，可不填写
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">&gt; Note: 集群作为实例的隔离，相同集群的实例才能相互感知。</span><br><span class="line">&gt;</span><br><span class="line">&gt; Note: namespace、cluster-name若不填写都将采取默认值，namespace的默认是public命名空间,cluster-name的默认值为DEFAULT集群。 </span><br><span class="line"></span><br><span class="line"># Nacos配置管理 </span><br><span class="line"></span><br><span class="line">## 理解配置中心</span><br><span class="line"></span><br><span class="line">### 什么是配置 </span><br><span class="line"></span><br><span class="line">应用程序在启动和运行的时候往往需要读取一些配置信息，配置基本上伴随着应用程序的整个生命周期，比如：数 据库连接参数、启动参数等。</span><br><span class="line"></span><br><span class="line">配置主要有以下几个特点： </span><br><span class="line"></span><br><span class="line">-  配置是独立于程序的只读变量</span><br><span class="line">  - 配置对于程序是只读的，程序通过读取配置来改变自己的行为，但是程序不应该去改变配置</span><br><span class="line">- 配置伴随应用的整个生命周期</span><br><span class="line">  - 配置贯穿于应用的整个生命周期，应用在启动时通过读取配置来初始化，在运行时根据配置调整行为。比如：启动时需要读取服务的端口号、系统在运行过程中需要读取定时策略执行定时任务等。 </span><br><span class="line">- 配置可以有多种加载方式 </span><br><span class="line">  - 常见的有程序内部hard code，配置文件，环境变量，启动参数，基于数据库等</span><br><span class="line">- 配置需要治理</span><br><span class="line">  - 同一份程序在不同的环境（开发，测试，生产）、不同的集群（如不同的数据中心）经常需要有不同的配置，所以需要有完善的环境、集群配置管理 </span><br><span class="line"></span><br><span class="line">### 什么是配置中心</span><br><span class="line"></span><br><span class="line">在微服务架构中，当系统从一个单体应用，被拆分成分布式系统上一个个服务节点后，配置文件也必须跟着迁移 （分割），这样配置就分散了，不仅如此，分散中还包含着冗余;下图显示了配置中心的功能，配置中心将配置从各应用中剥离出来，对配置进行统一管理，应用自身不需要自己去管理配置。</span><br><span class="line"></span><br><span class="line">![](http:&#x2F;&#x2F;cdn.panyucable.cn&#x2F;zysheep&#x2F;QQ截图20200609143624.png)</span><br><span class="line"></span><br><span class="line">配置中心的服务流程如下</span><br><span class="line"></span><br><span class="line">1.  用户在配置中心更新配置信息。 </span><br><span class="line">2. 服务A和服务B及时得到配置更新通知，从配置中心获取配置</span><br><span class="line"></span><br><span class="line">&gt; 总得来说，配置中心就是一种统一管理各种应用配置的基础服务组件</span><br><span class="line"></span><br><span class="line">###  主流配置中心对比 </span><br><span class="line"></span><br><span class="line">目前市面上用的比较多的配置中心有：Spring Cloud Confifig、Apollo、Nacos和Disconf等。 由于Disconf不再维护，下面主要对比一下Spring Cloud Confifig、Apollo和Nacos。</span><br><span class="line"></span><br><span class="line">| 对比项目      | Spring Cloud Confifig  | Apollo                   | Nacos                    |</span><br><span class="line">| ------------- | ---------------------- | ------------------------ | ------------------------ |</span><br><span class="line">| 配置实时推送  | 支持(Spring Cloud Bus) | 支持(HTTP长轮询1s内)     | 支持(HTTP长轮询1s内)     |</span><br><span class="line">| 版本管理      | 支持(Git)              | 支持                     | 支持                     |</span><br><span class="line">| 配置回滚      | 支持(Git)              | 支持                     | 支持                     |</span><br><span class="line">| 灰度发布      | 支持                   | 支持                     | 不支持                   |</span><br><span class="line">| 权限管理      | 支持(依赖Git)          | 支持                     | 不支持                   |</span><br><span class="line">| 多集群        | 支持                   | 支持                     | 支持                     |</span><br><span class="line">| 多环境        | 支持                   | 支持                     | 支持                     |</span><br><span class="line">| 监听查询      | 支持                   | 支持                     | 支持                     |</span><br><span class="line">| 多语言        | 只支持Java             | 主流语言，提供了Open API | 主流语言，提供了Open API |</span><br><span class="line">| 配置格式校验  | 不支持                 | 支持                     | 支持                     |</span><br><span class="line">| 单机读(QPS)   | 7(限流所致)            | 9000                     | 15000                    |</span><br><span class="line">| 单击写(QPS)   | 5(限流所致)            | 1100                     | 1800                     |</span><br><span class="line">| 3节点读 (QPS) | 21(限流所致)           | 27000                    | 45000                    |</span><br><span class="line">| 3节点写 (QPS) | 5(限流所致)            | 3300                     | 5600                     |</span><br><span class="line"></span><br><span class="line">&gt; 从配置中心角度来看，性能方面Nacos的读写性能最高，Apollo次之，Spring Cloud Confifig依赖Git场景不适合开 放的大规模自动化运维API。功能方面Apollo最为完善，nacos具有Apollo大部分配置管理功能，而Spring Cloud Confifig不带运维管理界面，需要自行开发。Nacos的一大优势是整合了注册中心、配置中心功能，部署和操作相比 Apollo都要直观简单，因此它简化了架构复杂度，并减轻运维及部署工作。 </span><br><span class="line"></span><br><span class="line">## Nacos配置管理</span><br><span class="line"></span><br><span class="line">### 发布配置 </span><br><span class="line"></span><br><span class="line">首先在nacos发布配置，nacos-config-test服务从nacos读取配置。</span><br><span class="line"></span><br><span class="line">浏览器访问 http:&#x2F;&#x2F;127.0.0.1:8848&#x2F;nacos ，打开nacos控制台，并点击菜单配置管理-&gt;配置列表：</span><br><span class="line"></span><br><span class="line">在Nacos添加如下的配置：</span><br></pre></td></tr></table></figure>
Namespace: public
Data ID: nacos-config-test.yaml
Group : DEFAULT_GROUP 
配置格式: YAML 
配置内容： 
common:
  name: application1 config
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">![](http:&#x2F;&#x2F;cdn.panyucable.cn&#x2F;zysheep&#x2F;QQ截图20200609144758.png)![](http:&#x2F;&#x2F;cdn.panyucable.cn&#x2F;zysheep&#x2F;QQ截图20200609145151.png)</span><br><span class="line"></span><br><span class="line"> ### 获取配置</span><br><span class="line"></span><br><span class="line">要想从配置中心获取配置添加nacos-confifig的依赖：</span><br></pre></td></tr></table></figure>
&lt;dependency&gt;
 &lt;groupId&gt;com.alibaba.cloud&lt;/groupId&gt;
 &lt;artifactId&gt;spring-cloud-starter-alibaba-nacos-config&lt;/artifactId&gt;
&lt;/dependency&gt;
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">在bootstrap.yml添加配置：</span><br></pre></td></tr></table></figure>
</code></pre></li>
</ol>
<p>spring:<br>  application:<br>    name: nacos-config-test<br>  cloud:<br>    nacos:<br>      config:<br>        server-addr: 127.0.0.1:8848 # 配置中心地址<br>        file-extension: yaml    # application.name和file-extension拼装成Data ID<br>        group: DEFAULT_GROUP</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">&gt; 注意：要使用配置中心就要在bootstrap.yml中来配置，bootstrap.yml配置文件的加载顺序要比application.yml要 优先。 </span><br><span class="line"></span><br><span class="line">在nacos-config-test工程的controller中增加获取配置的web访问端点&#x2F;，通过标准的spring @Value 方式</span><br></pre></td></tr></table></figure>
<p>package cn.zysheep.springboot.controller;</p>
<p>import org.springframework.beans.factory.annotation.Autowired;<br>import org.springframework.beans.factory.annotation.Value;<br>import org.springframework.context.ConfigurableApplicationContext;<br>import org.springframework.web.bind.annotation.GetMapping;<br>import org.springframework.web.bind.annotation.RestController;</p>
<p>/**</p>
<ul>
<li><p>@version v1.0</p>
</li>
<li><p>@ProjectName: springboot-learning-examples</p>
</li>
<li><p>@ClassName: IndexController</p>
</li>
<li><p>@Description: TODO(一句话描述该类的功能)</p>
</li>
<li><p>@Author: 三月三</p>
</li>
<li><p>/<br>@RestController<br>public class IndexController {<br>  @Value(“${common.name}”)<br>  private String common_name;</p>
<p>  @GetMapping(“/“)<br>  public String main(){</p>
<pre><code>return common_name;</code></pre><p>  }</p>
</li>
</ul>
<p>}</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">基于上面的例子，若要实现配置的动态更新，只需要进行如下改造：</span><br></pre></td></tr></table></figure>
<p>package cn.zysheep.springboot.controller;</p>
<p>import org.springframework.beans.factory.annotation.Autowired;<br>import org.springframework.beans.factory.annotation.Value;<br>import org.springframework.context.ConfigurableApplicationContext;<br>import org.springframework.web.bind.annotation.GetMapping;<br>import org.springframework.web.bind.annotation.RestController;</p>
<p>/**</p>
<ul>
<li><p>@version v1.0</p>
</li>
<li><p>@ProjectName: springboot-learning-examples</p>
</li>
<li><p>@ClassName: IndexController</p>
</li>
<li><p>@Description: TODO(一句话描述该类的功能)</p>
</li>
<li><p>@Author: 三月三</p>
</li>
<li><p>/<br>@RestController<br>public class IndexController {</p>
<p>  @Value(“${common.name}”)<br>  private String common_name;</p>
<p>  // 注入配置文件上下文,实现配置的动态更新<br>  @Autowired<br>  private ConfigurableApplicationContext applicationContext;</p>
</li>
</ul>
<pre><code>@GetMapping(&quot;/&quot;)
public String main(){
    return common_name;
}

//实现配置的动态更新
@GetMapping(&quot;/dynamicUpdate&quot;)
public String main1(){
    return applicationContext.getEnvironment().getProperty(&quot;common.name&quot;);
}</code></pre><p>}</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">我们通过nacos控制台更新common.name的配置值，再次访问web端点&#x2F;dynamicUpdate，发现应用程序能够获取到最新 的配置值，说明&#96;spring-cloud-starter-alibaba-nacos-confifig &#96;支持配置的动态更新。 </span><br><span class="line"></span><br><span class="line">### 配置管理模型</span><br><span class="line"></span><br><span class="line">&gt; 对于Nacos配置管理，通过Namespace、group、Data ID能够定位到一个配置集。 </span><br><span class="line"></span><br><span class="line">**配置集(Data ID) :**在系统中，一个配置文件通常就是一个配置集，一个配置集可以包含了系统的各种配置信息，例如，一个配置集可 能包含了数据源、线程池、日志级别等配置项。每个配置集都可以定义一个有意义的名称，就是配置集的ID即Data ID。</span><br><span class="line"></span><br><span class="line">**配置项 :**配置集中包含的一个个配置内容就是配置项。它代表一个具体的可配置的参数与其值域，通常以 key&#x3D;value 的形 式存在。例如我们常配置系统的日志输出级别（logLevel&#x3D;INFO|WARN|ERROR） 就是一个配置项</span><br><span class="line"></span><br><span class="line">**配置分组(Group):**配置分组是对配置集进行分组，通过一个有意义的字符串（如 Buy 或 Trade ）来表示，不同的配置分组下可以有 相同的配置集（Data ID）。当您在 Nacos 上创建一个配置时，如果未填写配置分组的名称，则配置分组的名称默 认采用 DEFAULT_GROUP 。配置分组的常见场景：可用于区分不同的项目或应用，例如：学生管理系统的配置集 可以定义一个group为：STUDENT_GROUP。 </span><br><span class="line"></span><br><span class="line">**命名空间(Namespace):**命名空间（namespace）可用于进行不同环境的配置隔离。例如可以隔离开发环境、测试环境和生产环境，因为 它们的配置可能各不相同，或者是隔离不同的用户，不同的开发人员使用同一个nacos管理各自的配置，可通过namespace隔离。不同的命名空间下，可以存在相同名称的配置分组(Group) 或 配置集。  </span><br><span class="line"></span><br><span class="line">获取某配置集的代码：</span><br><span class="line"></span><br><span class="line">1. nacos服务地址，必须指定 </span><br><span class="line">2. namespace，如不指定默认public </span><br><span class="line">3. group，如不指定默认 DEFAULT_GROUP </span><br><span class="line">4. dataId，必须指定，名称为应用名称+配置文件扩展名</span><br></pre></td></tr></table></figure>
<p>spring:<br>  application:<br>    name: nacos-ext-config<br>  cloud:<br>    nacos:<br>      config:<br>        server-addr: 127.0.0.1:8848 # 配置中心地址<br>        file-extension: yaml<br>        namespace: fbbcbf8a-5d5f-45fc-9074-9b96677c1adb  # 开发环境dev<br>        group: DEFAULT_GROUP    </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">##  自定义扩展的 Data Id 配置</span><br><span class="line"></span><br><span class="line">### ext-confifig扩展配置 </span><br><span class="line"></span><br><span class="line"> Spring Cloud Alibaba Nacos Confifig可支持自定义 Data Id 的配置。 一个完整的配置案例如下所示：</span><br></pre></td></tr></table></figure>
<p>spring:<br>  application:<br>    name: nacos-ext-config<br>  cloud:<br>    nacos:<br>      config:<br>        server-addr: 127.0.0.1:8848 # 配置中心地址<br>        file-extension: yaml<br>        namespace: fbbcbf8a-5d5f-45fc-9074-9b96677c1adb  # 开发环境dev<br>        group: DEFAULT_GROUP<br>        # config external configuration<br>        # Data Id<br>        # group：组名<br>        #refresh：动态刷新<br>        ext-config[0]:<br>          data-id: ext-config-common01.yaml<br>          group: COMMON_GROUP<br>          refresh: true<br>        ext-config[1]:<br>          data-id: ext-config-common02.yaml<br>          group: COMMON_GROUP<br>          refresh: true<br>        # 其中 n 的值越大，优先级越高。 通过内部相关规则(应用名、扩展名 )自动生成相关的 Data Id 配置的优先级最大。<br>        # 相同的配置优先级大的会覆盖低优先级的配置,没有,就会互补配置</p>
<p>```</p>
<p>可以看到: </p>
<ul>
<li>通过 <code>spring.cloud.nacos.config.ext-config[n].data-id</code> 的配置方式来支持多个 Data Id 的配置。 </li>
<li>通过 <code>spring.cloud.nacos.config.ext-config[n].group</code> 的配置方式自定义 Data Id 所在的组，不明确配置 的话，默认是 DEFAULT_GROUP。 </li>
<li>通过 <code>spring.cloud.nacos.config.ext-config[n].refresh</code>的配置方式来控制该 Data Id 在配置变更时，是 否支持应用中可动态刷新， 感知到最新的配置值。默认是不支持的。 </li>
</ul>
<blockquote>
<p>Note ： <code>spring.cloud.nacos.config.ext-config[n].data-id</code>的值必须带文件扩展名，文件扩展名既可支持 properties，又可以支持 yaml/yml。 此时<code>spring.cloud.nacos.config.file-extension</code> 的配置对自定义扩 展配置的 Data Id 文件扩展名没有影响。 </p>
</blockquote>
<h3 id="扩展配置优先级"><a href="#扩展配置优先级" class="headerlink" title="扩展配置优先级"></a>扩展配置优先级</h3><blockquote>
<p>扩展配置优先级是 <code>spring.cloud.nacos.config.ext-config[n].data-id</code> 其中 n 的值越大，优先级越高。 通过内部相关规则(应用名、扩展名 )自动生成相关的 Data Id 配置的优先级最大。 </p>
</blockquote>
<h1 id="总结-1"><a href="#总结-1" class="headerlink" title="总结"></a>总结</h1><p>Nacos用来干什么？ </p>
<blockquote>
<p>Nacos是阿里巴巴公司开源的项目，它用来实现配置中心和服务注册中心。 </p>
</blockquote>
<p>什么是服务发现？ </p>
<blockquote>
<p>在微服务架构中一个业务流程需要多个微服务通过网络接口调用完成业务处理，服务消费方从服务注册中心获取服 务提供方的地址，从而进行远程调用，这个过程叫做服务发现。</p>
</blockquote>
<p>服务发现的流程是什么?</p>
<blockquote>
<ol>
<li>服务发现的客户端从服务注册中心获取服务列表 </li>
<li>服务消费方通过客户端负载均衡获取服务实例地址，进行远程调用</li>
</ol>
</blockquote>
<p>什么是配置中心？ </p>
<blockquote>
<p>在微服务架构中为了统一管理各各微服务的配置信息专门设置配置中心，配置中心就是一种统一管理各种应用配置 的基础服务组件</p>
</blockquote>
<p>配置中心的应用流程是什么？ </p>
<blockquote>
<ol>
<li>发布配置，将配置信息发布到配置中心。</li>
<li>获取配置，配置中心客户端得到配置中心的通知，从配置中心获取配置</li>
</ol>
</blockquote>
<p>Spring Cloud是什么？ </p>
<blockquote>
<p>Spring Cloud是一套微服务开发框架集合，包括微服务开发的方方页面，Spring Cloud是一套微服务开发的标准， 集成了很多优秀的开源框架，比如有名的Netflflix公司的众多项目。 </p>
</blockquote>
<p>Spring Cloud Alibaba是什么？ </p>
<blockquote>
<p> Spring Cloud Alibaba是阿里巴巴公司基于Spring Cloud标准实现一套微服务开发框架集合，它和Netflflix一样都是 Spring Cloud微服务开发实现方案。 </p>
</blockquote>
<p>Dubbo服务开发流程是什么？</p>
<blockquote>
<ol>
<li>定义api工程。<ul>
<li>方便其它服务原来api工程，远程调用dubbo服务。</li>
</ul>
</li>
<li>定义api实现工程<ul>
<li>service实现类使用 @org.apache.dubbo.confifig.annotation.Service注解标记为dubbo服务</li>
</ul>
</li>
<li>服务消费方开发<ul>
<li>引入api工程依赖 </li>
<li>使用org.apache.dubbo.confifig.annotation.Reference注解注入service，发起远程调用</li>
</ul>
</li>
</ol>
</blockquote>
</div><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="mailto:undefined">三月三</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="https://zysheep.cn/2020/03/05/Spring/Spring%20Boot%202.2.2/SpringBoot%E4%B8%8Enacos/">https://zysheep.cn/2020/03/05/Spring/Spring Boot 2.2.2/SpringBoot与nacos/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://zysheep.cn" target="_blank">三月三</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/Spring/">Spring</a><a class="post-meta__tags" href="/tags/Spring-Boot2-2-2/">Spring Boot2.2.2</a></div><div class="post_share"><div class="social-share" data-image="http://cdn.panyucable.cn/zysheep/2010x1125.jfif" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css"/><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js"></script></div></div><div class="post-reward"><a class="reward-button button--primary button--animated"> <i class="fa fa-qrcode"></i> 打赏<div class="reward-main"><ul class="reward-all"><li class="reward-item"><img class="post-qr-code__img" src="https://cdn.jsdelivr.net/gh/zysheep/picgo-imgs/imgwechat.png" alt="微信"/><div class="post-qr-code__desc">微信</div></li><li class="reward-item"><img class="post-qr-code__img" src="https://cdn.jsdelivr.net/gh/zysheep/picgo-imgs/imgalipay.jpg" alt="支付寶"/><div class="post-qr-code__desc">支付寶</div></li></ul></div></a></div><nav class="pagination_post" id="pagination"><div class="prev-post pull_left"><a href="/2020/03/05/Linux/Linux%E5%AE%89%E8%A3%85Nginx/"><img class="prev_cover" src="http://cdn.panyucable.cn/zysheep/unbunto.jfif" onerror="onerror=null;src='/img/404.jpg'"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">Linux安装Nginx</div></div></a></div><div class="next-post pull_right"><a href="/2020/03/05/Vue/Vue.js/"><img class="next_cover" src="http://cdn.panyucable.cn/zysheep/vue_cover_logo.png" onerror="onerror=null;src='/img/404.jpg'"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">Vue.js入门宝典</div></div></a></div></nav><div class="relatedPosts"><div class="relatedPosts_headline"><i class="fa fa-fw fa-thumbs-up" aria-hidden="true"></i><span> 相关推荐</span></div><div class="relatedPosts_list"><div class="relatedPosts_item"><a href="/2020/04/08/Spring/SpringBoot后端接口规范/" title="SpringBoot后端接口规范"><img class="relatedPosts_cover" src="http://cdn.panyucable.cn/zysheep/spring-framework-logo.png"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="fa fa-calendar fa-fw" aria-hidden="true"></i> 2020-04-08</div><div class="relatedPosts_title">SpringBoot后端接口规范</div></div></a></div><div class="relatedPosts_item"><a href="/2020/04/01/Spring/Spring Boot 2.2.2/SpringBoot-h2/" title="SpringBoot整合H2"><img class="relatedPosts_cover" src="http://cdn.panyucable.cn/zysheep/1652x1101.jfif"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="fa fa-calendar fa-fw" aria-hidden="true"></i> 2020-04-01</div><div class="relatedPosts_title">SpringBoot整合H2</div></div></a></div><div class="relatedPosts_item"><a href="/2020/03/03/Spring/Spring Boot 2.2.2/SpringBoot-Jpa/" title="SpringBoot整合JPA"><img class="relatedPosts_cover" src="http://cdn.panyucable.cn/zysheep/springboot_cover_JPA_1.png"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="fa fa-calendar fa-fw" aria-hidden="true"></i> 2020-03-03</div><div class="relatedPosts_title">SpringBoot整合JPA</div></div></a></div><div class="relatedPosts_item"><a href="/2020/03/03/Spring/Spring Boot 2.2.2/SpringBoot-MongoDB/" title="SpringBoot整合MongDB"><img class="relatedPosts_cover" src="http://cdn.panyucable.cn/zysheep/springboot_cover_mongodb.png"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="fa fa-calendar fa-fw" aria-hidden="true"></i> 2020-03-03</div><div class="relatedPosts_title">SpringBoot整合MongDB</div></div></a></div><div class="relatedPosts_item"><a href="/2020/03/03/Spring/Spring Boot 2.2.2/SpringBoot-Mybatis-xml/" title="SpringBoot整合Mybatis-XML版"><img class="relatedPosts_cover" src="http://cdn.panyucable.cn/zysheep/springboot_cover_mybaits.png"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="fa fa-calendar fa-fw" aria-hidden="true"></i> 2020-03-03</div><div class="relatedPosts_title">SpringBoot整合Mybatis-XML版</div></div></a></div><div class="relatedPosts_item"><a href="/2020/03/03/Spring/Spring Boot 2.2.2/SpringBoot-Lombok/" title="SpringBoot集成Lombok"><img class="relatedPosts_cover" src="http://cdn.panyucable.cn/zysheep/springboot_cover_lombok_1.png"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="fa fa-calendar fa-fw" aria-hidden="true"></i> 2020-03-03</div><div class="relatedPosts_title">SpringBoot集成Lombok</div></div></a></div></div><div class="clear_both"></div></div><hr><div id="post-comment"><div class="comment_headling"><i class="fa fa-comments fa-fw" aria-hidden="true"></i><span> 评论</span></div><div id="gitalk-container"></div><script>var gitalk = new Gitalk({
  clientID: '502b8308721b081071a5',
  clientSecret: '35220d15c7f8aaf585d6822cf5d49fedf5b602d6',
  repo: 'blog-comment',
  owner: 'zysheep',
  admin: ['zysheep'],
  id: md5(decodeURI(location.pathname)),
  language: 'zh-CN',
  perPage: 10,
  distractionFreeMode: false,
  pagerDirection: 'last',
  createIssueManually: false,
  updateCountCallback: commentCount
})
gitalk.render('gitalk-container')

function commentCount(n){
  try {
    document.getElementsByClassName('gitalk-comment-count')[0].innerHTML= n
  } catch (e) {
    return false
  }
}</script></div></article></main><footer id="footer" style="background-image: url(http://cdn.panyucable.cn/zysheep/springboot_top_nacos.png)" data-type="photo"><div id="footer-wrap"><div class="copyright">&copy;2019 - 2020 By 三月三</div><div class="footer_custom_text">生活不只是眼前的苟且,还有诗和远方</div></div></footer></div><section class="rightside" id="rightside"><div id="rightside-config-hide"><i class="fa fa-book" id="readmode" title="阅读模式"></i><i class="fa fa-plus" id="font_plus" title="放大字体"></i><i class="fa fa-minus" id="font_minus" title="缩小字体"></i><a class="translate_chn_to_cht" id="translateLink" href="javascript:translatePage();" title="简繁转换" target="_self">繁</a><i class="darkmode fa fa-moon-o" id="darkmode" title="夜间模式"></i></div><div id="rightside-config-show"><div id="rightside_config" title="设置"><i class="fa fa-cog" aria-hidden="true"></i></div><a id="to_comment" href="#post-comment" title="直达评论"><i class="scroll_to_comment fa fa-comments">  </i></a><i class="fa fa-list-ul close" id="mobile-toc-button" title="目录" aria-hidden="true"></i><i class="fa fa-arrow-up" id="go-up" title="回到顶部" aria-hidden="true"></i></div></section><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.jsdelivr.net/npm/medium-zoom/dist/medium-zoom.min.js"></script><script src="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.js"></script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script src="/js/third-party/click_heart.js"></script><script src="https://cdn.jsdelivr.net/gh/sviptzk/HexoStaticFile@master/Hexo/js/hideCategory.min.js"></script><script>var endLoading = function () {
  document.body.style.overflow = 'auto';
  document.getElementById('loading-box').classList.add("loaded")
}
window.addEventListener('load',endLoading)</script></body></html>